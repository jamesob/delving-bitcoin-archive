{
  "id": 539,
  "name": "Matthew Zipkin",
  "username": "pinheadmz",
  "avatar_template": "/user_avatar/delvingbitcoin.org/pinheadmz/{size}/115_2.png",
  "created_at": "2023-12-01T16:46:53.686Z",
  "cooked": "<p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://delvingbitcoin.org/uploads/default/original/1X/dea94dfbfa35a5c610297b99734c7f3bbbf3b439.jpeg\" data-download-href=\"https://delvingbitcoin.org/uploads/default/dea94dfbfa35a5c610297b99734c7f3bbbf3b439\" title=\"Screen Shot 2023-12-01 at 11.38.00 AM\"><img src=\"https://delvingbitcoin.org/uploads/default/optimized/1X/dea94dfbfa35a5c610297b99734c7f3bbbf3b439_2_690x306.jpeg\" alt=\"Screen Shot 2023-12-01 at 11.38.00 AM\" data-base62-sha1=\"vLKJnwZDrP2f5EDbnCTCSKk4zUZ\" width=\"690\" height=\"306\" srcset=\"https://delvingbitcoin.org/uploads/default/optimized/1X/dea94dfbfa35a5c610297b99734c7f3bbbf3b439_2_690x306.jpeg, https://delvingbitcoin.org/uploads/default/optimized/1X/dea94dfbfa35a5c610297b99734c7f3bbbf3b439_2_1035x459.jpeg 1.5x, https://delvingbitcoin.org/uploads/default/optimized/1X/dea94dfbfa35a5c610297b99734c7f3bbbf3b439_2_1380x612.jpeg 2x\" data-dominant-color=\"1E1F21\"><div class=\"meta\"><svg class=\"fa d-icon d-icon-far-image svg-icon\" aria-hidden=\"true\"><use href=\"#far-image\"></use></svg><span class=\"filename\">Screen Shot 2023-12-01 at 11.38.00 AM</span><span class=\"informations\">1920\u00d7852 107 KB</span><svg class=\"fa d-icon d-icon-discourse-expand svg-icon\" aria-hidden=\"true\"><use href=\"#discourse-expand\"></use></svg></div></a></div></p>\n<p>node 0: <code>3c00d1496f (mzumsande/202308_increase_block_relay)</code> with Amiti\u2019s <code>getpeermemoryinfo</code> rebased on top</p>\n<p>node 1: <code>1a8d64d23f (HEAD, amitiuttarwar/peer-memory)</code> i.e. <em>just</em> the <code>getpeermemoryinfo</code> feature</p>\n<p>The network graph includes 248 additional v25.1 nodes that all connect to each other, then all attempt to create both full AND block-relay-only connections to both test nodes. The test nodes fill up with full connections and then get topped off by block-relay-only connections to hit their max.</p>\n<p>node 0 ends up with 181 total inbounds, node 1 ends up with 114. The difference includes 65 block-relay-only connections.</p>\n<p>The network activity generator can be seen <a href=\"https://github.com/pinheadmz/warnet/blob/2f4ae7f9278a7544e67620ab84f98385d554e061/src/scenarios/block_relay.py#L56\">here</a>. Random transactions from random nodes to random nodes, followed by a block generated by a random node. We can see in the bottom left chart that mempool size over time between the two test nodes is about the same.</p>\n<p>The total network bandwidth sent and received is also about the same for both nodes.</p>\n<p>Memory usage as reported by <code>getpeermemoryinfo</code> shows a linear increase with the number of extra peers node 0 has. I took a snapshot of that RPC from both nodes and totaled up the results:</p>\n<h2><a name=\"node-0-maxconn200-1\" class=\"anchor\" href=\"#node-0-maxconn200-1\"></a>node 0 (maxconn=200)</h2>\n<pre><code class=\"lang-auto\">cnode_withtx: 692958\npeer_withtx: 66040528\ncnode_notx: 391598\npeer_notx: 148256\nnotx_count: 73\nwithtx_count: 121\n</code></pre>\n<p>Which gives us about 5300 <code>CNode</code> bytes and about 2000 <code>Peer</code> bytes per block-relay-only connection.</p>\n<h2><a name=\"node-1-control-2\" class=\"anchor\" href=\"#node-1-control-2\"></a>node 1 (control)</h2>\n<pre><code class=\"lang-auto\">cnode_withtx: 660826\npeer_withtx: 62619008\ncnode_notx: 47742\npeer_notx: 8944\nnotx_count: 9\nwithtx_count: 115\n</code></pre>\n<p>Which gives us about 5300 <code>CNode</code> bytes and about 1000 <code>Peer</code> bytes per block-relay-only connection.</p>\n<p>So it may be notable that the memory used by <code>Peer</code> (per peer) in the the test node is 2x that of the control\u2026?</p>\n<p>I\u2019m excited to try out different types of activity or even attacks on these test nodes!</p>",
  "post_number": 1,
  "post_type": 1,
  "updated_at": "2023-12-01T16:46:53.686Z",
  "reply_count": 0,
  "reply_to_post_number": null,
  "quote_count": 0,
  "incoming_link_count": 1,
  "reads": 9,
  "readers_count": 8,
  "score": 81.8,
  "yours": false,
  "topic_id": 232,
  "topic_slug": "warnet-simulations",
  "topic_title": "Warnet simulations",
  "topic_html_title": "Warnet simulations",
  "category_id": 10,
  "display_username": "Matthew Zipkin",
  "primary_group_name": null,
  "flair_name": null,
  "flair_url": null,
  "flair_bg_color": null,
  "flair_color": null,
  "flair_group_id": null,
  "version": 1,
  "can_edit": false,
  "can_delete": false,
  "can_recover": false,
  "can_see_hidden_post": false,
  "can_wiki": false,
  "user_title": null,
  "bookmarked": false,
  "raw": "![Screen Shot 2023-12-01 at 11.38.00 AM|690x306](upload://vLKJnwZDrP2f5EDbnCTCSKk4zUZ.jpeg)\n\n\nnode 0: `3c00d1496f (mzumsande/202308_increase_block_relay)` with Amiti's `getpeermemoryinfo` rebased on top\n\nnode 1: `1a8d64d23f (HEAD, amitiuttarwar/peer-memory)` i.e. *just* the `getpeermemoryinfo` feature\n\nThe network graph includes 248 additional v25.1 nodes that all connect to each other, then all attempt to create both full AND block-relay-only connections to both test nodes. The test nodes fill up with full connections and then get topped off by block-relay-only connections to hit their max.\n\nnode 0 ends up with 181 total inbounds, node 1 ends up with 114. The difference includes 65 block-relay-only connections.\n\nThe network activity generator can be seen [here](https://github.com/pinheadmz/warnet/blob/2f4ae7f9278a7544e67620ab84f98385d554e061/src/scenarios/block_relay.py#L56). Random transactions from random nodes to random nodes, followed by a block generated by a random node. We can see in the bottom left chart that mempool size over time between the two test nodes is about the same.\n\nThe total network bandwidth sent and received is also about the same for both nodes.\n\nMemory usage as reported by `getpeermemoryinfo` shows a linear increase with the number of extra peers node 0 has. I took a snapshot of that RPC from both nodes and totaled up the results:\n\n## node 0 (maxconn=200)\n```\ncnode_withtx: 692958\npeer_withtx: 66040528\ncnode_notx: 391598\npeer_notx: 148256\nnotx_count: 73\nwithtx_count: 121\n```\n\nWhich gives us about 5300 `CNode` bytes and about 2000 `Peer` bytes per block-relay-only connection.\n\n## node 1 (control)\n```\ncnode_withtx: 660826\npeer_withtx: 62619008\ncnode_notx: 47742\npeer_notx: 8944\nnotx_count: 9\nwithtx_count: 115\n```\n\nWhich gives us about 5300 `CNode` bytes and about 1000 `Peer` bytes per block-relay-only connection.\n\nSo it may be notable that the memory used by `Peer` (per peer) in the the test node is 2x that of the control...?\n\nI'm excited to try out different types of activity or even attacks on these test nodes!",
  "actions_summary": [
    {
      "id": 2,
      "count": 5
    }
  ],
  "moderator": false,
  "admin": false,
  "staff": false,
  "group_moderator": true,
  "user_id": 120,
  "hidden": false,
  "trust_level": 3,
  "deleted_at": null,
  "user_deleted": false,
  "edit_reason": null,
  "can_view_edit_history": true,
  "wiki": false,
  "reactions": [
    {
      "id": "+1",
      "type": "emoji",
      "count": 5
    }
  ],
  "current_user_reaction": null,
  "reaction_users_count": 5,
  "current_user_used_main_reaction": false
}