{
  "id": 682,
  "name": "Matt Morehouse",
  "username": "morehouse",
  "avatar_template": "/letter_avatar_proxy/v4/letter/m/df705f/{size}.png",
  "created_at": "2023-12-07T18:49:52.328Z",
  "cooked": "<aside class=\"quote no-group quote-modified\" data-username=\"morehouse\" data-post=\"1\" data-topic=\"264\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://delvingbitcoin.org/letter_avatar_proxy/v4/letter/m/df705f/48.png\" class=\"avatar\"> morehouse:</div>\n<blockquote>\n<h2>v3 transactions</h2>\n<p>\u2026</p>\n<h3>Downsides</h3>\n<p>Even with v3 transactions, double spending can incur a limited RBF penalty fee. If Mallory engages in repeated witness inflation attacks against Bob, she can force him to consistently pay higher-than-normal fees to double-spend his griefed UTXOs.</p>\n</blockquote>\n</aside>\n<p>From a <a href=\"https://github.com/lightning/bolts/pull/851#issuecomment-1845650132\" rel=\"noopener nofollow ugc\">GitHub discusssion</a> about liquidity griefing against v3 transactions:</p>\n<aside class=\"quote no-group\" data-username=\"morehouse\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://delvingbitcoin.org/letter_avatar_proxy/v4/letter/m/df705f/48.png\" class=\"avatar\"> morehouse:</div>\n<blockquote>\n<p>I did a little math to see what a typical griefing might cost an LSP.</p>\n<p>Some recent mempool feerates:</p>\n<ul>\n<li>Minimum relay: 10 sat/vB</li>\n<li>1 week confirmation: 20 sat/vB</li>\n<li>6 hour confirmation: 80 sat/vB</li>\n</ul>\n<p>Let\u2019s say we use 80 sat/vB for a funding transaction and the LSP\u2019s portion of the transaction is 250 vB, so they allocate <code>80 * 250 = 20,000 sat</code> for the transaction fee.  Let\u2019s say the total transaction is 500 vB, so the total fee for the transaction is 40,000 sat.</p>\n<p>The attacker inflates their witnesses to reduce the feerate to 10 sat/vB and also chains a 1,000 vB descendant transaction (the max allowed by v3 policy) with a fee of 10,000 sat (10 sat/vB).  This package is unlikely to confirm for a very long time.</p>\n<p>If the LSP wishes to double-spend their griefed UTXOs, they must now spend <code>40,000 + 10,000 = 50,000 sat</code>.  If they use another 500 vB dual-funded transaction to double spend, the required feerate for that transaction would be <code>50,000 sat / 500 vB = 100 sat/vB</code>  This is 25% more than the expected current feerate.</p>\n<p>Suppose further that the attacker is doing repeated griefing and this new dual-funded transaction is actually with another node controlled by the attacker.  The attacker can grief this transaction as well, causing the double-spend fee to increase to <code>50,000 + 10,000 = 60,000 sat</code> (120 sat/vB).  And so on.</p>\n</blockquote>\n</aside>\n<aside class=\"quote no-group\" data-username=\"t-bast\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://delvingbitcoin.org/user_avatar/delvingbitcoin.org/t-bast/48/98_2.png\" class=\"avatar\"> t-bast:</div>\n<blockquote>\n<p>Nice work! But this pinning attack does not reliably work though, so I believe it\u2019s not the end of the world. To be able to effectively lower the feerate of the funding transaction, the attacker needs to have low-feerate ancestors. But since those ancestors are low-feerate, they will be dropped from a fraction of the network\u2019s mempools, which will allow an honest transaction at the normal feerate to go through (because in those mempools, that honest transaction isn\u2019t a double-spend, the conflicting transactions have been evicted). That\u2019s what <a href=\"https://github.com/TheBlueMatt\" rel=\"noopener nofollow ugc\">@TheBlueMatt</a> mentioned a few times, that in practice today, based on his experiments, even low-ish feerate transactions are still able to propagate and confirm.</p>\n</blockquote>\n</aside>",
  "post_number": 4,
  "post_type": 1,
  "updated_at": "2023-12-07T19:12:45.205Z",
  "reply_count": 2,
  "reply_to_post_number": null,
  "quote_count": 1,
  "incoming_link_count": 0,
  "reads": 12,
  "readers_count": 11,
  "score": 72.4,
  "yours": false,
  "topic_id": 264,
  "topic_slug": "liquidity-griefing-in-multi-party-transaction-protocols",
  "topic_title": "Liquidity griefing in multi-party transaction protocols",
  "topic_html_title": "Liquidity griefing in multi-party transaction protocols",
  "category_id": 7,
  "display_username": "Matt Morehouse",
  "primary_group_name": null,
  "flair_name": null,
  "flair_url": null,
  "flair_bg_color": null,
  "flair_color": null,
  "flair_group_id": null,
  "version": 1,
  "can_edit": false,
  "can_delete": false,
  "can_recover": false,
  "can_see_hidden_post": false,
  "can_wiki": false,
  "user_title": null,
  "bookmarked": false,
  "raw": "\n[quote=\"morehouse, post:1, topic:264\"]\n## v3 transactions\n...\n### Downsides\n\nEven with v3 transactions, double spending can incur a limited RBF penalty fee. If Mallory engages in repeated witness inflation attacks against Bob, she can force him to consistently pay higher-than-normal fees to double-spend his griefed UTXOs.\n[/quote]\n\nFrom a [GitHub discusssion](https://github.com/lightning/bolts/pull/851#issuecomment-1845650132) about liquidity griefing against v3 transactions:\n\n[quote=\"morehouse\"]\nI did a little math to see what a typical griefing might cost an LSP.\n\nSome recent mempool feerates:\n\n- Minimum relay: 10 sat/vB\n- 1 week confirmation: 20 sat/vB\n- 6 hour confirmation: 80 sat/vB\n\nLet's say we use 80 sat/vB for a funding transaction and the LSP's portion of the transaction is 250 vB, so they allocate `80 * 250 = 20,000 sat` for the transaction fee.  Let's say the total transaction is 500 vB, so the total fee for the transaction is 40,000 sat.\n\nThe attacker inflates their witnesses to reduce the feerate to 10 sat/vB and also chains a 1,000 vB descendant transaction (the max allowed by v3 policy) with a fee of 10,000 sat (10 sat/vB).  This package is unlikely to confirm for a very long time.\n\nIf the LSP wishes to double-spend their griefed UTXOs, they must now spend `40,000 + 10,000 = 50,000 sat`.  If they use another 500 vB dual-funded transaction to double spend, the required feerate for that transaction would be `50,000 sat / 500 vB = 100 sat/vB`  This is 25% more than the expected current feerate.\n\nSuppose further that the attacker is doing repeated griefing and this new dual-funded transaction is actually with another node controlled by the attacker.  The attacker can grief this transaction as well, causing the double-spend fee to increase to `50,000 + 10,000 = 60,000 sat` (120 sat/vB).  And so on.\n[/quote]\n\n[quote=\"t-bast\"]\nNice work! But this pinning attack does not reliably work though, so I believe it's not the end of the world. To be able to effectively lower the feerate of the funding transaction, the attacker needs to have low-feerate ancestors. But since those ancestors are low-feerate, they will be dropped from a fraction of the network's mempools, which will allow an honest transaction at the normal feerate to go through (because in those mempools, that honest transaction isn't a double-spend, the conflicting transactions have been evicted). That's what [@TheBlueMatt](https://github.com/TheBlueMatt) mentioned a few times, that in practice today, based on his experiments, even low-ish feerate transactions are still able to propagate and confirm.\n[/quote]",
  "actions_summary": [
    {
      "id": 2,
      "count": 1
    }
  ],
  "moderator": false,
  "admin": false,
  "staff": false,
  "user_id": 47,
  "hidden": false,
  "trust_level": 0,
  "deleted_at": null,
  "user_deleted": false,
  "edit_reason": null,
  "can_view_edit_history": true,
  "wiki": false,
  "reactions": [
    {
      "id": "+1",
      "type": "emoji",
      "count": 1
    }
  ],
  "current_user_reaction": null,
  "reaction_users_count": 1,
  "current_user_used_main_reaction": false
}