{
  "id": 725,
  "name": "Gregory Sanders",
  "username": "instagibbs",
  "avatar_template": "/user_avatar/delvingbitcoin.org/instagibbs/{size}/28_2.png",
  "created_at": "2023-12-13T14:40:09.686Z",
  "cooked": "<p>Noting up front that these scenarios are what I\u2019m calling \u201ccross-sponsor\u201d RBF, where the funding tx is sponsoring on package, then switches over to sponsor another parent. Typical example for a wallet would be they\u2019re CPFPing something with a nice sized utxo, then another package becomes higher priority and they want to switch.</p>\n<aside class=\"quote no-group\" data-username=\"sdaftuar\" data-post=\"23\" data-topic=\"156\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://delvingbitcoin.org/letter_avatar_proxy/v4/letter/s/0ea827/48.png\" class=\"avatar\"> sdaftuar:</div>\n<blockquote>\n<p>Issue 1: The feerate diagram might not improve using the rules described in <span class=\"hashtag-raw\">#28984</span>.</p>\n</blockquote>\n</aside>\n<p>I don\u2019t think it should be shocking miner scores isn\u2019t strictly improving the mempool. I\u2019m also unconvinced it\u2019s worth stalling out limited package rbf given the current state of the art, which is substantially worse.</p>\n<p>At the risk of re-adding a pin, changing the heuristic to:</p>\n<ol>\n<li>for all direct conflicts, package feerate must exceed direct conflict\u2019s feerate</li>\n<li>for all conflicts(direct or indirect), package feerate must exceed ancestor feerate of conflict</li>\n</ol>\n<p>may be something to double-check.</p>\n<p>This is what <a href=\"https://github.com/bitcoin/bitcoin/pull/25038\">https://github.com/bitcoin/bitcoin/pull/25038</a> had essentially implemented, which means the specific cross-sponsor RBF becomes relatively impractical.</p>\n<p>Example test case for this using this \u201cold\u201d heuristic:\n</p><aside class=\"onebox githubpullrequest\" data-onebox-src=\"https://github.com/bitcoin/bitcoin/pull/26403/files#diff-d18bbdec91d0f4825b512a31f34666b000c7b7e2e05a3d43570c4b971532616fR366\">\n  <header class=\"source\">\n\n      <a href=\"https://github.com/bitcoin/bitcoin/pull/26403/files#diff-d18bbdec91d0f4825b512a31f34666b000c7b7e2e05a3d43570c4b971532616fR366\" target=\"_blank\" rel=\"noopener\">github.com/bitcoin/bitcoin</a>\n  </header>\n\n  <article class=\"onebox-body\">\n    <div class=\"github-row\">\n\n\n\n    <div class=\"github-icon-container\" title=\"Pull Request\">\n      <svg width=\"60\" height=\"60\" class=\"github-icon\" viewBox=\"0 0 12 16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M11 11.28V5c-.03-.78-.34-1.47-.94-2.06C9.46 2.35 8.78 2.03 8 2H7V0L4 3l3 3V4h1c.27.02.48.11.69.31.21.2.3.42.31.69v6.28A1.993 1.993 0 0 0 10 15a1.993 1.993 0 0 0 1-3.72zm-1 2.92c-.66 0-1.2-.55-1.2-1.2 0-.65.55-1.2 1.2-1.2.65 0 1.2.55 1.2 1.2 0 .65-.55 1.2-1.2 1.2zM4 3c0-1.11-.89-2-2-2a1.993 1.993 0 0 0-1 3.72v6.56A1.993 1.993 0 0 0 2 15a1.993 1.993 0 0 0 1-3.72V4.72c.59-.34 1-.98 1-1.72zm-.8 10c0 .66-.55 1.2-1.2 1.2-.65 0-1.2-.55-1.2-1.2 0-.65.55-1.2 1.2-1.2.65 0 1.2.55 1.2 1.2zM2 4.2C1.34 4.2.8 3.65.8 3c0-.65.55-1.2 1.2-1.2.65 0 1.2.55 1.2 1.2 0 .65-.55 1.2-1.2 1.2z\"></path></svg>\n    </div>\n\n  <div class=\"github-info-container\">\n\n\n\n      <h4>\n        <a href=\"https://github.com/bitcoin/bitcoin/pull/26403/files#diff-d18bbdec91d0f4825b512a31f34666b000c7b7e2e05a3d43570c4b971532616fR366\" target=\"_blank\" rel=\"noopener\">policy: Ephemeral anchors</a>\n      </h4>\n\n    <div class=\"branches\">\n      <code>bitcoin:master</code> \u2190 <code>instagibbs:ephemeral-anchors</code>\n    </div>\n\n      <div class=\"github-info\">\n        <div class=\"date\">\n          opened <span class=\"discourse-local-date\" data-format=\"ll\" data-date=\"2022-10-27\" data-time=\"20:14:15\" data-timezone=\"UTC\">08:14PM - 27 Oct 22 UTC</span>\n        </div>\n\n        <div class=\"user\">\n          <a href=\"https://github.com/instagibbs\" target=\"_blank\" rel=\"noopener\">\n            <img alt=\"instagibbs\" src=\"https://delvingbitcoin.org/uploads/default/original/1X/2a9af978b4b1874fb9823afcc01cf7153cbd894a.png\" class=\"onebox-avatar-inline\" width=\"20\" height=\"20\" data-dominant-color=\"CDE7E0\">\n            instagibbs\n          </a>\n        </div>\n\n        <div class=\"lines\" title=\"37 commits changed 52 files with 2482 additions and 229 deletions\">\n          <a href=\"https://github.com/bitcoin/bitcoin/pull/26403/files\" target=\"_blank\" rel=\"noopener\">\n            <span class=\"added\">+2482</span>\n            <span class=\"removed\">-229</span>\n          </a>\n        </div>\n      </div>\n  </div>\n</div>\n\n  <div class=\"github-row\">\n    <p class=\"github-body-container\">TODO:\n\nI'll be updating to segwit variant soon, with updated BIP text.\n\n----<span class=\"show-more-container\"><a href=\"https://github.com/bitcoin/bitcoin/pull/26403\" target=\"_blank\" rel=\"noopener\" class=\"show-more\">\u2026</a></span><span class=\"excerpt hidden\">-\n\nBuilds on top of https://github.com/bitcoin/bitcoin/pull/25038 for consideration of inclusion to the proposal. Requires V3, for simplicity of reasoning and usage. Implementation of idea written out at https://lists.linuxfoundation.org/pipermail/bitcoin-dev/2022-October/021036.html\n\nBIP text here: https://github.com/instagibbs/bips/blob/ephemeral_anchor/bip-ephemeralanchors.mediawiki</span></p>\n  </div>\n\n  </article>\n\n  <div class=\"onebox-metadata\">\n    \n    \n  </div>\n\n  <div style=\"clear: both\"></div>\n</aside>\n\n<aside class=\"quote no-group\" data-username=\"sdaftuar\" data-post=\"23\" data-topic=\"156\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://delvingbitcoin.org/letter_avatar_proxy/v4/letter/s/0ea827/48.png\" class=\"avatar\"> sdaftuar:</div>\n<blockquote>\n<p>Issue 2: The rules proposed in <span class=\"hashtag-raw\">#28984</span> might be satisfied when validating a package (A, B), but might fail to successfully relay if A is valid in a peer\u2019s mempool and then B is evaluated using legacy RBF rules (as a singleton RBF).</p>\n</blockquote>\n</aside>\n<p>Gloria and I had this exact discussion prior: <a href=\"https://github.com/bitcoin/bitcoin/pull/25038/files#r1038334153\" class=\"inline-onebox\">policy: nVersion=3 and Package RBF by glozow \u00b7 Pull Request #25038 \u00b7 bitcoin/bitcoin \u00b7 GitHub</a></p>\n<p>Wallet authors can avoid this in a fairly simple manner, by not \u201ccross-sponsoring\u201d. If they do, make it a 0-fee parent package via v3/ephemeral anchors, but note that if a counter-party has already sponsored the package, cross-sponsoring will still be disallowed since parent will still be in the mempool. Post-cluster mempool this issue goes away (except the mild pinning as you note in issue 3?)</p>\n<p>Don\u2019t have anything intelligible to say about issue 3 yet other than it\u2019s interesting!</p>",
  "post_number": 24,
  "post_type": 1,
  "updated_at": "2023-12-13T14:43:21.343Z",
  "reply_count": 0,
  "reply_to_post_number": null,
  "quote_count": 1,
  "incoming_link_count": 0,
  "reads": 4,
  "readers_count": 3,
  "score": 0.4,
  "yours": false,
  "topic_id": 156,
  "topic_slug": "cluster-mempool-rbf-thoughts",
  "topic_title": "Cluster Mempool RBF Thoughts",
  "topic_html_title": "Cluster Mempool RBF Thoughts",
  "category_id": 9,
  "display_username": "Gregory Sanders",
  "primary_group_name": null,
  "flair_name": null,
  "flair_url": null,
  "flair_bg_color": null,
  "flair_color": null,
  "flair_group_id": null,
  "version": 1,
  "can_edit": false,
  "can_delete": false,
  "can_recover": false,
  "can_see_hidden_post": false,
  "can_wiki": false,
  "user_title": null,
  "bookmarked": false,
  "raw": "Noting up front that these scenarios are what I'm calling \"cross-sponsor\" RBF, where the funding tx is sponsoring on package, then switches over to sponsor another parent. Typical example for a wallet would be they're CPFPing something with a nice sized utxo, then another package becomes higher priority and they want to switch.\n\n[quote=\"sdaftuar, post:23, topic:156\"]\nIssue 1: The feerate diagram might not improve using the rules described in #28984.\n[/quote]\n\nI don't think it should be shocking miner scores isn't strictly improving the mempool. I'm also unconvinced it's worth stalling out limited package rbf given the current state of the art, which is substantially worse. \n\nAt the risk of re-adding a pin, changing the heuristic to:\n1) for all direct conflicts, package feerate must exceed direct conflict's feerate\n2) for all conflicts(direct or indirect), package feerate must exceed ancestor feerate of conflict\n\nmay be something to double-check.\n\nThis is what https://github.com/bitcoin/bitcoin/pull/25038 had essentially implemented, which means the specific cross-sponsor RBF becomes relatively impractical.\n\nExample test case for this using this \"old\" heuristic:\nhttps://github.com/bitcoin/bitcoin/pull/26403/files#diff-d18bbdec91d0f4825b512a31f34666b000c7b7e2e05a3d43570c4b971532616fR366\n\n[quote=\"sdaftuar, post:23, topic:156\"]\nIssue 2: The rules proposed in #28984 might be satisfied when validating a package (A, B), but might fail to successfully relay if A is valid in a peer\u2019s mempool and then B is evaluated using legacy RBF rules (as a singleton RBF).\n[/quote]\n\nGloria and I had this exact discussion prior: https://github.com/bitcoin/bitcoin/pull/25038/files#r1038334153\n\nWallet authors can avoid this in a fairly simple manner, by not \"cross-sponsoring\". If they do, make it a 0-fee parent package via v3/ephemeral anchors, but note that if a counter-party has already sponsored the package, cross-sponsoring will still be disallowed since parent will still be in the mempool. Post-cluster mempool this issue goes away (except the mild pinning as you note in issue 3?)\n\nDon't have anything intelligible to say about issue 3 yet other than it's interesting!",
  "actions_summary": [],
  "moderator": false,
  "admin": false,
  "staff": false,
  "user_id": 31,
  "hidden": false,
  "trust_level": 3,
  "deleted_at": null,
  "user_deleted": false,
  "edit_reason": null,
  "can_view_edit_history": true,
  "wiki": false,
  "reactions": [],
  "current_user_reaction": null,
  "reaction_users_count": 0,
  "current_user_used_main_reaction": false
}