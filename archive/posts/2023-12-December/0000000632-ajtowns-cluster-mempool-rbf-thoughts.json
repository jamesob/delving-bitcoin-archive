{
  "id": 632,
  "name": "Anthony Towns",
  "username": "ajtowns",
  "avatar_template": "/user_avatar/delvingbitcoin.org/ajtowns/{size}/3_2.png",
  "created_at": "2023-12-05T22:33:58.113Z",
  "cooked": "<p>You get the same thing if Pn had previously been CPFPed for by different transactions Xn (C2 conflicts with each Xn due to spending the same output of Pn):</p>\n<pre data-code-height=\"147\" data-code-wrap=\"mermaid\"><code class=\"lang-mermaid\">graph TD\n    P1[P1..P10] --&gt; C1\n    P11 --&gt; X11\n    P12 --&gt; X12\n    Pn[P13..P99] -.-&gt; Xn[X13..X99]\n</code></pre>\n<p>replaced by</p>\n<pre data-code-height=\"147\" data-code-wrap=\"mermaid\"><code class=\"lang-mermaid\">graph TD\n    Pa[P1..P30] --&gt; C2\n    P31 --&gt; X31\n    P32 --&gt; X32\n    Pn[P33..P99]-.-&gt; Xn[X33..X99]\n</code></pre>\n<p>then have C2 and X31\u2026X50 replaced by C3:</p>\n<pre data-code-height=\"147\" data-code-wrap=\"mermaid\"><code class=\"lang-mermaid\">graph TD\n    Pa[P1..P50] --&gt; C3\n    P51 --&gt; X51\n    P52 --&gt; X52\n    Pn[P53..P99]-.-&gt; Xn[X53..X99]\n</code></pre>\n<p>where C2 conflicts with C1, X11\u2026X30; C3 conflicts with C1, C2, X11\u2026X50. Then you hit 2a and 2b if they\u2019re below 40 when you go C1 to C3, but not if you got C1 then C2 then C3 (assuming you have C1, P1\u202699, X1\u202699 in your mempool initially).</p>\n<p>I think as far as linearisation goes, the issue is you need to:</p>\n<ol>\n<li>create a diagram for the relevant clusters from original mempool: easy, <span class=\"math\">O(n\\cdot \\log(c))</span> where <span class=\"math\">c</span> is number of clusters, <span class=\"math\">n</span> is number of txs in the clusters</li>\n<li>create a diagram for the post RBF mempool:\n<ul>\n<li>keep all the old clusters; removing any conflicts. don\u2019t worry if they\u2019ll end up splitting</li>\n<li>create a new cluster for the new tx(s); move all related txs from all clusters</li>\n<li>linearise this new cluster</li>\n<li>combine what\u2019s left from the old clusters and the new cluster into a single diagram</li>\n<li>compare it</li>\n</ul>\n</li>\n</ol>\n<p>So I\u2019d only count that as \u201c1\u201d linearisation, though you\u2019d probably want to re-linearise all the old clusters you touched after you\u2019ve decided to accept the RBF before you update the mempool?</p>",
  "post_number": 18,
  "post_type": 1,
  "updated_at": "2023-12-05T22:34:37.696Z",
  "reply_count": 1,
  "reply_to_post_number": 17,
  "quote_count": 0,
  "incoming_link_count": 0,
  "reads": 4,
  "readers_count": 3,
  "score": 5.6,
  "yours": false,
  "topic_id": 156,
  "topic_slug": "cluster-mempool-rbf-thoughts",
  "topic_title": "Cluster Mempool RBF Thoughts",
  "topic_html_title": "Cluster Mempool RBF Thoughts",
  "category_id": 9,
  "display_username": "Anthony Towns",
  "primary_group_name": null,
  "flair_name": null,
  "flair_url": null,
  "flair_bg_color": null,
  "flair_color": null,
  "flair_group_id": null,
  "version": 1,
  "can_edit": false,
  "can_delete": false,
  "can_recover": false,
  "can_see_hidden_post": false,
  "can_wiki": false,
  "user_title": null,
  "reply_to_user": {
    "username": "sdaftuar",
    "name": "Suhas Daftuar",
    "avatar_template": "/letter_avatar_proxy/v4/letter/s/0ea827/{size}.png"
  },
  "bookmarked": false,
  "raw": "You get the same thing if Pn had previously been CPFPed for by different transactions Xn (C2 conflicts with each Xn due to spending the same output of Pn):\n\n```mermaid height=147,auto\ngraph TD\n    P1[P1..P10] --> C1\n    P11 --> X11\n    P12 --> X12\n    Pn[P13..P99] -.-> Xn[X13..X99]\n```\n\nreplaced by\n\n```mermaid height=147,auto\ngraph TD\n    Pa[P1..P30] --> C2\n    P31 --> X31\n    P32 --> X32\n    Pn[P33..P99]-.-> Xn[X33..X99]\n```\n\nthen have C2 and X31..X50 replaced by C3:\n\n```mermaid height=147,auto\ngraph TD\n    Pa[P1..P50] --> C3\n    P51 --> X51\n    P52 --> X52\n    Pn[P53..P99]-.-> Xn[X53..X99]\n```\n\nwhere C2 conflicts with C1, X11..X30; C3 conflicts with C1, C2, X11..X50. Then you hit 2a and 2b if they're below 40 when you go C1 to C3, but not if you got C1 then C2 then C3 (assuming you have C1, P1..99, X1..99 in your mempool initially).\n\nI think as far as linearisation goes, the issue is you need to:\n\n 1. create a diagram for the relevant clusters from original mempool: easy, $O(n\\cdot \\log(c))$ where $c$ is number of clusters, $n$ is number of txs in the clusters\n 2. create a diagram for the post RBF mempool:\n     * keep all the old clusters; removing any conflicts. don't worry if they'll end up splitting\n     * create a new cluster for the new tx(s); move all related txs from all clusters\n     * linearise this new cluster\n     * combine what's left from the old clusters and the new cluster into a single diagram\n     * compare it\n\nSo I'd only count that as \"1\" linearisation, though you'd probably want to re-linearise all the old clusters you touched after you've decided to accept the RBF before you update the mempool?",
  "actions_summary": [],
  "moderator": true,
  "admin": true,
  "staff": true,
  "user_id": 3,
  "hidden": false,
  "trust_level": 4,
  "deleted_at": null,
  "user_deleted": false,
  "edit_reason": null,
  "can_view_edit_history": true,
  "wiki": false,
  "reactions": [],
  "current_user_reaction": null,
  "reaction_users_count": 0,
  "current_user_used_main_reaction": false
}