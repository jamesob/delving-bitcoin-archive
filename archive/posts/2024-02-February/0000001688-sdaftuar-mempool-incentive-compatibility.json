{
  "id": 1688,
  "name": "Suhas Daftuar",
  "username": "sdaftuar",
  "avatar_template": "/letter_avatar_proxy/v4/letter/s/0ea827/{size}.png",
  "created_at": "2024-02-24T11:18:37.781Z",
  "cooked": "<p><a class=\"mention\" href=\"/u/rustyrussell\">@rustyrussell</a>\nSorry for the transaction size typo; I corrected my earlier post and added a footnote mentioning the error. With that correction made, do you still find the example objectionable?</p>\n<p>My RBF policy suggestion is that we should allow a replacement transaction to evict some set of conflicts if:</p>\n<ul>\n<li>the feerate diagram of the resulting mempool is strictly better, and</li>\n<li>the total fees in the mempool go up by at least the min relay fee times the size of the new transaction</li>\n</ul>\n<p>I\u2019ll call this the \u201cFeerate Diagram Policy\u201d.</p>\n<p>I think you\u2019ve suggested an alternate RBF policy that would allow a replacement transaction to evict some set of conflicts if:</p>\n<ul>\n<li>the new transactions would all appear in the next block, and</li>\n<li>none of the conflicting transactions would have appeared in the next block</li>\n</ul>\n<p>Let\u2019s call this the \u201cNext Block Policy\u201d.</p>\n<p>Here\u2019s how I\u2019d summarize these two policies:</p>\n<div class=\"md-table\">\n<table>\n<thead>\n<tr>\n<th>Policy</th>\n<th>Prevents incentive incompatible replacements?</th>\n<th>Rejects some incentive compatible replacements?</th>\n<th>Is DoS resistant?</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Feerate Diagram Policy</td>\n<td>Yes</td>\n<td>Probably</td>\n<td>Yes</td>\n</tr>\n<tr>\n<td>Next Block Policy</td>\n<td>No</td>\n<td>Yes/Probably<sup class=\"footnote-ref\"><a href=\"#footnote-1688-1\" id=\"footnote-ref-1688-1\">[1]</a></sup></td>\n<td>No</td>\n</tr>\n</tbody>\n</table>\n</div><p>Is there any entry in this table that you\u2019d disagree with?</p>\n<p>The Next Block Policy seems to land in a region that we should avoid, namely of failing to guarantee incentive compatibility while also opening up the network to DoS (the example I gave in the OP shows a DoS vector that is possible when total fees are allowed to drop, which is relevant here).</p>\n<p>My immediate proposal \u2013 part of the cluster mempool design \u2013 is that we switch our RBF acceptance rules to follow the Feerate Diagram Policy I described above (the rationale for which is laid out in the OP).  This by itself doesn\u2019t \u201csolve\u201d the pinning issues that occur when low-feerate children are attached to transactions, but for all the reasons I\u2019ve laid out we don\u2019t currently have even an incentive compatibility framework that allows us to know under what circumstances allowing total fees to drop might be okay, let alone a DoS-resistant mechanism for doing so.</p>\n<p>Instead, I think relay rules like the v3 relay policy (<a href=\"https://delvingbitcoin.org/t/v3-transaction-policy-for-anti-pinning/340\" class=\"inline-onebox\">V3 transaction policy for anti-pinning</a>) are our best bet to mitigate pinning vectors for the foreseeable future.</p>\n<p>And in the long-run, maybe someone can come up with an anti-DoS design that works better on an open network than what we\u2019ve come up with so far, and if that is coupled with a better understanding of what is incentive compatible, then maybe there will be room for alternate pinning solutions\u2026?  (I don\u2019t think anyone should count on this being invented anytime soon!)</p>\n<hr class=\"footnotes-sep\">\n\n<ol class=\"footnotes-list\">\n<li id=\"footnote-1688-1\" class=\"footnote-item\"><p>I don\u2019t know if the Next Block Policy proposal would also layer on the Feerate Diagram Policy when considering replacements that wouldn\u2019t touch the top block; if so then the answer here should be \u201cmaybe\u201d.  But if the Next Block Policy always rejected replacements that would be further down in the mempool because the new transaction is not in the top block, then I\u2019d argue that it would definitely miss replacements that are incentive compatible, and hence the entry should be \u201cYes\u201d. <a href=\"#footnote-ref-1688-1\" class=\"footnote-backref\">\u21a9\ufe0e</a></p>\n</li>\n</ol>",
  "post_number": 14,
  "post_type": 1,
  "updated_at": "2024-02-24T11:18:37.781Z",
  "reply_count": 0,
  "reply_to_post_number": 9,
  "quote_count": 0,
  "incoming_link_count": 1,
  "reads": 6,
  "readers_count": 5,
  "score": 6.2,
  "yours": false,
  "topic_id": 553,
  "topic_slug": "mempool-incentive-compatibility",
  "topic_title": "Mempool Incentive Compatibility",
  "topic_html_title": "Mempool Incentive Compatibility",
  "category_id": 7,
  "display_username": "Suhas Daftuar",
  "primary_group_name": null,
  "flair_name": null,
  "flair_url": null,
  "flair_bg_color": null,
  "flair_color": null,
  "flair_group_id": null,
  "version": 1,
  "can_edit": false,
  "can_delete": false,
  "can_recover": false,
  "can_see_hidden_post": false,
  "can_wiki": false,
  "user_title": null,
  "reply_to_user": {
    "username": "rustyrussell",
    "name": "Rusty Russell",
    "avatar_template": "/user_avatar/delvingbitcoin.org/rustyrussell/{size}/154_2.png"
  },
  "bookmarked": false,
  "raw": "@rustyrussell \nSorry for the transaction size typo; I corrected my earlier post and added a footnote mentioning the error. With that correction made, do you still find the example objectionable?\n\nMy RBF policy suggestion is that we should allow a replacement transaction to evict some set of conflicts if:\n* the feerate diagram of the resulting mempool is strictly better, and \n* the total fees in the mempool go up by at least the min relay fee times the size of the new transaction\n\nI'll call this the \"Feerate Diagram Policy\".\n\nI think you've suggested an alternate RBF policy that would allow a replacement transaction to evict some set of conflicts if:\n* the new transactions would all appear in the next block, and\n* none of the conflicting transactions would have appeared in the next block\n\nLet's call this the \"Next Block Policy\". \n\nHere's how I'd summarize these two policies:\n\n|Policy | Prevents incentive incompatible replacements? | Rejects some incentive compatible replacements? | Is DoS resistant?|\n|--- | --- | --- | ---|\r\n|Feerate Diagram Policy | Yes | Probably | Yes|\r\n|Next Block Policy | No | Yes/Probably[^rejects] | No|\r\n\nIs there any entry in this table that you'd disagree with?  \n\nThe Next Block Policy seems to land in a region that we should avoid, namely of failing to guarantee incentive compatibility while also opening up the network to DoS (the example I gave in the OP shows a DoS vector that is possible when total fees are allowed to drop, which is relevant here).\n\nMy immediate proposal -- part of the cluster mempool design -- is that we switch our RBF acceptance rules to follow the Feerate Diagram Policy I described above (the rationale for which is laid out in the OP).  This by itself doesn't \"solve\" the pinning issues that occur when low-feerate children are attached to transactions, but for all the reasons I've laid out we don't currently have even an incentive compatibility framework that allows us to know under what circumstances allowing total fees to drop might be okay, let alone a DoS-resistant mechanism for doing so.\n\nInstead, I think relay rules like the v3 relay policy (https://delvingbitcoin.org/t/v3-transaction-policy-for-anti-pinning/340) are our best bet to mitigate pinning vectors for the foreseeable future.\n\nAnd in the long-run, maybe someone can come up with an anti-DoS design that works better on an open network than what we've come up with so far, and if that is coupled with a better understanding of what is incentive compatible, then maybe there will be room for alternate pinning solutions...?  (I don't think anyone should count on this being invented anytime soon!)\n\n[^rejects]: I don't know if the Next Block Policy proposal would also layer on the Feerate Diagram Policy when considering replacements that wouldn't touch the top block; if so then the answer here should be \"maybe\".  But if the Next Block Policy always rejected replacements that would be further down in the mempool because the new transaction is not in the top block, then I'd argue that it would definitely miss replacements that are incentive compatible, and hence the entry should be \"Yes\".",
  "actions_summary": [],
  "moderator": false,
  "admin": false,
  "staff": false,
  "user_id": 95,
  "hidden": false,
  "trust_level": 3,
  "deleted_at": null,
  "user_deleted": false,
  "edit_reason": null,
  "can_view_edit_history": true,
  "wiki": false,
  "reactions": [],
  "current_user_reaction": null,
  "reaction_users_count": 0,
  "current_user_used_main_reaction": false
}