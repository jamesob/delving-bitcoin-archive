{
  "id": 6256,
  "name": "Antoine Poinsot",
  "username": "AntoineP",
  "avatar_template": "/user_avatar/delvingbitcoin.org/antoinep/{size}/483_2.png",
  "created_at": "2025-11-17T14:13:24.965Z",
  "cooked": "<p>A few months ago i posted a <a href=\"https://delvingbitcoin.org/t/where-does-the-33-33-threshold-for-selfish-mining-come-from/1757\">detailed analysis of Selfish Mining</a>. \u201cSelfish\u201d Mining is a strategy\nwhereby a sufficiently large minority miner can maximize its revenues by selectively publishing\nblocks. While it\u2019s interesting to consider what is the optimal strategy a miner could adopt in this\nsimplified model, i think it\u2019s primarily interesting in demonstrating the considerable extent to\nwhich longer block propagation times advantage larger miners. Following up on this, i looked into how propagation time affects a miner\u2019s revenue as a function of its hashrate.</p>\n<p>In order to make this tractable, let\u2019s consider a simplified model whereby all propagation time is uniform and all miners are using the\nregular mining strategy (when a block is found, start mining on top of it immediately, publish it\nimmediately, switch to mine on a valid chain with more PoW as soon as it\u2019s received). Essentially a star\nnetwork topology whereby the Bitcoin p2p network serves as the hub:</p>\n<p><img src=\"https://delvingbitcoin.org/uploads/default/original/2X/d/dde750552f81080c62031fb55d3d1712de6a727a.gif\" alt=\"miners_star_network\" data-base62-sha1=\"vF36J4wJxC3QPqGoj0g134vFNdE\" width=\"690\" height=\"388\" class=\"animated\"></p>\n<p>In these conditions, if propagation time was instant a miner\u2019s revenue would be proportional to the\nshare of the network hashrate it controls. Because it\u2019s not, there is always a chance that a miner\u2019s\nblock goes stale because it enters a race with another miner\u2019s competing block which it ends up losing.</p>\n<p>In our model with uniform block propagation time <span class=\"math\">s</span> seconds, there is two situations in which a miner\u2019s block may go stale:</p>\n<ol>\n<li>Another miner found a block <span class=\"math\">s_b</span> seconds (<span class=\"math\">0 \\lt s_b \\lt s</span>) before we did. All other miners\nreceive the competing miner\u2019s block first and start mining on top of it (or on a competing block of their own). Any of these miners then finds a second block on top.</li>\n<li>Another miner finds a block <span class=\"math\">s_a</span> seconds (<span class=\"math\">0 \\lt s_a \\lt s</span>) after we did. It immediately\nstarts mining on top of it. Then the following block is also found by this same miner. Note how there\nmay be more than one such miner competing against our block.</li>\n</ol>\n<p>That a competing miner finds a second block does not technically guarantee to resolve the race, as a non-competing miner could also find a second block (before receiving the competing miner\u2019s) and prolong the race. This probability decreases exponentially with the size of the fork. In this simplified analysis, we will assume that a competing miner finding a second block always lead to them winning the race.</p>\n<p>Let\u2019s call the first event <span class=\"math\">Before</span> and the second one <span class=\"math\">After</span>. For a given miner that just found a block, the probability that this block ends up stale is the probability that either of these two events happens. From this definition, it seems clear that the probability of <span class=\"math\">Before</span> is higher than that of <span class=\"math\">After</span>. Could it mean that miners care more about hearing others\u2019 blocks faster than they care about publishing their own blocks faster? It also seems that the probability of <span class=\"math\">After</span> largely increases with mining centralization: one miner controlling 40% of the hashrate has a higher chance of finding two blocks in a row than 40 miners controlling 1% of the hashrate do. Finally, the probability of both events clearly decreases as a miner\u2019s hashrate grows. But by how much?</p>\n<p>We\u2019ll analyze the probability of <span class=\"math\">Before</span> first. It\u2019s worth pointing that one other miner finding a block <span class=\"math\">s_b</span> seconds before we do does not necessarily mean all other miners are mining on top of this competing miner\u2019s block. It may be that some of them found a block before receiving it, and mine on top of their own. And it may be that the competing miner\u2019s block is itself racing a previous block. But in all those cases, the rest of the network would be mining on top of a different block than that of the initial miner being studied. And this is all that matters to estimate the probability its block goes stale.</p>\n<p>Given a miner controlling a share <span class=\"math\">h</span> of the network\u2019s hashrate, the probability that the rest of the network had found a block at most <span class=\"math\">s</span> seconds before it did is <span class=\"math\">1 - \\exp( -\\frac{(1 - h) \\cdot s}{600} )</span> <sup class=\"footnote-ref\"><a href=\"#footnote-6256-1\" id=\"footnote-ref-6256-1\">[1]</a></sup>. Independently, the probability that the next block (whenever it arrives) is found by the rest of the network is <span class=\"math\">1 - h</span>. We\u2019ve established that if another miner had found a block <span class=\"math\">s</span> seconds or less before, then all the rest of the network mines on top of a block different from the block just found by this miner. Therefore the probability of event <span class=\"math\">Before</span> for this miner is simply:</p>\n<div class=\"math\">\nP(Before) = (1 - \\exp( -\\frac{(1 - h) \\cdot s}{600} ) ) \\cdot (1 - h)\n</div>\n<p>Now let\u2019s look into the probability of <span class=\"math\">After</span>. The probability that any other miner (possibly more than one) finds a block within the <span class=\"math\">s</span> seconds of our miner finding one, and then the following block (whenever it arrives) is found by this same miner, will necessarily depend on the distribution of the rest of the network\u2019s hashrate. Given such a distribution <span class=\"math\">\\mathbf{H} = (h_1, \\ldots, h_n)</span>, the probability of <span class=\"math\">After</span> for miner <span class=\"math\">i</span> is:</p>\n<div class=\"math\">\nP(After_i) = \\sum_{\\substack{1\\le j\\le |\\mathbf{H}|\\\\ j\\ne i}} (1 - \\exp(-\\frac{h_j \\cdot t}{600})) \\cdot h_j\n</div>\n<p>Given a hashrate distribution similar to <a href=\"https://mainnet.observer/charts/mining-pools-hashrate-distribution\">that of the past 3 months</a>, here is a couple graphs representing the impact of propagation time on mining centralization (source code <a href=\"https://github.com/darosior/miningsimulation/blob/d10b4346cf15eb6cda198414702b64fe685754fa/plot_stale_rate/plot.py\">here</a>).</p>\n<p>First, the stale rate of each pool in function of propagation time:\n<div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://delvingbitcoin.org/uploads/default/original/2X/e/eb34a6e153d7e31fc818be4f3f5338f62eed6d91.png\" data-download-href=\"https://delvingbitcoin.org/uploads/default/eb34a6e153d7e31fc818be4f3f5338f62eed6d91\" title=\"stale_rates\"><img src=\"https://delvingbitcoin.org/uploads/default/optimized/2X/e/eb34a6e153d7e31fc818be4f3f5338f62eed6d91_2_690x358.png\" alt=\"stale_rates\" data-base62-sha1=\"xyJ0ITr0ioEaUNdCVnhlCrviCkx\" width=\"690\" height=\"358\" srcset=\"https://delvingbitcoin.org/uploads/default/optimized/2X/e/eb34a6e153d7e31fc818be4f3f5338f62eed6d91_2_690x358.png, https://delvingbitcoin.org/uploads/default/optimized/2X/e/eb34a6e153d7e31fc818be4f3f5338f62eed6d91_2_1035x537.png 1.5x, https://delvingbitcoin.org/uploads/default/optimized/2X/e/eb34a6e153d7e31fc818be4f3f5338f62eed6d91_2_1380x716.png 2x\" data-dominant-color=\"FDFCFC\"><div class=\"meta\"><svg class=\"fa d-icon d-icon-far-image svg-icon\" aria-hidden=\"true\"><use href=\"#far-image\"></use></svg><span class=\"filename\">stale_rates</span><span class=\"informations\">2560\u00d71331 249 KB</span><svg class=\"fa d-icon d-icon-discourse-expand svg-icon\" aria-hidden=\"true\"><use href=\"#discourse-expand\"></use></svg></div></a></div></p>\n<p>Consequently, the net benefit of each pool in function of propagation time (% change between share of network hashrate and share of blocks found):\n<div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://delvingbitcoin.org/uploads/default/original/2X/3/3c6eb9769be23e2f94e1360631a772f1832995e6.png\" data-download-href=\"https://delvingbitcoin.org/uploads/default/3c6eb9769be23e2f94e1360631a772f1832995e6\" title=\"net_benefits\"><img src=\"https://delvingbitcoin.org/uploads/default/optimized/2X/3/3c6eb9769be23e2f94e1360631a772f1832995e6_2_690x358.png\" alt=\"net_benefits\" data-base62-sha1=\"8CBScOvRA6QE2hF3c0JFp0NAU1o\" width=\"690\" height=\"358\" srcset=\"https://delvingbitcoin.org/uploads/default/optimized/2X/3/3c6eb9769be23e2f94e1360631a772f1832995e6_2_690x358.png, https://delvingbitcoin.org/uploads/default/optimized/2X/3/3c6eb9769be23e2f94e1360631a772f1832995e6_2_1035x537.png 1.5x, https://delvingbitcoin.org/uploads/default/optimized/2X/3/3c6eb9769be23e2f94e1360631a772f1832995e6_2_1380x716.png 2x\" data-dominant-color=\"FDFDFC\"><div class=\"meta\"><svg class=\"fa d-icon d-icon-far-image svg-icon\" aria-hidden=\"true\"><use href=\"#far-image\"></use></svg><span class=\"filename\">net_benefits</span><span class=\"informations\">2560\u00d71331 136 KB</span><svg class=\"fa d-icon d-icon-discourse-expand svg-icon\" aria-hidden=\"true\"><use href=\"#discourse-expand\"></use></svg></div></a></div></p>\n<p>I think it\u2019s important to underline here that even a few basis points translate to material gains. Consider for instance the case of a mining operation controlling 5EH/s (about 0.5% of the <a href=\"https://bitcoin.sipa.be/\">network hashrate</a>) choosing which mining pool to connect to. With an average block reward of 3.16BTC and an average USD/BTC rate of $110k, this operation can expect to generate about $91M in mining revenue over a year. If blocks took 10 seconds to propagate, choosing to mine on the largest pool rather than the smallest one would increase their revenue by $100k.</p>\n<p>To confirm those numbers, i ran my <a href=\"https://github.com/darosior/miningsimulation\">mining simulation</a> configured with a hashrate distribution similar<sup class=\"footnote-ref\"><a href=\"#footnote-6256-2\" id=\"footnote-ref-6256-2\">[2]</a></sup> to that used to generate the graphs, for various uniform block propagation times:</p>\n<details>\n<summary>0 seconds propagation time</summary>\n<pre><code class=\"lang-auto\">Running 32768 simulations in parallel using 16 threads.\n100% progress..\nAfter running 32768 simulations for 365d each, on average:\n  - Miner 0 (30% of network hashrate) found 15779 blocks i.e. 30.0008% of blocks. Stale rate: 3.7317e-05%.\n  - Miner 1 (29% of network hashrate) found 15253 blocks i.e. 28.9996% of blocks. Stale rate: 8.39912e-05%.\n  - Miner 2 (12% of network hashrate) found 6311 blocks i.e. 12.0001% of blocks. Stale rate: 0.00018713%.\n  - Miner 3 (11% of network hashrate) found 5785 blocks i.e. 10.9996% of blocks. Stale rate: 0.000215721%.\n  - Miner 4 (8% of network hashrate) found 4207 blocks i.e. 7.99964% of blocks. Stale rate: 0.000245275%.\n  - Miner 5 (5% of network hashrate) found 2629 blocks i.e. 4.99994% of blocks. Stale rate: 0.00029004%.\n  - Miner 6 (3% of network hashrate) found 1577 blocks i.e. 3.00011% of blocks. Stale rate: 0.00029744%.\n  - Miner 7 (1% of network hashrate) found 525 blocks i.e. 1.00003% of blocks. Stale rate: 0.000308817%.\n  - Miner 8 (1% of network hashrate) found 526 blocks i.e. 1.00016% of blocks. Stale rate: 0.000338637%.\n</code></pre>\n</details>\n<details>\n<summary>5 seconds propagation time</summary>\n<pre><code class=\"lang-auto\">Running 32768 simulations in parallel using 16 threads.\n100% progress..\nAfter running 32768 simulations for 365d each, on average:\n  - Miner 0 (30% of network hashrate) found 15699 blocks i.e. 30.0456% of blocks. Stale rate: 0.506248%.\n  - Miner 1 (29% of network hashrate) found 15172 blocks i.e. 29.037% of blocks. Stale rate: 0.523793%.\n  - Miner 2 (12% of network hashrate) found 6260 blocks i.e. 11.9815% of blocks. Stale rate: 0.811484%.\n  - Miner 3 (11% of network hashrate) found 5738 blocks i.e. 10.9818% of blocks. Stale rate: 0.825946%.\n  - Miner 4 (8% of network hashrate) found 4171 blocks i.e. 7.98334% of blocks. Stale rate: 0.877786%.\n  - Miner 5 (5% of network hashrate) found 2605 blocks i.e. 4.98683% of blocks. Stale rate: 0.928523%.\n  - Miner 6 (3% of network hashrate) found 1562 blocks i.e. 2.99029% of blocks. Stale rate: 0.964853%.\n  - Miner 7 (1% of network hashrate) found 520 blocks i.e. 0.996918% of blocks. Stale rate: 0.997677%.\n  - Miner 8 (1% of network hashrate) found 520 blocks i.e. 0.996714% of blocks. Stale rate: 0.995936%.\n</code></pre>\n</details>\n<details>\n<summary>10 seconds propagation time</summary>\n<pre><code class=\"lang-auto\">Running 32768 simulations in parallel using 16 threads.\n100% progress..\nAfter running 32768 simulations for 365d each, on average:\n  - Miner 0 (30% of network hashrate) found 15620 blocks i.e. 30.0889% of blocks. Stale rate: 1.00885%.\n  - Miner 1 (29% of network hashrate) found 15095 blocks i.e. 29.0779% of blocks. Stale rate: 1.04392%.\n  - Miner 2 (12% of network hashrate) found 6210 blocks i.e. 11.963% of blocks. Stale rate: 1.61943%.\n  - Miner 3 (11% of network hashrate) found 5691 blocks i.e. 10.9634% of blocks. Stale rate: 1.65332%.\n  - Miner 4 (8% of network hashrate) found 4134 blocks i.e. 7.96494% of blocks. Stale rate: 1.75734%.\n  - Miner 5 (5% of network hashrate) found 2581 blocks i.e. 4.97324% of blocks. Stale rate: 1.85906%.\n  - Miner 6 (3% of network hashrate) found 1548 blocks i.e. 2.98236% of blocks. Stale rate: 1.93194%.\n  - Miner 7 (1% of network hashrate) found 515 blocks i.e. 0.993453% of blocks. Stale rate: 2.00014%.\n  - Miner 8 (1% of network hashrate) found 515 blocks i.e. 0.99282% of blocks. Stale rate: 2.00143%.\n</code></pre>\n</details>\n<details>\n<summary>15 seconds propagation time</summary>\n<pre><code class=\"lang-auto\">Running 32768 simulations in parallel using 16 threads.\n100% progress..\nAfter running 32768 simulations for 365d each, on average:\n  - Miner 0 (30% of network hashrate) found 15543 blocks i.e. 30.1333% of blocks. Stale rate: 1.50776%.\n  - Miner 1 (29% of network hashrate) found 15018 blocks i.e. 29.1155% of blocks. Stale rate: 1.55891%.\n  - Miner 2 (12% of network hashrate) found 6162 blocks i.e. 11.9478% of blocks. Stale rate: 2.43205%.\n  - Miner 3 (11% of network hashrate) found 5645 blocks i.e. 10.9445% of blocks. Stale rate: 2.48371%.\n  - Miner 4 (8% of network hashrate) found 4098 blocks i.e. 7.94632% of blocks. Stale rate: 2.64209%.\n  - Miner 5 (5% of network hashrate) found 2558 blocks i.e. 4.96005% of blocks. Stale rate: 2.79304%.\n  - Miner 6 (3% of network hashrate) found 1533 blocks i.e. 2.9729% of blocks. Stale rate: 2.90627%.\n  - Miner 7 (1% of network hashrate) found 510 blocks i.e. 0.990086% of blocks. Stale rate: 3.00608%.\n  - Miner 8 (1% of network hashrate) found 510 blocks i.e. 0.989569% of blocks. Stale rate: 3.01052%.\n</code></pre>\n</details>\n<details>\n<summary>20 seconds propagation time</summary>\n<pre><code class=\"lang-auto\">Running 32768 simulations in parallel using 16 threads.\n100% progress..\nAfter running 32768 simulations for 365d each, on average:\n  - Miner 0 (30% of network hashrate) found 15469 blocks i.e. 30.1808% of blocks. Stale rate: 2.002%.\n  - Miner 1 (29% of network hashrate) found 14943 blocks i.e. 29.154% of blocks. Stale rate: 2.07079%.\n  - Miner 2 (12% of network hashrate) found 6113 blocks i.e. 11.9273% of blocks. Stale rate: 3.24164%.\n  - Miner 3 (11% of network hashrate) found 5600 blocks i.e. 10.9257% of blocks. Stale rate: 3.31431%.\n  - Miner 4 (8% of network hashrate) found 4064 blocks i.e. 7.92956% of blocks. Stale rate: 3.52448%.\n  - Miner 5 (5% of network hashrate) found 2535 blocks i.e. 4.94618% of blocks. Stale rate: 3.7338%.\n  - Miner 6 (3% of network hashrate) found 1519 blocks i.e. 2.9636% of blocks. Stale rate: 3.87825%.\n  - Miner 7 (1% of network hashrate) found 505 blocks i.e. 0.986592% of blocks. Stale rate: 4.02113%.\n  - Miner 8 (1% of network hashrate) found 505 blocks i.e. 0.98618% of blocks. Stale rate: 4.02959%.\n</code></pre>\n</details>\n<p>When considering a change in the P2P network, it is hard to evaluate the impact it would have on the stale rate. This problem can be decomposed in two parts: how the change would likely affect block propagation times, and how the estimated effect on block propagation times would in turn affect the stale rate. I hope this simplified model can give us some insights on the latter.</p>\n<hr class=\"footnotes-sep\">\n\n<ol class=\"footnotes-list\">\n<li id=\"footnote-6256-1\" class=\"footnote-item\"><p>CDF of the <a href=\"https://en.wikipedia.org/wiki/Exponential_distribution\">exponential distribution</a> with mean 600. <a href=\"#footnote-ref-6256-1\" class=\"footnote-backref\">\u21a9\ufe0e</a></p>\n</li>\n<li id=\"footnote-6256-2\" class=\"footnote-item\"><p>My C++ simulation at the moment requires integer values for shares of network hashrate controlled, so the hashrate controlled by the made-up <code>SMALL</code>, <code>VERYSMALL</code> and <code>TINY</code> pools was changed. <a href=\"#footnote-ref-6256-2\" class=\"footnote-backref\">\u21a9\ufe0e</a></p>\n</li>\n</ol>",
  "post_number": 1,
  "post_type": 1,
  "posts_count": 2,
  "updated_at": "2025-11-17T14:18:31.321Z",
  "reply_count": 0,
  "reply_to_post_number": null,
  "quote_count": 0,
  "incoming_link_count": 2,
  "reads": 18,
  "readers_count": 17,
  "score": 43.6,
  "yours": false,
  "topic_id": 2110,
  "topic_slug": "propagation-delay-and-mining-centralization-modeling-stale-rates",
  "topic_title": "Propagation Delay and Mining Centralization: Modeling Stale Rates",
  "topic_html_title": "Propagation Delay and Mining Centralization: Modeling Stale Rates",
  "category_id": 7,
  "display_username": "Antoine Poinsot",
  "primary_group_name": null,
  "flair_name": "wg-consensus-cleanup",
  "flair_url": "/uploads/default/original/1X/856d779f9ec58484f3a96285a21a813538b689f6.png",
  "flair_bg_color": "",
  "flair_color": "",
  "flair_group_id": 43,
  "badges_granted": [],
  "version": 2,
  "can_edit": false,
  "can_delete": false,
  "can_recover": false,
  "can_see_hidden_post": false,
  "can_wiki": false,
  "user_title": "Regular",
  "title_is_group": false,
  "bookmarked": false,
  "raw": "A few months ago i posted a [detailed analysis of Selfish Mining](https://delvingbitcoin.org/t/where-does-the-33-33-threshold-for-selfish-mining-come-from/1757). \"Selfish\" Mining is a strategy\nwhereby a sufficiently large minority miner can maximize its revenues by selectively publishing\nblocks. While it's interesting to consider what is the optimal strategy a miner could adopt in this\nsimplified model, i think it's primarily interesting in demonstrating the considerable extent to\nwhich longer block propagation times advantage larger miners. Following up on this, i looked into how propagation time affects a miner's revenue as a function of its hashrate.\n\nIn order to make this tractable, let's consider a simplified model whereby all propagation time is uniform and all miners are using the\nregular mining strategy (when a block is found, start mining on top of it immediately, publish it\nimmediately, switch to mine on a valid chain with more PoW as soon as it's received). Essentially a star\nnetwork topology whereby the Bitcoin p2p network serves as the hub:\n\n![miners_star_network|690x388, 100%](upload://vF36J4wJxC3QPqGoj0g134vFNdE.gif)\n\nIn these conditions, if propagation time was instant a miner's revenue would be proportional to the\nshare of the network hashrate it controls. Because it's not, there is always a chance that a miner's\nblock goes stale because it enters a race with another miner's competing block which it ends up losing.\n\nIn our model with uniform block propagation time $s$ seconds, there is two situations in which a miner's block may go stale:\n1. Another miner found a block $s_b$ seconds ($0 \\lt s_b \\lt s$) before we did. All other miners\n  receive the competing miner's block first and start mining on top of it (or on a competing block of their own). Any of these miners then finds a second block on top.\n2. Another miner finds a block $s_a$ seconds ($0 \\lt s_a \\lt s$) after we did. It immediately\n  starts mining on top of it. Then the following block is also found by this same miner. Note how there\n  may be more than one such miner competing against our block.\n\nThat a competing miner finds a second block does not technically guarantee to resolve the race, as a non-competing miner could also find a second block (before receiving the competing miner's) and prolong the race. This probability decreases exponentially with the size of the fork. In this simplified analysis, we will assume that a competing miner finding a second block always lead to them winning the race.\n\nLet's call the first event $Before$ and the second one $After$. For a given miner that just found a block, the probability that this block ends up stale is the probability that either of these two events happens. From this definition, it seems clear that the probability of $Before$ is higher than that of $After$. Could it mean that miners care more about hearing others' blocks faster than they care about publishing their own blocks faster? It also seems that the probability of $After$ largely increases with mining centralization: one miner controlling 40% of the hashrate has a higher chance of finding two blocks in a row than 40 miners controlling 1% of the hashrate do. Finally, the probability of both events clearly decreases as a miner's hashrate grows. But by how much?\n\nWe'll analyze the probability of $Before$ first. It's worth pointing that one other miner finding a block $s_b$ seconds before we do does not necessarily mean all other miners are mining on top of this competing miner's block. It may be that some of them found a block before receiving it, and mine on top of their own. And it may be that the competing miner's block is itself racing a previous block. But in all those cases, the rest of the network would be mining on top of a different block than that of the initial miner being studied. And this is all that matters to estimate the probability its block goes stale.\n\nGiven a miner controlling a share $h$ of the network's hashrate, the probability that the rest of the network had found a block at most $s$ seconds before it did is $1 - \\exp( -\\frac{(1 - h) \\cdot s}{600} )$ [^cdf_exp]. Independently, the probability that the next block (whenever it arrives) is found by the rest of the network is $1 - h$. We've established that if another miner had found a block $s$ seconds or less before, then all the rest of the network mines on top of a block different from the block just found by this miner. Therefore the probability of event $Before$ for this miner is simply:\n$$\nP(Before) = (1 - \\exp( -\\frac{(1 - h) \\cdot s}{600} ) ) \\cdot (1 - h)\n$$\n\nNow let's look into the probability of $After$. The probability that any other miner (possibly more than one) finds a block within the $s$ seconds of our miner finding one, and then the following block (whenever it arrives) is found by this same miner, will necessarily depend on the distribution of the rest of the network's hashrate. Given such a distribution $\\mathbf{H} = (h_1, \\ldots, h_n)$, the probability of $After$ for miner $i$ is:\n$$\nP(After_i) = \\sum_{\\substack{1\\le j\\le |\\mathbf{H}|\\\\ j\\ne i}} (1 - \\exp(-\\frac{h_j \\cdot t}{600})) \\cdot h_j\n$$\n\nGiven a hashrate distribution similar to [that of the past 3 months](https://mainnet.observer/charts/mining-pools-hashrate-distribution), here is a couple graphs representing the impact of propagation time on mining centralization (source code [here](https://github.com/darosior/miningsimulation/blob/d10b4346cf15eb6cda198414702b64fe685754fa/plot_stale_rate/plot.py)).\n\nFirst, the stale rate of each pool in function of propagation time:\n![stale_rates|690x358](upload://xyJ0ITr0ioEaUNdCVnhlCrviCkx.png)\n\nConsequently, the net benefit of each pool in function of propagation time (% change between share of network hashrate and share of blocks found):\n![net_benefits|690x358](upload://8CBScOvRA6QE2hF3c0JFp0NAU1o.png)\n\n\nI think it's important to underline here that even a few basis points translate to material gains. Consider for instance the case of a mining operation controlling 5EH/s (about 0.5% of the [network hashrate](https://bitcoin.sipa.be/)) choosing which mining pool to connect to. With an average block reward of 3.16BTC and an average USD/BTC rate of $110k, this operation can expect to generate about $91M in mining revenue over a year. If blocks took 10 seconds to propagate, choosing to mine on the largest pool rather than the smallest one would increase their revenue by $100k.\n\nTo confirm those numbers, i ran my [mining simulation](https://github.com/darosior/miningsimulation) configured with a hashrate distribution similar[^similar_sim] to that used to generate the graphs, for various uniform block propagation times:\n<details>\n<summary>0 seconds propagation time</summary>\n\n```\nRunning 32768 simulations in parallel using 16 threads.\n100% progress..\nAfter running 32768 simulations for 365d each, on average:\n  - Miner 0 (30% of network hashrate) found 15779 blocks i.e. 30.0008% of blocks. Stale rate: 3.7317e-05%.\n  - Miner 1 (29% of network hashrate) found 15253 blocks i.e. 28.9996% of blocks. Stale rate: 8.39912e-05%.\n  - Miner 2 (12% of network hashrate) found 6311 blocks i.e. 12.0001% of blocks. Stale rate: 0.00018713%.\n  - Miner 3 (11% of network hashrate) found 5785 blocks i.e. 10.9996% of blocks. Stale rate: 0.000215721%.\n  - Miner 4 (8% of network hashrate) found 4207 blocks i.e. 7.99964% of blocks. Stale rate: 0.000245275%.\n  - Miner 5 (5% of network hashrate) found 2629 blocks i.e. 4.99994% of blocks. Stale rate: 0.00029004%.\n  - Miner 6 (3% of network hashrate) found 1577 blocks i.e. 3.00011% of blocks. Stale rate: 0.00029744%.\n  - Miner 7 (1% of network hashrate) found 525 blocks i.e. 1.00003% of blocks. Stale rate: 0.000308817%.\n  - Miner 8 (1% of network hashrate) found 526 blocks i.e. 1.00016% of blocks. Stale rate: 0.000338637%.\n```\n\n</details>\n\n<details>\n<summary>5 seconds propagation time</summary>\n\n```\nRunning 32768 simulations in parallel using 16 threads.\n100% progress..\nAfter running 32768 simulations for 365d each, on average:\n  - Miner 0 (30% of network hashrate) found 15699 blocks i.e. 30.0456% of blocks. Stale rate: 0.506248%.\n  - Miner 1 (29% of network hashrate) found 15172 blocks i.e. 29.037% of blocks. Stale rate: 0.523793%.\n  - Miner 2 (12% of network hashrate) found 6260 blocks i.e. 11.9815% of blocks. Stale rate: 0.811484%.\n  - Miner 3 (11% of network hashrate) found 5738 blocks i.e. 10.9818% of blocks. Stale rate: 0.825946%.\n  - Miner 4 (8% of network hashrate) found 4171 blocks i.e. 7.98334% of blocks. Stale rate: 0.877786%.\n  - Miner 5 (5% of network hashrate) found 2605 blocks i.e. 4.98683% of blocks. Stale rate: 0.928523%.\n  - Miner 6 (3% of network hashrate) found 1562 blocks i.e. 2.99029% of blocks. Stale rate: 0.964853%.\n  - Miner 7 (1% of network hashrate) found 520 blocks i.e. 0.996918% of blocks. Stale rate: 0.997677%.\n  - Miner 8 (1% of network hashrate) found 520 blocks i.e. 0.996714% of blocks. Stale rate: 0.995936%.\n```\n\n</details>\n\n<details>\n<summary>10 seconds propagation time</summary>\n\n```\nRunning 32768 simulations in parallel using 16 threads.\n100% progress..\nAfter running 32768 simulations for 365d each, on average:\n  - Miner 0 (30% of network hashrate) found 15620 blocks i.e. 30.0889% of blocks. Stale rate: 1.00885%.\n  - Miner 1 (29% of network hashrate) found 15095 blocks i.e. 29.0779% of blocks. Stale rate: 1.04392%.\n  - Miner 2 (12% of network hashrate) found 6210 blocks i.e. 11.963% of blocks. Stale rate: 1.61943%.\n  - Miner 3 (11% of network hashrate) found 5691 blocks i.e. 10.9634% of blocks. Stale rate: 1.65332%.\n  - Miner 4 (8% of network hashrate) found 4134 blocks i.e. 7.96494% of blocks. Stale rate: 1.75734%.\n  - Miner 5 (5% of network hashrate) found 2581 blocks i.e. 4.97324% of blocks. Stale rate: 1.85906%.\n  - Miner 6 (3% of network hashrate) found 1548 blocks i.e. 2.98236% of blocks. Stale rate: 1.93194%.\n  - Miner 7 (1% of network hashrate) found 515 blocks i.e. 0.993453% of blocks. Stale rate: 2.00014%.\n  - Miner 8 (1% of network hashrate) found 515 blocks i.e. 0.99282% of blocks. Stale rate: 2.00143%.\n```\n\n</details>\n\n<details>\n<summary>15 seconds propagation time</summary>\n\n```\nRunning 32768 simulations in parallel using 16 threads.\n100% progress..\nAfter running 32768 simulations for 365d each, on average:\n  - Miner 0 (30% of network hashrate) found 15543 blocks i.e. 30.1333% of blocks. Stale rate: 1.50776%.\n  - Miner 1 (29% of network hashrate) found 15018 blocks i.e. 29.1155% of blocks. Stale rate: 1.55891%.\n  - Miner 2 (12% of network hashrate) found 6162 blocks i.e. 11.9478% of blocks. Stale rate: 2.43205%.\n  - Miner 3 (11% of network hashrate) found 5645 blocks i.e. 10.9445% of blocks. Stale rate: 2.48371%.\n  - Miner 4 (8% of network hashrate) found 4098 blocks i.e. 7.94632% of blocks. Stale rate: 2.64209%.\n  - Miner 5 (5% of network hashrate) found 2558 blocks i.e. 4.96005% of blocks. Stale rate: 2.79304%.\n  - Miner 6 (3% of network hashrate) found 1533 blocks i.e. 2.9729% of blocks. Stale rate: 2.90627%.\n  - Miner 7 (1% of network hashrate) found 510 blocks i.e. 0.990086% of blocks. Stale rate: 3.00608%.\n  - Miner 8 (1% of network hashrate) found 510 blocks i.e. 0.989569% of blocks. Stale rate: 3.01052%.\n```\n\n</details>\n\n\n<details>\n<summary>20 seconds propagation time</summary>\n\n```\nRunning 32768 simulations in parallel using 16 threads.\n100% progress..\nAfter running 32768 simulations for 365d each, on average:\n  - Miner 0 (30% of network hashrate) found 15469 blocks i.e. 30.1808% of blocks. Stale rate: 2.002%.\n  - Miner 1 (29% of network hashrate) found 14943 blocks i.e. 29.154% of blocks. Stale rate: 2.07079%.\n  - Miner 2 (12% of network hashrate) found 6113 blocks i.e. 11.9273% of blocks. Stale rate: 3.24164%.\n  - Miner 3 (11% of network hashrate) found 5600 blocks i.e. 10.9257% of blocks. Stale rate: 3.31431%.\n  - Miner 4 (8% of network hashrate) found 4064 blocks i.e. 7.92956% of blocks. Stale rate: 3.52448%.\n  - Miner 5 (5% of network hashrate) found 2535 blocks i.e. 4.94618% of blocks. Stale rate: 3.7338%.\n  - Miner 6 (3% of network hashrate) found 1519 blocks i.e. 2.9636% of blocks. Stale rate: 3.87825%.\n  - Miner 7 (1% of network hashrate) found 505 blocks i.e. 0.986592% of blocks. Stale rate: 4.02113%.\n  - Miner 8 (1% of network hashrate) found 505 blocks i.e. 0.98618% of blocks. Stale rate: 4.02959%.\n```\n\n</details>\n\nWhen considering a change in the P2P network, it is hard to evaluate the impact it would have on the stale rate. This problem can be decomposed in two parts: how the change would likely affect block propagation times, and how the estimated effect on block propagation times would in turn affect the stale rate. I hope this simplified model can give us some insights on the latter.\n\n[^cdf_exp]: CDF of the [exponential distribution](https://en.wikipedia.org/wiki/Exponential_distribution) with mean 600.\n[^similar_sim]: My C++ simulation at the moment requires integer values for shares of network hashrate controlled, so the hashrate controlled by the made-up `SMALL`, `VERYSMALL` and `TINY` pools was changed.",
  "actions_summary": [
    {
      "id": 2,
      "count": 2
    }
  ],
  "moderator": false,
  "admin": false,
  "staff": false,
  "user_id": 12,
  "hidden": false,
  "trust_level": 3,
  "deleted_at": null,
  "user_deleted": false,
  "edit_reason": "Github link was replaced with a permanent link",
  "can_view_edit_history": true,
  "wiki": false,
  "excerpt": "A few months ago i posted a <a href=\"https://delvingbitcoin.org/t/where-does-the-33-33-threshold-for-selfish-mining-come-from/1757\">detailed analysis of Selfish Mining</a>. \u201cSelfish\u201d Mining is a strategy\nwhereby a sufficiently large minority miner can maximize its revenues by selectively publishing\nblocks. While it\u2019s interesting to consider what is the optimal strategy a miner could adopt in this\nsimplifi&hellip;",
  "truncated": true,
  "post_url": "/t/propagation-delay-and-mining-centralization-modeling-stale-rates/2110/1",
  "reactions": [
    {
      "id": "+1",
      "type": "emoji",
      "count": 1
    },
    {
      "id": "rocket",
      "type": "emoji",
      "count": 1
    }
  ],
  "current_user_reaction": null,
  "reaction_users_count": 2,
  "current_user_used_main_reaction": false,
  "can_accept_answer": false,
  "can_unaccept_answer": false,
  "accepted_answer": false,
  "topic_accepted_answer": null,
  "can_vote": false
}