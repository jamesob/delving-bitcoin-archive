{
  "id": 6185,
  "name": "/dev/fd0",
  "username": "1440000bytes",
  "avatar_template": "/user_avatar/delvingbitcoin.org/1440000bytes/{size}/301_2.png",
  "created_at": "2025-11-02T02:03:44.143Z",
  "cooked": "<h2><a name=\"p-6185-vulnerability-1\" class=\"anchor\" href=\"#p-6185-vulnerability-1\"></a>Vulnerability</h2>\n<p>The size of preimage was not validated in nutshell versions &lt; 0.18.0. This allows the attacker to fill the mint\u2019s database and disk with arbitrary data.</p>\n<pre data-code-wrap=\"python\"><code class=\"lang-python\">    def _verify_htlc_spending_conditions(\n        self,\n        proof: Proof,\n        secret: HTLCSecret,\n        message_to_sign: Optional[str] = None,\n    ) -&gt; bool:\n\n        htlc_secret = secret\n        # hash lock\n        if not proof.htlcpreimage:\n            raise TransactionError(\"no HTLC preimage provided\")\n        # verify correct preimage (the hashlock) if the locktime hasn't passed\n        now = time.time()\n        if not htlc_secret.locktime or htlc_secret.locktime &gt; now:\n            if not hashlib.sha256(\n                bytes.fromhex(proof.htlcpreimage)\n            ).digest() == bytes.fromhex(htlc_secret.data):\n                raise TransactionError(\"HTLC preimage does not match.\")\n        return True\n</code></pre>\n<p>NUT-14 can be used to create cashu tokens with a preimage and NUT-07 to see the preimage stored by the mint.</p>\n<h2><a name=\"p-6185-proof-of-concept-2\" class=\"anchor\" href=\"#p-6185-proof-of-concept-2\"></a>Proof of Concept</h2>\n<aside class=\"onebox allowlistedgeneric\" data-onebox-src=\"https://uncensoredtech.substack.com/p/denial-of-service-using-htlc-in-cashu\">\n  <header class=\"source\">\n      <img src=\"https://delvingbitcoin.org/uploads/default/original/2X/4/44ba39eefdcc2f8096173414f999159755ccfd7b.png\" class=\"site-icon\" alt=\"\" data-dominant-color=\"FA8D56\" width=\"32\" height=\"32\">\n\n      <a href=\"https://uncensoredtech.substack.com/p/denial-of-service-using-htlc-in-cashu\" target=\"_blank\" rel=\"noopener nofollow ugc\">uncensoredtech.substack.com</a>\n  </header>\n\n  <article class=\"onebox-body\">\n    <div class=\"aspect-image\" style=\"--aspect-ratio:690/461;\"><img src=\"https://delvingbitcoin.org/uploads/default/optimized/2X/b/b0e952d60e2c82a3d97dc4962c1ff4f1bff66a89_2_690x461.jpeg\" class=\"thumbnail\" alt=\"\" data-dominant-color=\"C76531\" width=\"690\" height=\"461\"></div>\n\n<h3><a href=\"https://uncensoredtech.substack.com/p/denial-of-service-using-htlc-in-cashu\" target=\"_blank\" rel=\"noopener nofollow ugc\">Denial of Service using HTLC in Cashu</a></h3>\n\n  <p>Proof of Concept</p>\n\n\n  </article>\n\n  <div class=\"onebox-metadata\">\n    \n    \n  </div>\n\n  <div style=\"clear: both\"></div>\n</aside>\n\n<h2><a name=\"p-6185-fix-3\" class=\"anchor\" href=\"#p-6185-fix-3\"></a>Fix</h2>\n<p>It was fixed by <em>lollerfirs</em>t in <a href=\"https://github.com/cashubtc/nutshell/pull/803\" class=\"inline-onebox\" rel=\"noopener nofollow ugc\">refactor: HTLC spending conditions by lollerfirst \u00b7 Pull Request #803 \u00b7 cashubtc/nutshell \u00b7 GitHub</a></p>\n<h2><a name=\"p-6185-timeline-4\" class=\"anchor\" href=\"#p-6185-timeline-4\"></a>Timeline</h2>\n<p>19 October 2025: I reported the vulnerabillity to <a href=\"mailto:cashu-dev@pm.me\">cashu-dev@pm.me</a><br>\n19 October 2025: Cashu dev team acknowledged it as a serious issue and <a href=\"https://opencash.dev/\" rel=\"noopener nofollow ugc\">opencash</a> rewarded with 100k sats<br>\n21 October 2025: It was fixed in <a href=\"https://github.com/cashubtc/nutshell/commit/f84028ca3f8f0b476f7be8c29b58666f075be2c2\" class=\"inline-onebox\" rel=\"noopener nofollow ugc\">refactor: HTLC spending conditions (#803) \u00b7 cashubtc/nutshell@f84028c \u00b7 GitHub</a><br>\n28 October 2025: v0.18.0 was released with the fix<br>\n29-31 October 2025: I reached out to several mints and requested to update nutshell<br>\n2 November 2025: Public Disclosure</p>\n<h2><a name=\"p-6185-advisory-for-mints-and-users-5\" class=\"anchor\" href=\"#p-6185-advisory-for-mints-and-users-5\"></a>Advisory for mints and users</h2>\n<p>Some mints have still not updated nutshell. They should backup the database and run the mint with v0.18.0. Reach out to Cashu dev team if you experience any issues while updating the mint.</p>\n<p>Users should check the version of the mint with <code>https://&lt;mint_url&gt;/v1/info</code> and stop using the mint if it supports NUT-14 and running nutshell version older than 0.18.0.</p>",
  "post_number": 1,
  "post_type": 1,
  "posts_count": 1,
  "updated_at": "2025-11-02T02:18:31.081Z",
  "reply_count": 0,
  "reply_to_post_number": null,
  "quote_count": 0,
  "incoming_link_count": 98,
  "reads": 5,
  "readers_count": 4,
  "score": 481.0,
  "yours": false,
  "topic_id": 2090,
  "topic_slug": "public-disclosure-denial-of-service-using-htlc-in-cashu",
  "topic_title": "Public Disclosure: Denial of Service using HTLC in Cashu",
  "topic_html_title": "Public Disclosure: Denial of Service using HTLC in Cashu",
  "category_id": 8,
  "display_username": "/dev/fd0",
  "primary_group_name": null,
  "flair_name": null,
  "flair_url": null,
  "flair_bg_color": null,
  "flair_color": null,
  "flair_group_id": null,
  "badges_granted": [],
  "version": 3,
  "can_edit": false,
  "can_delete": false,
  "can_recover": false,
  "can_see_hidden_post": false,
  "can_wiki": false,
  "user_title": null,
  "bookmarked": false,
  "raw": "## Vulnerability\n\nThe size of preimage was not validated in nutshell versions < 0.18.0. This allows the attacker to fill the mint's database and disk with arbitrary data. \n\n```python\n    def _verify_htlc_spending_conditions(\n        self,\n        proof: Proof,\n        secret: HTLCSecret,\n        message_to_sign: Optional[str] = None,\n    ) -> bool:\n\n        htlc_secret = secret\n        # hash lock\n        if not proof.htlcpreimage:\n            raise TransactionError(\"no HTLC preimage provided\")\n        # verify correct preimage (the hashlock) if the locktime hasn't passed\n        now = time.time()\n        if not htlc_secret.locktime or htlc_secret.locktime > now:\n            if not hashlib.sha256(\n                bytes.fromhex(proof.htlcpreimage)\n            ).digest() == bytes.fromhex(htlc_secret.data):\n                raise TransactionError(\"HTLC preimage does not match.\")\n        return True\n```\n\nNUT-14 can be used to create cashu tokens with a preimage and NUT-07 to see the preimage stored by the mint.\n\n## Proof of Concept\n\nhttps://uncensoredtech.substack.com/p/denial-of-service-using-htlc-in-cashu\n\n## Fix\n\nIt was fixed by *lollerfirs*t in https://github.com/cashubtc/nutshell/pull/803\n\n## Timeline\n\n19 October 2025: I reported the vulnerabillity to cashu-dev@pm.me  \n19 October 2025: Cashu dev team acknowledged it as a serious issue and [opencash](https://opencash.dev/) rewarded with 100k sats  \n21 October 2025: It was fixed in https://github.com/cashubtc/nutshell/commit/f84028ca3f8f0b476f7be8c29b58666f075be2c2  \n28 October 2025: v0.18.0 was released with the fix  \n29-31 October 2025: I reached out to several mints and requested to update nutshell  \n2 November 2025: Public Disclosure\n\n## Advisory for mints and users\n\nSome mints have still not updated nutshell. They should backup the database and run the mint with v0.18.0. Reach out to Cashu dev team if you experience any issues while updating the mint.\n\nUsers should check the version of the mint with `https://<mint_url>/v1/info` and stop using the mint if it supports NUT-14 and running nutshell version older than 0.18.0.",
  "actions_summary": [
    {
      "id": 2,
      "count": 1
    }
  ],
  "moderator": false,
  "admin": false,
  "staff": false,
  "user_id": 247,
  "hidden": false,
  "trust_level": 2,
  "deleted_at": null,
  "user_deleted": false,
  "edit_reason": null,
  "can_view_edit_history": true,
  "wiki": false,
  "excerpt": "<a name=\"p-6185-vulnerability-1\" class=\"anchor\" href=\"#p-6185-vulnerability-1\"></a>Vulnerability\nThe size of preimage was not validated in nutshell versions &lt; 0.18.0. This allows the attacker to fill the mint\u2019s database and disk with arbitrary data. \n    def _verify_htlc_spending_conditions(\n        self,\n        proof: Proof,\n        secret: HTLCSecret,\n        message_to_sign: O&hellip;",
  "truncated": true,
  "post_url": "/t/public-disclosure-denial-of-service-using-htlc-in-cashu/2090/1",
  "reactions": [
    {
      "id": "heart",
      "type": "emoji",
      "count": 1
    }
  ],
  "current_user_reaction": null,
  "reaction_users_count": 1,
  "current_user_used_main_reaction": false,
  "can_accept_answer": false,
  "can_unaccept_answer": false,
  "accepted_answer": false,
  "topic_accepted_answer": null,
  "can_vote": false
}