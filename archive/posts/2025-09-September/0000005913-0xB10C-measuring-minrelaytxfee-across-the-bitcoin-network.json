{
  "id": 5913,
  "name": "0xB10C",
  "username": "0xB10C",
  "avatar_template": "/user_avatar/delvingbitcoin.org/0xb10c/{size}/15_2.png",
  "created_at": "2025-09-18T08:55:46.165Z",
  "cooked": "<p>Thanks for sharing!</p>\n<aside class=\"quote no-group\" data-username=\"danielabrozzoni\" data-post=\"1\" data-topic=\"1989\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img alt=\"\" width=\"24\" height=\"24\" src=\"https://delvingbitcoin.org/user_avatar/delvingbitcoin.org/danielabrozzoni/48/1300_2.png\" class=\"avatar\"> danielabrozzoni:</div>\n<blockquote>\n<p>The <strong>9170997</strong> entries are a bit odd\u2026 I connected to a few of those nodes with Bitcoin Core and checked <code>minfeefilter</code> in <code>getpeerinfo</code> to make sure the crawler wasn\u2019t wrongly parsing messages. The value really is what they\u2019re advertising, but I have no idea why\u2026 if anyone has a theory, I\u2019d love to hear it.</p>\n</blockquote>\n</aside>\n<p>Bitcoin Core \u201crounds\u201d the feerate filters a bit (i.e. it put them into bins) as sending an exact feefilter based on mempool contents is a way of fingerprinting nodes across networks. See <a href=\"https://github.com/bitcoin/bitcoin/blob/1444ed855f438f1270104fca259ce61b99ed5cdb/src/policy/fees.h#L322-L343\"><code>FeeFilterRounder</code></a> in <code>src/policy/fees.h</code>.  The <code>FeeFilterRounder</code> defines a <code>MAX_FILTER_FEERATE</code> of <code>1e7</code> (10,000,000). <code>1e7</code> happens to \u201cround\u201d to <code>9170997</code>. This can also be seen in this test where <code>MAX_MONEY</code> (21,000,000 * COIN) is \u201crounded\u201d to <code>9170997</code>.</p>\n<aside class=\"onebox githubblob\" data-onebox-src=\"https://github.com/bitcoin/bitcoin/blob/1444ed855f438f1270104fca259ce61b99ed5cdb/src/test/policy_fee_tests.cpp#L31-L32\">\n  <header class=\"source\">\n\n      <a href=\"https://github.com/bitcoin/bitcoin/blob/1444ed855f438f1270104fca259ce61b99ed5cdb/src/test/policy_fee_tests.cpp#L31-L32\" target=\"_blank\" rel=\"noopener\">github.com/bitcoin/bitcoin</a>\n  </header>\n\n  <article class=\"onebox-body\">\n    <h4><a href=\"https://github.com/bitcoin/bitcoin/blob/1444ed855f438f1270104fca259ce61b99ed5cdb/src/test/policy_fee_tests.cpp#L31-L32\" target=\"_blank\" rel=\"noopener\">src/test/policy_fee_tests.cpp</a></h4>\n\n<div class=\"git-blob-info\">\n  <a href=\"https://github.com/bitcoin/bitcoin/blob/1444ed855f438f1270104fca259ce61b99ed5cdb/src/test/policy_fee_tests.cpp#L31-L32\" rel=\"noopener\"><code>1444ed855</code></a>\n</div>\n\n\n\n    <pre class=\"onebox\"><code class=\"lang-cpp\">\n      <ol class=\"start lines\" start=\"31\" style=\"counter-reset: li-counter 30 ;\">\n          <li>// check that MAX_MONEY rounds to 9170997</li>\n          <li>BOOST_CHECK_EQUAL(fee_rounder.round(MAX_MONEY), 9170997);</li>\n      </ol>\n    </code></pre>\n\n\n\n  </article>\n\n  <div class=\"onebox-metadata\">\n    \n    \n  </div>\n\n  <div style=\"clear: both\"></div>\n</aside>\n\n<p>When in IBD, a feefilter of <code>MAX_MONEY</code> is set:\n</p><aside class=\"onebox githubblob\" data-onebox-src=\"https://github.com/bitcoin/bitcoin/blob/1444ed855f438f1270104fca259ce61b99ed5cdb/src/net_processing.cpp#L5382-L5386\">\n  <header class=\"source\">\n\n      <a href=\"https://github.com/bitcoin/bitcoin/blob/1444ed855f438f1270104fca259ce61b99ed5cdb/src/net_processing.cpp#L5382-L5386\" target=\"_blank\" rel=\"noopener\">github.com/bitcoin/bitcoin</a>\n  </header>\n\n  <article class=\"onebox-body\">\n    <h4><a href=\"https://github.com/bitcoin/bitcoin/blob/1444ed855f438f1270104fca259ce61b99ed5cdb/src/net_processing.cpp#L5382-L5386\" target=\"_blank\" rel=\"noopener\">src/net_processing.cpp</a></h4>\n\n<div class=\"git-blob-info\">\n  <a href=\"https://github.com/bitcoin/bitcoin/blob/1444ed855f438f1270104fca259ce61b99ed5cdb/src/net_processing.cpp#L5382-L5386\" rel=\"noopener\"><code>1444ed855</code></a>\n</div>\n\n\n\n    <pre class=\"onebox\"><code class=\"lang-cpp\">\n      <ol class=\"start lines\" start=\"5382\" style=\"counter-reset: li-counter 5381 ;\">\n          <li>if (m_chainman.IsInitialBlockDownload()) {</li>\n          <li>    // Received tx-inv messages are discarded when the active</li>\n          <li>    // chainstate is in IBD, so tell the peer to not send them.</li>\n          <li>    currentFilter = MAX_MONEY;</li>\n          <li>} else {</li>\n      </ol>\n    </code></pre>\n\n\n\n  </article>\n\n  <div class=\"onebox-metadata\">\n    \n    \n  </div>\n\n  <div style=\"clear: both\"></div>\n</aside>\n\n<p>so they should return a feefilter of <code>9170997</code>. Maybe the nodes were in IBD when you connected to them?</p>\n<hr>\n<p>Looking at some logs I can see the following pattern happening repeatedly:</p>\n<p>We connect to peer=5129 at height 908087, the peer is at height 907929 (158 blocks behind). Initially, the peer sends a feefilter of 9170997. After four seconds, the peer lowers its feefilter of 9170997 to 1000.</p>\n<pre><code class=\"lang-auto\">2025-09-01T09:29:34.83Z [net] send version message: version 70016, blocks=908087, txrelay=1, peer=5129\n2025-09-01T09:29:34.83Z [net] receive version message: version 70016, blocks=907929, txrelay=1, peer=5129\n..\n2025-09-01T09:29:35.99Z [net] received: feefilter of 0.09170997 BTC/kvB from peer=5129\n2025-09-01T09:29:39.08Z [net] received: feefilter of 0.00001000 BTC/kvB from peer=5129\n</code></pre>\n<p>The code for is:</p>\n<aside class=\"onebox githubblob\" data-onebox-src=\"https://github.com/bitcoin/bitcoin/blob/1444ed855f438f1270104fca259ce61b99ed5cdb/src/net_processing.cpp#L5388-L5391\">\n  <header class=\"source\">\n\n      <a href=\"https://github.com/bitcoin/bitcoin/blob/1444ed855f438f1270104fca259ce61b99ed5cdb/src/net_processing.cpp#L5388-L5391\" target=\"_blank\" rel=\"noopener\">github.com/bitcoin/bitcoin</a>\n  </header>\n\n  <article class=\"onebox-body\">\n    <h4><a href=\"https://github.com/bitcoin/bitcoin/blob/1444ed855f438f1270104fca259ce61b99ed5cdb/src/net_processing.cpp#L5388-L5391\" target=\"_blank\" rel=\"noopener\">src/net_processing.cpp</a></h4>\n\n<div class=\"git-blob-info\">\n  <a href=\"https://github.com/bitcoin/bitcoin/blob/1444ed855f438f1270104fca259ce61b99ed5cdb/src/net_processing.cpp#L5388-L5391\" rel=\"noopener\"><code>1444ed855</code></a>\n</div>\n\n\n\n    <pre class=\"onebox\"><code class=\"lang-cpp\">\n      <ol class=\"start lines\" start=\"5388\" style=\"counter-reset: li-counter 5387 ;\">\n          <li>if (peer.m_fee_filter_sent == MAX_FILTER) {</li>\n          <li>    // Send the current filter if we sent MAX_FILTER previously</li>\n          <li>    // and made it out of IBD.</li>\n          <li>    peer.m_next_send_feefilter = 0us;</li>\n      </ol>\n    </code></pre>\n\n\n\n  </article>\n\n  <div class=\"onebox-metadata\">\n    \n    \n  </div>\n\n  <div style=\"clear: both\"></div>\n</aside>\n",
  "post_number": 3,
  "post_type": 1,
  "posts_count": 4,
  "updated_at": "2025-09-18T08:55:46.165Z",
  "reply_count": 1,
  "reply_to_post_number": null,
  "quote_count": 1,
  "incoming_link_count": 0,
  "reads": 23,
  "readers_count": 22,
  "score": 84.6,
  "yours": false,
  "topic_id": 1989,
  "topic_slug": "measuring-minrelaytxfee-across-the-bitcoin-network",
  "topic_title": "Measuring minrelaytxfee across the Bitcoin network",
  "topic_html_title": "Measuring minrelaytxfee across the Bitcoin network",
  "category_id": 7,
  "display_username": "0xB10C",
  "primary_group_name": null,
  "flair_name": null,
  "flair_url": null,
  "flair_bg_color": null,
  "flair_color": null,
  "flair_group_id": null,
  "badges_granted": [],
  "version": 1,
  "can_edit": false,
  "can_delete": false,
  "can_recover": false,
  "can_see_hidden_post": false,
  "can_wiki": false,
  "user_title": null,
  "bookmarked": false,
  "raw": "Thanks for sharing!\n\n[quote=\"danielabrozzoni, post:1, topic:1989\"]\nThe **9170997** entries are a bit odd\u2026 I connected to a few of those nodes with Bitcoin Core and checked `minfeefilter` in `getpeerinfo` to make sure the crawler wasn\u2019t wrongly parsing messages. The value really is what they\u2019re advertising, but I have no idea why\u2026 if anyone has a theory, I\u2019d love to hear it.\n[/quote]\n\nBitcoin Core \"rounds\" the feerate filters a bit (i.e. it put them into bins) as sending an exact feefilter based on mempool contents is a way of fingerprinting nodes across networks. See [`FeeFilterRounder`](https://github.com/bitcoin/bitcoin/blob/1444ed855f438f1270104fca259ce61b99ed5cdb/src/policy/fees.h#L322-L343) in `src/policy/fees.h`.  The `FeeFilterRounder` defines a `MAX_FILTER_FEERATE` of `1e7` (10,000,000). `1e7` happens to \"round\" to `9170997`. This can also be seen in this test where `MAX_MONEY` (21,000,000 * COIN) is \"rounded\" to `9170997`.\n\nhttps://github.com/bitcoin/bitcoin/blob/1444ed855f438f1270104fca259ce61b99ed5cdb/src/test/policy_fee_tests.cpp#L31-L32\n\n\nWhen in IBD, a feefilter of `MAX_MONEY` is set:\nhttps://github.com/bitcoin/bitcoin/blob/1444ed855f438f1270104fca259ce61b99ed5cdb/src/net_processing.cpp#L5382-L5386\n\nso they should return a feefilter of `9170997`. Maybe the nodes were in IBD when you connected to them?\n\n---\n\nLooking at some logs I can see the following pattern happening repeatedly: \n\nWe connect to peer=5129 at height 908087, the peer is at height 907929 (158 blocks behind). Initially, the peer sends a feefilter of 9170997. After four seconds, the peer lowers its feefilter of 9170997 to 1000. \n\n```\n2025-09-01T09:29:34.83Z [net] send version message: version 70016, blocks=908087, txrelay=1, peer=5129\n2025-09-01T09:29:34.83Z [net] receive version message: version 70016, blocks=907929, txrelay=1, peer=5129\n..\n2025-09-01T09:29:35.99Z [net] received: feefilter of 0.09170997 BTC/kvB from peer=5129\n2025-09-01T09:29:39.08Z [net] received: feefilter of 0.00001000 BTC/kvB from peer=5129\n```\n\nThe code for is:\n\nhttps://github.com/bitcoin/bitcoin/blob/1444ed855f438f1270104fca259ce61b99ed5cdb/src/net_processing.cpp#L5388-L5391",
  "actions_summary": [
    {
      "id": 2,
      "count": 3
    }
  ],
  "moderator": false,
  "admin": false,
  "staff": false,
  "user_id": 16,
  "hidden": false,
  "trust_level": 3,
  "deleted_at": null,
  "user_deleted": false,
  "edit_reason": null,
  "can_view_edit_history": true,
  "wiki": false,
  "excerpt": "Thanks for sharing! \n\nBitcoin Core \u201crounds\u201d the feerate filters a bit (i.e. it put them into bins) as sending an exact feefilter based on mempool contents is a way of fingerprinting nodes across networks. See <a href=\"https://github.com/bitcoin/bitcoin/blob/1444ed855f438f1270104fca259ce61b99ed5cdb/src/policy/fees.h#L322-L343\">FeeFilterRounder</a> in src/policy/fees.h.  The FeeFilterRounder defines a MAX_FILTER_FEERATE o&hellip;",
  "truncated": true,
  "post_url": "/t/measuring-minrelaytxfee-across-the-bitcoin-network/1989/3",
  "reactions": [
    {
      "id": "+1",
      "type": "emoji",
      "count": 2
    },
    {
      "id": "heart",
      "type": "emoji",
      "count": 1
    }
  ],
  "current_user_reaction": null,
  "reaction_users_count": 3,
  "current_user_used_main_reaction": false,
  "can_accept_answer": false,
  "can_unaccept_answer": false,
  "accepted_answer": false,
  "topic_accepted_answer": null
}