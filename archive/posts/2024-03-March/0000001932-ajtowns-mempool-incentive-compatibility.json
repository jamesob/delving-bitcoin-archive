{
  "id": 1932,
  "name": "Anthony Towns",
  "username": "ajtowns",
  "avatar_template": "/user_avatar/delvingbitcoin.org/ajtowns/{size}/417_2.png",
  "created_at": "2024-03-19T01:10:26.618Z",
  "cooked": "<aside class=\"quote no-group\" data-username=\"rustyrussell\" data-post=\"26\" data-topic=\"553\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://delvingbitcoin.org/user_avatar/delvingbitcoin.org/rustyrussell/48/154_2.png\" class=\"avatar\"> rustyrussell:</div>\n<blockquote>\n<p>I think we\u2019ve demonstrated that there are cases where the miners are incentivized to fix this, and cases they are not. In the latter case, there\u2019s a Schelling point where, even if it\u2019s not directly incentive compatible for a miner to replace, it becomes so if the <em>other</em> miners do. Such a Schelling point might come into existence if (1) miners agree it\u2019s generally better for the network, (2) the gains of not doing so are minor anyway, and (3) it\u2019s the default.</p>\n</blockquote>\n</aside>\n<p>Hmm, poking at this some more, I think my <a href=\"https://delvingbitcoin.org/t/mempool-incentive-compatibility/553/7\">previous post</a> went too far into the miners-all-cooperate edge case.</p>\n<p>If you consider some pinning tx that won\u2019t be worth mining for 100 blocks, and a stratumv2 mining pool with only 98% hashrate that keeps the pinning tx hoping for its high fees, that\u2019s still leaves an 86% chance that the remaining 2% hashrate mines a block a block in the meantime with the high feerate tx, invalidating the pinning tx. In that case, the pinning tx needs to pay <span class=\"math\">h^{1-n}</span> times as much as the pinned tx, or the pool would have had a higher expected value for just trying to mine the higher feerate/lower fee pinned tx instead. For a pool with 100% hashrate, that devolves to always requiring a higher fee independent of <span class=\"math\">n</span>; but for a pool with 90% hashrate, it\u2019s already 100x fee at about 45 blocks; at 50% hashrate, it\u2019s 500x fee at 10 blocks. For the 98% pool at 100 blocks, it\u2019s a factor of about 7.4.</p>\n<p>That model may give a strong incentive to defect, if you get some direct benefit from fees, other than just \u201cthe pool has more funds to distribute\u201d. For example, if a sv2 pool finds that some percent of hashpower is just building working on empty blocks, perhaps it will decide to issue rewards rated not just by number of shares found, but also by the potential reward that those blocks would return to the pool. In that case, defecting and attempting to mine the replacement transaction would increase your share of rewards in the short term, and, provided the pool doesn\u2019t check for that sort of defection and punish it, and without having done the maths, I think that would end up being attractive, at least, for small miners within the pool.</p>\n<p>I think that still adds up to \u201cthe replacement tx needs to pay a fee proportional to the total fee of the tx being replaced\u201d though \u2013 along with having a threshold along the lines of \u201cdon\u2019t replace txs you expect will confirm in the next 50 blocks\u201d \u2013 but at least it allows that proportion to be substantially less than 1.</p>\n<p>I think in this view, you can conclude that as long as you don\u2019t have a mining pool/cartel with over 95% hashrate, than replacing a tx that won\u2019t be mined for 135 or more blocks with one that would be mined immediately is fine unless the total fee of the existing tx is more than 1000x that of the new one (pretty implausible as it would mean even a 100vb tx replacement would be paying a lower feerate than a max size 100kvb tx), as is replacing a tx whose total fee is under 10x and won\u2019t be mined for 50 or more blocks.</p>\n<p>Those numbers seem much more reasonable, though I\u2019m not sure how you\u2019d make any of this practical to implement \u2013 both the \u201cthis tx won\u2019t be mined for <span class=\"math\">n</span> blocks\u201d and \u201c<span class=\"math\">h</span> percent of hashpower will wait to try to collect fees from the pinning tx\u201d aren\u2019t really things you can measure very accurately\u2026 Dealing with a 50 or 135 block delay might not be very practical for many applications either.</p>",
  "post_number": 30,
  "post_type": 1,
  "posts_count": 42,
  "updated_at": "2024-03-19T01:10:26.618Z",
  "reply_count": 1,
  "reply_to_post_number": 26,
  "quote_count": 1,
  "incoming_link_count": 1,
  "reads": 33,
  "readers_count": 32,
  "score": 16.6,
  "yours": false,
  "topic_id": 553,
  "topic_slug": "mempool-incentive-compatibility",
  "topic_title": "Mempool Incentive Compatibility",
  "topic_html_title": "Mempool Incentive Compatibility",
  "category_id": 7,
  "display_username": "Anthony Towns",
  "primary_group_name": null,
  "flair_name": null,
  "flair_url": null,
  "flair_bg_color": null,
  "flair_color": null,
  "flair_group_id": null,
  "badges_granted": [],
  "version": 1,
  "can_edit": false,
  "can_delete": false,
  "can_recover": false,
  "can_see_hidden_post": false,
  "can_wiki": false,
  "user_title": null,
  "bookmarked": false,
  "raw": "[quote=\"rustyrussell, post:26, topic:553\"]\nI think we\u2019ve demonstrated that there are cases where the miners are incentivized to fix this, and cases they are not. In the latter case, there\u2019s a Schelling point where, even if it\u2019s not directly incentive compatible for a miner to replace, it becomes so if the *other* miners do. Such a Schelling point might come into existence if (1) miners agree it\u2019s generally better for the network, (2) the gains of not doing so are minor anyway, and (3) it\u2019s the default.\n[/quote]\n\nHmm, poking at this some more, I think my [previous post](https://delvingbitcoin.org/t/mempool-incentive-compatibility/553/7) went too far into the miners-all-cooperate edge case.\n\nIf you consider some pinning tx that won't be worth mining for 100 blocks, and a stratumv2 mining pool with only 98% hashrate that keeps the pinning tx hoping for its high fees, that's still leaves an 86% chance that the remaining 2% hashrate mines a block a block in the meantime with the high feerate tx, invalidating the pinning tx. In that case, the pinning tx needs to pay $h^{1-n}$ times as much as the pinned tx, or the pool would have had a higher expected value for just trying to mine the higher feerate/lower fee pinned tx instead. For a pool with 100% hashrate, that devolves to always requiring a higher fee independent of $n$; but for a pool with 90% hashrate, it's already 100x fee at about 45 blocks; at 50% hashrate, it's 500x fee at 10 blocks. For the 98% pool at 100 blocks, it's a factor of about 7.4.\n\nThat model may give a strong incentive to defect, if you get some direct benefit from fees, other than just \"the pool has more funds to distribute\". For example, if a sv2 pool finds that some percent of hashpower is just building working on empty blocks, perhaps it will decide to issue rewards rated not just by number of shares found, but also by the potential reward that those blocks would return to the pool. In that case, defecting and attempting to mine the replacement transaction would increase your share of rewards in the short term, and, provided the pool doesn't check for that sort of defection and punish it, and without having done the maths, I think that would end up being attractive, at least, for small miners within the pool.\n\nI think that still adds up to \"the replacement tx needs to pay a fee proportional to the total fee of the tx being replaced\" though -- along with having a threshold along the lines of \"don't replace txs you expect will confirm in the next 50 blocks\" -- but at least it allows that proportion to be substantially less than 1. \n\nI think in this view, you can conclude that as long as you don't have a mining pool/cartel with over 95% hashrate, than replacing a tx that won't be mined for 135 or more blocks with one that would be mined immediately is fine unless the total fee of the existing tx is more than 1000x that of the new one (pretty implausible as it would mean even a 100vb tx replacement would be paying a lower feerate than a max size 100kvb tx), as is replacing a tx whose total fee is under 10x and won't be mined for 50 or more blocks.\n\nThose numbers seem much more reasonable, though I'm not sure how you'd make any of this practical to implement -- both the \"this tx won't be mined for $n$ blocks\" and \"$h$ percent of hashpower will wait to try to collect fees from the pinning tx\" aren't really things you can measure very accurately... Dealing with a 50 or 135 block delay might not be very practical for many applications either.",
  "actions_summary": [],
  "moderator": true,
  "admin": true,
  "staff": true,
  "user_id": 3,
  "hidden": false,
  "trust_level": 4,
  "deleted_at": null,
  "user_deleted": false,
  "edit_reason": null,
  "can_view_edit_history": true,
  "wiki": false,
  "excerpt": "Hmm, poking at this some more, I think my <a href=\"https://delvingbitcoin.org/t/mempool-incentive-compatibility/553/7\">previous post</a> went too far into the miners-all-cooperate edge case. \nIf you consider some pinning tx that won\u2019t be worth mining for 100 blocks, and a stratumv2 mining pool with only 98% hashrate that keeps the pinning tx hoping for its high fees, that\u2019s sti&hellip;",
  "truncated": true,
  "post_url": "/t/mempool-incentive-compatibility/553/30",
  "reactions": [
    {
      "id": "clap",
      "type": "emoji",
      "count": 1
    },
    {
      "id": "heart",
      "type": "emoji",
      "count": 1
    }
  ],
  "current_user_reaction": null,
  "reaction_users_count": 2,
  "current_user_used_main_reaction": false,
  "can_accept_answer": false,
  "can_unaccept_answer": false,
  "accepted_answer": false,
  "topic_accepted_answer": null
}