{
  "id": 2090,
  "name": "David A. Harding",
  "username": "harding",
  "avatar_template": "/user_avatar/delvingbitcoin.org/harding/{size}/6_2.png",
  "created_at": "2024-03-29T22:33:16.785Z",
  "cooked": "<aside class=\"quote no-group\" data-username=\"sdaftuar\" data-post=\"13\" data-topic=\"696\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://delvingbitcoin.org/letter_avatar_proxy/v4/letter/s/0ea827/48.png\" class=\"avatar\"> sdaftuar:</div>\n<blockquote>\n<p>in the event of a reorg <strong>the script will still be valid</strong>, even if the\nmerkle root that is referenced in a script is not in the active chain.</p>\n</blockquote>\n</aside>\n<p>Argh, yes, you\u2019re correct, of course.  I really didn\u2019t think that one\nthrough.  Thank you for putting up with me!</p>\n<aside class=\"quote no-group\" data-username=\"sdaftuar\" data-post=\"13\" data-topic=\"696\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://delvingbitcoin.org/letter_avatar_proxy/v4/letter/s/0ea827/48.png\" class=\"avatar\"> sdaftuar:</div>\n<blockquote>\n<p>That means that we\u2019re talking about saving 10-15% of the cost of a CPFP\nby using an efficient sponsors implementation, versus something like\nEphemeral Anchors.</p>\n</blockquote>\n</aside>\n<p>It was pointed out to me elsewhere that I\u2019m not being as clear as I\nshould be about absolute costs versus marginal costs.</p>\n<p>I agree with you about the absolute cost.</p>\n<p>However, let\u2019s imagine any regular transaction could sponsor at least\none other transaction with no prior setup.  Let\u2019s also assume there will\ncontinue to be people and organizations who broadcast at least one\ntransaction every hour or so, including someone named Alice.  This\nallows Bob to pay Alice to make her next transaction a sponsor\ntransaction and the marginal increase in her transaction size over the\ntransaction she was planning to create anyway is ~0.5 vbytes.</p>\n<p>By comparison, Bob could include an ephemeral anchor output in his\ntransaction, which would also allow Bob to pay third-party Alice (via an\noff chain mechanism) to CPFP his transaction.  Alice would need to\ninclude an extra ~40 vbytes in her transaction and would need pay for\nBob\u2019s transaction containing an extra ~11 vbytes (51 vbytes total).</p>\n<p>Whether using anchors or sponsors, I\u2019m not aware of any way for Bob to\npay Alice trustlessly offchain (without prior setup that adds\nsignificant additional costs and complexity).  Bob will be paying Alice\nwith no guarantee of result; she could take his money and not sponsor\nhis transaction.  I\u2019m pretty sure that\u2019s also the case with paying a\nlarge miner OOB, so the individual user risks of all approaches for\npaying for third party fee bumping seem roughly equivalent to me.</p>\n<p>With both anchors and sponsors, Bob can of course trustlessly fee bump\nhis own transaction.  However, Bob can only fee bump his own transaction\nif he has an unencumbered UTXO to spend.  If we start to see adoption of\npooling technologies (e.g. joinpools, channel factories, and timeout\ntrees), delayed spending protocols (like vaults), and a general increase\nin typical feerates, it seems likely to me that there will be many users\nwho use trustless or trust-minimized offchain protocols but don\u2019t have\nconvenient access to an unencumbered UTXO.  For those users, obtaining\nan unencumbered UTXO on short notice might require an additional\ntransaction onchain (or even more than one to do trustlessly, as things\nlike submarine swaps require two onchain transactions to settle).</p>\n<p>To compare between Bob\u2019s different options at some point in the\nfuture, let\u2019s assume that he knows he will later have a transaction\nwhose base size is 500 vbytes, that the typical fee for a transaction that\nsize is $1,000 USD (in circa 2024 dollars), and that he also has a\nreliable offchain mechanism for paying third parties.</p>\n<ul>\n<li>\n<p>$1,000 (500 vbytes) is his overall cost using endogenous fees and\ntransmitting on the P2P protocol.</p>\n</li>\n<li>\n<p>$1,000 (500 vbytes) is his overall cost using OOB payment to miners.\nThere may be a delay to confirmation and there\u2019s a risk a miner will\ntake his money without mining his transaction.  He\u2019ll probably have to\npay a slight premium over this so that the miner profits.</p>\n</li>\n<li>\n<p>$1,001 (500 + 0.5 vbytes) is his overall cost using sponsors via the\nP2P protocol with a third party who was already going to create a\ntransaction.  There\u2019s a risk the third party will take his money\nwithout sponsoring his transaction.  He\u2019ll probably have to pay a\nslight premium over this so the sponsor profits.</p>\n</li>\n<li>\n<p>$1,022 (511 + 0 vbytes) is his overall cost of adding an anchor output but\nlater deciding to OOB pay miners.  There may be a confirmation delay,\nhe risks miners taking his money without providing confirmation, and\nthere will likely be a slight premium.  This also leaves an output in\nthe UTXO set indefinitely.</p>\n</li>\n<li>\n<p>$1,102 (511 + 40 vbytes) is his overall cost using ephemeral anchors\nvia the P2P protocol with a third party who was already going to\ncreate a transaction.  There\u2019s a risk the third party will take his\nmoney without sponsoring his transaction and he\u2019ll probably have to\npay a slight premium so that they profit.</p>\n</li>\n<li>\n<p>$1,322 (511 + 150 vbytes) is his overall cost using an ephemeral\nanchor via the P2P and fee bumping it himself, assuming he already\nhad a UTXO ready to spend.</p>\n</li>\n<li>\n<p>$1,722 (511 + 200 + 150 vbytes) is a rough estimate of his overall\ncost using an ephemeral anchor via the P2P protocol plus trustlessly\nobtaining a UTXO to fee bump the anchor himself.</p>\n</li>\n</ul>\n<p>I don\u2019t think we can rule out a future where feerates are the equivalent\nof $2/vbyte, and I think there would be quite a few people in that\npotential future who would be willing to save $100 or more per\ntransaction by paying miners OOB.  Even if fees were $0.2/vbyte, a level\nwe\u2019ve seen, I think there are a significant number of people who would\nbe willing to pay miners OOB to save $10 per transaction, especially if\nthere is a service (as has been proposed) to make paying OOB easy.</p>\n<p>It adds significant overhead and complexity to contract protocols to use\nincremental presigned RBF fee bumps for a wide range of potential fees,\nso they\u2019re probably always going to depend at least partly on some sort\nof exogenous fee mechanism.  Paying OOB may look unexciting given\nthat it only saves 10% over ephemeral anchors in the best case, but the\nfrequency at which I receive store coupons that offer around 10%\nindicates that many people find that amount of savings to be highly\nmotivating.  Sponsors gives us the chance to offer that same 10%\ndiscount that large miners can offer without the risk to mining\ndecentralization.  I think that makes it worth pursuing.</p>\n<p>Thanks to the discussion on this thread, I realize there are several\nchallenges to sponsors that I need to do a better job of addressing,\nparticularly reorg safety, avoiding the creation of new pinning vectors,\nand ensuring sponsors otherwise interact well with mempool structures\nand algorithms.  I\u2019m investigating those now.</p>",
  "post_number": 14,
  "post_type": 1,
  "updated_at": "2024-03-29T22:33:16.785Z",
  "reply_count": 0,
  "reply_to_post_number": null,
  "quote_count": 1,
  "incoming_link_count": 0,
  "reads": 4,
  "readers_count": 3,
  "score": 0.8,
  "yours": false,
  "topic_id": 696,
  "topic_slug": "improving-transaction-sponsor-blockspace-efficiency",
  "topic_title": "Improving transaction sponsor blockspace efficiency",
  "topic_html_title": "Improving transaction sponsor blockspace efficiency",
  "category_id": 7,
  "display_username": "David A. Harding",
  "primary_group_name": null,
  "flair_name": null,
  "flair_url": null,
  "flair_bg_color": null,
  "flair_color": null,
  "flair_group_id": null,
  "version": 1,
  "can_edit": false,
  "can_delete": false,
  "can_recover": false,
  "can_see_hidden_post": false,
  "can_wiki": false,
  "user_title": null,
  "bookmarked": false,
  "raw": "[quote=\"sdaftuar, post:13, topic:696\"]\nin the event of a reorg **the script will still be valid**, even if the\nmerkle root that is referenced in a script is not in the active chain.\n[/quote]\n\nArgh, yes, you're correct, of course.  I really didn't think that one\nthrough.  Thank you for putting up with me!\n\n[quote=\"sdaftuar, post:13, topic:696\"]\nThat means that we\u2019re talking about saving 10-15% of the cost of a CPFP\nby using an efficient sponsors implementation, versus something like\nEphemeral Anchors.\n[/quote]\n\nIt was pointed out to me elsewhere that I'm not being as clear as I\nshould be about absolute costs versus marginal costs.\n\nI agree with you about the absolute cost.\n\nHowever, let's imagine any regular transaction could sponsor at least\none other transaction with no prior setup.  Let's also assume there will\ncontinue to be people and organizations who broadcast at least one\ntransaction every hour or so, including someone named Alice.  This\nallows Bob to pay Alice to make her next transaction a sponsor\ntransaction and the marginal increase in her transaction size over the\ntransaction she was planning to create anyway is ~0.5 vbytes.\n\nBy comparison, Bob could include an ephemeral anchor output in his\ntransaction, which would also allow Bob to pay third-party Alice (via an\noff chain mechanism) to CPFP his transaction.  Alice would need to\ninclude an extra ~40 vbytes in her transaction and would need pay for\nBob's transaction containing an extra ~11 vbytes (51 vbytes total).\n\nWhether using anchors or sponsors, I'm not aware of any way for Bob to\npay Alice trustlessly offchain (without prior setup that adds\nsignificant additional costs and complexity).  Bob will be paying Alice\nwith no guarantee of result; she could take his money and not sponsor\nhis transaction.  I'm pretty sure that's also the case with paying a\nlarge miner OOB, so the individual user risks of all approaches for\npaying for third party fee bumping seem roughly equivalent to me.\n\nWith both anchors and sponsors, Bob can of course trustlessly fee bump\nhis own transaction.  However, Bob can only fee bump his own transaction\nif he has an unencumbered UTXO to spend.  If we start to see adoption of\npooling technologies (e.g. joinpools, channel factories, and timeout\ntrees), delayed spending protocols (like vaults), and a general increase\nin typical feerates, it seems likely to me that there will be many users\nwho use trustless or trust-minimized offchain protocols but don't have\nconvenient access to an unencumbered UTXO.  For those users, obtaining\nan unencumbered UTXO on short notice might require an additional\ntransaction onchain (or even more than one to do trustlessly, as things\nlike submarine swaps require two onchain transactions to settle).\n\nTo compare between Bob's different options at some point in the\nfuture, let's assume that he knows he will later have a transaction\nwhose base size is 500 vbytes, that the typical fee for a transaction that\nsize is $1,000 USD (in circa 2024 dollars), and that he also has a\nreliable offchain mechanism for paying third parties.\n\n- $1,000 (500 vbytes) is his overall cost using endogenous fees and\n  transmitting on the P2P protocol.\n\n- $1,000 (500 vbytes) is his overall cost using OOB payment to miners.\n  There may be a delay to confirmation and there's a risk a miner will\n  take his money without mining his transaction.  He'll probably have to\n  pay a slight premium over this so that the miner profits.\n\n- $1,001 (500 + 0.5 vbytes) is his overall cost using sponsors via the\n  P2P protocol with a third party who was already going to create a\n  transaction.  There's a risk the third party will take his money\n  without sponsoring his transaction.  He'll probably have to pay a\n  slight premium over this so the sponsor profits.\n\n- $1,022 (511 + 0 vbytes) is his overall cost of adding an anchor output but\n  later deciding to OOB pay miners.  There may be a confirmation delay,\n  he risks miners taking his money without providing confirmation, and\n  there will likely be a slight premium.  This also leaves an output in\n  the UTXO set indefinitely.\n\n- $1,102 (511 + 40 vbytes) is his overall cost using ephemeral anchors\n  via the P2P protocol with a third party who was already going to\n  create a transaction.  There's a risk the third party will take his\n  money without sponsoring his transaction and he'll probably have to\n  pay a slight premium so that they profit.\n\n- $1,322 (511 + 150 vbytes) is his overall cost using an ephemeral\n  anchor via the P2P and fee bumping it himself, assuming he already\n  had a UTXO ready to spend.\n\n- $1,722 (511 + 200 + 150 vbytes) is a rough estimate of his overall\n  cost using an ephemeral anchor via the P2P protocol plus trustlessly\n  obtaining a UTXO to fee bump the anchor himself.\n\nI don't think we can rule out a future where feerates are the equivalent\nof $2/vbyte, and I think there would be quite a few people in that\npotential future who would be willing to save $100 or more per\ntransaction by paying miners OOB.  Even if fees were $0.2/vbyte, a level\nwe've seen, I think there are a significant number of people who would\nbe willing to pay miners OOB to save $10 per transaction, especially if\nthere is a service (as has been proposed) to make paying OOB easy.\n\nIt adds significant overhead and complexity to contract protocols to use\nincremental presigned RBF fee bumps for a wide range of potential fees,\nso they're probably always going to depend at least partly on some sort\nof exogenous fee mechanism.  Paying OOB may look unexciting given\nthat it only saves 10% over ephemeral anchors in the best case, but the\nfrequency at which I receive store coupons that offer around 10%\nindicates that many people find that amount of savings to be highly\nmotivating.  Sponsors gives us the chance to offer that same 10%\ndiscount that large miners can offer without the risk to mining\ndecentralization.  I think that makes it worth pursuing.\n\nThanks to the discussion on this thread, I realize there are several\nchallenges to sponsors that I need to do a better job of addressing,\nparticularly reorg safety, avoiding the creation of new pinning vectors,\nand ensuring sponsors otherwise interact well with mempool structures\nand algorithms.  I'm investigating those now.",
  "actions_summary": [],
  "moderator": false,
  "admin": false,
  "staff": false,
  "user_id": 6,
  "hidden": false,
  "trust_level": 3,
  "deleted_at": null,
  "user_deleted": false,
  "edit_reason": null,
  "can_view_edit_history": true,
  "wiki": false,
  "reactions": [],
  "current_user_reaction": null,
  "reaction_users_count": 0,
  "current_user_used_main_reaction": false
}