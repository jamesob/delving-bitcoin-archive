{
  "id": 2194,
  "name": "",
  "username": "dgpv",
  "avatar_template": "/user_avatar/delvingbitcoin.org/dgpv/{size}/75_2.png",
  "created_at": "2024-04-10T17:09:27.430Z",
  "cooked": "<aside class=\"quote no-group\" data-username=\"rijndael\" data-post=\"1\" data-topic=\"576\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://delvingbitcoin.org/letter_avatar_proxy/v4/letter/r/8797f3/48.png\" class=\"avatar\"> rijndael:</div>\n<blockquote>\n<p>We use the CAT-checksig technique to validate that the amount and scriptpubkey of the first input and first output are the same. We enforce that the second output is amount is exactly 546 sats, but we do not place any restrictions on the scriptpubkey. We also enforce that there are two inputs and two outputs.</p>\n</blockquote>\n</aside>\n<p>I think that the covenant script does not actually enforce all that.</p>\n<p>It enforces that the amount and scriptpubkey of first input is the same as the amount and scriptpubkey of the first output.</p>\n<p>But It does not validate the sizes of the buffers - that means that <code>target_scriptpubkey_buffer</code> can contain extra data, for extra outputs.</p>\n<p>The <code>fee_scriptpubkey_buffer</code> and <code>fee_amount_buffer</code> can contain extra data, too, for extra inputs.</p>\n<p>If the <code>script_pubkey_buffer</code> contains extra data, it will interfere with calculation of <code>spent_scripts_single_hash</code> as that extra data will be taken as scriptpubkey data, while it will need to contain the amounts. But IIRC, non-standard taproot outputs are treated as anyone-can-spend by miners, so maybe some manipulation is possible here, too.</p>\n<p>I think the script should have size checks added for the sizes of all the buffers, just in case.</p>",
  "post_number": 5,
  "post_type": 1,
  "updated_at": "2024-04-10T20:20:22.603Z",
  "reply_count": 1,
  "reply_to_post_number": null,
  "quote_count": 1,
  "incoming_link_count": 0,
  "reads": 12,
  "readers_count": 11,
  "score": 37.4,
  "yours": false,
  "topic_id": 576,
  "topic_slug": "basic-vault-prototype-using-op-cat",
  "topic_title": "Basic vault prototype using OP_CAT",
  "topic_html_title": "Basic vault prototype using OP_CAT",
  "category_id": 7,
  "display_username": "",
  "primary_group_name": null,
  "flair_name": null,
  "flair_url": null,
  "flair_bg_color": null,
  "flair_color": null,
  "flair_group_id": null,
  "version": 2,
  "can_edit": false,
  "can_delete": false,
  "can_recover": false,
  "can_see_hidden_post": false,
  "can_wiki": false,
  "user_title": "",
  "bookmarked": false,
  "raw": "[quote=\"rijndael, post:1, topic:576\"]\nWe use the CAT-checksig technique to validate that the amount and scriptpubkey of the first input and first output are the same. We enforce that the second output is amount is exactly 546 sats, but we do not place any restrictions on the scriptpubkey. We also enforce that there are two inputs and two outputs.\n[/quote]\n\nI think that the covenant script does not actually enforce all that.\n\nIt enforces that the amount and scriptpubkey of first input is the same as the amount and scriptpubkey of the first output.\n\nBut It does not validate the sizes of the buffers - that means that `target_scriptpubkey_buffer` can contain extra data, for extra outputs.\n\nThe `fee_scriptpubkey_buffer` and `fee_amount_buffer` can contain extra data, too, for extra inputs.\n\nIf the `script_pubkey_buffer` contains extra data, it will interfere with calculation of `spent_scripts_single_hash` as that extra data will be taken as scriptpubkey data, while it will need to contain the amounts. But IIRC, non-standard taproot outputs are treated as anyone-can-spend by miners, so maybe some manipulation is possible here, too. \n\nI think the script should have size checks added for the sizes of all the buffers, just in case.",
  "actions_summary": [
    {
      "id": 2,
      "count": 2
    }
  ],
  "moderator": false,
  "admin": false,
  "staff": false,
  "user_id": 85,
  "hidden": false,
  "trust_level": 3,
  "deleted_at": null,
  "user_deleted": false,
  "edit_reason": null,
  "can_view_edit_history": true,
  "wiki": false,
  "reactions": [
    {
      "id": "+1",
      "type": "emoji",
      "count": 2
    }
  ],
  "current_user_reaction": null,
  "reaction_users_count": 2,
  "current_user_used_main_reaction": false
}