{
  "id": 2175,
  "name": "Sjors Provoost",
  "username": "sjors",
  "avatar_template": "/user_avatar/delvingbitcoin.org/sjors/{size}/59_2.png",
  "created_at": "2024-04-05T17:07:05.538Z",
  "cooked": "<aside class=\"quote no-group\" data-username=\"AntoineP\" data-post=\"12\" data-topic=\"710\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://delvingbitcoin.org/user_avatar/delvingbitcoin.org/antoinep/48/483_2.png\" class=\"avatar\"> AntoineP:</div>\n<blockquote>\n<p>Making absolutely sure txids are unique seems like a good property to have in Bitcoin. And making it so comes at very little cost as this rule would only take effect in 21 years (much more than the current lifetime of Bitcoin).</p>\n</blockquote>\n</aside>\n<p>Ah, so I guess the rule could be: blocks (with more than one transaction) at or above 1,983,702 MUST have a witness commitment. That\u2019s plenty of time to make sure all mining software does that by default.</p>\n<p>This is probably the only new soft-fork rule that miners could violate by accident. Not requiring a witness commitment for \u201cempty\u201d (only a coinbase) blocks makes it safer, because who knows what custom code is out there to SPV/spy-mine in the brief interval between when a new block is seen and when it\u2019s fully validated and the new template is ready.</p>\n<aside class=\"quote no-group\" data-username=\"AntoineP\" data-post=\"1\" data-topic=\"710\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://delvingbitcoin.org/user_avatar/delvingbitcoin.org/antoinep/48/483_2.png\" class=\"avatar\"> AntoineP:</div>\n<blockquote>\n<p>I have yet to check if there is any violation of this but i\u2019d be surprised if there is a pre-Segwit coinbase transaction with an output pushing exactly the witness commitment header followed by 32 <code>0x00</code> bytes.</p>\n</blockquote>\n</aside>\n<p>There isn\u2019t, unless I missed it: <a href=\"https://bitcoin.stackexchange.com/questions/121069/when-was-the-first-op-return-output-in-a-coinbase\" class=\"inline-onebox\">op return - When was the first OP_RETURN output in a coinbase? - Bitcoin Stack Exchange</a></p>\n<p>(actually that\u2019s not exactly what you asked, but at least there\u2019s no OP_RETURN use in the coinbase before BIP30 and BIP34 kicked in)</p>\n<aside class=\"quote no-group\" data-username=\"AntoineP\" data-post=\"12\" data-topic=\"710\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://delvingbitcoin.org/user_avatar/delvingbitcoin.org/antoinep/48/483_2.png\" class=\"avatar\"> AntoineP:</div>\n<blockquote>\n<p>A check that the coinbase transaction at block 490,897 can never be <code>bec6606bb10f77f5f0395cc86d0489fbef70c0615b177a326612d8bd7b84f84d</code> could be hardcoded in the client, but i think if there is a reorg this deep we have bigger problems anyways.</p>\n</blockquote>\n</aside>\n<p>This is not necessary. As explained in <code>validation.cpp</code>:</p>\n<pre data-code-wrap=\"cpp\"><code class=\"lang-cpp\">// Block 490,897 was, in fact, mined with a different coinbase than\n// block 176,684, but it is important to note that even if it hadn't been or\n// is remined on an alternate fork with a duplicate coinbase, we would still\n// not run into a BIP30 violation.  This is because the coinbase for 176,684\n// is spent in block 185,956 in transaction\n</code></pre>\n<p>So a re-org would have to go all the way back to <code>185,956</code>. That\u2019s buried below multiple checkpoints. And although we might <a href=\"https://github.com/bitcoin/bitcoin/pull/25725\">get rid of checkpoints</a> completely, many nodes would consider a reorg that deep a hard fork.</p>",
  "post_number": 14,
  "post_type": 1,
  "updated_at": "2024-04-05T17:34:57.722Z",
  "reply_count": 1,
  "reply_to_post_number": 12,
  "quote_count": 2,
  "incoming_link_count": 0,
  "reads": 10,
  "readers_count": 9,
  "score": 7.0,
  "yours": false,
  "topic_id": 710,
  "topic_slug": "great-consensus-cleanup-revival",
  "topic_title": "Great Consensus Cleanup Revival",
  "topic_html_title": "Great Consensus Cleanup Revival",
  "category_id": 7,
  "display_username": "Sjors Provoost",
  "primary_group_name": null,
  "flair_name": null,
  "flair_url": null,
  "flair_bg_color": null,
  "flair_color": null,
  "flair_group_id": null,
  "version": 4,
  "can_edit": false,
  "can_delete": false,
  "can_recover": false,
  "can_see_hidden_post": false,
  "can_wiki": false,
  "user_title": null,
  "bookmarked": false,
  "raw": "[quote=\"AntoineP, post:12, topic:710\"]\nMaking absolutely sure txids are unique seems like a good property to have in Bitcoin. And making it so comes at very little cost as this rule would only take effect in 21 years (much more than the current lifetime of Bitcoin).\n[/quote]\n\nAh, so I guess the rule could be: blocks (with more than one transaction) at or above 1,983,702 MUST have a witness commitment. That's plenty of time to make sure all mining software does that by default.\n\nThis is probably the only new soft-fork rule that miners could violate by accident. Not requiring a witness commitment for \"empty\" (only a coinbase) blocks makes it safer, because who knows what custom code is out there to SPV/spy-mine in the brief interval between when a new block is seen and when it's fully validated and the new template is ready. \n\n[quote=\"AntoineP, post:1, topic:710\"]\nI have yet to check if there is any violation of this but i\u2019d be surprised if there is a pre-Segwit coinbase transaction with an output pushing exactly the witness commitment header followed by 32 `0x00` bytes.\n[/quote]\n\nThere isn't, unless I missed it: https://bitcoin.stackexchange.com/questions/121069/when-was-the-first-op-return-output-in-a-coinbase\n\n(actually that's not exactly what you asked, but at least there's no OP_RETURN use in the coinbase before BIP30 and BIP34 kicked in)\n\n[quote=\"AntoineP, post:12, topic:710\"]\nA check that the coinbase transaction at block 490,897 can never be `bec6606bb10f77f5f0395cc86d0489fbef70c0615b177a326612d8bd7b84f84d` could be hardcoded in the client, but i think if there is a reorg this deep we have bigger problems anyways.\n[/quote]\n\nThis is not necessary. As explained in `validation.cpp`:\n\n```cpp\n// Block 490,897 was, in fact, mined with a different coinbase than\n// block 176,684, but it is important to note that even if it hadn't been or\n// is remined on an alternate fork with a duplicate coinbase, we would still\n// not run into a BIP30 violation.  This is because the coinbase for 176,684\n// is spent in block 185,956 in transaction\n```\n\nSo a re-org would have to go all the way back to `185,956`. That's buried below multiple checkpoints. And although we might [get rid of checkpoints](https://github.com/bitcoin/bitcoin/pull/25725) completely, many nodes would consider a reorg that deep a hard fork.",
  "actions_summary": [],
  "moderator": false,
  "admin": false,
  "staff": false,
  "user_id": 71,
  "hidden": false,
  "trust_level": 3,
  "deleted_at": null,
  "user_deleted": false,
  "edit_reason": null,
  "can_view_edit_history": true,
  "wiki": false,
  "reactions": [],
  "current_user_reaction": null,
  "reaction_users_count": 0,
  "current_user_used_main_reaction": false
}