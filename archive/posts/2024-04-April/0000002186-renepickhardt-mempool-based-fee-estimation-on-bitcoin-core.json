{
  "id": 2186,
  "name": "Rene Pickhardt",
  "username": "renepickhardt",
  "avatar_template": "/user_avatar/delvingbitcoin.org/renepickhardt/{size}/7_2.png",
  "created_at": "2024-04-09T13:11:52.484Z",
  "cooked": "<p>Sorry for jumping in a bit late! Until February I have supervised and interacted quite a bit with <a href=\"https://github.com/oscars181/Jugend-Forscht-Fee-Estimator/\" rel=\"noopener nofollow ugc\">a student to study fee estimation via mempool</a> (unfortunately in German language). I wanted to open an issue on github with a summary of our findings but didn\u2019t have the time. Yet I have the feeling this thread may be the right place to add a few thoughts. Apologies if this is not a 100% direct reply to the discussion. If too off-topic, I could move the post to a new thread.</p>\n<p>Before I start I want to emphasize that I really like the direction of this work as I believed that using statistics on the mempool would be good. However the way I interpret Oscar\u2019s results I tend to believe that the problem is much more complicated.</p>\n<h2><a name=\"bitcoin-core-tends-to-overestimate-fees-after-spikes-1\" class=\"anchor\" href=\"#bitcoin-core-tends-to-overestimate-fees-after-spikes-1\"></a>Bitcoin core tends to overestimate fees after spikes</h2>\n<p>First I wanted to share a diagram that show that bitcoin core\u2019s fee estimater tends to overestimate fees for quite some time especially after a spike in fees occured:\n<div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://delvingbitcoin.org/uploads/default/original/1X/3159cb9394c9af3e02d3730c33377042d0abb6a5.jpeg\" data-download-href=\"https://delvingbitcoin.org/uploads/default/3159cb9394c9af3e02d3730c33377042d0abb6a5\" title=\"photo_2024-04-09 14.43.14\"><img src=\"https://delvingbitcoin.org/uploads/default/optimized/1X/3159cb9394c9af3e02d3730c33377042d0abb6a5_2_690x338.jpeg\" alt=\"photo_2024-04-09 14.43.14\" data-base62-sha1=\"72zMrNsjhcPrYlZ1LkXcmf8h6AZ\" width=\"690\" height=\"338\" srcset=\"https://delvingbitcoin.org/uploads/default/optimized/1X/3159cb9394c9af3e02d3730c33377042d0abb6a5_2_690x338.jpeg, https://delvingbitcoin.org/uploads/default/optimized/1X/3159cb9394c9af3e02d3730c33377042d0abb6a5_2_1035x507.jpeg 1.5x, https://delvingbitcoin.org/uploads/default/original/1X/3159cb9394c9af3e02d3730c33377042d0abb6a5.jpeg 2x\" data-dominant-color=\"F4F0F0\"><div class=\"meta\"><svg class=\"fa d-icon d-icon-far-image svg-icon\" aria-hidden=\"true\"><use href=\"#far-image\"></use></svg><span class=\"filename\">photo_2024-04-09 14.43.14</span><span class=\"informations\">1110\u00d7545 71.1 KB</span><svg class=\"fa d-icon d-icon-discourse-expand svg-icon\" aria-hidden=\"true\"><use href=\"#discourse-expand\"></use></svg></div></a></div></p>\n<h2><a name=\"median-or-average-fee-as-a-feature-2\" class=\"anchor\" href=\"#median-or-average-fee-as-a-feature-2\"></a>Median or average Fee as a feature?</h2>\n<p>With respect to <a class=\"mention\" href=\"/u/ismaelsadeeq\">@ismaelsadeeq</a> choosing the median fee as a feature: We had been discussing this quite a bit. Initially we also thought that the median would be a great and obvious statistic to use. However as we have CPFP we could technically have more than 50% of tx and blockspace with really cheap transactions and one child paying for all of them. (Think of a Lightning Network node that force closes all its channels and the txs are bumped via anchors). At the same time miners tend to maximize the total fees in the block. Thus we came to the conclusion that against our own intuition the average fee per byte seems more indicative as a feature to use as it correlates with the total fees of the block.</p>\n<h2><a name=\"mempool-resting-times-of-tx-before-confirmation-as-a-feature-3\" class=\"anchor\" href=\"#mempool-resting-times-of-tx-before-confirmation-as-a-feature-3\"></a>Mempool resting times of tx before confirmation as a feature</h2>\n<p>We identified the distribution of mempool resting times of tx that made it to the current block an useful feature to predict weather we are in a rising or falling fee market. The philosophy is that transactions in the latest block that are longer in the mempool than the block time indicate that not much demand has been happening and older TX are being confirmed. Assuming no sudden demand change this means that the fees would be declining.</p>\n<h2><a name=\"best-predictive-feature-not-applicable-confused-4\" class=\"anchor\" href=\"#best-predictive-feature-not-applicable-confused-4\"></a>Best predictive feature not applicable <img src=\"https://delvingbitcoin.org/images/emoji/twitter/confused.png?v=12\" title=\":confused:\" class=\"emoji\" alt=\":confused:\" loading=\"lazy\" width=\"20\" height=\"20\"></h2>\n<p>The best feature that we were able to extract on historic mempool data was the block time. This makes sense. If a block is found very quickly it is very likely that it includes a large amount of tx that have been resting in the Mempool longer than the blocktime which indicates that fees should decline. On the other hand if a block is not found quickly it is rather likely that users start to push fees up. Obviously we don\u2019t know the next blocktime and cannot use that feature.</p>\n<h2><a name=\"what-about-using-option-pricing-via-black-scholes-5\" class=\"anchor\" href=\"#what-about-using-option-pricing-via-black-scholes-5\"></a>What about using option pricing via Black Scholes</h2>\n<p>Oscar\u2019s work was handed in for a student competition. While the Jury acknowledged the technical depth and awarded a second price they had the criticism that the problem of fee estimation cannot and should not be studied without looking at the behavior of the other participants in the network.</p>\n<p>Changing the fee estimator in bitcoin core might work well for a single node but if all nodes upgrade this may not be reasonable anymore. While we haven\u2019t done so yet the Jury suggest to understand the problem of fee estimation as an option pricing model where one pays fees to have the option to be included in the next block. Consequently the suggested that we should have used <a href=\"https://en.m.wikipedia.org/wiki/Black%E2%80%93Scholes_equation\" rel=\"noopener nofollow ugc\">Black-Scholes Equation</a> to derive a price for such an option instead of just looking at statistics in the current mempool.</p>",
  "post_number": 12,
  "post_type": 1,
  "updated_at": "2024-04-09T13:11:52.484Z",
  "reply_count": 1,
  "reply_to_post_number": null,
  "quote_count": 0,
  "incoming_link_count": 4,
  "reads": 4,
  "readers_count": 3,
  "score": 25.8,
  "yours": false,
  "topic_id": 703,
  "topic_slug": "mempool-based-fee-estimation-on-bitcoin-core",
  "topic_title": "Mempool Based Fee Estimation on Bitcoin Core",
  "topic_html_title": "Mempool Based Fee Estimation on Bitcoin Core",
  "category_id": 8,
  "display_username": "Rene Pickhardt",
  "primary_group_name": null,
  "flair_name": null,
  "flair_url": null,
  "flair_bg_color": null,
  "flair_color": null,
  "flair_group_id": null,
  "version": 1,
  "can_edit": false,
  "can_delete": false,
  "can_recover": false,
  "can_see_hidden_post": false,
  "can_wiki": false,
  "user_title": null,
  "bookmarked": false,
  "raw": "Sorry for jumping in a bit late! Until February I have supervised and interacted quite a bit with [a student to study fee estimation via mempool](https://github.com/oscars181/Jugend-Forscht-Fee-Estimator/) (unfortunately in German language). I wanted to open an issue on github with a summary of our findings but didn't have the time. Yet I have the feeling this thread may be the right place to add a few thoughts. Apologies if this is not a 100% direct reply to the discussion. If too off-topic, I could move the post to a new thread. \n\nBefore I start I want to emphasize that I really like the direction of this work as I believed that using statistics on the mempool would be good. However the way I interpret Oscar's results I tend to believe that the problem is much more complicated. \n\n## Bitcoin core tends to overestimate fees after spikes\n\nFirst I wanted to share a diagram that show that bitcoin core's fee estimater tends to overestimate fees for quite some time especially after a spike in fees occured:\n![photo_2024-04-09 14.43.14|690x338](upload://72zMrNsjhcPrYlZ1LkXcmf8h6AZ.jpeg)\n\n## Median or average Fee as a feature?\n\nWith respect to @ismaelsadeeq choosing the median fee as a feature: We had been discussing this quite a bit. Initially we also thought that the median would be a great and obvious statistic to use. However as we have CPFP we could technically have more than 50% of tx and blockspace with really cheap transactions and one child paying for all of them. (Think of a Lightning Network node that force closes all its channels and the txs are bumped via anchors). At the same time miners tend to maximize the total fees in the block. Thus we came to the conclusion that against our own intuition the average fee per byte seems more indicative as a feature to use as it correlates with the total fees of the block.\n\n## Mempool resting times of tx before confirmation as a feature\n\nWe identified the distribution of mempool resting times of tx that made it to the current block an useful feature to predict weather we are in a rising or falling fee market. The philosophy is that transactions in the latest block that are longer in the mempool than the block time indicate that not much demand has been happening and older TX are being confirmed. Assuming no sudden demand change this means that the fees would be declining. \n\n## Best predictive feature not applicable :confused: \n\nThe best feature that we were able to extract on historic mempool data was the block time. This makes sense. If a block is found very quickly it is very likely that it includes a large amount of tx that have been resting in the Mempool longer than the blocktime which indicates that fees should decline. On the other hand if a block is not found quickly it is rather likely that users start to push fees up. Obviously we don't know the next blocktime and cannot use that feature.\n\n\n## What about using option pricing via Black Scholes\n\nOscar's work was handed in for a student competition. While the Jury acknowledged the technical depth and awarded a second price they had the criticism that the problem of fee estimation cannot and should not be studied without looking at the behavior of the other participants in the network. \n\nChanging the fee estimator in bitcoin core might work well for a single node but if all nodes upgrade this may not be reasonable anymore. While we haven't done so yet the Jury suggest to understand the problem of fee estimation as an option pricing model where one pays fees to have the option to be included in the next block. Consequently the suggested that we should have used [Black-Scholes Equation](https://en.m.wikipedia.org/wiki/Black%E2%80%93Scholes_equation) to derive a price for such an option instead of just looking at statistics in the current mempool.",
  "actions_summary": [],
  "moderator": false,
  "admin": false,
  "staff": false,
  "user_id": 8,
  "hidden": false,
  "trust_level": 2,
  "deleted_at": null,
  "user_deleted": false,
  "edit_reason": null,
  "can_view_edit_history": true,
  "wiki": false,
  "reactions": [],
  "current_user_reaction": null,
  "reaction_users_count": 0,
  "current_user_used_main_reaction": false
}