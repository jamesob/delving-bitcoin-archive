{
  "id": 2215,
  "name": "Chris Stewart",
  "username": "Chris_Stewart_5",
  "avatar_template": "/user_avatar/delvingbitcoin.org/chris_stewart_5/{size}/296_2.png",
  "created_at": "2024-04-12T15:40:48.526Z",
  "cooked": "<p>Hi Ben!</p>\n<p>I don\u2019t believe this can be changed anymore in v1 taproot. We serialize the entire byte representation of the leaf version into the tap leaf hash.</p>\n<p>In other words, we commit to the full byte rather than an individual bit in the leaf version.</p>\n<aside class=\"onebox githubblob\" data-onebox-src=\"https://github.com/bitcoin/bitcoin/blob/0de63b8b46eff5cda85b4950062703324ba65a80/src/script/interpreter.cpp#L1828\">\n  <header class=\"source\">\n\n      <a href=\"https://github.com/bitcoin/bitcoin/blob/0de63b8b46eff5cda85b4950062703324ba65a80/src/script/interpreter.cpp#L1828\" target=\"_blank\" rel=\"noopener nofollow ugc\">github.com</a>\n  </header>\n\n  <article class=\"onebox-body\">\n    <h4><a href=\"https://github.com/bitcoin/bitcoin/blob/0de63b8b46eff5cda85b4950062703324ba65a80/src/script/interpreter.cpp#L1828\" target=\"_blank\" rel=\"noopener nofollow ugc\">bitcoin/bitcoin/blob/0de63b8b46eff5cda85b4950062703324ba65a80/src/script/interpreter.cpp#L1828</a></h4>\n\n\n\n    <pre class=\"onebox\"><code class=\"lang-cpp\">\n      <ol class=\"start lines\" start=\"1818\" style=\"counter-reset: li-counter 1817 ;\">\n          <li></li>\n          <li>    // Run the script interpreter.</li>\n          <li>    if (!EvalScript(stack, exec_script, flags, checker, sigversion, execdata, serror)) return false;</li>\n          <li></li>\n          <li>    // Scripts inside witness implicitly require cleanstack behaviour</li>\n          <li>    if (stack.size() != 1) return set_error(serror, SCRIPT_ERR_CLEANSTACK);</li>\n          <li>    if (!CastToBool(stack.back())) return set_error(serror, SCRIPT_ERR_EVAL_FALSE);</li>\n          <li>    return true;</li>\n          <li>}</li>\n          <li></li>\n          <li class=\"selected\">uint256 ComputeTapleafHash(uint8_t leaf_version, Span&lt;const unsigned char&gt; script)</li>\n          <li>{</li>\n          <li>    return (HashWriter{HASHER_TAPLEAF} &lt;&lt; leaf_version &lt;&lt; CompactSizeWriter(script.size()) &lt;&lt; script).GetSHA256();</li>\n          <li>}</li>\n          <li></li>\n          <li>uint256 ComputeTapbranchHash(Span&lt;const unsigned char&gt; a, Span&lt;const unsigned char&gt; b)</li>\n          <li>{</li>\n          <li>    HashWriter ss_branch{HASHER_TAPBRANCH};</li>\n          <li>    if (std::lexicographical_compare(a.begin(), a.end(), b.begin(), b.end())) {</li>\n          <li>        ss_branch &lt;&lt; a &lt;&lt; b;</li>\n          <li>    } else {</li>\n      </ol>\n    </code></pre>\n\n\n\n  </article>\n\n  <div class=\"onebox-metadata\">\n    \n    \n  </div>\n\n  <div style=\"clear: both\"></div>\n</aside>\n\n<p><a href=\"https://github.com/bitcoin/bitcoin/blob/0de63b8b46eff5cda85b4950062703324ba65a80/src/script/interpreter.cpp#L1929\" rel=\"noopener nofollow ugc\">Whenever we roll out witness version 2, i believe we could change semantics around this</a>. However, when we do roll out version 2 we could totally redefine semantics for leaf versions any way. With the pace we deploy things currently, 256 leaf versions more than adequate imo.</p>",
  "post_number": 3,
  "post_type": 1,
  "updated_at": "2024-04-12T16:28:32.762Z",
  "reply_count": 0,
  "reply_to_post_number": null,
  "quote_count": 0,
  "incoming_link_count": 0,
  "reads": 9,
  "readers_count": 8,
  "score": 1.8,
  "yours": false,
  "topic_id": 698,
  "topic_slug": "leaf-version-as-flags",
  "topic_title": "Leaf Version as Flags",
  "topic_html_title": "Leaf Version as Flags",
  "category_id": 7,
  "display_username": "Chris Stewart",
  "primary_group_name": null,
  "flair_name": null,
  "flair_url": null,
  "flair_bg_color": null,
  "flair_color": null,
  "flair_group_id": null,
  "version": 2,
  "can_edit": false,
  "can_delete": false,
  "can_recover": false,
  "can_see_hidden_post": false,
  "can_wiki": false,
  "user_title": null,
  "bookmarked": false,
  "raw": "Hi Ben! \n\nI don't believe this can be changed anymore in v1 taproot. We serialize the entire byte representation of the leaf version into the tap leaf hash.\n\nIn other words, we commit to the full byte rather than an individual bit in the leaf version.\n\nhttps://github.com/bitcoin/bitcoin/blob/0de63b8b46eff5cda85b4950062703324ba65a80/src/script/interpreter.cpp#L1828\n\n\n[Whenever we roll out witness version 2, i believe we could change semantics around this](https://github.com/bitcoin/bitcoin/blob/0de63b8b46eff5cda85b4950062703324ba65a80/src/script/interpreter.cpp#L1929). However, when we do roll out version 2 we could totally redefine semantics for leaf versions any way. With the pace we deploy things currently, 256 leaf versions more than adequate imo.",
  "actions_summary": [],
  "moderator": false,
  "admin": false,
  "staff": false,
  "user_id": 193,
  "hidden": false,
  "trust_level": 2,
  "deleted_at": null,
  "user_deleted": false,
  "edit_reason": null,
  "can_view_edit_history": true,
  "wiki": false,
  "reactions": [],
  "current_user_reaction": null,
  "reaction_users_count": 0,
  "current_user_used_main_reaction": false
}