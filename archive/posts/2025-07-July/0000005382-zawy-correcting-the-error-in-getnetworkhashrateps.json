{
  "id": 5382,
  "name": "Zawy",
  "username": "zawy",
  "avatar_template": "/user_avatar/delvingbitcoin.org/zawy/{size}/750_2.png",
  "created_at": "2025-07-01T10:57:41.557Z",
  "cooked": "<p>I found the problem. The total work in the <strong>timespan</strong> that N blocks are found is the sum of Ds from 1 to N-1 blocks. When we say W = sum of Ds in N blocks, it\u2019s actually the amount of work done in the timespan covering N+1 blocks.  The sum of Ds in the past N blocks is the work done up until the current time (a randomly chosen time to perform the query), not up until the most recent block\u2019s timestamp. The hashrate doesn\u2019t need the (N-1)/N correction in that case if it divides by the longer timespan in using current time instead of most recent timestamp.</p>\n<p>Hashrate at any height h in the past is</p>\n<p>2^32 * sumD(h+1 to h+N) / timespan(h to h+N+1)</p>\n<p>And the work in that timespan is just this times that timespan.</p>\n<p>In my competing tips example, pretend the last block has not been found, but the ending time is the same and is local time which is the expected time to be randomly looking at both chains. Then both our hashrate and work calculations agree that the tip with the easier difficulty did 33% more work.</p>\n<p>If you want the work done in the solvetime of N blocks, and you sum up the difficulties for those N blocks, then you have to apply the (N-1)/N correction to get the ~correct amount of work in that timespan.</p>\n<p>In deciding a leading tip, you just sum the difficulties as usual because you want the work up until current time, not the last timestamp.</p>",
  "post_number": 15,
  "post_type": 1,
  "posts_count": 14,
  "updated_at": "2025-07-01T14:28:31.915Z",
  "reply_count": 0,
  "reply_to_post_number": null,
  "quote_count": 0,
  "incoming_link_count": 0,
  "reads": 6,
  "readers_count": 5,
  "score": 1.2,
  "yours": false,
  "topic_id": 1745,
  "topic_slug": "correcting-the-error-in-getnetworkhashrateps",
  "topic_title": "Correcting the error in getnetworkhashrateps",
  "topic_html_title": "Correcting the error in getnetworkhashrateps",
  "category_id": 7,
  "display_username": "Zawy",
  "primary_group_name": null,
  "flair_name": null,
  "flair_url": null,
  "flair_bg_color": null,
  "flair_color": null,
  "flair_group_id": null,
  "badges_granted": [],
  "version": 7,
  "can_edit": false,
  "can_delete": false,
  "can_recover": false,
  "can_see_hidden_post": false,
  "can_wiki": false,
  "user_title": null,
  "bookmarked": false,
  "raw": "I found the problem. The total work in the **timespan** that N blocks are found is the sum of Ds from 1 to N-1 blocks. When we say W = sum of Ds in N blocks, it's actually the amount of work done in the timespan covering N+1 blocks.  The sum of Ds in the past N blocks is the work done up until the current time (a randomly chosen time to perform the query), not up until the most recent block's timestamp. The hashrate doesn't need the (N-1)/N correction in that case if it divides by the longer timespan in using current time instead of most recent timestamp.\n\nHashrate at any height h in the past is\n\n2^32 * sumD(h+1 to h+N) / timespan(h to h+N+1)\n\nAnd the work in that timespan is just this times that timespan. \n\nIn my competing tips example, pretend the last block has not been found, but the ending time is the same and is local time which is the expected time to be randomly looking at both chains. Then both our hashrate and work calculations agree that the tip with the easier difficulty did 33% more work.\n\nIf you want the work done in the solvetime of N blocks, and you sum up the difficulties for those N blocks, then you have to apply the (N-1)/N correction to get the ~correct amount of work in that timespan.\n\nIn deciding a leading tip, you just sum the difficulties as usual because you want the work up until current time, not the last timestamp.",
  "actions_summary": [],
  "moderator": false,
  "admin": false,
  "staff": false,
  "user_id": 502,
  "hidden": false,
  "trust_level": 1,
  "deleted_at": null,
  "user_deleted": false,
  "edit_reason": null,
  "can_view_edit_history": true,
  "wiki": false,
  "excerpt": "I found the problem. The total work in the timespan that N blocks are found is the sum of Ds from 1 to N-1 blocks. When we say W = sum of Ds in N blocks, it\u2019s actually the amount of work done in the timespan covering N+1 blocks.  The sum of Ds in the past N blocks is the work done up until the curre&hellip;",
  "truncated": true,
  "post_url": "/t/correcting-the-error-in-getnetworkhashrateps/1745/15",
  "reactions": [],
  "current_user_reaction": null,
  "reaction_users_count": 0,
  "current_user_used_main_reaction": false
}