{
  "id": 4118,
  "name": "Sjors Provoost",
  "username": "sjors",
  "avatar_template": "/user_avatar/delvingbitcoin.org/sjors/{size}/59_2.png",
  "created_at": "2025-01-31T08:02:21.390Z",
  "cooked": "<p>See this comment: <a href=\"https://delvingbitcoin.org/t/great-consensus-cleanup-revival/710/66\" class=\"inline-onebox\">Great Consensus Cleanup Revival - #66 by AntoineP</a></p>\n<p>Although <a class=\"mention\" href=\"/u/antoinep\">@AntoineP</a> now agrees with increasing the grace period, for reasons explained in the above comment, it might still be useful to investigate the following:</p>\n<aside class=\"quote no-group\" data-username=\"AntoineP\" data-post=\"66\" data-topic=\"710\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://delvingbitcoin.org/user_avatar/delvingbitcoin.org/antoinep/48/483_2.png\" class=\"avatar\"><a href=\"https://delvingbitcoin.org/t/great-consensus-cleanup-revival/710/66\">Great Consensus Cleanup Revival</a></div>\n<blockquote>\n<p>Sjors then raises another concern about pool software ignoring the time in the Bitcoin Core provided block template and instead using wall clock time.</p>\n</blockquote>\n</aside>\n<aside class=\"quote no-group\" data-username=\"AntoineP\" data-post=\"66\" data-topic=\"710\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://delvingbitcoin.org/user_avatar/delvingbitcoin.org/antoinep/48/483_2.png\" class=\"avatar\"><a href=\"https://delvingbitcoin.org/t/great-consensus-cleanup-revival/710/66\">Great Consensus Cleanup Revival</a></div>\n<blockquote>\n<p>Further, it\u2019s not clear the timewarp fix is worsening things that much since such software is already vulnerable today to having a timestamp lower than 6 or more of its previous 11 blocks. Contrary to the timewarp fix this can happen on any block and does not even require an attack scenario (misconfigured clock).</p>\n</blockquote>\n</aside>\n<p>Does anyone have a log of when their node saw blocks arrive over e.g. the past 10 years? Perhaps we can determine, or rule out, the presence of such a bug in the wild.</p>\n<p>I don\u2019t know how though.</p>\n<p>One problem with such analysis is that any block violating the MTP rule would not get propagated, so you wouldn\u2019t observe it. Even compact block relay checks the header: <a href=\"https://github.com/bitcoin/bips/blob/5333e5e9514aa9f92810cfbde830da79c44051bf/bip-0152.mediawiki#user-content-PreValidation_Relay_and_Consistency_Considerations\" class=\"inline-onebox\">bips/bip-0152.mediawiki at 5333e5e9514aa9f92810cfbde830da79c44051bf \u00b7 bitcoin/bips \u00b7 GitHub</a></p>\n<p>Another problem is that you don\u2019t know know the clock of the (pool) node that generated the block template.</p>\n<p>A bug that ignores the template timestamp can be present in the pool software, the ASIC (stock or alternative) firmware or a proxy run by the miner.</p>\n<p>If the bug is in pool software, we might be able to observe it live by studying live stratum jobs. This is easy on testnet4 today because MTP is ahead of wall clock time there. But not on mainnet.</p>\n<p>Perhaps long term logs of such jobs exist, though again I\u2019m not sure what to look for.</p>\n<p>It seems a bit less likely to me that ASIC firmware ignores the timestamp provided in its stratum job. My own experience with old linux machines is that NTP doesn\u2019t always work out of the box, so someone would have noticed such a bug the hard way quickly.</p>\n<p>I have no idea how stratum proxies work. Those might exist at the scale of a small mining farm that rarely finds an actual block, so it seems undetectable.</p>",
  "post_number": 35,
  "post_type": 1,
  "updated_at": "2025-01-31T08:32:51.392Z",
  "reply_count": 1,
  "reply_to_post_number": null,
  "quote_count": 0,
  "incoming_link_count": 0,
  "reads": 7,
  "readers_count": 6,
  "score": 6.4,
  "yours": false,
  "topic_id": 1326,
  "topic_slug": "timewarp-attack-600-second-grace-period",
  "topic_title": "Timewarp attack 600 second grace period",
  "topic_html_title": "Timewarp attack 600 second grace period",
  "category_id": 7,
  "display_username": "Sjors Provoost",
  "primary_group_name": null,
  "flair_name": null,
  "flair_url": null,
  "flair_bg_color": null,
  "flair_color": null,
  "flair_group_id": null,
  "badges_granted": [],
  "version": 3,
  "can_edit": false,
  "can_delete": false,
  "can_recover": false,
  "can_see_hidden_post": false,
  "can_wiki": false,
  "user_title": null,
  "bookmarked": false,
  "raw": "See this comment: https://delvingbitcoin.org/t/great-consensus-cleanup-revival/710/66?u=sjors\n\nAlthough @AntoineP now agrees with increasing the grace period, for reasons explained in the above comment, it might still be useful to investigate the following:\n\n[quote=\"AntoineP, post:66, topic:710\"]\nSjors then raises another concern about pool software ignoring the time in the Bitcoin Core provided block template and instead using wall clock time.\n[/quote]\n\n[quote=\"AntoineP, post:66, topic:710\"]\nFurther, it\u2019s not clear the timewarp fix is worsening things that much since such software is already vulnerable today to having a timestamp lower than 6 or more of its previous 11 blocks. Contrary to the timewarp fix this can happen on any block and does not even require an attack scenario (misconfigured clock).\n[/quote]\n\nDoes anyone have a log of when their node saw blocks arrive over e.g. the past 10 years? Perhaps we can determine, or rule out, the presence of such a bug in the wild.\n\nI don't know how though.\n\nOne problem with such analysis is that any block violating the MTP rule would not get propagated, so you wouldn't observe it. Even compact block relay checks the header: https://github.com/bitcoin/bips/blob/5333e5e9514aa9f92810cfbde830da79c44051bf/bip-0152.mediawiki#user-content-PreValidation_Relay_and_Consistency_Considerations\n\nAnother problem is that you don't know know the clock of the (pool) node that generated the block template.\n\nA bug that ignores the template timestamp can be present in the pool software, the ASIC (stock or alternative) firmware or a proxy run by the miner.\n\nIf the bug is in pool software, we might be able to observe it live by studying live stratum jobs. This is easy on testnet4 today because MTP is ahead of wall clock time there. But not on mainnet.\n\nPerhaps long term logs of such jobs exist, though again I'm not sure what to look for.\n\nIt seems a bit less likely to me that ASIC firmware ignores the timestamp provided in its stratum job. My own experience with old linux machines is that NTP doesn't always work out of the box, so someone would have noticed such a bug the hard way quickly.\n\nI have no idea how stratum proxies work. Those might exist at the scale of a small mining farm that rarely finds an actual block, so it seems undetectable.",
  "actions_summary": [],
  "moderator": false,
  "admin": false,
  "staff": false,
  "user_id": 71,
  "hidden": false,
  "trust_level": 3,
  "deleted_at": null,
  "user_deleted": false,
  "edit_reason": "Github link was replaced with a permanent link",
  "can_view_edit_history": true,
  "wiki": false,
  "reactions": [],
  "current_user_reaction": null,
  "reaction_users_count": 0,
  "current_user_used_main_reaction": false
}