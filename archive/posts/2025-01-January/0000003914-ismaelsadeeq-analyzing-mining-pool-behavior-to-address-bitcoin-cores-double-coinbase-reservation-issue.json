{
  "id": 3914,
  "name": "Abubakar Sadiq Ismail",
  "username": "ismaelsadeeq",
  "avatar_template": "/user_avatar/delvingbitcoin.org/ismaelsadeeq/{size}/151_2.png",
  "created_at": "2025-01-01T18:53:06.842Z",
  "cooked": "<p>In theory, Bitcoin Core\u2019s block-building algorithm reserves <strong>4000 WU</strong> for block header, transaction count and miners\u2019 coinbase transactions.\nThis means it should generate a block template with a weight of <strong>3,996,000 WU</strong>.<br>\nHowever, in practice, this is not the case due to an accidental double-reservation bug (<a href=\"https://github.com/bitcoin/bitcoin/issues/21950\" rel=\"noopener nofollow ugc\">see #21950</a>).<br>\nAs a result, Bitcoin Core generates block templates with a weight of <strong>3,992,000 WU</strong>.</p>\n<p>There is an ongoing attempt to fix this issue (<a href=\"https://github.com/bitcoin/bitcoin/pull/31384\" rel=\"noopener nofollow ugc\">see #31384</a>), but there are <a href=\"https://github.com/bitcoin/bitcoin/pull/31384#pullrequestreview-2489253785\" rel=\"noopener nofollow ugc\">concerns</a> that fixing the issue could lead to some miners generating invalid block templates.<br>\nIf the PR were to be merged, mining pools using the updated Bitcoin Core version must ensure the sum of the coinbase transaction weight and the weight of all additional transactions added to the block template must not exceed <strong>4000 WU</strong>.<br>\nOtherwise, the block will exceed the consensus limit for the maximum block weight (<strong>4,000,000 WU</strong>) and be invalid.</p>\n<p>The proposed PR fixes the double reservation issue, which means the block template size is increased by <strong>4000 WU</strong>, resulting in blocks with a weight of <strong>3,996,000 WU</strong> as expected and matches theory.</p>\n<p>Miners or pools needing more than <strong>4000 WU</strong> for their coinbase transactions should configure <code>bitcoind</code> with a lower <code>-blockmaxweight</code> option.<br>\nFor example, starting Bitcoin Core with <code>-blockmaxweight=3999000</code> will free up an additional <strong>1000 WU</strong>.</p>\n<p>The purpose of this analysis is to examine mining pool behavior and determine the feasibility of this change.</p>\n<ul>\n<li><strong>Blocks Analyzed</strong>: 107,313</li>\n<li><strong>Period</strong>: 24th December 2022 to 23rd December 2024</li>\n</ul>\n<h3><a name=\"p-3914-methodology-1\" class=\"anchor\" href=\"#p-3914-methodology-1\"></a>Methodology</h3>\n<ul>\n<li>I\u2019ve used <a href=\"https://github.com/stickies-v/py-bitcoinkernel/\" rel=\"noopener nofollow ugc\">libbitcoinkernel</a> to read blocks from disk.</li>\n<li>Each block is deserialized, and <a href=\"https://github.com/bitcoin-data/mining-pools\" rel=\"noopener nofollow ugc\">bitcoin-data/mining-pools</a> tags are used to match the block to a mining pool. The block weight, coinbase transaction, and mining pool information are then saved to disk.</li>\n<li>After saving the data for the entire block interval, I generated the analysis results using <a href=\"https://github.com/ismaelsadeeq/mining-analysis?tab=readme-ov-file#3-generate_resultspy\" rel=\"noopener nofollow ugc\">this script</a>.</li>\n<li>Charts were generated using a set of <a href=\"https://github.com/ismaelsadeeq/mining-analysis?tab=readme-ov-file#4-graph-generation-scripts\" rel=\"noopener nofollow ugc\">scripts</a>.</li>\n<li>More details on the methodology can be found <a href=\"https://github.com/ismaelsadeeq/mining-analysis\" class=\"inline-onebox\" rel=\"noopener nofollow ugc\">GitHub - ismaelsadeeq/mining-analysis</a>.</li>\n</ul>\n<h2><a name=\"p-3914-results-2\" class=\"anchor\" href=\"#p-3914-results-2\"></a>Results</h2>\n<p>Note: Values in paranthesis represent block heights</p>\n<h3><a name=\"p-3914-pools-generating-blocks-with-coinbase-weight-4000-wu-3\" class=\"anchor\" href=\"#p-3914-pools-generating-blocks-with-coinbase-weight-4000-wu-3\"></a>Pools Generating Blocks with Coinbase Weight &gt; 4000 WU</h3>\n<div class=\"md-table\">\n<table>\n<thead>\n<tr>\n<th>Pool Name</th>\n<th>Average Coinbase weight</th>\n<th>Lowest Coinbase weight</th>\n<th>Highest coinbase weight</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Ocean.xyz</td>\n<td>6994</td>\n<td>5308 (865820)</td>\n<td>9272 (863471)</td>\n</tr>\n<tr>\n<td>Unknown pool</td>\n<td>7432</td>\n<td>7000 (824116)</td>\n<td>7864 (785117)</td>\n</tr>\n</tbody>\n</table>\n</div><h4><a name=\"p-3914-figure-1-box-plot-of-coinbase-transaction-weights-4000-wu-4\" class=\"anchor\" href=\"#p-3914-figure-1-box-plot-of-coinbase-transaction-weights-4000-wu-4\"></a>Figure 1: Box Plot of Coinbase Transaction Weights &gt; 4000 WU</h4>\n<p>This box plot shows the distribution of coinbase transaction weights for pools generating blocks with coinbase weights greater than 4000 WU.</p>\n<p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://delvingbitcoin.org/uploads/default/original/1X/cf05d75ca26418d68fbad2ac530e700ab699572b.png\" data-download-href=\"https://delvingbitcoin.org/uploads/default/cf05d75ca26418d68fbad2ac530e700ab699572b\" title=\"Large Coinbase Transaction Weights\"><img src=\"https://delvingbitcoin.org/uploads/default/optimized/1X/cf05d75ca26418d68fbad2ac530e700ab699572b_2_690x417.png\" alt=\"Large Coinbase Transaction Weights\" data-base62-sha1=\"txplM5i0pl6hVyorGFZL04MFxwL\" width=\"690\" height=\"417\" srcset=\"https://delvingbitcoin.org/uploads/default/optimized/1X/cf05d75ca26418d68fbad2ac530e700ab699572b_2_690x417.png, https://delvingbitcoin.org/uploads/default/optimized/1X/cf05d75ca26418d68fbad2ac530e700ab699572b_2_1035x625.png 1.5x, https://delvingbitcoin.org/uploads/default/optimized/1X/cf05d75ca26418d68fbad2ac530e700ab699572b_2_1380x834.png 2x\" data-dominant-color=\"E6EDF2\"><div class=\"meta\"><svg class=\"fa d-icon d-icon-far-image svg-icon\" aria-hidden=\"true\"><use href=\"#far-image\"></use></svg><span class=\"filename\">Large Coinbase Transaction Weights</span><span class=\"informations\">1800\u00d71090 36 KB</span><svg class=\"fa d-icon d-icon-discourse-expand svg-icon\" aria-hidden=\"true\"><use href=\"#discourse-expand\"></use></svg></div></a></div></p>\n<h3><a name=\"p-3914-remaining-mining-pools-coinbase-stats-5\" class=\"anchor\" href=\"#p-3914-remaining-mining-pools-coinbase-stats-5\"></a>Remaining mining pools coinbase stats</h3>\n<div class=\"md-table\">\n<table>\n<thead>\n<tr>\n<th>Pool Name</th>\n<th>Average Coinbase Weight</th>\n<th>Lowest Coinbase Weight</th>\n<th>Highest Coinbase Weight</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>ViaBTC</td>\n<td>1,128</td>\n<td>864 (778363)</td>\n<td>1,284 (868424)</td>\n</tr>\n<tr>\n<td>Foundry USA</td>\n<td>834</td>\n<td>748 (833764)</td>\n<td>1,192 (868391)</td>\n</tr>\n<tr>\n<td>F2Pool</td>\n<td>1,610</td>\n<td>1,176 (787112)</td>\n<td>1,832 (868388)</td>\n</tr>\n<tr>\n<td>AntPool</td>\n<td>1,357</td>\n<td>732 (814783)</td>\n<td>1,612 (875136)</td>\n</tr>\n<tr>\n<td>Binance Pool</td>\n<td>1,151</td>\n<td>684 (789485)</td>\n<td>1,480 (810101)</td>\n</tr>\n<tr>\n<td>SpiderPool</td>\n<td>997</td>\n<td>704 (817123)</td>\n<td>1,296 (863176)</td>\n</tr>\n<tr>\n<td>Braiins Pool</td>\n<td>1,056</td>\n<td>684 (853433)</td>\n<td>1,232 (785389)</td>\n</tr>\n<tr>\n<td>MARA Pool</td>\n<td>815</td>\n<td>720 (800883)</td>\n<td>1,016 (833308)</td>\n</tr>\n<tr>\n<td>SecPool</td>\n<td>1,371</td>\n<td>1,088 (808120)</td>\n<td>1,460 (871380)</td>\n</tr>\n<tr>\n<td>Poolin</td>\n<td>1,110</td>\n<td>728 (852695)</td>\n<td>1,336 (795979)</td>\n</tr>\n<tr>\n<td>Luxor</td>\n<td>1,237</td>\n<td>780 (770527)</td>\n<td>1,480 (868404)</td>\n</tr>\n<tr>\n<td><a href=\"http://BTC.com\" rel=\"noopener nofollow ugc\">BTC.com</a></td>\n<td>1,205</td>\n<td>740 (796334)</td>\n<td>1,476 (811469)</td>\n</tr>\n<tr>\n<td>Pega Pool</td>\n<td>688</td>\n<td>688 (800892)</td>\n<td>688 (800892)</td>\n</tr>\n<tr>\n<td>Ultimus Pool</td>\n<td>1,209</td>\n<td>1,056 (853449)</td>\n<td>1,444 (844214)</td>\n</tr>\n<tr>\n<td>EMCDPool</td>\n<td>1,082</td>\n<td>1,080 (804771)</td>\n<td>1,304 (795962)</td>\n</tr>\n<tr>\n<td>SBI Crypto</td>\n<td>716</td>\n<td>716 (833247)</td>\n<td>716 (833247)</td>\n</tr>\n<tr>\n<td>NiceHash</td>\n<td>786</td>\n<td>780 (804872)</td>\n<td>828 (870207)</td>\n</tr>\n<tr>\n<td>Titan</td>\n<td>696</td>\n<td>696 (770484)</td>\n<td>696 (770484)</td>\n</tr>\n<tr>\n<td>WhitePool</td>\n<td>887</td>\n<td>676 (820630)</td>\n<td>1,304 (865060)</td>\n</tr>\n<tr>\n<td>KuCoin Pool</td>\n<td>1,095</td>\n<td>1,092 (777136)</td>\n<td>1,316 (796122)</td>\n</tr>\n<tr>\n<td>CleanIncentive</td>\n<td>728</td>\n<td>728 (819134)</td>\n<td>728 (819134)</td>\n</tr>\n<tr>\n<td>1THash</td>\n<td>1,084</td>\n<td>1,084 (837937)</td>\n<td>1,088 (864350)</td>\n</tr>\n<tr>\n<td>EclipseMC</td>\n<td>860</td>\n<td>860 (858559)</td>\n<td>860 (858559)</td>\n</tr>\n<tr>\n<td>Terra Pool</td>\n<td>844</td>\n<td>844 (780190)</td>\n<td>844 (780190)</td>\n</tr>\n<tr>\n<td>CKPool</td>\n<td>856</td>\n<td>856 (863890)</td>\n<td>856 (863890)</td>\n</tr>\n</tbody>\n</table>\n</div><h1><a name=\"p-3914-figure-2-line-chart-of-coinbase-transaction-weights-6\" class=\"anchor\" href=\"#p-3914-figure-2-line-chart-of-coinbase-transaction-weights-6\"></a>Figure 2: Line Chart of Coinbase Transaction Weights</h1>\n<p>This line chart shows the average, minimum, and maximum coinbase transaction weights for various mining pools.\n<div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://delvingbitcoin.org/uploads/default/original/1X/4586aa3a673a10737968add7df4faceaf25ae01a.png\" data-download-href=\"https://delvingbitcoin.org/uploads/default/4586aa3a673a10737968add7df4faceaf25ae01a\" title=\"Line Chart of Coinbase Transaction Weights\"><img src=\"https://delvingbitcoin.org/uploads/default/optimized/1X/4586aa3a673a10737968add7df4faceaf25ae01a_2_690x417.png\" alt=\"Line Chart of Coinbase Transaction Weights\" data-base62-sha1=\"9V3sKOZGNlGSZPRcm22NFSRKSyC\" width=\"690\" height=\"417\" srcset=\"https://delvingbitcoin.org/uploads/default/optimized/1X/4586aa3a673a10737968add7df4faceaf25ae01a_2_690x417.png, https://delvingbitcoin.org/uploads/default/optimized/1X/4586aa3a673a10737968add7df4faceaf25ae01a_2_1035x625.png 1.5x, https://delvingbitcoin.org/uploads/default/optimized/1X/4586aa3a673a10737968add7df4faceaf25ae01a_2_1380x834.png 2x\" data-dominant-color=\"FDFDFC\"><div class=\"meta\"><svg class=\"fa d-icon d-icon-far-image svg-icon\" aria-hidden=\"true\"><use href=\"#far-image\"></use></svg><span class=\"filename\">Line Chart of Coinbase Transaction Weights</span><span class=\"informations\">1800\u00d71090 75.7 KB</span><svg class=\"fa d-icon d-icon-discourse-expand svg-icon\" aria-hidden=\"true\"><use href=\"#discourse-expand\"></use></svg></div></a></div></p>\n<h3><a name=\"p-3914-pools-with-blocks-3996000-wu-7\" class=\"anchor\" href=\"#p-3914-pools-with-blocks-3996000-wu-7\"></a>Pools with Blocks (&gt; 3,996,000 WU)</h3>\n<div class=\"md-table\">\n<table>\n<thead>\n<tr>\n<th>Pool Name</th>\n<th>Average Block Weight</th>\n<th>Lowest Block Weight</th>\n<th>Highest Block Weight</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>F2Pool</td>\n<td>3,997,857</td>\n<td>3,994,044 (828959)</td>\n<td>3,998,554 (779729)</td>\n</tr>\n</tbody>\n</table>\n</div><h3><a name=\"p-3914-pools-with-blocks-3996000-wu-8\" class=\"anchor\" href=\"#p-3914-pools-with-blocks-3996000-wu-8\"></a>Pools with Blocks (&lt; 3,996,000 WU)</h3>\n<div class=\"md-table\">\n<table>\n<thead>\n<tr>\n<th>Pool Name</th>\n<th>Average Block Weight</th>\n<th>Lowest Block Weight</th>\n<th>Highest Block Weight</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Foundry USA</td>\n<td>3,993,030</td>\n<td>3,992,749 (813879)</td>\n<td>3,993,523 (874770)</td>\n</tr>\n<tr>\n<td>Binance Pool</td>\n<td>3,993,348</td>\n<td>3,992,753 (784937)</td>\n<td>3,993,768 (846996)</td>\n</tr>\n<tr>\n<td>MARA Pool</td>\n<td>3,993,017</td>\n<td>3,992,721 (802653)</td>\n<td>3,994,944 (859968)</td>\n</tr>\n<tr>\n<td>Luxor</td>\n<td>3,993,434</td>\n<td>3,992,782 (768718)</td>\n<td>3,993,811 (841510)</td>\n</tr>\n<tr>\n<td>AntPool</td>\n<td>3,993,554</td>\n<td>3,992,868 (814783)</td>\n<td>3,993,918 (873367)</td>\n</tr>\n<tr>\n<td>ViaBTC</td>\n<td>3,993,324</td>\n<td>3,992,881 (782955)</td>\n<td>3,993,612 (872513)</td>\n</tr>\n<tr>\n<td>Poolin</td>\n<td>3,993,308</td>\n<td>3,992,987 (855538)</td>\n<td>3,993,613 (795979)</td>\n</tr>\n<tr>\n<td>Braiins Pool</td>\n<td>3,993,251</td>\n<td>3,992,695 (853433)</td>\n<td>3,993,416 (853776)</td>\n</tr>\n<tr>\n<td>SBI Crypto</td>\n<td>3,992,911</td>\n<td>3,992,717 (796840)</td>\n<td>3,993,047 (834797)</td>\n</tr>\n<tr>\n<td>Ultimus Pool</td>\n<td>3,993,407</td>\n<td>3,993,076 (852748)</td>\n<td>3,993,768 (842345)</td>\n</tr>\n<tr>\n<td><a href=\"http://BTC.com\" rel=\"noopener nofollow ugc\">BTC.com</a></td>\n<td>3,993,399</td>\n<td>3,992,745 (796409)</td>\n<td>3,993,781 (806063)</td>\n</tr>\n<tr>\n<td>SpiderPool</td>\n<td>3,993,190</td>\n<td>3,992,912 (856599)</td>\n<td>3,993,616 (864899)</td>\n</tr>\n<tr>\n<td>WhitePool</td>\n<td>3,993,072</td>\n<td>3,992,677 (825268)</td>\n<td>3,993,631 (872281)</td>\n</tr>\n<tr>\n<td>Ocean.xyz</td>\n<td>3,988,137</td>\n<td>3,986,489 (865820)</td>\n<td>3,990,301 (863471)</td>\n</tr>\n<tr>\n<td>EMCDPool</td>\n<td>3,993,273</td>\n<td>3,993,081 (781934)</td>\n<td>3,993,428 (796046)</td>\n</tr>\n<tr>\n<td>Pega Pool</td>\n<td>3,992,894</td>\n<td>3,992,690 (783729)</td>\n<td>3,993,018 (781576)</td>\n</tr>\n<tr>\n<td>Titan</td>\n<td>3,992,974</td>\n<td>3,992,926 (768641)</td>\n<td>3,993,020 (769939)</td>\n</tr>\n<tr>\n<td>KuCoin Pool</td>\n<td>3,993,282</td>\n<td>3,993,101 (781030)</td>\n<td>3,993,504 (796188)</td>\n</tr>\n<tr>\n<td>Terra Pool</td>\n<td>3,993,032</td>\n<td>3,992,863 (776927)</td>\n<td>3,993,172 (780396)</td>\n</tr>\n<tr>\n<td>CleanIncentive</td>\n<td>3,992,946</td>\n<td>3,992,748 (823029)</td>\n<td>3,993,038 (822604)</td>\n</tr>\n<tr>\n<td>1THash</td>\n<td>3,993,276</td>\n<td>3,993,085 (837937)</td>\n<td>3,993,412 (814830)</td>\n</tr>\n<tr>\n<td>NiceHash</td>\n<td>3,992,987</td>\n<td>3,992,782 (789503)</td>\n<td>3,993,148 (785085)</td>\n</tr>\n<tr>\n<td>CKPool</td>\n<td>3,993,102</td>\n<td>3,992,897 (863890)</td>\n<td>3,993,181 (822636)</td>\n</tr>\n</tbody>\n</table>\n</div><h4><a name=\"p-3914-figure-3-line-chart-of-mining-pool-block-weights-9\" class=\"anchor\" href=\"#p-3914-figure-3-line-chart-of-mining-pool-block-weights-9\"></a>Figure 3: Line Chart of Mining pool block Weights</h4>\n<p>This line chart shows the average, minimum, and maximum block weights for various mining pools.</p>\n<p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://delvingbitcoin.org/uploads/default/original/1X/1a62ca490660618be2f30b7059cc4f78356cec3b.png\" data-download-href=\"https://delvingbitcoin.org/uploads/default/1a62ca490660618be2f30b7059cc4f78356cec3b\" title=\"Block Weights for Pools\"><img src=\"https://delvingbitcoin.org/uploads/default/optimized/1X/1a62ca490660618be2f30b7059cc4f78356cec3b_2_690x417.png\" alt=\"Block Weights for Pools\" data-base62-sha1=\"3Lq4pJ9Ur9jpFqOYzRXohjAclOb\" width=\"690\" height=\"417\" srcset=\"https://delvingbitcoin.org/uploads/default/optimized/1X/1a62ca490660618be2f30b7059cc4f78356cec3b_2_690x417.png, https://delvingbitcoin.org/uploads/default/optimized/1X/1a62ca490660618be2f30b7059cc4f78356cec3b_2_1035x625.png 1.5x, https://delvingbitcoin.org/uploads/default/optimized/1X/1a62ca490660618be2f30b7059cc4f78356cec3b_2_1380x834.png 2x\" data-dominant-color=\"FCFDFC\"><div class=\"meta\"><svg class=\"fa d-icon d-icon-far-image svg-icon\" aria-hidden=\"true\"><use href=\"#far-image\"></use></svg><span class=\"filename\">Block Weights for Pools</span><span class=\"informations\">1800\u00d71090 86.4 KB</span><svg class=\"fa d-icon d-icon-discourse-expand svg-icon\" aria-hidden=\"true\"><use href=\"#discourse-expand\"></use></svg></div></a></div></p>\n<h3><a name=\"p-3914-key-observations-10\" class=\"anchor\" href=\"#p-3914-key-observations-10\"></a>Key Observations</h3>\n<ul>\n<li>Most mining pools adhere to Bitcoin Core\u2019s default setup, keeping coinbase transaction weights well below <strong>4000 WU</strong>. However, two pools stand out:\n<ul>\n<li><strong>Ocean.xyz</strong> consistently uses larger coinbase transactions, with an average weight of <strong>6,994 WU</strong>. Their smallest coinbase weight was <strong>5,308 WU</strong> (in block 865820), and their largest reached <strong>9,272 WU</strong> (block 863471). This suggests Ocean.xyz configures its node with a reduced <code>-blockmaxweight</code> setting, as their average block size is <strong>3,986,489 WU</strong>, well below the default template size.</li>\n<li>An <strong>Unknown Pool/miner</strong> also exceeded the default coinbase weight, averaging <strong>7,432 WU</strong>, with a maximum of <strong>7,864 WU</strong> but a very low block weight average which is unusual behavior.</li>\n</ul>\n</li>\n<li><strong>F2Pool</strong> blocks have an average weight of <strong>3,997,857 WU</strong>. For instance, block <strong>779729</strong> reached <strong>3,998,554 WU</strong> with a coinbase weight of just <strong>1,588 WU</strong>, showcasing F2 optimal use of the available block weight.</li>\n<li>The majority of pools\u2014such as Foundry USA, Binance Pool, and AntPool\u2014produce blocks averaging around <strong>3,993,000 WU</strong>, consistent with Bitcoin Core\u2019s current behavior. However, this depicts underutilization which is a direct result of the double-reservation bug.</li>\n<li><s>The small increase in the weights of the blocks among these pools suggests minor additions of transactions by miners after building a block template</s>.</li>\n<li>The small increase in the weights of the blocks after selecting the transactions is accounted for the block headers, as noted by <a class=\"mention\" href=\"/u/0xb10c\">@0xB10C</a> <a href=\"https://delvingbitcoin.org/t/analyzing-mining-pool-behavior-to-address-bitcoin-cores-double-coinbase-reservation-issue/1351/4\">here</a></li>\n</ul>\n<p>If the double-reservation issue is fixed, block templates will increase to <strong>3,996,000 WU</strong>, aligning theoretical and actual limits. This change benefits pools by allowing full utilization of the block weight while preserving <strong>4000 WU</strong> for coinbase transactions and other small additions.</p>\n<p>Miners who need more space, such as Ocean.xyz, can still configure their nodes with a reduced <code>-blockmaxweight</code>. For example, setting it to <strong>3,999,000 WU</strong> frees up <strong>1000 WU</strong> for larger coinbase transactions, ensuring compliance with consensus rules.</p>\n<p>I think addressing this bug will enhance fairness across the mining pools and fix the ambiguity for developers working with the bitcoin core codebase.</p>",
  "post_number": 1,
  "post_type": 1,
  "posts_count": 7,
  "updated_at": "2025-01-16T18:37:06.929Z",
  "reply_count": 2,
  "reply_to_post_number": null,
  "quote_count": 0,
  "incoming_link_count": 309,
  "reads": 54,
  "readers_count": 53,
  "score": 1715.8,
  "yours": false,
  "topic_id": 1351,
  "topic_slug": "analyzing-mining-pool-behavior-to-address-bitcoin-cores-double-coinbase-reservation-issue",
  "topic_title": "Analyzing Mining Pool Behavior to Address Bitcoin Core's Double Coinbase Reservation Issue",
  "topic_html_title": "Analyzing Mining Pool Behavior to Address Bitcoin Core&rsquo;s Double Coinbase Reservation Issue",
  "category_id": 8,
  "display_username": "Abubakar Sadiq Ismail",
  "primary_group_name": null,
  "flair_name": null,
  "flair_url": null,
  "flair_bg_color": null,
  "flair_color": null,
  "flair_group_id": null,
  "badges_granted": [],
  "version": 8,
  "can_edit": false,
  "can_delete": false,
  "can_recover": false,
  "can_see_hidden_post": false,
  "can_wiki": false,
  "user_title": null,
  "bookmarked": false,
  "raw": "In theory, Bitcoin Core's block-building algorithm reserves **4000 WU** for block header, transaction count and miners' coinbase transactions.\nThis means it should generate a block template with a weight of **3,996,000 WU**.  \nHowever, in practice, this is not the case due to an accidental double-reservation bug ([see #21950](https://github.com/bitcoin/bitcoin/issues/21950)).  \nAs a result, Bitcoin Core generates block templates with a weight of **3,992,000 WU**.  \n\nThere is an ongoing attempt to fix this issue ([see #31384](https://github.com/bitcoin/bitcoin/pull/31384)), but there are [concerns](https://github.com/bitcoin/bitcoin/pull/31384#pullrequestreview-2489253785) that fixing the issue could lead to some miners generating invalid block templates.  \nIf the PR were to be merged, mining pools using the updated Bitcoin Core version must ensure the sum of the coinbase transaction weight and the weight of all additional transactions added to the block template must not exceed **4000 WU**.  \nOtherwise, the block will exceed the consensus limit for the maximum block weight (**4,000,000 WU**) and be invalid.\n\nThe proposed PR fixes the double reservation issue, which means the block template size is increased by **4000 WU**, resulting in blocks with a weight of **3,996,000 WU** as expected and matches theory.\n\nMiners or pools needing more than **4000 WU** for their coinbase transactions should configure `bitcoind` with a lower `-blockmaxweight` option.  \nFor example, starting Bitcoin Core with `-blockmaxweight=3999000` will free up an additional **1000 WU**.  \n\nThe purpose of this analysis is to examine mining pool behavior and determine the feasibility of this change.\n- **Blocks Analyzed**: 107,313  \n- **Period**: 24th December 2022 to 23rd December 2024\n### Methodology\n\n- I've used [libbitcoinkernel](https://github.com/stickies-v/py-bitcoinkernel/) to read blocks from disk.  \n- Each block is deserialized, and [bitcoin-data/mining-pools](https://github.com/bitcoin-data/mining-pools) tags are used to match the block to a mining pool. The block weight, coinbase transaction, and mining pool information are then saved to disk.  \n- After saving the data for the entire block interval, I generated the analysis results using [this script](https://github.com/ismaelsadeeq/mining-analysis?tab=readme-ov-file#3-generate_resultspy).  \n- Charts were generated using a set of [scripts](https://github.com/ismaelsadeeq/mining-analysis?tab=readme-ov-file#4-graph-generation-scripts).  \n- More details on the methodology can be found https://github.com/ismaelsadeeq/mining-analysis.\n\n\n## Results\n\nNote: Values in paranthesis represent block heights\n\n### Pools Generating Blocks with Coinbase Weight > 4000 WU\n\n|Pool Name | Average Coinbase weight  | Lowest Coinbase weight | Highest coinbase weight |\n|--- | --- | --- | --- |\n|Ocean.xyz | 6994 | 5308 (865820) | 9272 (863471) |\n|Unknown pool | 7432 | 7000 (824116) | 7864 (785117) |\n\n#### Figure 1: Box Plot of Coinbase Transaction Weights > 4000 WU\nThis box plot shows the distribution of coinbase transaction weights for pools generating blocks with coinbase weights greater than 4000 WU.\n\n![Large Coinbase Transaction Weights|690x417](upload://txplM5i0pl6hVyorGFZL04MFxwL.png)\n\n### Remaining mining pools coinbase stats\n\n|Pool Name|Average Coinbase Weight|Lowest Coinbase Weight|Highest Coinbase Weight|\n|---------|---------------------|---------------------|---------------------|\n|ViaBTC|1,128|864 (778363)|1,284 (868424)|\n|Foundry USA|834|748 (833764)|1,192 (868391)|\n|F2Pool|1,610|1,176 (787112)|1,832 (868388)|\n|AntPool|1,357|732 (814783)|1,612 (875136)|\n|Binance Pool|1,151|684 (789485)|1,480 (810101)|\n|SpiderPool|997|704 (817123)|1,296 (863176)|\n|Braiins Pool|1,056|684 (853433)|1,232 (785389)|\n|MARA Pool|815|720 (800883)|1,016 (833308)|\n|SecPool|1,371|1,088 (808120)|1,460 (871380)|\n|Poolin|1,110|728 (852695)|1,336 (795979)|\n|Luxor|1,237|780 (770527)|1,480 (868404)|\n|BTC.com|1,205|740 (796334)|1,476 (811469)|\n|Pega Pool|688|688 (800892)|688 (800892)|\n|Ultimus Pool|1,209|1,056 (853449)|1,444 (844214)|\n|EMCDPool|1,082|1,080 (804771)|1,304 (795962)|\n|SBI Crypto|716|716 (833247)|716 (833247)|\n|NiceHash|786|780 (804872)|828 (870207)|\n|Titan|696|696 (770484)|696 (770484)|\n|WhitePool|887|676 (820630)|1,304 (865060)|\n|KuCoin Pool|1,095|1,092 (777136)|1,316 (796122)|\n|CleanIncentive|728|728 (819134)|728 (819134)|\n|1THash|1,084|1,084 (837937)|1,088 (864350)|\n|EclipseMC|860|860 (858559)|860 (858559)|\n|Terra Pool|844|844 (780190)|844 (780190)|\n|CKPool|856|856 (863890)|856 (863890)|\n\n# Figure 2: Line Chart of Coinbase Transaction Weights\nThis line chart shows the average, minimum, and maximum coinbase transaction weights for various mining pools.\n![Line Chart of Coinbase Transaction Weights|690x417](upload://9V3sKOZGNlGSZPRcm22NFSRKSyC.png)\n\n### Pools with Blocks (> 3,996,000 WU)\n\n\n| Pool Name | Average Block Weight | Lowest Block Weight | Highest Block Weight |\n| --- | --- | --- | --- |\n| F2Pool | 3,997,857 | 3,994,044 (828959) | 3,998,554 (779729) |\n\n### Pools with Blocks (< 3,996,000 WU)\n\n| Pool Name | Average Block Weight | Lowest Block Weight | Highest Block Weight |\n| --- | --- | --- | --- |\n| Foundry USA    | 3,993,030         | 3,992,749 (813879)       | 3,993,523 (874770) |\n| Binance Pool   | 3,993,348         | 3,992,753 (784937)       | 3,993,768 (846996) |\n| MARA Pool      | 3,993,017         | 3,992,721 (802653)       | 3,994,944 (859968) |\n| Luxor          | 3,993,434         | 3,992,782 (768718)       | 3,993,811 (841510) |\n| AntPool        | 3,993,554         | 3,992,868 (814783)       | 3,993,918 (873367) |\n| ViaBTC         | 3,993,324         | 3,992,881 (782955)       | 3,993,612 (872513) |\n| Poolin         | 3,993,308         | 3,992,987 (855538)       | 3,993,613 (795979) |\n| Braiins Pool   | 3,993,251         | 3,992,695 (853433)       | 3,993,416 (853776) |\n| SBI Crypto     | 3,992,911         | 3,992,717 (796840)       | 3,993,047 (834797) |\n| Ultimus Pool   | 3,993,407         | 3,993,076 (852748)       | 3,993,768 (842345) |\n| BTC.com        | 3,993,399         | 3,992,745 (796409)       | 3,993,781 (806063) |\n| SpiderPool     | 3,993,190         | 3,992,912 (856599)       | 3,993,616 (864899) |\n| WhitePool      | 3,993,072         | 3,992,677 (825268)       | 3,993,631 (872281) |\n| Ocean.xyz      | 3,988,137         | 3,986,489 (865820)       | 3,990,301 (863471) |\n| EMCDPool       | 3,993,273         | 3,993,081 (781934)       | 3,993,428 (796046) |\n| Pega Pool      | 3,992,894         | 3,992,690 (783729)       | 3,993,018 (781576) |\n| Titan          | 3,992,974         | 3,992,926 (768641)       | 3,993,020 (769939) |\n| KuCoin Pool    | 3,993,282         | 3,993,101 (781030)       | 3,993,504 (796188) |\n| Terra Pool     | 3,993,032         | 3,992,863 (776927)       | 3,993,172 (780396) |\n| CleanIncentive | 3,992,946         | 3,992,748 (823029)       | 3,993,038 (822604) |\n| 1THash         | 3,993,276         | 3,993,085 (837937)       | 3,993,412 (814830) |\n| NiceHash       | 3,992,987         | 3,992,782 (789503)       | 3,993,148 (785085) |\n| CKPool         | 3,993,102         | 3,992,897 (863890)       | 3,993,181 (822636) |\n\n#### Figure 3: Line Chart of Mining pool block Weights\nThis line chart shows the average, minimum, and maximum block weights for various mining pools.\n\n![Block Weights for Pools|690x417](upload://3Lq4pJ9Ur9jpFqOYzRXohjAclOb.png)\n\n\n### Key Observations\n\n- Most mining pools adhere to Bitcoin Core\u2019s default setup, keeping coinbase transaction weights well below **4000 WU**. However, two pools stand out:\n  - **Ocean.xyz** consistently uses larger coinbase transactions, with an average weight of **6,994 WU**. Their smallest coinbase weight was **5,308 WU** (in block 865820), and their largest reached **9,272 WU** (block 863471). This suggests Ocean.xyz configures its node with a reduced `-blockmaxweight` setting, as their average block size is **3,986,489 WU**, well below the default template size.\n  - An **Unknown Pool/miner** also exceeded the default coinbase weight, averaging **7,432 WU**, with a maximum of **7,864 WU** but a very low block weight average which is unusual behavior.\n- **F2Pool** blocks have an average weight of **3,997,857 WU**. For instance, block **779729** reached **3,998,554 WU** with a coinbase weight of just **1,588 WU**, showcasing F2 optimal use of the available block weight.\n- The majority of pools\u2014such as Foundry USA, Binance Pool, and AntPool\u2014produce blocks averaging around **3,993,000 WU**, consistent with Bitcoin Core\u2019s current behavior. However, this depicts underutilization which is a direct result of the double-reservation bug.\n- ~~The small increase in the weights of the blocks among these pools suggests minor additions of transactions by miners after building a block template~~.\n- The small increase in the weights of the blocks after selecting the transactions is accounted for the block headers, as noted by @0xB10C [here](https://delvingbitcoin.org/t/analyzing-mining-pool-behavior-to-address-bitcoin-cores-double-coinbase-reservation-issue/1351/4?u=ismaelsadeeq)\n\nIf the double-reservation issue is fixed, block templates will increase to **3,996,000 WU**, aligning theoretical and actual limits. This change benefits pools by allowing full utilization of the block weight while preserving **4000 WU** for coinbase transactions and other small additions.\n\nMiners who need more space, such as Ocean.xyz, can still configure their nodes with a reduced `-blockmaxweight`. For example, setting it to **3,999,000 WU** frees up **1000 WU** for larger coinbase transactions, ensuring compliance with consensus rules.\n\nI think addressing this bug will enhance fairness across the mining pools and fix the ambiguity for developers working with the bitcoin core codebase.",
  "actions_summary": [
    {
      "id": 2,
      "count": 10
    }
  ],
  "moderator": false,
  "admin": false,
  "staff": false,
  "user_id": 135,
  "hidden": false,
  "trust_level": 2,
  "deleted_at": null,
  "user_deleted": false,
  "edit_reason": null,
  "can_view_edit_history": true,
  "wiki": false,
  "excerpt": "In theory, Bitcoin Core\u2019s block-building algorithm reserves 4000 WU for block header, transaction count and miners\u2019 coinbase transactions.\nThis means it should generate a block template with a weight of 3,996,000 WU. \nHowever, in practice, this is not the case due to an accidental double-reservation&hellip;",
  "truncated": true,
  "post_url": "/t/analyzing-mining-pool-behavior-to-address-bitcoin-cores-double-coinbase-reservation-issue/1351/1",
  "reactions": [
    {
      "id": "+1",
      "type": "emoji",
      "count": 5
    },
    {
      "id": "heart",
      "type": "emoji",
      "count": 5
    }
  ],
  "current_user_reaction": null,
  "reaction_users_count": 10,
  "current_user_used_main_reaction": false,
  "can_accept_answer": false,
  "can_unaccept_answer": false,
  "accepted_answer": false,
  "topic_accepted_answer": null,
  "can_vote": false
}