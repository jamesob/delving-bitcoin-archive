{
  "id": 4009,
  "name": "Pieter Wuille",
  "username": "sipa",
  "avatar_template": "/user_avatar/delvingbitcoin.org/sipa/{size}/102_2.png",
  "created_at": "2025-01-07T15:03:12.090Z",
  "cooked": "<p><a class=\"mention\" href=\"/u/zawy\">@zawy</a> Imagine the proposed rule, that the first block in a period (i.e., one where <span class=\"math\">n = 0 \\mod 2016</span>) must have a timestamp no more than 600s before its immediate predecessor (the last block of the previous period).</p>\n<p>Call this constant <span class=\"math\">G = 600</span> (grace period). Also introduce <span class=\"math\">P = 2016 \\cdot 600</span> (the period, 2 weeks).</p>\n<p>For simplicity, let\u2019s replace the \u201ctimestamp must be strictly larger than MTP\u201d rule with a \u201ctimestamp must not be below MTP\u201d rule (i.e., we allow timestamp=MTP). This doesn\u2019t materially affect the attack, but means we don\u2019t need to increment by 1s every 6 blocks.</p>\n<p>The following sequence of timestamps for periods is valid, starting at time <span class=\"math\">0</span>:</p>\n<ul>\n<li>Period 0: [<span class=\"math\">0</span>, <span class=\"math\">0</span>, <span class=\"math\">0</span>, \u2026, <span class=\"math\">0</span>, <span class=\"math\">0</span>, <span class=\"math\">P</span>].</li>\n<li>Period 1: [<span class=\"math\">P-G</span>, <span class=\"math\">P-G</span>, \u2026, <span class=\"math\">P-G</span>, <span class=\"math\">2P-G</span>].</li>\n<li>Period 2: [<span class=\"math\">2P-2G</span>, \u2026, <span class=\"math\">3P-2G</span>].</li>\n<li>Period 3: [<span class=\"math\">3P-3G</span>, \u2026, <span class=\"math\">4P-3G</span>],</li>\n<li>\u2026</li>\n<li>Period <span class=\"math\">k</span>: [<span class=\"math\">kP-kG</span>, \u2026, <span class=\"math\">(1+k)P-kG</span>].</li>\n</ul>\n<p>Within each period, the difference between the first and last block timestamp is exactly <span class=\"math\">P</span>, so the difficulty will not adjust. However, the net timestamp increase per period is only <span class=\"math\">P-G</span>, i.e., 10 minutes less than 2 weeks.</p>\n<p>So this allows attacker to permanently keep the block rate higher than intended, without incurring a difficulty increase cost.</p>\n<p>The reason for the 600s grace period is that is compensates the effect of the off-by-one in the difficulty calculation (it only looks at how long 2015 blocks take, not 2016), which would otherwise result in (under constant hashrate) periods of 2 weeks <em>plus</em> 10 minutes. So with the proposed rule, a timewarp attacker can not cause a steady constant-difficulty block production rate of more than 2016 per two weeks.</p>\n<p>There is another effect due to asymmetry of the Erlang distribution that results in another 10 minutes lengthening under constant hashrate. I forget why this isn\u2019t incorporated for compensation in the proposed GCC rule.</p>\n<p>EDIT: ah, it\u2019s explained in footnote [1] in <a href=\"https://github.com/TheBlueMatt/bips/blob/7f9670b643b7c943a0cc6d2197d3eabe661050c2/bip-XXXX.mediawiki\" class=\"inline-onebox\">bips/bip-XXXX.mediawiki at 7f9670b643b7c943a0cc6d2197d3eabe661050c2 \u00b7 TheBlueMatt/bips \u00b7 GitHub</a>. The attacker can ignore the first effect but not the second.</p>",
  "post_number": 28,
  "post_type": 1,
  "updated_at": "2025-01-07T15:18:24.296Z",
  "reply_count": 1,
  "reply_to_post_number": null,
  "quote_count": 0,
  "incoming_link_count": 0,
  "reads": 14,
  "readers_count": 13,
  "score": 22.8,
  "yours": false,
  "topic_id": 1326,
  "topic_slug": "timewarp-attack-600-second-grace-period",
  "topic_title": "Timewarp attack 600 second grace period",
  "topic_html_title": "Timewarp attack 600 second grace period",
  "category_id": 7,
  "display_username": "Pieter Wuille",
  "primary_group_name": null,
  "flair_name": null,
  "flair_url": null,
  "flair_bg_color": null,
  "flair_color": null,
  "flair_group_id": null,
  "badges_granted": [],
  "version": 4,
  "can_edit": false,
  "can_delete": false,
  "can_recover": false,
  "can_see_hidden_post": false,
  "can_wiki": false,
  "user_title": null,
  "bookmarked": false,
  "raw": "@zawy Imagine the proposed rule, that the first block in a period (i.e., one where $n = 0 \\mod 2016$) must have a timestamp no more than 600s before its immediate predecessor (the last block of the previous period).\n\nCall this constant $G = 600$ (grace period). Also introduce $P = 2016 \\cdot 600$ (the period, 2 weeks).\n\nFor simplicity, let's replace the \"timestamp must be strictly larger than MTP\" rule with a \"timestamp must not be below MTP\" rule (i.e., we allow timestamp=MTP). This doesn't materially affect the attack, but means we don't need to increment by 1s every 6 blocks.\n\nThe following sequence of timestamps for periods is valid, starting at time $0$:\n* Period 0: [$0$, $0$, $0$, ..., $0$, $0$, $P$].\n* Period 1: [$P-G$, $P-G$, ..., $P-G$, $2P-G$].\n* Period 2: [$2P-2G$, ..., $3P-2G$].\n* Period 3: [$3P-3G$, ..., $4P-3G$],\n* ...\n* Period $k$: [$kP-kG$, ..., $(1+k)P-kG$].\n\nWithin each period, the difference between the first and last block timestamp is exactly $P$, so the difficulty will not adjust. However, the net timestamp increase per period is only $P-G$, i.e., 10 minutes less than 2 weeks.\n\nSo this allows attacker to permanently keep the block rate higher than intended, without incurring a difficulty increase cost.\n\nThe reason for the 600s grace period is that is compensates the effect of the off-by-one in the difficulty calculation (it only looks at how long 2015 blocks take, not 2016), which would otherwise result in (under constant hashrate) periods of 2 weeks *plus* 10 minutes. So with the proposed rule, a timewarp attacker can not cause a steady constant-difficulty block production rate of more than 2016 per two weeks.\n\nThere is another effect due to asymmetry of the Erlang distribution that results in another 10 minutes lengthening under constant hashrate. I forget why this isn't incorporated for compensation in the proposed GCC rule.\n\nEDIT: ah, it's explained in footnote [1] in https://github.com/TheBlueMatt/bips/blob/7f9670b643b7c943a0cc6d2197d3eabe661050c2/bip-XXXX.mediawiki. The attacker can ignore the first effect but not the second.",
  "actions_summary": [
    {
      "id": 2,
      "count": 1
    }
  ],
  "moderator": false,
  "admin": false,
  "staff": false,
  "user_id": 96,
  "hidden": false,
  "trust_level": 3,
  "deleted_at": null,
  "user_deleted": false,
  "edit_reason": "Github link was replaced with a permanent link",
  "can_view_edit_history": true,
  "wiki": false,
  "reactions": [
    {
      "id": "+1",
      "type": "emoji",
      "count": 1
    }
  ],
  "current_user_reaction": null,
  "reaction_users_count": 1,
  "current_user_used_main_reaction": false
}