{
  "id": 4884,
  "name": "Rene Pickhardt",
  "username": "renepickhardt",
  "avatar_template": "/user_avatar/delvingbitcoin.org/renepickhardt/{size}/7_2.png",
  "created_at": "2025-04-28T19:08:03.683Z",
  "cooked": "<h1><a name=\"p-4884-good-morning-fellow-lightning-network-developers-1\" class=\"anchor\" href=\"#p-4884-good-morning-fellow-lightning-network-developers-1\"></a>Good morning fellow Lightning Network developers (:</h1>\n<p>Recent analyses suggest that <a href=\"https://bitcoinops.org/en/podcast/2024/12/12/\" rel=\"noopener nofollow ugc\">most channels on the Lightning Network are <strong>expected to be depleted</strong> over time, primarily due to selfish routing behavior within the current protocol design</a>.</p>\n<p>The problem: Depleted channels drastically lower the likelihood of successful payments. Without probing, any given link has roughly a 50% chance of fulfilling a routing request.</p>\n<p><strong>Question:</strong> Can we reasonably do something about this?</p>\n<p>This post collects potential solutions \u2014 please view it as a reference and starting point. I\u2019m happy for feedback, refinements, and critiques.<br>\nSome ideas included might be philosophically undesirable but deserve technical consideration.</p>\n<hr>\n<h1><a name=\"p-4884-h-1-two-broad-strategies-2\" class=\"anchor\" href=\"#p-4884-h-1-two-broad-strategies-2\"></a>1. Two Broad Strategies</h1>\n<ul>\n<li><strong>Protocol changes</strong> (requiring updates)</li>\n<li><strong>Voluntary node behavior changes</strong></li>\n</ul>\n<hr>\n<h1><a name=\"p-4884-h-2-protocol-changes-3\" class=\"anchor\" href=\"#p-4884-h-2-protocol-changes-3\"></a>2. Protocol Changes</h1>\n<p>Changes would modify the LN protocol, sometimes needing broad adoption.</p>\n<hr>\n<h2><a name=\"p-4884-sharing-liquidity-information-4\" class=\"anchor\" href=\"#p-4884-sharing-liquidity-information-4\"></a>Sharing liquidity information</h2>\n<p>Extend the gossip protocol to <a href=\"https://github.com/lightning/bolts/pull/780\" rel=\"noopener nofollow ugc\">share liquidity info</a>, either locally (e.g. the <a href=\"https://en.wikipedia.org/wiki/Friend-to-friend\" rel=\"noopener nofollow ugc\">friend of a friend network</a>) or network-wide.<br>\nEven partial signals (e.g., liquidity at channel ends) could be helpful.</p>\n<ul>\n<li><strong>Pros:</strong><br>\n(Min-cost flow) routing becomes much easier as the uncertainty decreases.</li>\n<li><strong>Cons:</strong><br>\nHonest signaling enforcement, bandwidth, and privacy.</li>\n</ul>\n<hr>\n<h2><a name=\"p-4884-centralized-routing-coordinators-5\" class=\"anchor\" href=\"#p-4884-centralized-routing-coordinators-5\"></a>(Centralized?) routing coordinators</h2>\n<p><a href=\"https://delvingbitcoin.org/t/channel-depletion-ln-topology-cycles-and-rational-behavior-of-nodes/1259\">Selfish node behavior exacerbates depletion</a>. A coordinator could reorder payments for better liquidity use and engage in flow and congestion control. One could see a <a href=\"https://medium.com/@ACINQ/phoenix-wallet-part-4-trampoline-payments-fb1befd027c8\" rel=\"noopener nofollow ugc\">trampoline node as a routing coordinator</a> for its clients</p>\n<ul>\n<li><strong>Pros:</strong><br>\nLess gossip overhead, global optimization possible.</li>\n<li><strong>Cons:</strong><br>\nTrust issues, decentralization concerns, liquidity limits may still remain to some degree.</li>\n</ul>\n<hr>\n<h2><a name=\"p-4884-distance-vector-or-opportunistic-routing-6\" class=\"anchor\" href=\"#p-4884-distance-vector-or-opportunistic-routing-6\"></a>Distance-vector or opportunistic routing</h2>\n<p>Move from source-routing to local, best-effort forwarding decisions.</p>\n<ul>\n<li><strong>Pros:</strong><br>\nForwarders can act on real liquidity, less reliance on probing.</li>\n<li><strong>Cons:</strong><br>\nPrivacy concerns (sender/receiver visible); new forms of selfishness.</li>\n</ul>\n<hr>\n<h2><a name=\"p-4884-symmetric-channel-fees-7\" class=\"anchor\" href=\"#p-4884-symmetric-channel-fees-7\"></a>Symmetric channel fees</h2>\n<p>Enforce fee symmetry between directions to encourage balanced flows.</p>\n<ul>\n<li><strong>Pros:</strong><br>\nSupports circular economies, mitigates depletion.</li>\n<li><strong>Cons:</strong><br>\nNeeds broad adoption \u2014 difficult to bootstrap.</li>\n</ul>\n<hr>\n<h2><a name=\"p-4884-update_update_htlc-partial-forwarding-8\" class=\"anchor\" href=\"#p-4884-update_update_htlc-partial-forwarding-8\"></a><code>update_update_htlc</code>: Partial forwarding</h2>\n<p>Rather than failing large HTLCs, allow partial forwarding (push-relabel style, <a href=\"https://arxiv.org/abs/1708.02419\" rel=\"noopener nofollow ugc\">Rohrer et al. 2017</a>).</p>\n<ul>\n<li><strong>Pros:</strong><br>\nEnables \u201clink AMP\u201d, more natural flow network behavior.</li>\n<li><strong>Cons:</strong><br>\nCould worsen depletion without better depleted-channel signaling.</li>\n</ul>\n<hr>\n<h2><a name=\"p-4884-multiparty-channels-9\" class=\"anchor\" href=\"#p-4884-multiparty-channels-9\"></a>Multiparty channels</h2>\n<p>Using shared UTXOs among multiple participants increases capital efficiency and boosts reliability but <a href=\"https://petertodd.org/2024/covenant-dependent-layer-2-review\" rel=\"noopener nofollow ugc\">they come (even with softforks) with their own challenges</a></p>\n<p><strong>Challenges</strong>:</p>\n<ul>\n<li>Secure unilateral exits</li>\n<li>Interactive complexity</li>\n<li>Multihop routing is unclear</li>\n<li>Potentially rethinking routing itself as that may not be necessary</li>\n</ul>\n<p>Further reading: <a href=\"https://royalsocietypublishing.org/doi/10.1098/rsos.180089\" rel=\"noopener nofollow ugc\">Burchert, Decker, Wattenhofer (2017)</a>.</p>\n<hr>\n<h1><a name=\"p-4884-h-3-behavior-adoption-by-routing-nodes-10\" class=\"anchor\" href=\"#p-4884-h-3-behavior-adoption-by-routing-nodes-10\"></a>3. Behavior Adoption by Routing Nodes</h1>\n<p>There are various ways nodes can voluntarily address liquidity issues.</p>\n<hr>\n<h2><a name=\"p-4884-dynamic-pricing-11\" class=\"anchor\" href=\"#p-4884-dynamic-pricing-11\"></a>Dynamic pricing</h2>\n<p>Already common:</p>\n<ul>\n<li><a href=\"https://corelightning.org/automate-lightning-node-management-with-clboss/\" rel=\"noopener nofollow ugc\">CLBOSS</a>, <a href=\"https://github.com/bitromortac/lndmanage\" rel=\"noopener nofollow ugc\">lndmanage</a></li>\n<li><a href=\"https://diyhpl.us/~bryan/irc/bitcoin/bitcoin-dev/linuxfoundation-pipermail/lightning-dev/2022-September/003685.txt\" rel=\"noopener nofollow ugc\">Fee rate cards</a></li>\n<li><a href=\"https://github.com/lightning/blips/pull/22\" rel=\"noopener nofollow ugc\">Negative fees</a></li>\n<li><a href=\"https://github.com/lightning/bolts/issues/835\" rel=\"noopener nofollow ugc\">Inbound fees</a></li>\n</ul>\n<p><strong>Limits:</strong><br>\nReactions are delayed due to gossip forwarding, based on local information, it is questionable weather the network can find an equilibrium.</p>\n<hr>\n<h2><a name=\"p-4884-flow-and-congestion-control-12\" class=\"anchor\" href=\"#p-4884-flow-and-congestion-control-12\"></a>Flow and congestion control</h2>\n<p>Beyond pricing:</p>\n<ul>\n<li><a href=\"https://blog.bitmex.com/the-power-of-htlc_maximum_msat-as-a-control-valve-for-better-flow-control-improved-reliability-and-lower-expected-payment-failure-rates-on-the-lightning-network/\" rel=\"noopener nofollow ugc\">Use <code>htlc_maximum_msat</code> as a control valve</a></li>\n<li>Available Liquidity may be signaled  via <code>htlc_maximum_msat</code>, which is at least a semantic that nodes understand.</li>\n<li>(<a href=\"https://www.usenix.org/conference/nsdi20/presentation/sivaraman\" rel=\"noopener nofollow ugc\">Sivaraman et al. 2020</a>) proposed a routing scheme based on nodes buffering routing requests for congestion control.</li>\n</ul>\n<p>Semantics of Control valve using <code>htlc_maximum_msat</code> are not agreed upon and is thus not supported by node software.</p>\n<hr>\n<h2><a name=\"p-4884-reverse-logistics-13\" class=\"anchor\" href=\"#p-4884-reverse-logistics-13\"></a>Reverse logistics</h2>\n<p>Relocating liquidity via:</p>\n<ul>\n<li><strong>Off-chain</strong>: <a href=\"https://github.com/alexbosworth/balanceofsatoshis\" rel=\"noopener nofollow ugc\">BOS</a>, decentralized rebalancing (<a href=\"https://arxiv.org/abs/1912.09555\" rel=\"noopener nofollow ugc\">example paper</a>), <a href=\"https://x.com/renepickhardt/status/1909918246020448693\" rel=\"noopener nofollow ugc\">min-cost circulation ideas</a>.</li>\n<li><strong>On-chain</strong>: <a href=\"https://www.peerswap.dev/\" rel=\"noopener nofollow ugc\">PeerSwap</a>, <a href=\"https://lightning.engineering/loop/\" rel=\"noopener nofollow ugc\">Loop</a>, <a href=\"https://lightningsplice.com/splicing_explained.html\" rel=\"noopener nofollow ugc\">Splicing</a>.</li>\n<li><strong>Liquidity markets</strong>: <a href=\"https://bitcoinops.org/en/topics/liquidity-advertisements/\" rel=\"noopener nofollow ugc\">Liquidity Ads</a>, <a href=\"https://amboss.space/magma\" rel=\"noopener nofollow ugc\">proprietary solutions</a>,\u2026</li>\n</ul>\n<p>Note: (Fee Free) offchain rebalancing schemes might also be enabled or supported on a protocol level. In particular offchain rebalancing can be modeled as a <a href=\"https://en.wikipedia.org/wiki/Circulation_problem\" rel=\"noopener nofollow ugc\">circulation problem</a> instead of just finding a single rebalancing cycle.</p>\n<hr>\n<h2><a name=\"p-4884-hierarchical-topologies-14\" class=\"anchor\" href=\"#p-4884-hierarchical-topologies-14\"></a>Hierarchical topologies</h2>\n<p>Organize Lightning like real transport systems (compare with Highway, Trainsystems,\u2026):</p>\n<ul>\n<li>Spanning tree based \u201ccore\u201d node networks (spanning trees don\u00b4t deplete but split if a link breaks)</li>\n<li>Peripheral nodes connect strategically</li>\n<li>Use sparse graphs or skip topologies</li>\n</ul>\n<hr>\n<h1><a name=\"p-4884-h-4-conclusion-15\" class=\"anchor\" href=\"#p-4884-h-4-conclusion-15\"></a>4. Conclusion</h1>\n<p>This is an overview, not a final prescription.</p>\n<p>Many solutions interact and involve trade-offs between implementation overhead, privacy, scalability, and decentralization.</p>\n<p><strong>Feedback, missing ideas, and criticisms welcome!</strong> (:</p>\n<h2><a name=\"p-4884-disclaimer-16\" class=\"anchor\" href=\"#p-4884-disclaimer-16\"></a>Disclaimer:</h2>\n<ol>\n<li>While those strategies may help to fight depletion of channels and improve reliability as they support sending nodes to quickly find the liquidity most of them do not address the fact that <a href=\"https://delvingbitcoin.org/t/estimating-likelihood-for-lightning-payments-to-be-in-feasible/973\">payments can be infeasible in payment channel networks without making additional on chain transactions</a>.</li>\n<li>I have a long form of this text on my computer with a bit more context but used an LLM to make it more succinct for your convenience.</li>\n</ol>",
  "post_number": 1,
  "post_type": 1,
  "posts_count": 7,
  "updated_at": "2025-04-28T19:08:03.683Z",
  "reply_count": 1,
  "reply_to_post_number": null,
  "quote_count": 0,
  "incoming_link_count": 42,
  "reads": 40,
  "readers_count": 39,
  "score": 223.0,
  "yours": false,
  "topic_id": 1640,
  "topic_slug": "mitigating-channel-depletion-in-the-lightning-network-a-survey-of-potential-solutions",
  "topic_title": "Mitigating Channel Depletion in the Lightning Network: A Survey of Potential Solutions",
  "topic_html_title": "Mitigating Channel Depletion in the Lightning Network: A Survey of Potential Solutions",
  "category_id": 7,
  "display_username": "Rene Pickhardt",
  "primary_group_name": null,
  "flair_name": null,
  "flair_url": null,
  "flair_bg_color": null,
  "flair_color": null,
  "flair_group_id": null,
  "badges_granted": [],
  "version": 1,
  "can_edit": false,
  "can_delete": false,
  "can_recover": false,
  "can_see_hidden_post": false,
  "can_wiki": false,
  "user_title": null,
  "bookmarked": false,
  "raw": "# Good morning fellow Lightning Network developers (:\n\nRecent analyses suggest that [most channels on the Lightning Network are **expected to be depleted** over time, primarily due to selfish routing behavior within the current protocol design](https://bitcoinops.org/en/podcast/2024/12/12/).\n\nThe problem: Depleted channels drastically lower the likelihood of successful payments. Without probing, any given link has roughly a 50% chance of fulfilling a routing request.\n\n**Question:** Can we reasonably do something about this?\n\nThis post collects potential solutions \u2014 please view it as a reference and starting point. I'm happy for feedback, refinements, and critiques.  \nSome ideas included might be philosophically undesirable but deserve technical consideration.\n\n---\n\n# 1. Two Broad Strategies\n\n- **Protocol changes** (requiring updates)\n- **Voluntary node behavior changes**\n\n---\n\n# 2. Protocol Changes\n\nChanges would modify the LN protocol, sometimes needing broad adoption.\n\n---\n\n## Sharing liquidity information\n\nExtend the gossip protocol to [share liquidity info](https://github.com/lightning/bolts/pull/780), either locally (e.g. the [friend of a friend network](https://en.wikipedia.org/wiki/Friend-to-friend)) or network-wide.  \nEven partial signals (e.g., liquidity at channel ends) could be helpful.\n\n- **Pros:**  \n  (Min-cost flow) routing becomes much easier as the uncertainty decreases.\n- **Cons:**  \n  Honest signaling enforcement, bandwidth, and privacy.\n\n---\n\n## (Centralized?) routing coordinators\n\n[Selfish node behavior exacerbates depletion](https://delvingbitcoin.org/t/channel-depletion-ln-topology-cycles-and-rational-behavior-of-nodes/1259). A coordinator could reorder payments for better liquidity use and engage in flow and congestion control. One could see a [trampoline node as a routing coordinator](https://medium.com/@ACINQ/phoenix-wallet-part-4-trampoline-payments-fb1befd027c8) for its clients\n\n- **Pros:**  \n  Less gossip overhead, global optimization possible.\n- **Cons:**  \n  Trust issues, decentralization concerns, liquidity limits may still remain to some degree.\n\n---\n\n## Distance-vector or opportunistic routing\n\nMove from source-routing to local, best-effort forwarding decisions.\n\n- **Pros:**  \n  Forwarders can act on real liquidity, less reliance on probing. \n- **Cons:**  \n  Privacy concerns (sender/receiver visible); new forms of selfishness.\n\n---\n\n## Symmetric channel fees\n\nEnforce fee symmetry between directions to encourage balanced flows.\n\n- **Pros:**  \n  Supports circular economies, mitigates depletion.\n- **Cons:**  \n  Needs broad adoption \u2014 difficult to bootstrap.\n\n---\n\n## `update_update_htlc`: Partial forwarding\n\nRather than failing large HTLCs, allow partial forwarding (push-relabel style, [Rohrer et al. 2017](https://arxiv.org/abs/1708.02419)).\n\n- **Pros:**  \n  Enables \"link AMP\", more natural flow network behavior.\n- **Cons:**  \n  Could worsen depletion without better depleted-channel signaling.\n\n---\n\n## Multiparty channels\n\nUsing shared UTXOs among multiple participants increases capital efficiency and boosts reliability but [they come (even with softforks) with their own challenges](https://petertodd.org/2024/covenant-dependent-layer-2-review)\n\n**Challenges**:\n- Secure unilateral exits\n- Interactive complexity\n- Multihop routing is unclear\n- Potentially rethinking routing itself as that may not be necessary\n\nFurther reading: [Burchert, Decker, Wattenhofer (2017)](https://royalsocietypublishing.org/doi/10.1098/rsos.180089).\n\n---\n\n# 3. Behavior Adoption by Routing Nodes\n\nThere are various ways nodes can voluntarily address liquidity issues.\n\n---\n\n## Dynamic pricing\n\nAlready common:  \n- [CLBOSS](https://corelightning.org/automate-lightning-node-management-with-clboss/), [lndmanage](https://github.com/bitromortac/lndmanage)\n- [Fee rate cards](https://diyhpl.us/~bryan/irc/bitcoin/bitcoin-dev/linuxfoundation-pipermail/lightning-dev/2022-September/003685.txt)\n- [Negative fees](https://github.com/lightning/blips/pull/22)\n- [Inbound fees](https://github.com/lightning/bolts/issues/835)\n\n**Limits:**  \nReactions are delayed due to gossip forwarding, based on local information, it is questionable weather the network can find an equilibrium. \n\n---\n\n## Flow and congestion control\n\nBeyond pricing:\n\n- [Use `htlc_maximum_msat` as a control valve](https://blog.bitmex.com/the-power-of-htlc_maximum_msat-as-a-control-valve-for-better-flow-control-improved-reliability-and-lower-expected-payment-failure-rates-on-the-lightning-network/)\n- Available Liquidity may be signaled  via `htlc_maximum_msat`, which is at least a semantic that nodes understand. \n- ([Sivaraman et al. 2020](https://www.usenix.org/conference/nsdi20/presentation/sivaraman)) proposed a routing scheme based on nodes buffering routing requests for congestion control.\n\nSemantics of Control valve using `htlc_maximum_msat` are not agreed upon and is thus not supported by node software.\n\n---\n\n## Reverse logistics\n\nRelocating liquidity via:\n\n- **Off-chain**: [BOS](https://github.com/alexbosworth/balanceofsatoshis), decentralized rebalancing ([example paper](https://arxiv.org/abs/1912.09555)), [min-cost circulation ideas](https://x.com/renepickhardt/status/1909918246020448693).\n- **On-chain**: [PeerSwap](https://www.peerswap.dev/), [Loop](https://lightning.engineering/loop/), [Splicing](https://lightningsplice.com/splicing_explained.html).\n- **Liquidity markets**: [Liquidity Ads](https://bitcoinops.org/en/topics/liquidity-advertisements/), [proprietary solutions](https://amboss.space/magma),...\n\nNote: (Fee Free) offchain rebalancing schemes might also be enabled or supported on a protocol level. In particular offchain rebalancing can be modeled as a [circulation problem](https://en.wikipedia.org/wiki/Circulation_problem) instead of just finding a single rebalancing cycle.\n\n---\n\n## Hierarchical topologies\n\nOrganize Lightning like real transport systems (compare with Highway, Trainsystems,...):\n\n- Spanning tree based \"core\" node networks (spanning trees don\u00b4t deplete but split if a link breaks)\n- Peripheral nodes connect strategically\n- Use sparse graphs or skip topologies\n\n---\n\n# 4. Conclusion\n\nThis is an overview, not a final prescription.\n\nMany solutions interact and involve trade-offs between implementation overhead, privacy, scalability, and decentralization.\n\n**Feedback, missing ideas, and criticisms welcome!** (:\n\n## Disclaimer:\n1. While those strategies may help to fight depletion of channels and improve reliability as they support sending nodes to quickly find the liquidity most of them do not address the fact that [payments can be infeasible in payment channel networks without making additional on chain transactions](https://delvingbitcoin.org/t/estimating-likelihood-for-lightning-payments-to-be-in-feasible/973).  \n2. I have a long form of this text on my computer with a bit more context but used an LLM to make it more succinct for your convenience.",
  "actions_summary": [],
  "moderator": false,
  "admin": false,
  "staff": false,
  "user_id": 8,
  "hidden": false,
  "trust_level": 2,
  "deleted_at": null,
  "user_deleted": false,
  "edit_reason": null,
  "can_view_edit_history": true,
  "wiki": false,
  "excerpt": "<a name=\"p-4884-good-morning-fellow-lightning-network-developers-1\" class=\"anchor\" href=\"#p-4884-good-morning-fellow-lightning-network-developers-1\"></a>Good morning fellow Lightning Network developers (:\nRecent analyses suggest that <a href=\"https://bitcoinops.org/en/podcast/2024/12/12/\" rel=\"noopener nofollow ugc\">most channels on the Lightning Network are expected to be depleted over time, primarily due to selfish routing behavior within the current protocol design</a>. \nThe problem: Depleted channels drastically lower the likelihoo&hellip;",
  "truncated": true,
  "post_url": "/t/mitigating-channel-depletion-in-the-lightning-network-a-survey-of-potential-solutions/1640/1",
  "reactions": [],
  "current_user_reaction": null,
  "reaction_users_count": 0,
  "current_user_used_main_reaction": false,
  "can_accept_answer": false,
  "can_unaccept_answer": false,
  "accepted_answer": false,
  "topic_accepted_answer": null,
  "can_vote": false
}