{
  "id": 4854,
  "name": "Pieter Wuille",
  "username": "sipa",
  "avatar_template": "/user_avatar/delvingbitcoin.org/sipa/{size}/1100_2.png",
  "created_at": "2025-04-22T17:19:50.337Z",
  "cooked": "<h2><a name=\"p-4854-benchmark-results-1\" class=\"anchor\" href=\"#p-4854-benchmark-results-1\"></a>Benchmark results</h2>\n<p>All data is tested in 6 different linearization settings:</p>\n<ul>\n<li>CSS: the candidate-set search algorithm this thread was initially about, both from scratch and when given an optimal linearization as input already.</li>\n<li>SFL: the spanning-forest linearization algorithm, also from scratch and when given an optimal linearization as input already.</li>\n<li>GGT: the parametric min-cut breakpoints algorithm from the 1989 GGT paper, both its full bidirectional version, and a variant that only runs in the forward direction.</li>\n</ul>\n<h3><a name=\"p-4854-simulated-2023-mempools-2\" class=\"anchor\" href=\"#p-4854-simulated-2023-mempools-2\"></a>Simulated 2023 mempools</h3>\n<p>This uses clusters that were created by replaying a dump of 2023 P2P network activity into a cluster-mempool-patched version of Bitcoin Core (by <a class=\"mention\" href=\"/u/sdaftuar\">@sdaftuar</a>), and storing all clusters that appear in a file. This included 199076 clusters of size between 26 and 64 transactions, and over 24 million clusters between 2 and 25 transactions. Note that this is not necessarily representative for what a post-cluster-mempool world will look like, as it enforces a cluster size limit of 64, which may well influence network behavior after adoption.</p>\n<p>Here are two example 64-transaction clusters:</p>\n<p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://delvingbitcoin.org/uploads/default/original/2X/c/c01e008a34c42931e7aeb1f43b23f7f95d1c8208.png\" data-download-href=\"https://delvingbitcoin.org/uploads/default/c01e008a34c42931e7aeb1f43b23f7f95d1c8208\" title=\"sim2023_ggt\"><img src=\"https://delvingbitcoin.org/uploads/default/optimized/2X/c/c01e008a34c42931e7aeb1f43b23f7f95d1c8208_2_172x112.png\" alt=\"sim2023_ggt\" data-base62-sha1=\"rpxX7rby2r1MGgaywce8tU458zm\" width=\"172\" height=\"112\" srcset=\"https://delvingbitcoin.org/uploads/default/optimized/2X/c/c01e008a34c42931e7aeb1f43b23f7f95d1c8208_2_172x112.png, https://delvingbitcoin.org/uploads/default/optimized/2X/c/c01e008a34c42931e7aeb1f43b23f7f95d1c8208_2_258x168.png 1.5x, https://delvingbitcoin.org/uploads/default/optimized/2X/c/c01e008a34c42931e7aeb1f43b23f7f95d1c8208_2_344x224.png 2x\" data-dominant-color=\"F7F7F7\"><div class=\"meta\"><svg class=\"fa d-icon d-icon-far-image svg-icon\" aria-hidden=\"true\"><use href=\"#far-image\"></use></svg><span class=\"filename\">sim2023_ggt</span><span class=\"informations\">2009\u00d71307 302 KB</span><svg class=\"fa d-icon d-icon-discourse-expand svg-icon\" aria-hidden=\"true\"><use href=\"#discourse-expand\"></use></svg></div></a></div>\n<div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://delvingbitcoin.org/uploads/default/original/2X/4/432a3fb0a7b7a0f495733d0b74bff69fa8ac3881.png\" data-download-href=\"https://delvingbitcoin.org/uploads/default/432a3fb0a7b7a0f495733d0b74bff69fa8ac3881\" title=\"sim2023\"><img src=\"https://delvingbitcoin.org/uploads/default/optimized/2X/4/432a3fb0a7b7a0f495733d0b74bff69fa8ac3881_2_510x46.png\" alt=\"sim2023\" data-base62-sha1=\"9Aavvgu4bhZSUHJ7xmDg48H167f\" width=\"510\" height=\"46\" srcset=\"https://delvingbitcoin.org/uploads/default/optimized/2X/4/432a3fb0a7b7a0f495733d0b74bff69fa8ac3881_2_510x46.png, https://delvingbitcoin.org/uploads/default/optimized/2X/4/432a3fb0a7b7a0f495733d0b74bff69fa8ac3881_2_765x69.png 1.5x, https://delvingbitcoin.org/uploads/default/optimized/2X/4/432a3fb0a7b7a0f495733d0b74bff69fa8ac3881_2_1020x92.png 2x\" data-dominant-color=\"F7F7F7\"><div class=\"meta\"><svg class=\"fa d-icon d-icon-far-image svg-icon\" aria-hidden=\"true\"><use href=\"#far-image\"></use></svg><span class=\"filename\">sim2023</span><span class=\"informations\">5847\u00d7539 292 KB</span><svg class=\"fa d-icon d-icon-discourse-expand svg-icon\" aria-hidden=\"true\"><use href=\"#discourse-expand\"></use></svg></div></a></div></p>\n<p>Numbers for 2-25 transaction clusters, based on benchmarks of 17% of the recorded clusters:</p>\n<p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://delvingbitcoin.org/uploads/default/original/2X/7/793fc6101c09310a4f6cc7b404417a9913434ab0.png\" data-download-href=\"https://delvingbitcoin.org/uploads/default/793fc6101c09310a4f6cc7b404417a9913434ab0\" title=\"clusters_sim2023_ntx2_min\"><img src=\"https://delvingbitcoin.org/uploads/default/optimized/2X/7/793fc6101c09310a4f6cc7b404417a9913434ab0_2_227x142.png\" alt=\"clusters_sim2023_ntx2_min\" data-base62-sha1=\"hiCpjVHqapa1jjpXUoLL1vpxW1y\" width=\"227\" height=\"142\" srcset=\"https://delvingbitcoin.org/uploads/default/optimized/2X/7/793fc6101c09310a4f6cc7b404417a9913434ab0_2_227x142.png, https://delvingbitcoin.org/uploads/default/optimized/2X/7/793fc6101c09310a4f6cc7b404417a9913434ab0_2_340x213.png 1.5x, https://delvingbitcoin.org/uploads/default/optimized/2X/7/793fc6101c09310a4f6cc7b404417a9913434ab0_2_454x284.png 2x\" data-dominant-color=\"FBFBFB\"><div class=\"meta\"><svg class=\"fa d-icon d-icon-far-image svg-icon\" aria-hidden=\"true\"><use href=\"#far-image\"></use></svg><span class=\"filename\">clusters_sim2023_ntx2_min</span><span class=\"informations\">1280\u00d7800 75.9 KB</span><svg class=\"fa d-icon d-icon-discourse-expand svg-icon\" aria-hidden=\"true\"><use href=\"#discourse-expand\"></use></svg></div></a></div>\n<div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://delvingbitcoin.org/uploads/default/original/2X/0/0c4991f8a24aa3ad6f8d8bf711bdd39b4caaf403.png\" data-download-href=\"https://delvingbitcoin.org/uploads/default/0c4991f8a24aa3ad6f8d8bf711bdd39b4caaf403\" title=\"clusters_sim2023_ntx2_avg\"><img src=\"https://delvingbitcoin.org/uploads/default/optimized/2X/0/0c4991f8a24aa3ad6f8d8bf711bdd39b4caaf403_2_227x142.png\" alt=\"clusters_sim2023_ntx2_avg\" data-base62-sha1=\"1KHlTcYPVkWV9hNYe8QeMvgqk1B\" width=\"227\" height=\"142\" srcset=\"https://delvingbitcoin.org/uploads/default/optimized/2X/0/0c4991f8a24aa3ad6f8d8bf711bdd39b4caaf403_2_227x142.png, https://delvingbitcoin.org/uploads/default/optimized/2X/0/0c4991f8a24aa3ad6f8d8bf711bdd39b4caaf403_2_340x213.png 1.5x, https://delvingbitcoin.org/uploads/default/optimized/2X/0/0c4991f8a24aa3ad6f8d8bf711bdd39b4caaf403_2_454x284.png 2x\" data-dominant-color=\"FBFBFB\"><div class=\"meta\"><svg class=\"fa d-icon d-icon-far-image svg-icon\" aria-hidden=\"true\"><use href=\"#far-image\"></use></svg><span class=\"filename\">clusters_sim2023_ntx2_avg</span><span class=\"informations\">1280\u00d7800 77.4 KB</span><svg class=\"fa d-icon d-icon-discourse-expand svg-icon\" aria-hidden=\"true\"><use href=\"#discourse-expand\"></use></svg></div></a></div>\n<div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://delvingbitcoin.org/uploads/default/original/2X/7/71105f5683afcc617f20edae580e647522b320b6.png\" data-download-href=\"https://delvingbitcoin.org/uploads/default/71105f5683afcc617f20edae580e647522b320b6\" title=\"clusters_sim2023_ntx2_max\"><img src=\"https://delvingbitcoin.org/uploads/default/optimized/2X/7/71105f5683afcc617f20edae580e647522b320b6_2_227x142.png\" alt=\"clusters_sim2023_ntx2_max\" data-base62-sha1=\"g8d1YBCQEichYnCCWaTY8ZaM2xM\" width=\"227\" height=\"142\" srcset=\"https://delvingbitcoin.org/uploads/default/optimized/2X/7/71105f5683afcc617f20edae580e647522b320b6_2_227x142.png, https://delvingbitcoin.org/uploads/default/optimized/2X/7/71105f5683afcc617f20edae580e647522b320b6_2_340x213.png 1.5x, https://delvingbitcoin.org/uploads/default/optimized/2X/7/71105f5683afcc617f20edae580e647522b320b6_2_454x284.png 2x\" data-dominant-color=\"FBFBFB\"><div class=\"meta\"><svg class=\"fa d-icon d-icon-far-image svg-icon\" aria-hidden=\"true\"><use href=\"#far-image\"></use></svg><span class=\"filename\">clusters_sim2023_ntx2_max</span><span class=\"informations\">1280\u00d7800 73 KB</span><svg class=\"fa d-icon d-icon-discourse-expand svg-icon\" aria-hidden=\"true\"><use href=\"#discourse-expand\"></use></svg></div></a></div></p>\n<p>Numbers for 26-64 transaction clusters, benchmarking all of the clusters:</p>\n<p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://delvingbitcoin.org/uploads/default/original/2X/4/409d51f4e20c740b83bcfdca601bff874f9164e4.png\" data-download-href=\"https://delvingbitcoin.org/uploads/default/409d51f4e20c740b83bcfdca601bff874f9164e4\" title=\"clusters_sim2023_min\"><img src=\"https://delvingbitcoin.org/uploads/default/optimized/2X/4/409d51f4e20c740b83bcfdca601bff874f9164e4_2_227x142.png\" alt=\"clusters_sim2023_min\" data-base62-sha1=\"9dBC7UgGbnSPt6IuhRZxcKuXfso\" width=\"227\" height=\"142\" srcset=\"https://delvingbitcoin.org/uploads/default/optimized/2X/4/409d51f4e20c740b83bcfdca601bff874f9164e4_2_227x142.png, https://delvingbitcoin.org/uploads/default/optimized/2X/4/409d51f4e20c740b83bcfdca601bff874f9164e4_2_340x213.png 1.5x, https://delvingbitcoin.org/uploads/default/optimized/2X/4/409d51f4e20c740b83bcfdca601bff874f9164e4_2_454x284.png 2x\" data-dominant-color=\"FBFBFB\"><div class=\"meta\"><svg class=\"fa d-icon d-icon-far-image svg-icon\" aria-hidden=\"true\"><use href=\"#far-image\"></use></svg><span class=\"filename\">clusters_sim2023_min</span><span class=\"informations\">1280\u00d7800 78.8 KB</span><svg class=\"fa d-icon d-icon-discourse-expand svg-icon\" aria-hidden=\"true\"><use href=\"#discourse-expand\"></use></svg></div></a></div>\n<div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://delvingbitcoin.org/uploads/default/original/2X/e/ea3e31c670090ca7aabc55d381face3ecd242b90.png\" data-download-href=\"https://delvingbitcoin.org/uploads/default/ea3e31c670090ca7aabc55d381face3ecd242b90\" title=\"clusters_sim2023_avg\"><img src=\"https://delvingbitcoin.org/uploads/default/optimized/2X/e/ea3e31c670090ca7aabc55d381face3ecd242b90_2_227x142.png\" alt=\"clusters_sim2023_avg\" data-base62-sha1=\"xqcYHs0LkIFxiHmtXLD7w0bUtvG\" width=\"227\" height=\"142\" srcset=\"https://delvingbitcoin.org/uploads/default/optimized/2X/e/ea3e31c670090ca7aabc55d381face3ecd242b90_2_227x142.png, https://delvingbitcoin.org/uploads/default/optimized/2X/e/ea3e31c670090ca7aabc55d381face3ecd242b90_2_340x213.png 1.5x, https://delvingbitcoin.org/uploads/default/optimized/2X/e/ea3e31c670090ca7aabc55d381face3ecd242b90_2_454x284.png 2x\" data-dominant-color=\"FBFBFB\"><div class=\"meta\"><svg class=\"fa d-icon d-icon-far-image svg-icon\" aria-hidden=\"true\"><use href=\"#far-image\"></use></svg><span class=\"filename\">clusters_sim2023_avg</span><span class=\"informations\">1280\u00d7800 77.5 KB</span><svg class=\"fa d-icon d-icon-discourse-expand svg-icon\" aria-hidden=\"true\"><use href=\"#discourse-expand\"></use></svg></div></a></div>\n<div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://delvingbitcoin.org/uploads/default/original/2X/2/22ad16f71db37fcb8cadb8a8f73c4acfd3def203.png\" data-download-href=\"https://delvingbitcoin.org/uploads/default/22ad16f71db37fcb8cadb8a8f73c4acfd3def203\" title=\"clusters_sim2023_max\"><img src=\"https://delvingbitcoin.org/uploads/default/optimized/2X/2/22ad16f71db37fcb8cadb8a8f73c4acfd3def203_2_227x142.png\" alt=\"clusters_sim2023_max\" data-base62-sha1=\"4WL4LVCElZwNqOwKiDMG1UkeOFZ\" width=\"227\" height=\"142\" srcset=\"https://delvingbitcoin.org/uploads/default/optimized/2X/2/22ad16f71db37fcb8cadb8a8f73c4acfd3def203_2_227x142.png, https://delvingbitcoin.org/uploads/default/optimized/2X/2/22ad16f71db37fcb8cadb8a8f73c4acfd3def203_2_340x213.png 1.5x, https://delvingbitcoin.org/uploads/default/optimized/2X/2/22ad16f71db37fcb8cadb8a8f73c4acfd3def203_2_454x284.png 2x\" data-dominant-color=\"FBFBFB\"><div class=\"meta\"><svg class=\"fa d-icon d-icon-far-image svg-icon\" aria-hidden=\"true\"><use href=\"#far-image\"></use></svg><span class=\"filename\">clusters_sim2023_max</span><span class=\"informations\">1280\u00d7800 72.1 KB</span><svg class=\"fa d-icon d-icon-discourse-expand svg-icon\" aria-hidden=\"true\"><use href=\"#discourse-expand\"></use></svg></div></a></div></p>\n<p>For sufficiently large clusters, and in average and maximum runtime, SFL is the clear winner in this data set. CSS has better lower bounds, but is terrible in the worst case (37 <strong>m</strong>s).</p>\n<h3><a name=\"p-4854-randomly-generated-tree-shaped-clusters-3\" class=\"anchor\" href=\"#p-4854-randomly-generated-tree-shaped-clusters-3\"></a>Randomly-generated tree-shaped clusters</h3>\n<p>In this dataset, for each size between 26 and 64 transactions, 100 random tree-shaped clusters (i.e., a connected graph with exactly n-1 dependencies) were generated, like this 64-transaction one:</p>\n<p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://delvingbitcoin.org/uploads/default/original/2X/c/cfe0c1b36089028a85a14f08dd8639b98e70c4fe.png\" data-download-href=\"https://delvingbitcoin.org/uploads/default/cfe0c1b36089028a85a14f08dd8639b98e70c4fe\" title=\"spanning\"><img src=\"https://delvingbitcoin.org/uploads/default/optimized/2X/c/cfe0c1b36089028a85a14f08dd8639b98e70c4fe_2_690x173.png\" alt=\"spanning\" data-base62-sha1=\"tEYngxsf8LUCo8HLISq7aXaYPIG\" width=\"690\" height=\"173\" srcset=\"https://delvingbitcoin.org/uploads/default/optimized/2X/c/cfe0c1b36089028a85a14f08dd8639b98e70c4fe_2_690x173.png, https://delvingbitcoin.org/uploads/default/optimized/2X/c/cfe0c1b36089028a85a14f08dd8639b98e70c4fe_2_1035x259.png 1.5x, https://delvingbitcoin.org/uploads/default/optimized/2X/c/cfe0c1b36089028a85a14f08dd8639b98e70c4fe_2_1380x346.png 2x\" data-dominant-color=\"F7F7F7\"><div class=\"meta\"><svg class=\"fa d-icon d-icon-far-image svg-icon\" aria-hidden=\"true\"><use href=\"#far-image\"></use></svg><span class=\"filename\">spanning</span><span class=\"informations\">2899\u00d7731 274 KB</span><svg class=\"fa d-icon d-icon-discourse-expand svg-icon\" aria-hidden=\"true\"><use href=\"#discourse-expand\"></use></svg></div></a></div></p>\n<p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://delvingbitcoin.org/uploads/default/original/2X/6/6b151de4fdab5eb3d29fe53f12d1254ae9e1408b.png\" data-download-href=\"https://delvingbitcoin.org/uploads/default/6b151de4fdab5eb3d29fe53f12d1254ae9e1408b\" title=\"clusters_spanning_min\"><img src=\"https://delvingbitcoin.org/uploads/default/optimized/2X/6/6b151de4fdab5eb3d29fe53f12d1254ae9e1408b_2_227x142.png\" alt=\"clusters_spanning_min\" data-base62-sha1=\"fhikzw98iksoHF6ASsjaE5X8rOP\" width=\"227\" height=\"142\" srcset=\"https://delvingbitcoin.org/uploads/default/optimized/2X/6/6b151de4fdab5eb3d29fe53f12d1254ae9e1408b_2_227x142.png, https://delvingbitcoin.org/uploads/default/optimized/2X/6/6b151de4fdab5eb3d29fe53f12d1254ae9e1408b_2_340x213.png 1.5x, https://delvingbitcoin.org/uploads/default/optimized/2X/6/6b151de4fdab5eb3d29fe53f12d1254ae9e1408b_2_454x284.png 2x\" data-dominant-color=\"FBFBFB\"><div class=\"meta\"><svg class=\"fa d-icon d-icon-far-image svg-icon\" aria-hidden=\"true\"><use href=\"#far-image\"></use></svg><span class=\"filename\">clusters_spanning_min</span><span class=\"informations\">1280\u00d7800 78.9 KB</span><svg class=\"fa d-icon d-icon-discourse-expand svg-icon\" aria-hidden=\"true\"><use href=\"#discourse-expand\"></use></svg></div></a></div>\n<div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://delvingbitcoin.org/uploads/default/original/2X/0/0d8067056778cec5e2628f52fc0dc7b5b50e90dd.png\" data-download-href=\"https://delvingbitcoin.org/uploads/default/0d8067056778cec5e2628f52fc0dc7b5b50e90dd\" title=\"clusters_spanning_avg\"><img src=\"https://delvingbitcoin.org/uploads/default/optimized/2X/0/0d8067056778cec5e2628f52fc0dc7b5b50e90dd_2_227x142.png\" alt=\"clusters_spanning_avg\" data-base62-sha1=\"1Vrj67O1r7Kye5mt7lQ5TWnoDPT\" width=\"227\" height=\"142\" srcset=\"https://delvingbitcoin.org/uploads/default/optimized/2X/0/0d8067056778cec5e2628f52fc0dc7b5b50e90dd_2_227x142.png, https://delvingbitcoin.org/uploads/default/optimized/2X/0/0d8067056778cec5e2628f52fc0dc7b5b50e90dd_2_340x213.png 1.5x, https://delvingbitcoin.org/uploads/default/optimized/2X/0/0d8067056778cec5e2628f52fc0dc7b5b50e90dd_2_454x284.png 2x\" data-dominant-color=\"FBFBFB\"><div class=\"meta\"><svg class=\"fa d-icon d-icon-far-image svg-icon\" aria-hidden=\"true\"><use href=\"#far-image\"></use></svg><span class=\"filename\">clusters_spanning_avg</span><span class=\"informations\">1280\u00d7800 70.2 KB</span><svg class=\"fa d-icon d-icon-discourse-expand svg-icon\" aria-hidden=\"true\"><use href=\"#discourse-expand\"></use></svg></div></a></div>\n<div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://delvingbitcoin.org/uploads/default/original/2X/2/2ebbb9077ee56a8b53272c00576871ffe989c2ff.png\" data-download-href=\"https://delvingbitcoin.org/uploads/default/2ebbb9077ee56a8b53272c00576871ffe989c2ff\" title=\"clusters_spanning_max\"><img src=\"https://delvingbitcoin.org/uploads/default/optimized/2X/2/2ebbb9077ee56a8b53272c00576871ffe989c2ff_2_227x142.png\" alt=\"clusters_spanning_max\" data-base62-sha1=\"6Fq9MFmfUTCBqMNCFFrp0CINHm7\" width=\"227\" height=\"142\" srcset=\"https://delvingbitcoin.org/uploads/default/optimized/2X/2/2ebbb9077ee56a8b53272c00576871ffe989c2ff_2_227x142.png, https://delvingbitcoin.org/uploads/default/optimized/2X/2/2ebbb9077ee56a8b53272c00576871ffe989c2ff_2_340x213.png 1.5x, https://delvingbitcoin.org/uploads/default/optimized/2X/2/2ebbb9077ee56a8b53272c00576871ffe989c2ff_2_454x284.png 2x\" data-dominant-color=\"FBFBFB\"><div class=\"meta\"><svg class=\"fa d-icon d-icon-far-image svg-icon\" aria-hidden=\"true\"><use href=\"#far-image\"></use></svg><span class=\"filename\">clusters_spanning_max</span><span class=\"informations\">1280\u00d7800 75.9 KB</span><svg class=\"fa d-icon d-icon-discourse-expand svg-icon\" aria-hidden=\"true\"><use href=\"#discourse-expand\"></use></svg></div></a></div></p>\n<p>Again, SFL seems the clear winner.</p>\n<h3><a name=\"p-4854-randomly-generated-medium-density-clusters-4\" class=\"anchor\" href=\"#p-4854-randomly-generated-medium-density-clusters-4\"></a>Randomly-generated medium-density clusters</h3>\n<p>In this dataset, for each size between 26 and 64 transactions, 100 random spanning-tree clusters (with roughly 3 dependencies per transaction) were generated, like this 64-transaction one. I promise this is not the plot of <a href=\"https://xkcd.com/657/\">Primer (2004)</a>:</p>\n<p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://delvingbitcoin.org/uploads/default/original/2X/1/1bb2ca8e1c19a0bd2356b79ae7c75ec3928e68f3.jpeg\" data-download-href=\"https://delvingbitcoin.org/uploads/default/1bb2ca8e1c19a0bd2356b79ae7c75ec3928e68f3\" title=\"medium\"><img src=\"https://delvingbitcoin.org/uploads/default/optimized/2X/1/1bb2ca8e1c19a0bd2356b79ae7c75ec3928e68f3_2_690x216.jpeg\" alt=\"medium\" data-base62-sha1=\"3X1WUmO6VnMeUpxpLBoBePwqWGf\" width=\"690\" height=\"216\" srcset=\"https://delvingbitcoin.org/uploads/default/optimized/2X/1/1bb2ca8e1c19a0bd2356b79ae7c75ec3928e68f3_2_690x216.jpeg, https://delvingbitcoin.org/uploads/default/optimized/2X/1/1bb2ca8e1c19a0bd2356b79ae7c75ec3928e68f3_2_1035x324.jpeg 1.5x, https://delvingbitcoin.org/uploads/default/optimized/2X/1/1bb2ca8e1c19a0bd2356b79ae7c75ec3928e68f3_2_1380x432.jpeg 2x\" data-dominant-color=\"EFEFEF\"><div class=\"meta\"><svg class=\"fa d-icon d-icon-far-image svg-icon\" aria-hidden=\"true\"><use href=\"#far-image\"></use></svg><span class=\"filename\">medium</span><span class=\"informations\">4469\u00d71403 1000 KB</span><svg class=\"fa d-icon d-icon-discourse-expand svg-icon\" aria-hidden=\"true\"><use href=\"#discourse-expand\"></use></svg></div></a></div></p>\n<p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://delvingbitcoin.org/uploads/default/original/2X/4/44813aa0566b798cd3b3f9becd5915d96b76e96c.png\" data-download-href=\"https://delvingbitcoin.org/uploads/default/44813aa0566b798cd3b3f9becd5915d96b76e96c\" title=\"clusters_medium_min\"><img src=\"https://delvingbitcoin.org/uploads/default/optimized/2X/4/44813aa0566b798cd3b3f9becd5915d96b76e96c_2_227x142.png\" alt=\"clusters_medium_min\" data-base62-sha1=\"9M1l4rt8Dpr5OpwGfuwGsYtDqJ6\" width=\"227\" height=\"142\" srcset=\"https://delvingbitcoin.org/uploads/default/optimized/2X/4/44813aa0566b798cd3b3f9becd5915d96b76e96c_2_227x142.png, https://delvingbitcoin.org/uploads/default/optimized/2X/4/44813aa0566b798cd3b3f9becd5915d96b76e96c_2_340x213.png 1.5x, https://delvingbitcoin.org/uploads/default/optimized/2X/4/44813aa0566b798cd3b3f9becd5915d96b76e96c_2_454x284.png 2x\" data-dominant-color=\"FBFAFB\"><div class=\"meta\"><svg class=\"fa d-icon d-icon-far-image svg-icon\" aria-hidden=\"true\"><use href=\"#far-image\"></use></svg><span class=\"filename\">clusters_medium_min</span><span class=\"informations\">1280\u00d7800 96 KB</span><svg class=\"fa d-icon d-icon-discourse-expand svg-icon\" aria-hidden=\"true\"><use href=\"#discourse-expand\"></use></svg></div></a></div>\n<div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://delvingbitcoin.org/uploads/default/original/2X/3/32ca7a9e3dd40a5242090b2ffada55e9ee01ce13.png\" data-download-href=\"https://delvingbitcoin.org/uploads/default/32ca7a9e3dd40a5242090b2ffada55e9ee01ce13\" title=\"clusters_medium_avg\"><img src=\"https://delvingbitcoin.org/uploads/default/optimized/2X/3/32ca7a9e3dd40a5242090b2ffada55e9ee01ce13_2_227x142.png\" alt=\"clusters_medium_avg\" data-base62-sha1=\"7fjGkpHKG1WghEUXUCnR48YsuOv\" width=\"227\" height=\"142\" srcset=\"https://delvingbitcoin.org/uploads/default/optimized/2X/3/32ca7a9e3dd40a5242090b2ffada55e9ee01ce13_2_227x142.png, https://delvingbitcoin.org/uploads/default/optimized/2X/3/32ca7a9e3dd40a5242090b2ffada55e9ee01ce13_2_340x213.png 1.5x, https://delvingbitcoin.org/uploads/default/optimized/2X/3/32ca7a9e3dd40a5242090b2ffada55e9ee01ce13_2_454x284.png 2x\" data-dominant-color=\"FBFBFB\"><div class=\"meta\"><svg class=\"fa d-icon d-icon-far-image svg-icon\" aria-hidden=\"true\"><use href=\"#far-image\"></use></svg><span class=\"filename\">clusters_medium_avg</span><span class=\"informations\">1280\u00d7800 74 KB</span><svg class=\"fa d-icon d-icon-discourse-expand svg-icon\" aria-hidden=\"true\"><use href=\"#discourse-expand\"></use></svg></div></a></div>\n<div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://delvingbitcoin.org/uploads/default/original/2X/7/7334d48fb954e0657e7a695e195f84100512abf9.png\" data-download-href=\"https://delvingbitcoin.org/uploads/default/7334d48fb954e0657e7a695e195f84100512abf9\" title=\"clusters_medium_max\"><img src=\"https://delvingbitcoin.org/uploads/default/optimized/2X/7/7334d48fb954e0657e7a695e195f84100512abf9_2_227x142.png\" alt=\"clusters_medium_max\" data-base62-sha1=\"gra62VzsLrFSr21TOeT49PDMqMx\" width=\"227\" height=\"142\" srcset=\"https://delvingbitcoin.org/uploads/default/optimized/2X/7/7334d48fb954e0657e7a695e195f84100512abf9_2_227x142.png, https://delvingbitcoin.org/uploads/default/optimized/2X/7/7334d48fb954e0657e7a695e195f84100512abf9_2_340x213.png 1.5x, https://delvingbitcoin.org/uploads/default/optimized/2X/7/7334d48fb954e0657e7a695e195f84100512abf9_2_454x284.png 2x\" data-dominant-color=\"FBFBFB\"><div class=\"meta\"><svg class=\"fa d-icon d-icon-far-image svg-icon\" aria-hidden=\"true\"><use href=\"#far-image\"></use></svg><span class=\"filename\">clusters_medium_max</span><span class=\"informations\">1280\u00d7800 83.4 KB</span><svg class=\"fa d-icon d-icon-discourse-expand svg-icon\" aria-hidden=\"true\"><use href=\"#discourse-expand\"></use></svg></div></a></div></p>\n<p>Notably, SFL performs worst in the worst case here, with up to 62.3 \u03bcs runtime, though even the fastest algorithm (unidirectional GGT) even takes up to 34.1 \u03bcs. This is probably due to it inherently scaling with the number of dependencies.</p>\n<h3><a name=\"p-4854-randomly-generated-complete-bipartite-clusters-5\" class=\"anchor\" href=\"#p-4854-randomly-generated-complete-bipartite-clusters-5\"></a>Randomly-generated complete bipartite clusters</h3>\n<p>In this dataset, for each size between 26 and 64 transactions, 100 random complete-connected bipartite clusters (with roughly n/4 dependencies per transaction) were generated, like this 64-transaction one:</p>\n<p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://delvingbitcoin.org/uploads/default/original/2X/f/f3fb49bc0ee3785b66f8b0ad997b985e435f18d5.png\" data-download-href=\"https://delvingbitcoin.org/uploads/default/f3fb49bc0ee3785b66f8b0ad997b985e435f18d5\" title=\"bipartite\"><img src=\"https://delvingbitcoin.org/uploads/default/optimized/2X/f/f3fb49bc0ee3785b66f8b0ad997b985e435f18d5_2_690x15.png\" alt=\"bipartite\" data-base62-sha1=\"yOmpgaj0xSIW6UTther0VFFJw0d\" width=\"690\" height=\"15\" srcset=\"https://delvingbitcoin.org/uploads/default/optimized/2X/f/f3fb49bc0ee3785b66f8b0ad997b985e435f18d5_2_690x15.png, https://delvingbitcoin.org/uploads/default/optimized/2X/f/f3fb49bc0ee3785b66f8b0ad997b985e435f18d5_2_1035x22.png 1.5x, https://delvingbitcoin.org/uploads/default/optimized/2X/f/f3fb49bc0ee3785b66f8b0ad997b985e435f18d5_2_1380x30.png 2x\" data-dominant-color=\"A3A3A3\"><div class=\"meta\"><svg class=\"fa d-icon d-icon-far-image svg-icon\" aria-hidden=\"true\"><use href=\"#far-image\"></use></svg><span class=\"filename\">bipartite</span><span class=\"informations\">6737\u00d7155 124 KB</span><svg class=\"fa d-icon d-icon-discourse-expand svg-icon\" aria-hidden=\"true\"><use href=\"#discourse-expand\"></use></svg></div></a></div></p>\n<p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://delvingbitcoin.org/uploads/default/original/2X/3/353cb141c03f0d110fd461c70f44daf4da077e8f.png\" data-download-href=\"https://delvingbitcoin.org/uploads/default/353cb141c03f0d110fd461c70f44daf4da077e8f\" title=\"clusters_bipartite_min\"><img src=\"https://delvingbitcoin.org/uploads/default/optimized/2X/3/353cb141c03f0d110fd461c70f44daf4da077e8f_2_227x142.png\" alt=\"clusters_bipartite_min\" data-base62-sha1=\"7AXl0qEvZ9lUwlmnZjMonytzhFB\" width=\"227\" height=\"142\" srcset=\"https://delvingbitcoin.org/uploads/default/optimized/2X/3/353cb141c03f0d110fd461c70f44daf4da077e8f_2_227x142.png, https://delvingbitcoin.org/uploads/default/optimized/2X/3/353cb141c03f0d110fd461c70f44daf4da077e8f_2_340x213.png 1.5x, https://delvingbitcoin.org/uploads/default/optimized/2X/3/353cb141c03f0d110fd461c70f44daf4da077e8f_2_454x284.png 2x\" data-dominant-color=\"FBFBFB\"><div class=\"meta\"><svg class=\"fa d-icon d-icon-far-image svg-icon\" aria-hidden=\"true\"><use href=\"#far-image\"></use></svg><span class=\"filename\">clusters_bipartite_min</span><span class=\"informations\">1280\u00d7800 91.4 KB</span><svg class=\"fa d-icon d-icon-discourse-expand svg-icon\" aria-hidden=\"true\"><use href=\"#discourse-expand\"></use></svg></div></a></div>\n<div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://delvingbitcoin.org/uploads/default/original/2X/3/3430c5bce69af61851cf7d15296ea3e5c4eb4487.png\" data-download-href=\"https://delvingbitcoin.org/uploads/default/3430c5bce69af61851cf7d15296ea3e5c4eb4487\" title=\"clusters_bipartite_avg\"><img src=\"https://delvingbitcoin.org/uploads/default/optimized/2X/3/3430c5bce69af61851cf7d15296ea3e5c4eb4487_2_227x142.png\" alt=\"clusters_bipartite_avg\" data-base62-sha1=\"7rHk18MTR0dX4Ca7DMTZymA5bgz\" width=\"227\" height=\"142\" srcset=\"https://delvingbitcoin.org/uploads/default/optimized/2X/3/3430c5bce69af61851cf7d15296ea3e5c4eb4487_2_227x142.png, https://delvingbitcoin.org/uploads/default/optimized/2X/3/3430c5bce69af61851cf7d15296ea3e5c4eb4487_2_340x213.png 1.5x, https://delvingbitcoin.org/uploads/default/optimized/2X/3/3430c5bce69af61851cf7d15296ea3e5c4eb4487_2_454x284.png 2x\" data-dominant-color=\"FBFBFB\"><div class=\"meta\"><svg class=\"fa d-icon d-icon-far-image svg-icon\" aria-hidden=\"true\"><use href=\"#far-image\"></use></svg><span class=\"filename\">clusters_bipartite_avg</span><span class=\"informations\">1280\u00d7800 74.5 KB</span><svg class=\"fa d-icon d-icon-discourse-expand svg-icon\" aria-hidden=\"true\"><use href=\"#discourse-expand\"></use></svg></div></a></div>\n<div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://delvingbitcoin.org/uploads/default/original/2X/d/df57ba77478552c3fd23947b39248cf43cc7c351.png\" data-download-href=\"https://delvingbitcoin.org/uploads/default/df57ba77478552c3fd23947b39248cf43cc7c351\" title=\"clusters_bipartite_max\"><img src=\"https://delvingbitcoin.org/uploads/default/optimized/2X/d/df57ba77478552c3fd23947b39248cf43cc7c351_2_227x142.png\" alt=\"clusters_bipartite_max\" data-base62-sha1=\"vRMqQQyinPMmdwXog4V21YIJpIJ\" width=\"227\" height=\"142\" srcset=\"https://delvingbitcoin.org/uploads/default/optimized/2X/d/df57ba77478552c3fd23947b39248cf43cc7c351_2_227x142.png, https://delvingbitcoin.org/uploads/default/optimized/2X/d/df57ba77478552c3fd23947b39248cf43cc7c351_2_340x213.png 1.5x, https://delvingbitcoin.org/uploads/default/optimized/2X/d/df57ba77478552c3fd23947b39248cf43cc7c351_2_454x284.png 2x\" data-dominant-color=\"FBFBFB\"><div class=\"meta\"><svg class=\"fa d-icon d-icon-far-image svg-icon\" aria-hidden=\"true\"><use href=\"#far-image\"></use></svg><span class=\"filename\">clusters_bipartite_max</span><span class=\"informations\">1280\u00d7800 80.5 KB</span><svg class=\"fa d-icon d-icon-discourse-expand svg-icon\" aria-hidden=\"true\"><use href=\"#discourse-expand\"></use></svg></div></a></div></p>\n<p>With even more dependencies per transaction here, SFL\u2019s weakness is even more visible (up to 98.9 \u03bcs), though it affects GGT too. Note that due to the large number of dependencies, these clusters are expensive too: if all the inputs and outputs are key-path P2TR, then the 64-transaction case needs ~103 kvB in transaction input &amp; output data.</p>\n<h3><a name=\"p-4854-methodology-6\" class=\"anchor\" href=\"#p-4854-methodology-6\"></a>Methodology</h3>\n<p>All of these numbers are constructed by:</p>\n<ul>\n<li>Gather a list of N clusters (by replaying mempool data, or randomly generating them).</li>\n<li>For each of the N cluster, do the following 3 times:\n<ul>\n<li>Generate 100 RNG seeds for the linearization algorithm.</li>\n<li>For each RNG seed:\n<ul>\n<li>Benchmark optimal linearization 13 times with the same RNG seed, on an AMD Ryzen Threadripper 7995WX system, remembering the time it took.</li>\n<li>Remember the median of those 13 runs, to weed out variance due to task swapping and other effects).</li>\n</ul>\n</li>\n<li>Remember the average of those 100 medians, as we care mostly about how long the duration of linearization many clusters at once is, not an individual one. This removes some of the variance caused by individual RNG seeds.</li>\n</ul>\n</li>\n<li>Output the minimum, average, and maximum of those 3N average-of-medians.</li>\n<li>Convert all numbers to \u00b5s.</li>\n</ul>\n<p>All the data and graphs can be found on <a href=\"https://gist.github.com/sipa/6e21121eaecda0cb33f99cb80ad03766\" class=\"inline-onebox\">Cluster linearization databench plotting code \u00b7 GitHub</a>.</p>",
  "post_number": 73,
  "post_type": 1,
  "posts_count": 78,
  "updated_at": "2025-05-16T19:33:50.873Z",
  "reply_count": 1,
  "reply_to_post_number": null,
  "quote_count": 0,
  "incoming_link_count": 50,
  "reads": 32,
  "readers_count": 31,
  "score": 331.4,
  "yours": false,
  "topic_id": 303,
  "topic_slug": "how-to-linearize-your-cluster",
  "topic_title": "How to linearize your cluster",
  "topic_html_title": "How to linearize your cluster",
  "category_id": 8,
  "display_username": "Pieter Wuille",
  "primary_group_name": null,
  "flair_name": null,
  "flair_url": null,
  "flair_bg_color": null,
  "flair_color": null,
  "flair_group_id": null,
  "badges_granted": [],
  "version": 14,
  "can_edit": false,
  "can_delete": false,
  "can_recover": false,
  "can_see_hidden_post": false,
  "can_wiki": false,
  "user_title": null,
  "bookmarked": false,
  "raw": "## Benchmark results\n\nAll data is tested in 6 different linearization settings:\n* CSS: the candidate-set search algorithm this thread was initially about, both from scratch and when given an optimal linearization as input already.\n* SFL: the spanning-forest linearization algorithm, also from scratch and when given an optimal linearization as input already.\n* GGT: the parametric min-cut breakpoints algorithm from the 1989 GGT paper, both its full bidirectional version, and a variant that only runs in the forward direction.\n\n### Simulated 2023 mempools\n\nThis uses clusters that were created by replaying a dump of 2023 P2P network activity into a cluster-mempool-patched version of Bitcoin Core (by @sdaftuar), and storing all clusters that appear in a file. This included 199076 clusters of size between 26 and 64 transactions, and over 24 million clusters between 2 and 25 transactions. Note that this is not necessarily representative for what a post-cluster-mempool world will look like, as it enforces a cluster size limit of 64, which may well influence network behavior after adoption.\n\nHere are two example 64-transaction clusters:\n\n![sim2023_ggt|690x448, 25%](upload://rpxX7rby2r1MGgaywce8tU458zm.png)\n![sim2023|690x63, 74%](upload://9Aavvgu4bhZSUHJ7xmDg48H167f.png)\n\nNumbers for 2-25 transaction clusters, based on benchmarks of 17% of the recorded clusters:\n\n![clusters_sim2023_ntx2_min|690x431, 33%](upload://hiCpjVHqapa1jjpXUoLL1vpxW1y.png)\n![clusters_sim2023_ntx2_avg|690x431, 33%](upload://1KHlTcYPVkWV9hNYe8QeMvgqk1B.png)\n![clusters_sim2023_ntx2_max|690x431, 33%](upload://g8d1YBCQEichYnCCWaTY8ZaM2xM.png)\n\nNumbers for 26-64 transaction clusters, benchmarking all of the clusters:\n\n![clusters_sim2023_min|690x431, 33%](upload://9dBC7UgGbnSPt6IuhRZxcKuXfso.png)\n![clusters_sim2023_avg|690x431, 33%](upload://xqcYHs0LkIFxiHmtXLD7w0bUtvG.png)\n![clusters_sim2023_max|690x431, 33%](upload://4WL4LVCElZwNqOwKiDMG1UkeOFZ.png)\n\nFor sufficiently large clusters, and in average and maximum runtime, SFL is the clear winner in this data set. CSS has better lower bounds, but is terrible in the worst case (37 **m**s).\n\n### Randomly-generated tree-shaped clusters\n\nIn this dataset, for each size between 26 and 64 transactions, 100 random tree-shaped clusters (i.e., a connected graph with exactly n-1 dependencies) were generated, like this 64-transaction one:\n\n![spanning|690x173](upload://tEYngxsf8LUCo8HLISq7aXaYPIG.png)\n\n![clusters_spanning_min|690x431, 33%](upload://fhikzw98iksoHF6ASsjaE5X8rOP.png)\n![clusters_spanning_avg|690x431, 33%](upload://1Vrj67O1r7Kye5mt7lQ5TWnoDPT.png)\n![clusters_spanning_max|690x431, 33%](upload://6Fq9MFmfUTCBqMNCFFrp0CINHm7.png)\n\nAgain, SFL seems the clear winner.\n\n### Randomly-generated medium-density clusters\n\nIn this dataset, for each size between 26 and 64 transactions, 100 random spanning-tree clusters (with roughly 3 dependencies per transaction) were generated, like this 64-transaction one. I promise this is not the plot of [Primer (2004)](https://xkcd.com/657/):\n\n![medium|690x216](upload://3X1WUmO6VnMeUpxpLBoBePwqWGf.jpeg)\n\n![clusters_medium_min|690x431, 33%](upload://9M1l4rt8Dpr5OpwGfuwGsYtDqJ6.png)\n![clusters_medium_avg|690x431, 33%](upload://7fjGkpHKG1WghEUXUCnR48YsuOv.png)\n![clusters_medium_max|690x431, 33%](upload://gra62VzsLrFSr21TOeT49PDMqMx.png)\n\nNotably, SFL performs worst in the worst case here, with up to 62.3 \u03bcs runtime, though even the fastest algorithm (unidirectional GGT) even takes up to 34.1 \u03bcs. This is probably due to it inherently scaling with the number of dependencies.\n\n### Randomly-generated complete bipartite clusters\n\nIn this dataset, for each size between 26 and 64 transactions, 100 random complete-connected bipartite clusters (with roughly n/4 dependencies per transaction) were generated, like this 64-transaction one:\n\n![bipartite|690x15](upload://yOmpgaj0xSIW6UTther0VFFJw0d.png)\n\n![clusters_bipartite_min|690x431, 33%](upload://7AXl0qEvZ9lUwlmnZjMonytzhFB.png)\n![clusters_bipartite_avg|690x431, 33%](upload://7rHk18MTR0dX4Ca7DMTZymA5bgz.png)\n![clusters_bipartite_max|690x431, 33%](upload://vRMqQQyinPMmdwXog4V21YIJpIJ.png)\n\nWith even more dependencies per transaction here, SFL's weakness is even more visible (up to 98.9 \u03bcs), though it affects GGT too. Note that due to the large number of dependencies, these clusters are expensive too: if all the inputs and outputs are key-path P2TR, then the 64-transaction case needs ~103 kvB in transaction input & output data.\n\n### Methodology\n\nAll of these numbers are constructed by:\n* Gather a list of N clusters (by replaying mempool data, or randomly generating them).\n* For each of the N cluster, do the following 3 times:\n  * Generate 100 RNG seeds for the linearization algorithm.\n  * For each RNG seed:\n    * Benchmark optimal linearization 13 times with the same RNG seed, on an AMD Ryzen Threadripper 7995WX system, remembering the time it took.\n    * Remember the median of those 13 runs, to weed out variance due to task swapping and other effects).\n  * Remember the average of those 100 medians, as we care mostly about how long the duration of linearization many clusters at once is, not an individual one. This removes some of the variance caused by individual RNG seeds.\n* Output the minimum, average, and maximum of those 3N average-of-medians.\n* Convert all numbers to \u00b5s.\n\nAll the data and graphs can be found on https://gist.github.com/sipa/6e21121eaecda0cb33f99cb80ad03766.",
  "actions_summary": [
    {
      "id": 2,
      "count": 3
    }
  ],
  "moderator": false,
  "admin": false,
  "staff": false,
  "user_id": 96,
  "hidden": false,
  "trust_level": 3,
  "deleted_at": null,
  "user_deleted": false,
  "edit_reason": null,
  "can_view_edit_history": true,
  "wiki": false,
  "excerpt": "<a name=\"p-4854-benchmark-results-1\" class=\"anchor\" href=\"#p-4854-benchmark-results-1\"></a>Benchmark results\nAll data is tested in 6 different linearization settings: \n\nCSS: the candidate-set search algorithm this thread was initially about, both from scratch and when given an optimal linearization as input already.\nSFL: the spanning-forest linearization algorithm, also from scratch and w&hellip;",
  "truncated": true,
  "post_url": "/t/how-to-linearize-your-cluster/303/73",
  "reactions": [
    {
      "id": "+1",
      "type": "emoji",
      "count": 3
    }
  ],
  "current_user_reaction": null,
  "reaction_users_count": 3,
  "current_user_used_main_reaction": false,
  "can_accept_answer": false,
  "can_unaccept_answer": false,
  "accepted_answer": false,
  "topic_accepted_answer": null
}