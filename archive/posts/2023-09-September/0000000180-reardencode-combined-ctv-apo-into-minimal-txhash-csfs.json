{
  "id": 180,
  "name": "Brandon Black",
  "username": "reardencode",
  "avatar_template": "/user_avatar/delvingbitcoin.org/reardencode/{size}/27_2.png",
  "created_at": "2023-09-08T16:39:22.417Z",
  "cooked": "<p>Continuing to explore these ideas, and discussing with many folks (thanks everyone), it is seeming more and more like for hash-based transaction validation there is at least some disjunction between the types of hashes that we would want to verify with a signature vs. those that we would want to check a simple comparison. In light of this, I\u2019m working on an updated proposal that attempts to unify this style of (loosely) ANYPREVOUT/NOINPUT hash that can be used to form covenants, and (for similar reasons) allow for dynamic binding.</p>\n<p>Some folks have been talking about soft forking both APO and CTV as written, which is tempting (and I would not resist such a fork); but I continue to think that APO itself is kinda a weird half measure. My current line of thinking is to take much of APO\u2019s design (new key version, signing with taproot internal key), but use an entirely new hashing method that is nearly or completely disjoint from the existing Tapscript v0 key signature hashing. <strong>Is anyone currently aware of a proposal or protocol that would specifically want to use a Tapscript v1 key and in some cases sign with SIGHASH_DEFAULT but in others sign with one of the new APO modes?</strong></p>\n<p>If we design a separate hashing mode for our new Tapscript key version, then we can also mirror that mode (with appropriate modification for use in equality vs. signature check) to CTV with 33-byte hash, and avoid the temptation for folks to use pre-signed output covenants in awkward ways. Further, in designing the hashing mode, we can have a separate default mode from the existing SIGHASH_DEFAULT which is better suited to these V1 keys and would save a byte in whatever that common signing case is (I propose that this default be the signature-appropriate equivalent of CTV so that Tapscript v1 key and CTV hashes closely mirror each other).</p>\n<p>Here\u2019s my VERY incomplete draft of this line of thinking:</p><aside class=\"onebox githubgist\" data-onebox-src=\"https://gist.github.com/reardencode/2aa98700b720174598d21989dd46e781#file-proposal2-mediawiki\">\n  <header class=\"source\">\n\n      <a href=\"https://gist.github.com/reardencode/2aa98700b720174598d21989dd46e781#file-proposal2-mediawiki\" target=\"_blank\" rel=\"noopener nofollow ugc\">gist.github.com</a>\n  </header>\n\n  <article class=\"onebox-body\">\n    <h4><a href=\"https://gist.github.com/reardencode/2aa98700b720174598d21989dd46e781#file-proposal2-mediawiki\" target=\"_blank\" rel=\"noopener nofollow ugc\">https://gist.github.com/reardencode/2aa98700b720174598d21989dd46e781#file-proposal2-mediawiki</a></h4>\n\n  <h5>proposal.md</h5>\n  <pre><code class=\"Markdown\"># Abstract\n\nThis proposal is an alternative to [bip119][] and [bip118][], providing the\nfunctionality of both proposals with minimal additional overhead in [many\ncases](#compared-to-non-tapscript-ctv), while clearing certain objections to\nboth, and opening clear upgrade paths.\n\nThis is, in essence, an initially constrained version of Russel O'Connor's\n[OP_TXHASH+OP_CSFS proposal][].\n</code></pre>\n    This file has been truncated. <a href=\"https://gist.github.com/reardencode/2aa98700b720174598d21989dd46e781#file-proposal2-mediawiki\" target=\"_blank\" rel=\"noopener nofollow ugc\">show original</a>\n  <h5>proposal2.mediawiki</h5>\n  <pre><code class=\"Wikitext\">= Motivation =\n\nSince posting [https://gist.github.com/reardencode/2aa98700b720174598d21989dd46e781#file-proposal-md my minimal TXHASH+CSFS proposal], I've had the pleasure to continue learning about a variety of trade-offs and use cases for bitcoin scripts including both signed and and unsigned hash checks. Here are some things that I've learned in that process:\n\n* The requirements for a transaction hash are different when committed to in the locking script vs by a signature in the unlock script.\n* For transaction hash covenants, recursion is only possible through deleted key signatures.\n** If the hash commits to an output, there is a hash-loop unless the hash is committed to in the unlock by a deleted key signature.\n** If the hash does not commit to any outputs then it cannot constrain the next spend, no recursion.\n* Single-output, single-input script covenants can be useful to enable fees to be added to covenant constructions\n** Bitcoin does not have transaction sponsors, ephemeral anchors, or fee accounts</code></pre>\n    This file has been truncated. <a href=\"https://gist.github.com/reardencode/2aa98700b720174598d21989dd46e781#file-proposal2-mediawiki\" target=\"_blank\" rel=\"noopener nofollow ugc\">show original</a>\n\n<p>\n</p>\n\n  </article>\n\n  <div class=\"onebox-metadata\">\n    \n    \n  </div>\n\n  <div style=\"clear: both\"></div>\n</aside>\n",
  "post_number": 8,
  "post_type": 1,
  "updated_at": "2023-09-08T16:44:56.872Z",
  "reply_count": 0,
  "reply_to_post_number": 7,
  "quote_count": 0,
  "incoming_link_count": 33,
  "reads": 1,
  "readers_count": 0,
  "score": 160.2,
  "yours": false,
  "topic_id": 60,
  "topic_slug": "combined-ctv-apo-into-minimal-txhash-csfs",
  "topic_title": "Combined CTV/APO into minimal TXHASH+CSFS",
  "topic_html_title": "Combined CTV/APO into minimal TXHASH+CSFS",
  "category_id": 7,
  "display_username": "Brandon Black",
  "primary_group_name": null,
  "flair_name": null,
  "flair_url": null,
  "flair_bg_color": null,
  "flair_color": null,
  "flair_group_id": null,
  "version": 2,
  "can_edit": false,
  "can_delete": false,
  "can_recover": false,
  "can_see_hidden_post": false,
  "can_wiki": false,
  "user_title": null,
  "reply_to_user": {
    "username": "reardencode",
    "name": "Brandon Black",
    "avatar_template": "/user_avatar/delvingbitcoin.org/reardencode/{size}/27_2.png"
  },
  "bookmarked": false,
  "raw": "Continuing to explore these ideas, and discussing with many folks (thanks everyone), it is seeming more and more like for hash-based transaction validation there is at least some disjunction between the types of hashes that we would want to verify with a signature vs. those that we would want to check a simple comparison. In light of this, I'm working on an updated proposal that attempts to unify this style of (loosely) ANYPREVOUT/NOINPUT hash that can be used to form covenants, and (for similar reasons) allow for dynamic binding.\n\nSome folks have been talking about soft forking both APO and CTV as written, which is tempting (and I would not resist such a fork); but I continue to think that APO itself is kinda a weird half measure. My current line of thinking is to take much of APO's design (new key version, signing with taproot internal key), but use an entirely new hashing method that is nearly or completely disjoint from the existing Tapscript v0 key signature hashing. **Is anyone currently aware of a proposal or protocol that would specifically want to use a Tapscript v1 key and in some cases sign with SIGHASH_DEFAULT but in others sign with one of the new APO modes?**\n\nIf we design a separate hashing mode for our new Tapscript key version, then we can also mirror that mode (with appropriate modification for use in equality vs. signature check) to CTV with 33-byte hash, and avoid the temptation for folks to use pre-signed output covenants in awkward ways. Further, in designing the hashing mode, we can have a separate default mode from the existing SIGHASH_DEFAULT which is better suited to these V1 keys and would save a byte in whatever that common signing case is (I propose that this default be the signature-appropriate equivalent of CTV so that Tapscript v1 key and CTV hashes closely mirror each other).\n\nHere's my VERY incomplete draft of this line of thinking:\nhttps://gist.github.com/reardencode/2aa98700b720174598d21989dd46e781#file-proposal2-mediawiki",
  "actions_summary": [],
  "moderator": false,
  "admin": false,
  "staff": false,
  "user_id": 30,
  "hidden": false,
  "trust_level": 2,
  "deleted_at": null,
  "user_deleted": false,
  "edit_reason": null,
  "can_view_edit_history": true,
  "wiki": false,
  "reactions": [],
  "current_user_reaction": null,
  "reaction_users_count": 0,
  "current_user_used_main_reaction": false
}