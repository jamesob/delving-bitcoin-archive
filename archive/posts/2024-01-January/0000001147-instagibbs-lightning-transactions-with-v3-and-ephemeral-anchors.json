{
  "id": 1147,
  "name": "Gregory Sanders",
  "username": "instagibbs",
  "avatar_template": "/user_avatar/delvingbitcoin.org/instagibbs/{size}/28_2.png",
  "created_at": "2024-01-16T18:02:03.173Z",
  "cooked": "<aside class=\"quote no-group\" data-username=\"t-bast\" data-post=\"1\" data-topic=\"418\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://delvingbitcoin.org/user_avatar/delvingbitcoin.org/t-bast/48/98_2.png\" class=\"avatar\"> t-bast:</div>\n<blockquote>\n<p>we remove the 1-block relative delay on the main outputs and HTLC outputs</p>\n</blockquote>\n</aside>\n<p>Note that this is easily done by having the feature not be <code>option_anchors</code>, since that\u2019s the prior format for all the output scripts.</p>\n<p>The other discussion that came up is that of deployment strategy. There\u2019s a bit of a timeline problem:</p>\n<ol>\n<li>We need to roll out updates to mempool/relay to make the transition to v3 style transactions safe, so LN implementations can adopt it</li>\n<li>We need LN implementations to update before we can deploy cluster mempool upgrade, since CPFP carveout as it stands is inapplicable to cluster mempool.</li>\n</ol>\n<p>A suggestion on the call was essentially \u201cwhat if Bitcoin Core implicitly opts commitment transactions that rely on CPFP carveout into a new regime that doesn\u2019t rely on the carveout per se\u201d?</p>\n<p>This could lead to a revised project roadmap:</p>\n<ol>\n<li>V3, 2-cluster package rbf, 1p1c relay + mild orphanage churn protection</li>\n<li>Imbue LN commit txs with two anchors with \u201cimplicit signaling\u201d of V3<br>\na)  Anything with <em>two 330-sat outputs</em>?<br>\ni) Or get more specific, e.g., one input only, nversion==2, a couple of bytes here or there\u2026<br>\nb) Allow 1p2c \u201ccpfp carveout\u201d<br>\ni) \u201cOne more\u201d child, same size limitations as normal v3 child tx limit<br>\nii) This, along with 2-cluster package RBF, means if you stop spending the remote anchor, you can now efficiently do package rbf against remote tx, and the counter-party cannot pin local commit tx. Child will have to be \u201csmall\u201d following V3 rules. Exact implementation TBD</li>\n<li>Further rollouts, with no inherent inter-dependencies\na) Cluster mempool\nb) Further make orphan handling robust\nc) Ephemeral anchors\nd) LN spec update to do 0-fee commit txns</li>\n<li>\u2026 Remove the 1p2c CPFP carveout</li>\n</ol>\n<p>It doesn\u2019t interfere with the current work, and removes critical paths from deployment, so I think it\u2019s worth considering.</p>\n<p>With the revised timeline, we may be able to swap out CPFP carveout without doing any harm, allow implementations to improve their security via limited package rbf, and allow spec updates to happen on their own time for further improvements.</p>\n<hr>\n<h1><a name=\"v3-child-tx-size-1\" class=\"anchor\" href=\"#v3-child-tx-size-1\"></a>V3 Child tx size</h1>\n<p>We would also like feedback on what the maximal V3 child size should be. It\u2019s an inherent tradeoff between practical CPFP tx sizes and potential pin vectors, so it\u2019d be nice to know what expectations are around that from any wallet project.</p>",
  "post_number": 2,
  "post_type": 1,
  "updated_at": "2024-01-16T18:06:54.151Z",
  "reply_count": 2,
  "reply_to_post_number": null,
  "quote_count": 1,
  "incoming_link_count": 6,
  "reads": 20,
  "readers_count": 19,
  "score": 44.0,
  "yours": false,
  "topic_id": 418,
  "topic_slug": "lightning-transactions-with-v3-and-ephemeral-anchors",
  "topic_title": "Lightning transactions with v3 and ephemeral anchors",
  "topic_html_title": "Lightning transactions with v3 and ephemeral anchors",
  "category_id": 7,
  "display_username": "Gregory Sanders",
  "primary_group_name": null,
  "flair_name": null,
  "flair_url": null,
  "flair_bg_color": null,
  "flair_color": null,
  "flair_group_id": null,
  "version": 1,
  "can_edit": false,
  "can_delete": false,
  "can_recover": false,
  "can_see_hidden_post": false,
  "can_wiki": false,
  "user_title": null,
  "bookmarked": false,
  "raw": "[quote=\"t-bast, post:1, topic:418\"]\nwe remove the 1-block relative delay on the main outputs and HTLC outputs\n[/quote]\n\nNote that this is easily done by having the feature not be `option_anchors`, since that's the prior format for all the output scripts.\n\nThe other discussion that came up is that of deployment strategy. There's a bit of a timeline problem:\n1) We need to roll out updates to mempool/relay to make the transition to v3 style transactions safe, so LN implementations can adopt it\n2) We need LN implementations to update before we can deploy cluster mempool upgrade, since CPFP carveout as it stands is inapplicable to cluster mempool. \n\nA suggestion on the call was essentially \"what if Bitcoin Core implicitly opts commitment transactions that rely on CPFP carveout into a new regime that doesn't rely on the carveout per se\"?\n\nThis could lead to a revised project roadmap:\n\n1) V3, 2-cluster package rbf, 1p1c relay + mild orphanage churn protection\n2) Imbue LN commit txs with two anchors with \u201cimplicit signaling\u201d of V3  \n  a)  Anything with *two 330-sat outputs*?  \n      i) Or get more specific, e.g., one input only, nversion==2, a couple of bytes here or there...  \n  b) Allow 1p2c \u201ccpfp carveout\u201d  \n    i) \u201cOne more\u201d child, same size limitations as normal v3 child tx limit  \n    ii) This, along with 2-cluster package RBF, means if you stop spending the remote anchor, you can now efficiently do package rbf against remote tx, and the counter-party cannot pin local commit tx. Child will have to be \u201csmall\u201d following V3 rules. Exact implementation TBD  \n3) Further rollouts, with no inherent inter-dependencies\n  a) Cluster mempool\n  b) Further make orphan handling robust\n  c) Ephemeral anchors\n  d) LN spec update to do 0-fee commit txns\n4) ... Remove the 1p2c CPFP carveout\n\nIt doesn't interfere with the current work, and removes critical paths from deployment, so I think it's worth considering.\n\nWith the revised timeline, we may be able to swap out CPFP carveout without doing any harm, allow implementations to improve their security via limited package rbf, and allow spec updates to happen on their own time for further improvements.\n\n---\n\n# V3 Child tx size\n\nWe would also like feedback on what the maximal V3 child size should be. It's an inherent tradeoff between practical CPFP tx sizes and potential pin vectors, so it'd be nice to know what expectations are around that from any wallet project.",
  "actions_summary": [],
  "moderator": false,
  "admin": false,
  "staff": false,
  "user_id": 31,
  "hidden": false,
  "trust_level": 3,
  "deleted_at": null,
  "user_deleted": false,
  "edit_reason": null,
  "can_view_edit_history": true,
  "wiki": false,
  "reactions": [],
  "current_user_reaction": null,
  "reaction_users_count": 0,
  "current_user_used_main_reaction": false
}