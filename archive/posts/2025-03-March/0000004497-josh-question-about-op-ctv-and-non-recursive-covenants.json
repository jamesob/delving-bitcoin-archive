{
  "id": 4497,
  "name": "",
  "username": "josh",
  "avatar_template": "/user_avatar/delvingbitcoin.org/josh/{size}/95_2.png",
  "created_at": "2025-03-12T23:02:27.468Z",
  "cooked": "<p><em>This post is not an endorsement of OP_CTV or any specific covenant proposal.</em></p>\n<p>Hi all, I\u2019m trying to learn more about the OP_CTV proposal and covenants in general. My understanding is that OP_CTV was explicitly designed to avoid recursive covenants, which is why users of OP_CTV can commit to the outputs of a transaction, but not the inputs.</p>\n<p>First, is that explanation correct for why the inputs of a transaction cannot be committed to in OP_CTV?</p>\n<p>For context, I\u2019ve been thinking about how to create multiple buy offers for multiple UTXOs at once, in a single PSBT. As it stands, it is impossible to do this without creating a separately signed PSBT for every UTXO you wish to make an offer for.</p>\n<p>This is a pressing problem faced by the runes protocol. Users can make a trustless PSBT offer, which anyone can accept, but users cannot make the equivalent PSBT buy offer. Doing so would require making a separate PSBT offer for every single UTXO holding the rune the user wishes to make an offer for.</p>\n<p>Initially, I thought OP_CTV might provide a solution to this problem. A user would commit to a taproot output with separate script paths for every UTXO the user wishes to make an offer for. The executed script would commit to the outputs and the inclusion of the input of interest. An owner of any of the UTXOs could then accept the offer by signing and broadcasting their version of the reveal transaction (with perhaps a subsequent CPFP fee bump).</p>\n<p>Sadly, this doesn\u2019t appear possible with OP_CTV, since you can\u2019t commit to other inputs. At the same time, I wouldn\u2019t say that this feature alone is worth opening the can of worms that is recursive covenants.</p>\n<p>This brings to my second question. Would it ever make sense to let users commit to the <em>location</em> of an input (the block height, transaction index, and output index of the outpoint)?</p>\n<p>This would add complexity to script validation and create a non-txid dependency, but to my knowledge, this wouldn\u2019t enable recursive covenants. Recursive covenants are impossible if you need to know the mined location of an input, which can\u2019t be known ahead of time or while executing the transaction.</p>\n<p>There are certain tradeoffs, like the risk the location changes in the event of a reorg, and the difficulty of evaluating the script without access to the full UTXO set, but this functionality would be good enough for the use case I described above.</p>\n<p>Would there be a better way to enable multi-UTXO offers, without also enabling recursive covenants?</p>\n<p>Appreciate your help understanding OP_CTV and thinking through this problem!</p>\n<p><em>Disclaimer: I do not own any runes. My interest in runes is chiefly as a protocol that could facilitate the issuance of stocks and other securities natively on Bitcoin. I have no financial stake in the latter, other than a belief that Bitcoin-native capital markets, particularly for companies on a Bitcoin treasury strategy, could deepen people\u2019s understanding and appreciation of Bitcoin as money.</em></p>\n<p><em>I might also add that this post is purely exploratory and for my own education. I\u2019m not sure yet where I fall on the existing soft fork debate.</em></p>",
  "post_number": 1,
  "post_type": 1,
  "updated_at": "2025-03-12T23:02:27.468Z",
  "reply_count": 0,
  "reply_to_post_number": null,
  "quote_count": 0,
  "incoming_link_count": 0,
  "reads": 5,
  "readers_count": 4,
  "score": 0.8,
  "yours": false,
  "topic_id": 1517,
  "topic_slug": "question-about-op-ctv-and-non-recursive-covenants",
  "topic_title": "Question about OP_CTV and Non-Recursive Covenants",
  "topic_html_title": "Question about OP_CTV and Non-Recursive Covenants",
  "category_id": 7,
  "display_username": "",
  "primary_group_name": null,
  "flair_name": null,
  "flair_url": null,
  "flair_bg_color": null,
  "flair_color": null,
  "flair_group_id": null,
  "badges_granted": [],
  "version": 1,
  "can_edit": false,
  "can_delete": false,
  "can_recover": false,
  "can_see_hidden_post": false,
  "can_wiki": false,
  "user_title": null,
  "bookmarked": false,
  "raw": "*This post is not an endorsement of OP_CTV or any specific covenant proposal.*\n\nHi all, I\u2019m trying to learn more about the OP_CTV proposal and covenants in general. My understanding is that OP_CTV was explicitly designed to avoid recursive covenants, which is why users of OP_CTV can commit to the outputs of a transaction, but not the inputs.\n\nFirst, is that explanation correct for why the inputs of a transaction cannot be committed to in OP_CTV?\n\nFor context, I\u2019ve been thinking about how to create multiple buy offers for multiple UTXOs at once, in a single PSBT. As it stands, it is impossible to do this without creating a separately signed PSBT for every UTXO you wish to make an offer for.\n\nThis is a pressing problem faced by the runes protocol. Users can make a trustless PSBT offer, which anyone can accept, but users cannot make the equivalent PSBT buy offer. Doing so would require making a separate PSBT offer for every single UTXO holding the rune the user wishes to make an offer for.\n\nInitially, I thought OP_CTV might provide a solution to this problem. A user would commit to a taproot output with separate script paths for every UTXO the user wishes to make an offer for. The executed script would commit to the outputs and the inclusion of the input of interest. An owner of any of the UTXOs could then accept the offer by signing and broadcasting their version of the reveal transaction (with perhaps a subsequent CPFP fee bump).\n\nSadly, this doesn\u2019t appear possible with OP_CTV, since you can\u2019t commit to other inputs. At the same time, I wouldn\u2019t say that this feature alone is worth opening the can of worms that is recursive covenants.\n\nThis brings to my second question. Would it ever make sense to let users commit to the *location* of an input (the block height, transaction index, and output index of the outpoint)?\n\nThis would add complexity to script validation and create a non-txid dependency, but to my knowledge, this wouldn\u2019t enable recursive covenants. Recursive covenants are impossible if you need to know the mined location of an input, which can\u2019t be known ahead of time or while executing the transaction.\n\nThere are certain tradeoffs, like the risk the location changes in the event of a reorg, and the difficulty of evaluating the script without access to the full UTXO set, but this functionality would be good enough for the use case I described above.\n\nWould there be a better way to enable multi-UTXO offers, without also enabling recursive covenants?\n\nAppreciate your help understanding OP_CTV and thinking through this problem!\n\n*Disclaimer: I do not own any runes. My interest in runes is chiefly as a protocol that could facilitate the issuance of stocks and other securities natively on Bitcoin. I have no financial stake in the latter, other than a belief that Bitcoin-native capital markets, particularly for companies on a Bitcoin treasury strategy, could deepen people\u2019s understanding and appreciation of Bitcoin as money.*\n\n *I might also add that this post is purely exploratory and for my own education. I\u2019m not sure yet where I fall on the existing soft fork debate.*",
  "actions_summary": [],
  "moderator": false,
  "admin": false,
  "staff": false,
  "user_id": 98,
  "hidden": false,
  "trust_level": 1,
  "deleted_at": null,
  "user_deleted": false,
  "edit_reason": null,
  "can_view_edit_history": true,
  "wiki": false,
  "reactions": [],
  "current_user_reaction": null,
  "reaction_users_count": 0,
  "current_user_used_main_reaction": false
}