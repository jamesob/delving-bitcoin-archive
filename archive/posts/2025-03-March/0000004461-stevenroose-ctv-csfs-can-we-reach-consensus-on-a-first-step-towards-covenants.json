{
  "id": 4461,
  "name": "Steven Roose",
  "username": "stevenroose",
  "avatar_template": "/user_avatar/delvingbitcoin.org/stevenroose/{size}/1087_2.png",
  "created_at": "2025-03-10T22:35:25.181Z",
  "cooked": "<p>First of all, it is not easy to write about covenants without upsetting at least some people, given the various different leanings on the topic. Don\u2019t worry, I won\u2019t be announcing an activation client, nor pointing fingers or proposing yet another opcode.</p>\n<p>Recently I have noticed a small uptick in positive sentiment on the topic of covenants; at least within my own bubble of bitcoin developers. When I noticed some people were sharing their ideal covenants roadmap on Twitter, <a href=\"https://x.com/stevenroose3/status/1893206459602870583\" rel=\"noopener nofollow ugc\">I did the same</a>. While I didn\u2019t put a whole lot of thought into this roadmap (you\u2019re not supposed to do that on Twitter), it was nonetheless based on two years of pondering on the topic. To my surprise, I received a lot of positive feedback, both publicly and privately. And even more to my surprise, I heard almost no voices of objection. So I\u2019m here to share a little bit of the thinking process behind this roadmap.</p>\n<p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://delvingbitcoin.org/uploads/default/original/2X/a/a22f25d90c7eeb2b6297b9e7348b5187197ecc83.png\" data-download-href=\"https://delvingbitcoin.org/uploads/default/a22f25d90c7eeb2b6297b9e7348b5187197ecc83\" title=\"\"><img src=\"https://delvingbitcoin.org/uploads/default/original/2X/a/a22f25d90c7eeb2b6297b9e7348b5187197ecc83.png\" alt=\"\" data-base62-sha1=\"n8KmzdAyvu07AuUQ2Uf8Twmljbl\" width=\"579\" height=\"301\" role=\"presentation\"><div class=\"meta\"><svg class=\"fa d-icon d-icon-far-image svg-icon\" aria-hidden=\"true\"><use href=\"#far-image\"></use></svg><span class=\"filename\"></span><span class=\"informations\">579\u00d7301 29.2 KB</span><svg class=\"fa d-icon d-icon-discourse-expand svg-icon\" aria-hidden=\"true\"><use href=\"#discourse-expand\"></use></svg></div></a></div></p>\n<h1><a name=\"p-4461-consensus-upgrades-1\" class=\"anchor\" href=\"#p-4461-consensus-upgrades-1\"></a>Consensus upgrades</h1>\n<p>Bitcoin protocol developers have only two duties: maintain and protect the decentralized and permissionless nature of the bitcoin network; and provide functionality for app developers to build the product that is bitcoin as digital money.</p>\n<p>Immediately, two challenges come to mind:</p>\n<ul>\n<li>Changing consensus code to provide new functionality always comes with a certain risk. From buggy code to chain splits to changes in the network\u2019s incentive structures, it is our duty to take the utmost care when evaluating changes to bitcoin\u2019s consensus before proposing them to users.</li>\n<li>Since bitcoin users don\u2019t use the protocol directly, but app developers do when they are building the applications on top, it is hard to evaluate the utility of different proposals.</li>\n</ul>\n<p>Because the design space of application developers is so vast and bitcoin users so varied, I think the best approach is to make the bitcoin protocol as expressive as possible, while focussing on maintaining the security of the network and not endangering bitcoin\u2019s core properties.</p>\n<h1><a name=\"p-4461-on-generalized-covenants-2\" class=\"anchor\" href=\"#p-4461-on-generalized-covenants-2\"></a>On generalized covenants</h1>\n<p>In light of this approach, I specifically like the outlook of the <a href=\"https://rusty.ozlabs.org/2024/01/19/the-great-opcode-restoration.html\" rel=\"noopener nofollow ugc\">Great Script Restoration</a> project of Rusty Russel. It aims to re-instante much of the originally intended expressivity of bitcoin\u2019s Script and at the same time safeguarding validation requirements by introducing the VarOps budget for Script execution. The basic opcodes the GSR re-enables can then be extended with a combination of opcodes specifically tailored to provide transaction introspection (covenants) in an efficient, practical and safe way.</p>\n<p>While no one will deny that covenants are a useful tool to build a wide variety of second-layer protocols, I feel that there is still hesitancy in the wider bitcoin user community on how the merits of the functionality covenants and second-layer protocols enable outweigh the risks of introducing them.</p>\n<h1><a name=\"p-4461-a-careful-first-step-3\" class=\"anchor\" href=\"#p-4461-a-careful-first-step-3\"></a>A careful first step</h1>\n<p>Given the above arguments, I feel like we have both not yet figured out how to best design a practical protocol for fully generalized covenants, nor fully figured out their implications for the network\u2019s incentives.</p>\n<p>Technically however, I do feel that we can already sufficiently envision at least how the basis of any more generalized solution will look. For example, any proposal currently being designed, will benefit from an opcode to succinctly assert certain transaction properties. This is why I took on the work to spec out and implement the <a href=\"https://covenants.info/proposals/txhash/\" rel=\"noopener nofollow ugc\">OP_TXHASH opcode</a> according to Russel O\u2019Connor\u2019s ideas. While TXHASH as it stands is far from being mature enough to be deployed, it can function as an upgrade path for the similar but more restricted opcode <a href=\"https://covenants.info/proposals/ctv/\" rel=\"noopener nofollow ugc\">OP_CTV</a>. CTV has been known to the developer space for several years, has been deployed on various <a href=\"https://github.com/bitcoin-inquisition/bitcoin\" rel=\"noopener nofollow ugc\">test networks</a> and has been used to develop <a href=\"https://utxos.org/uses/\" rel=\"noopener nofollow ugc\">several use cases</a>.</p>\n<p>While CTV alone is quite a powerful tool for various second-layer protocols, it might on its own not be compelling enough to perform a soft-fork upgrade. That\u2019s why I think it makes sense to bundle it with another simple and mature opcode, <a href=\"https://github.com/bitcoin/bips/blob/050d422b2ac24d8221edab0ff0053e0f585409f7/bip-0348.md\" rel=\"noopener nofollow ugc\">OP_CHECKSIGFROMSTACK</a>. This opcode is also active on some test networks and has been <a href=\"https://github.com/ElementsProject/elements/commit/c35693257ca59b80659cfc4a965311f028c2d751#diff-a0337ffd7259e8c7c9a7786d6dbd420c80abfa1afdb34ebae3261109d9ae3c19R1328\" rel=\"noopener nofollow ugc\">deployed to the Liquid network for years</a>.</p>\n<p>What attracts me to this combination of opcodes, CTV &amp; CSFS, is that both of them stay useful in the scenario of further upgrades towards generalized covenants. Templating transactions is a useful tool in itself, and CTV can be upgraded with TXHASH to make the templating a lot more powerful. CSFS on the other hand, enabling simple signature verification, is such a basic tool that it will likely always have some use cases.</p>\n<p>Besides, CTV and CSFS enable only the most restrictive version of covenants possible. This both gives us more time to design technical solutions for generalized covenants and better study their implications for the network.</p>\n<h1><a name=\"p-4461-ctv-csfs-what-do-we-actually-get-4\" class=\"anchor\" href=\"#p-4461-ctv-csfs-what-do-we-actually-get-4\"></a>CTV + CSFS, what do we actually get?</h1>\n<p>Summarizing, CTV &amp; CSFS as a combination both enhances existing protocols and makes some entirely new protocols possible, while still being a very careful addition to bitcoin\u2019s expressiveness.</p>\n<p>Some examples of new protocol possibilities:</p>\n<ul>\n<li>In general terms, CTV simplifies any protocol that is based on pre-signed transactions by removing the need for both the interactivity of the pre-signing and the requirement to store the signatures. This in itself can benefit both existing protocols and new protocols yet uninvented.</li>\n<li>Since CTV+CSFS functions as an equivalent for <a href=\"https://covenants.info/proposals/apo/\" rel=\"noopener nofollow ugc\">SIGHASH_ANYPREVOUT</a> (APO), which enables Lightning Symmetry (formerly Eltoo). LN Symmerty is argued to be a better and more user-friendly implementation of Lightning channels, while it also makes multi-party channels possible and simplifies the implementation of PTLCs, further improving the Lightning Network.\nGreg Sanders\u2019 <a href=\"https://delvingbitcoin.org/t/ln-symmetry-project-recap/359\">deep dive summary on LN Symmetry</a> mentions additional benefits of CTV specifically. Various Lightning devs have stated their intention to implement LN Symmetry if CTV+CSFS would be available.</li>\n<li>More generally, CTV + CSFS as an APO replacement enabling re-bindable signatures can have further usage beyond LN Symmetry.</li>\n<li>I am obviously biased here, but CTV is a game-changer for <a href=\"https://ark-protocol.org/\" rel=\"noopener nofollow ugc\">Ark</a>, the younger second-layer protocol. While both Ark implementations are currently being built within bitcoin\u2019s actual capabilities, the <a href=\"https://x.com/stevenroose3/status/1865144252751028733\" rel=\"noopener nofollow ugc\">benefits of CTV</a> to the user experience are undeniable, and it is without doubt that both implementations will utilize CTV as soon as it is available.</li>\n<li>Protocols involving <a href=\"https://dci.mit.edu/smart-contracts\" rel=\"noopener nofollow ugc\">DLCs</a>, which have been growing in popularity, can be <a href=\"https://gnusha.org/pi/bitcoindev/CAH5Bsr2vxL3FWXnJTszMQj83jTVdRvvuVpimEfY7JpFCyP1AZA@mail.gmail.com/\" rel=\"noopener nofollow ugc\">significantly simplified</a> using CTV.</li>\n<li><a href=\"https://bitvm.org/\" rel=\"noopener nofollow ugc\">BitVM</a> would be able to drastically reduce its script sizes by replacing their current use of Lamport signatures implemented in Script by simple CSFS operations, while CTV could eliminate the need for some of the pre-signed transactions in its constructions.</li>\n<li><a href=\"https://github.com/jamesob/simple-ctv-vault\" rel=\"noopener nofollow ugc\">Very limited vaults</a> have been built with CTV.</li>\n</ul>\n<h1><a name=\"p-4461-where-do-we-go-from-here-5\" class=\"anchor\" href=\"#p-4461-where-do-we-go-from-here-5\"></a>Where do we go from here?</h1>\n<p>I mostly wanted to put this out there as a first step to see how people feel about this minimal package of opcodes as a first step on the covenants roadmap and hear out any feedback.</p>\n<p>James O\u2019Beirne and Rearden, who authored the latest implementations of the relevant BIPs (<a href=\"https://github.com/bitcoin/bips/blob/050d422b2ac24d8221edab0ff0053e0f585409f7/bip-0119.mediawiki\" rel=\"noopener nofollow ugc\">ctv</a>, <a href=\"https://github.com/bitcoin/bips/blob/050d422b2ac24d8221edab0ff0053e0f585409f7/bip-0348.md\" rel=\"noopener nofollow ugc\">csfs</a>), are working on updating their pull request to the Bitcoin Core repository so that they can be re-opened. While both the implementations are not new, they will obviously have to be thoroughly reviewed by other developers with knowledge of the codebase.</p>\n<p>Additionally, I have been talking with the authors of alternative covenant proposals to ask them how they feel about this idea. Surprisingly, I have received almost exclusively positive responses, some of them publicly announcing their opinion on Twitter. But then again, my own personal bubble of developers is obviously biased in favor of expanding Script with more functionality. That\u2019s why I\u2019d like to gather some feedback from a broader audience.</p>",
  "post_number": 1,
  "post_type": 1,
  "updated_at": "2025-03-11T09:44:00.452Z",
  "reply_count": 3,
  "reply_to_post_number": null,
  "quote_count": 0,
  "incoming_link_count": 241,
  "reads": 39,
  "readers_count": 38,
  "score": 1307.8,
  "yours": false,
  "topic_id": 1509,
  "topic_slug": "ctv-csfs-can-we-reach-consensus-on-a-first-step-towards-covenants",
  "topic_title": "CTV+CSFS: Can we reach consensus on a first step towards covenants?",
  "topic_html_title": "CTV+CSFS: Can we reach consensus on a first step towards covenants?",
  "category_id": 7,
  "display_username": "Steven Roose",
  "primary_group_name": null,
  "flair_name": null,
  "flair_url": null,
  "flair_bg_color": null,
  "flair_color": null,
  "flair_group_id": null,
  "badges_granted": [],
  "version": 5,
  "can_edit": false,
  "can_delete": false,
  "can_recover": false,
  "can_see_hidden_post": false,
  "can_wiki": false,
  "user_title": null,
  "bookmarked": false,
  "raw": "First of all, it is not easy to write about covenants without upsetting at least some people, given the various different leanings on the topic. Don\u2019t worry, I won't be announcing an activation client, nor pointing fingers or proposing yet another opcode.\n\nRecently I have noticed a small uptick in positive sentiment on the topic of covenants; at least within my own bubble of bitcoin developers. When I noticed some people were sharing their ideal covenants roadmap on Twitter, [I did the same](https://x.com/stevenroose3/status/1893206459602870583). While I didn\u2019t put a whole lot of thought into this roadmap (you\u2019re not supposed to do that on Twitter), it was nonetheless based on two years of pondering on the topic. To my surprise, I received a lot of positive feedback, both publicly and privately. And even more to my surprise, I heard almost no voices of objection. So I\u2019m here to share a little bit of the thinking process behind this roadmap.\n\n![|579x301](upload://n8KmzdAyvu07AuUQ2Uf8Twmljbl.png)\n\n# Consensus upgrades\n\nBitcoin protocol developers have only two duties: maintain and protect the decentralized and permissionless nature of the bitcoin network; and provide functionality for app developers to build the product that is bitcoin as digital money.\n\nImmediately, two challenges come to mind:\n\n* Changing consensus code to provide new functionality always comes with a certain risk. From buggy code to chain splits to changes in the network\u2019s incentive structures, it is our duty to take the utmost care when evaluating changes to bitcoin\u2019s consensus before proposing them to users.\n* Since bitcoin users don\u2019t use the protocol directly, but app developers do when they are building the applications on top, it is hard to evaluate the utility of different proposals.\n\nBecause the design space of application developers is so vast and bitcoin users so varied, I think the best approach is to make the bitcoin protocol as expressive as possible, while focussing on maintaining the security of the network and not endangering bitcoin\u2019s core properties.\n\n# On generalized covenants\n\nIn light of this approach, I specifically like the outlook of the [Great Script Restoration](https://rusty.ozlabs.org/2024/01/19/the-great-opcode-restoration.html) project of Rusty Russel. It aims to re-instante much of the originally intended expressivity of bitcoin\u2019s Script and at the same time safeguarding validation requirements by introducing the VarOps budget for Script execution. The basic opcodes the GSR re-enables can then be extended with a combination of opcodes specifically tailored to provide transaction introspection (covenants) in an efficient, practical and safe way.\n\nWhile no one will deny that covenants are a useful tool to build a wide variety of second-layer protocols, I feel that there is still hesitancy in the wider bitcoin user community on how the merits of the functionality covenants and second-layer protocols enable outweigh the risks of introducing them.\n\n# A careful first step\n\nGiven the above arguments, I feel like we have both not yet figured out how to best design a practical protocol for fully generalized covenants, nor fully figured out their implications for the network\u2019s incentives.\n\nTechnically however, I do feel that we can already sufficiently envision at least how the basis of any more generalized solution will look. For example, any proposal currently being designed, will benefit from an opcode to succinctly assert certain transaction properties. This is why I took on the work to spec out and implement the [OP_TXHASH opcode](https://covenants.info/proposals/txhash/) according to Russel O\u2019Connor\u2019s ideas. While TXHASH as it stands is far from being mature enough to be deployed, it can function as an upgrade path for the similar but more restricted opcode [OP_CTV](https://covenants.info/proposals/ctv/). CTV has been known to the developer space for several years, has been deployed on various [test networks](https://github.com/bitcoin-inquisition/bitcoin) and has been used to develop [several use cases](https://utxos.org/uses/).\n\nWhile CTV alone is quite a powerful tool for various second-layer protocols, it might on its own not be compelling enough to perform a soft-fork upgrade. That\u2019s why I think it makes sense to bundle it with another simple and mature opcode, [OP_CHECKSIGFROMSTACK](https://github.com/bitcoin/bips/blob/050d422b2ac24d8221edab0ff0053e0f585409f7/bip-0348.md). This opcode is also active on some test networks and has been [deployed to the Liquid network for years](https://github.com/ElementsProject/elements/commit/c35693257ca59b80659cfc4a965311f028c2d751#diff-a0337ffd7259e8c7c9a7786d6dbd420c80abfa1afdb34ebae3261109d9ae3c19R1328).\n\nWhat attracts me to this combination of opcodes, CTV & CSFS, is that both of them stay useful in the scenario of further upgrades towards generalized covenants. Templating transactions is a useful tool in itself, and CTV can be upgraded with TXHASH to make the templating a lot more powerful. CSFS on the other hand, enabling simple signature verification, is such a basic tool that it will likely always have some use cases.\n\nBesides, CTV and CSFS enable only the most restrictive version of covenants possible. This both gives us more time to design technical solutions for generalized covenants and better study their implications for the network.\n\n# CTV + CSFS, what do we actually get?\n\nSummarizing, CTV & CSFS as a combination both enhances existing protocols and makes some entirely new protocols possible, while still being a very careful addition to bitcoin\u2019s expressiveness.\n\nSome examples of new protocol possibilities:\n\n* In general terms, CTV simplifies any protocol that is based on pre-signed transactions by removing the need for both the interactivity of the pre-signing and the requirement to store the signatures. This in itself can benefit both existing protocols and new protocols yet uninvented.\n* Since CTV+CSFS functions as an equivalent for [SIGHASH_ANYPREVOUT](https://covenants.info/proposals/apo/) (APO), which enables Lightning Symmetry (formerly Eltoo). LN Symmerty is argued to be a better and more user-friendly implementation of Lightning channels, while it also makes multi-party channels possible and simplifies the implementation of PTLCs, further improving the Lightning Network.\nGreg Sanders\u2019 [deep dive summary on LN Symmetry](https://delvingbitcoin.org/t/ln-symmetry-project-recap/359) mentions additional benefits of CTV specifically. Various Lightning devs have stated their intention to implement LN Symmetry if CTV+CSFS would be available.\n* More generally, CTV + CSFS as an APO replacement enabling re-bindable signatures can have further usage beyond LN Symmetry.\n* I am obviously biased here, but CTV is a game-changer for [Ark](https://ark-protocol.org/), the younger second-layer protocol. While both Ark implementations are currently being built within bitcoin\u2019s actual capabilities, the [benefits of CTV](https://x.com/stevenroose3/status/1865144252751028733) to the user experience are undeniable, and it is without doubt that both implementations will utilize CTV as soon as it is available.\n* Protocols involving [DLCs](https://dci.mit.edu/smart-contracts), which have been growing in popularity, can be [significantly simplified](https://gnusha.org/pi/bitcoindev/CAH5Bsr2vxL3FWXnJTszMQj83jTVdRvvuVpimEfY7JpFCyP1AZA@mail.gmail.com/) using CTV.\n* [BitVM](https://bitvm.org/) would be able to drastically reduce its script sizes by replacing their current use of Lamport signatures implemented in Script by simple CSFS operations, while CTV could eliminate the need for some of the pre-signed transactions in its constructions.\n* [Very limited vaults](https://github.com/jamesob/simple-ctv-vault) have been built with CTV.\n\n# Where do we go from here?\n\nI mostly wanted to put this out there as a first step to see how people feel about this minimal package of opcodes as a first step on the covenants roadmap and hear out any feedback.\n\nJames O\u2019Beirne and Rearden, who authored the latest implementations of the relevant BIPs ([ctv](https://github.com/bitcoin/bips/blob/050d422b2ac24d8221edab0ff0053e0f585409f7/bip-0119.mediawiki), [csfs](https://github.com/bitcoin/bips/blob/050d422b2ac24d8221edab0ff0053e0f585409f7/bip-0348.md)), are working on updating their pull request to the Bitcoin Core repository so that they can be re-opened. While both the implementations are not new, they will obviously have to be thoroughly reviewed by other developers with knowledge of the codebase.\n\nAdditionally, I have been talking with the authors of alternative covenant proposals to ask them how they feel about this idea. Surprisingly, I have received almost exclusively positive responses, some of them publicly announcing their opinion on Twitter. But then again, my own personal bubble of developers is obviously biased in favor of expanding Script with more functionality. That's why I'd like to gather some feedback from a broader audience.",
  "actions_summary": [
    {
      "id": 2,
      "count": 6
    }
  ],
  "moderator": false,
  "admin": false,
  "staff": false,
  "user_id": 76,
  "hidden": false,
  "trust_level": 2,
  "deleted_at": null,
  "user_deleted": false,
  "edit_reason": null,
  "can_view_edit_history": true,
  "wiki": false,
  "reactions": [
    {
      "id": "+1",
      "type": "emoji",
      "count": 3
    },
    {
      "id": "heart",
      "type": "emoji",
      "count": 3
    }
  ],
  "current_user_reaction": null,
  "reaction_users_count": 6,
  "current_user_used_main_reaction": false
}