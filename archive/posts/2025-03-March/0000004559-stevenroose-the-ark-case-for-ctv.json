{
  "id": 4559,
  "name": "Steven Roose",
  "username": "stevenroose",
  "avatar_template": "/user_avatar/delvingbitcoin.org/stevenroose/{size}/1087_2.png",
  "created_at": "2025-03-17T17:23:04.588Z",
  "cooked": "<p>I initially made this layout as part of <a href=\"https://delvingbitcoin.org/t/ctv-csfs-can-we-reach-consensus-on-a-first-step-towards-covenants/1509/50\">another thread</a>, but to avoid derailing the original conversation, I\u2019ll repeat the post here so that questions and suggestions can be posted here.</p>\n<p>Because it was requested, let me make the <a href=\"https://x.com/stevenroose3/status/1865144252751028733\" rel=\"noopener nofollow ugc\">Ark case for CTV</a> in a bit more detail, because I think it is significant. One can also refer to <a href=\"https://ark-protocol.org/intro/vtxos/index.html\" rel=\"noopener nofollow ugc\">ark-protocol.org</a> for more detail.</p>\n<p>TL;DR: send-to-others, automatic vtxo reissuance, lightning receive and mass payouts</p>\n<p>For those that don\u2019t know, in Ark users hold off-chain utxos that we call virtual utxos or vtxos. In the original design, which uses CTV, these vtxos are constructed using a tree of transactions where each transaction uses a CTV covenant to get into the next transaction. Much like congestion control.</p>\n<p>Generalized, a vtxo can be any construction that has:</p>\n<ol>\n<li>\n<p>a chain or one or more txs with policy <code>ctv OR (pk(S) AND after(T))</code> (<code>S</code> being the Ark server\u2019s key and <code>T</code> being the vtxo\u2019s expiry time). Each <code>ctv</code> comitting to the next tx in the chain</p>\n</li>\n<li>\n<p>followed by a tx with the following policy <code>(pk(A) AND pk(S)) OR (pk(A) AND older(delta))</code> (<code>A</code> being the key of the vtxo\u2019s owner and <code>delta</code> being a relative timelock which gives the other policy enough time to react (something like 24h or 28h).</p>\n</li>\n</ol>\n<p>Using CTV, this construction can be constructed entirely non-interactively, meaning that knowing the Ark\u2019s parameters <code>S</code> and <code>delta</code>, anyone can issue their own vtxo that expires at time <code>T</code>. This is how \u201conboarding\u201d works, i.e. entering the Ark.</p>\n<p>When we developing <code>clArk</code> (covenant-less Ark), we replace the <code>ctv</code> policy with a MuSig2 pre-signature of <code>S</code> and all the users of the leaves below that node. The intermediate nodes from step 1. above become then <code>pk(S+A+B+C+..) OR (pk(S) AND after(T))</code>. Apart from additional signing and storage overhead, this has one strong limitation:</p>\n<p><strong>Co-signed (clArk) vtxos cannot be issued without the presence of the eventual owner</strong>, otherwise the construction is not safe. This has led our team (at <a>Second</a>) to only designate Ark rounds to be used for users that have expiring vtxos and need them to be refreshed, in effect \u201csending them to themselves\u201d. Because senders always have to be present in either Ark construction (they need to sign <a href=\"https://ark-protocol.org/intro/connectors/index.html#forfeit-transactions\" rel=\"noopener nofollow ugc\">forfeit txs</a>), if the receivers are also the senders, they are already present during the process.</p>\n<p>But being able to issue vtxos for others has several significant benefits:</p>\n<ul>\n<li>\n<p>The most obvious is simply being able to <strong>send vtxos to others without requiring the receiver to participate in Ark rounds</strong>. We currently only support users sending to each other using <a href=\"https://ark-protocol.org/intro/oor/index.html\" rel=\"noopener nofollow ugc\">out-of-round (Arkoor)</a> transactions, which has an additional security assumption. With CTV we could again support sending vtxos to others in rounds.</p>\n</li>\n<li>\n<p>It allows the server to issue vtxos for users. We currently want to do this in two occasions:</p>\n<ul>\n<li>A good server will want to <strong>re-issue expired vtxos automatically</strong>. This is obviously not secure, but the server can continuously provide proofs that it hasn\u2019t claimed any expired vtxos and for some smaller-value vtxos, this can be enough security for certain users.</li>\n<li><strong>Receiving Lightning payments</strong> in Ark (without having virtual channels) is not easy. One way it could be done is by having the user notify the server that it is expecting an inbound payment, the server will accept the HTLC as a hodl HTLC and issue an HTLC for the user in a vtxo in the next round. The user can then reveal the preimage which grants him the vtxo fully and allows the server to claim the hodl HTLC. (With various anti-abuse measures in place.) Without CTV the receiver would have to participate in a round in order to receive his HTLC.</li>\n</ul>\n</li>\n<li>\n<p>It would allow non-interactive onboards, but since for an onboard, the onboarder is usually the receiver anyway this seems quite uninteresting, but it equivalently <strong>allows any party to non-interactively issue any number of vtxos with a single on-chain output</strong>. We think this can be a very powerful tool for exchanges or DCA providers that want to regularly payout amounts to their users. Using CTV, they could independently construct a tree of vtxos (using the Ark\u2019s parameters), fund the root tx and inform all their users. Since these vtxos are no different than vtxos created in Ark rounds, the recipients can use them as if they were any other type of vtxo in this Ark.</p>\n</li>\n</ul>\n<p>At Second we believe these benefits are quite significant for both the user experience more broadly and the viability of participating in Ark rounds a the mobile setting in the first place. We have little data currently to back up this latter claim, but we are working hard to put up our implementation of co-signed Ark to the test on mobile clients.</p>",
  "post_number": 1,
  "post_type": 1,
  "updated_at": "2025-03-17T17:23:04.588Z",
  "reply_count": 1,
  "reply_to_post_number": null,
  "quote_count": 0,
  "incoming_link_count": 0,
  "reads": 15,
  "readers_count": 14,
  "score": 37.8,
  "yours": false,
  "topic_id": 1528,
  "topic_slug": "the-ark-case-for-ctv",
  "topic_title": "The Ark case for CTV",
  "topic_html_title": "The Ark case for CTV",
  "category_id": 7,
  "display_username": "Steven Roose",
  "primary_group_name": null,
  "flair_name": null,
  "flair_url": null,
  "flair_bg_color": null,
  "flair_color": null,
  "flair_group_id": null,
  "badges_granted": [],
  "version": 1,
  "can_edit": false,
  "can_delete": false,
  "can_recover": false,
  "can_see_hidden_post": false,
  "can_wiki": false,
  "user_title": null,
  "bookmarked": false,
  "raw": "I initially made this layout as part of [another thread](https://delvingbitcoin.org/t/ctv-csfs-can-we-reach-consensus-on-a-first-step-towards-covenants/1509/50?u=stevenroose), but to avoid derailing the original conversation, I'll repeat the post here so that questions and suggestions can be posted here.\n\n\nBecause it was requested, let me make the [Ark case for CTV](https://x.com/stevenroose3/status/1865144252751028733) in a bit more detail, because I think it is significant. One can also refer to [ark-protocol.org](https://ark-protocol.org/intro/vtxos/index.html) for more detail.\n\nTL;DR: send-to-others, automatic vtxo reissuance, lightning receive and mass payouts\n\nFor those that don't know, in Ark users hold off-chain utxos that we call virtual utxos or vtxos. In the original design, which uses CTV, these vtxos are constructed using a tree of transactions where each transaction uses a CTV covenant to get into the next transaction. Much like congestion control.\n\nGeneralized, a vtxo can be any construction that has:\n\n1. a chain or one or more txs with policy `ctv OR (pk(S) AND after(T))` (`S` being the Ark server's key and `T` being the vtxo's expiry time). Each `ctv` comitting to the next tx in the chain\n\n2. followed by a tx with the following policy `(pk(A) AND pk(S)) OR (pk(A) AND older(delta))` (`A` being the key of the vtxo's owner and `delta` being a relative timelock which gives the other policy enough time to react (something like 24h or 28h).\n\nUsing CTV, this construction can be constructed entirely non-interactively, meaning that knowing the Ark's parameters `S` and `delta`, anyone can issue their own vtxo that expires at time `T`. This is how \"onboarding\" works, i.e. entering the Ark.\n\nWhen we developing `clArk` (covenant-less Ark), we replace the `ctv` policy with a MuSig2 pre-signature of `S` and all the users of the leaves below that node. The intermediate nodes from step 1. above become then `pk(S+A+B+C+..) OR (pk(S) AND after(T))`. Apart from additional signing and storage overhead, this has one strong limitation:\n\n**Co-signed (clArk) vtxos cannot be issued without the presence of the eventual owner**, otherwise the construction is not safe. This has led our team (at [Second](second.tech)) to only designate Ark rounds to be used for users that have expiring vtxos and need them to be refreshed, in effect \"sending them to themselves\". Because senders always have to be present in either Ark construction (they need to sign [forfeit txs](https://ark-protocol.org/intro/connectors/index.html#forfeit-transactions)), if the receivers are also the senders, they are already present during the process.\n\nBut being able to issue vtxos for others has several significant benefits:\n\n- The most obvious is simply being able to **send vtxos to others without requiring the receiver to participate in Ark rounds**. We currently only support users sending to each other using [out-of-round (Arkoor)](https://ark-protocol.org/intro/oor/index.html) transactions, which has an additional security assumption. With CTV we could again support sending vtxos to others in rounds.\n\n- It allows the server to issue vtxos for users. We currently want to do this in two occasions:\n  - A good server will want to **re-issue expired vtxos automatically**. This is obviously not secure, but the server can continuously provide proofs that it hasn't claimed any expired vtxos and for some smaller-value vtxos, this can be enough security for certain users.\n  - **Receiving Lightning payments** in Ark (without having virtual channels) is not easy. One way it could be done is by having the user notify the server that it is expecting an inbound payment, the server will accept the HTLC as a hodl HTLC and issue an HTLC for the user in a vtxo in the next round. The user can then reveal the preimage which grants him the vtxo fully and allows the server to claim the hodl HTLC. (With various anti-abuse measures in place.) Without CTV the receiver would have to participate in a round in order to receive his HTLC.\n\n- It would allow non-interactive onboards, but since for an onboard, the onboarder is usually the receiver anyway this seems quite uninteresting, but it equivalently **allows any party to non-interactively issue any number of vtxos with a single on-chain output**. We think this can be a very powerful tool for exchanges or DCA providers that want to regularly payout amounts to their users. Using CTV, they could independently construct a tree of vtxos (using the Ark's parameters), fund the root tx and inform all their users. Since these vtxos are no different than vtxos created in Ark rounds, the recipients can use them as if they were any other type of vtxo in this Ark.\n\nAt Second we believe these benefits are quite significant for both the user experience more broadly and the viability of participating in Ark rounds a the mobile setting in the first place. We have little data currently to back up this latter claim, but we are working hard to put up our implementation of co-signed Ark to the test on mobile clients.",
  "actions_summary": [
    {
      "id": 2,
      "count": 2
    }
  ],
  "moderator": false,
  "admin": false,
  "staff": false,
  "user_id": 76,
  "hidden": false,
  "trust_level": 2,
  "deleted_at": null,
  "user_deleted": false,
  "edit_reason": null,
  "can_view_edit_history": true,
  "wiki": false,
  "reactions": [
    {
      "id": "+1",
      "type": "emoji",
      "count": 1
    },
    {
      "id": "heart",
      "type": "emoji",
      "count": 1
    }
  ],
  "current_user_reaction": null,
  "reaction_users_count": 2,
  "current_user_used_main_reaction": false
}