{
  "id": 2507,
  "name": "",
  "username": "setavenger",
  "avatar_template": "/user_avatar/delvingbitcoin.org/setavenger/{size}/573_2.png",
  "created_at": "2024-05-22T17:24:46.230Z",
  "cooked": "<aside class=\"quote no-group\" data-username=\"cygnet3\" data-post=\"6\" data-topic=\"891\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://delvingbitcoin.org/user_avatar/delvingbitcoin.org/cygnet3/48/575_2.png\" class=\"avatar\"> cygnet3:</div>\n<blockquote>\n<p>In Donation wallet, we keep a mapping between <code>ScriptPubKey -&gt; tweak</code> that we calculated during Step 2. Even though that is not a direct mapping from <code>txid -&gt; tweak</code>, you can still indirectly look up the <code>tweak</code> of a transaction by looking at the outputs. I think this avoids having to scan all outputs of a block for every tweak, without needing to tag the tweaks with their <code>txid</code>. However, it does require a grouping of the outputs.</p>\n</blockquote>\n</aside>\n<p>The UTXOs already contain the txids so grouping is already possible on the client side if necessary. The question is whether this should happen on the indexing or client side. I would not agree that grouping avoids scanning all the outputs. It only avoids doing it a second \u2192 nth time if you\u2019ve found an output on <code>k=0</code>.</p>\n<p>But if we were to offload grouping to the indexer, how would it look? How is the grouping done for donation wallet, is there any additional overhead for doing so? Especially on a per request basis. Which structure do you currently use? Something like this:</p>\n<pre data-code-wrap=\"json\"><code class=\"lang-json\">{\n    \"txid1..\" : [\n        {\n            \"txid\": \"txid1...\",\n            \"vout\": 1,\n            \"value\": 1000000,\n            \"scriptpubkey\": \"...\",\n            \"block_height\": 0,\n            \"block_hash\": \"...\",\n            \"timestamp\": 1715205985,\n            \"spent\": false\n         },\n         {\n            \"txid\": \"txid1...\",\n            \"vout\": 2,\n            \"value\": 1000000,\n            \"scriptpubkey\": \"...\",\n            \"block_height\": 0,\n            \"block_hash\": \"...\",\n            \"timestamp\": 1715205985,\n            \"spent\": false\n        },\n        ...\n    ],\n    \"txid2\": [\n        {\n            \"txid\": \"txid2...\",\n            \"vout\": 2,\n            \"value\": 1000000,\n            \"scriptpubkey\": \"...\",\n            \"block_height\": 0,\n            \"block_hash\": \"...\",\n            \"timestamp\": 1715205985,\n            \"spent\": false\n          },\n    ]\n}\n</code></pre>",
  "post_number": 7,
  "post_type": 1,
  "updated_at": "2024-05-22T17:24:46.230Z",
  "reply_count": 1,
  "reply_to_post_number": 6,
  "quote_count": 1,
  "incoming_link_count": 2,
  "reads": 15,
  "readers_count": 14,
  "score": 18.0,
  "yours": false,
  "topic_id": 891,
  "topic_slug": "silent-payments-light-client-protocol",
  "topic_title": "Silent Payments: Light Client Protocol",
  "topic_html_title": "Silent Payments: Light Client Protocol",
  "category_id": 12,
  "display_username": "",
  "primary_group_name": null,
  "flair_name": null,
  "flair_url": null,
  "flair_bg_color": null,
  "flair_color": null,
  "flair_group_id": null,
  "version": 1,
  "can_edit": false,
  "can_delete": false,
  "can_recover": false,
  "can_see_hidden_post": false,
  "can_wiki": false,
  "user_title": null,
  "bookmarked": false,
  "raw": "[quote=\"cygnet3, post:6, topic:891\"]\nIn Donation wallet, we keep a mapping between `ScriptPubKey -> tweak` that we calculated during Step 2. Even though that is not a direct mapping from `txid -> tweak`, you can still indirectly look up the `tweak` of a transaction by looking at the outputs. I think this avoids having to scan all outputs of a block for every tweak, without needing to tag the tweaks with their `txid`. However, it does require a grouping of the outputs.\n[/quote]\n\nThe UTXOs already contain the txids so grouping is already possible on the client side if necessary. The question is whether this should happen on the indexing or client side. I would not agree that grouping avoids scanning all the outputs. It only avoids doing it a second -> nth time if you've found an output on `k=0`. \n\nBut if we were to offload grouping to the indexer, how would it look? How is the grouping done for donation wallet, is there any additional overhead for doing so? Especially on a per request basis. Which structure do you currently use? Something like this:\n```json\n{\n    \"txid1..\" : [\n        {\n            \"txid\": \"txid1...\",\n            \"vout\": 1,\n            \"value\": 1000000,\n            \"scriptpubkey\": \"...\",\n            \"block_height\": 0,\n            \"block_hash\": \"...\",\n            \"timestamp\": 1715205985,\n            \"spent\": false\n         },\n         {\n            \"txid\": \"txid1...\",\n            \"vout\": 2,\n            \"value\": 1000000,\n            \"scriptpubkey\": \"...\",\n            \"block_height\": 0,\n            \"block_hash\": \"...\",\n            \"timestamp\": 1715205985,\n            \"spent\": false\n        },\n        ...\n    ],\n    \"txid2\": [\n        {\n            \"txid\": \"txid2...\",\n            \"vout\": 2,\n            \"value\": 1000000,\n            \"scriptpubkey\": \"...\",\n            \"block_height\": 0,\n            \"block_hash\": \"...\",\n            \"timestamp\": 1715205985,\n            \"spent\": false\n          },\n    ]\n}\n```",
  "actions_summary": [],
  "moderator": false,
  "admin": false,
  "staff": false,
  "user_id": 435,
  "hidden": false,
  "trust_level": 1,
  "deleted_at": null,
  "user_deleted": false,
  "edit_reason": null,
  "can_view_edit_history": true,
  "wiki": false,
  "reactions": [],
  "current_user_reaction": null,
  "reaction_users_count": 0,
  "current_user_used_main_reaction": false
}