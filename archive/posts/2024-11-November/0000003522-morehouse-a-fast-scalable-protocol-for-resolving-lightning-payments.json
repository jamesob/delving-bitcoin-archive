{
  "id": 3522,
  "name": "Matt Morehouse",
  "username": "morehouse",
  "avatar_template": "/letter_avatar_proxy/v4/letter/m/df705f/{size}.png",
  "created_at": "2024-11-14T20:52:41.355Z",
  "cooked": "<aside class=\"quote no-group\" data-username=\"JohnLaw\" data-post=\"4\" data-topic=\"1233\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://delvingbitcoin.org/letter_avatar_proxy/v4/letter/j/58956e/48.png\" class=\"avatar\"> JohnLaw:</div>\n<blockquote>\n<p>Users can <em>never</em> profit from force closing a channel with the OPR protocol (as long as their peer follows the protocol and avoids being bullied, as described in the post). With the OPR protocol, neither the offerer nor the offeree receives the HTLC\u2019s funds if they force close the channel with a peer that has not agreed on the HTLC\u2019s resolution. Therefore, there is no such minimum burn contribution that\u2019s required to secure the channel.</p>\n</blockquote>\n</aside>\n<p>After thinking through this more, I agree a node can\u2019t profit from force closing.  It can, however, carry out an asymmetric griefing attack where the cost of the attack is less than the damage caused to the victim.</p>\n<p>Suppose the following payment route:</p>\n<pre data-code-height=\"60\" data-code-wrap=\"mermaid\"><code class=\"lang-mermaid\">flowchart LR\nAlice--1001 sat--&gt;Bob--1000 sat--&gt;Mallory\n</code></pre>\n<p>Suppose further than 200 sat of matching funds are contributed by each party to the burn outputs of the two channels.  So while the HTLC is outstanding the contributions to burn outputs on the Bob-Mallory channel are as follows:</p>\n<div class=\"md-table\">\n<table>\n<thead>\n<tr>\n<th>Bob\u2019s Burn</th>\n<th>Mallory\u2019s Burn</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>1200 sat</td>\n<td>200 sat</td>\n</tr>\n</tbody>\n</table>\n</div><p>If Mallory closes the Bob-Mallory channel, Bob loses 1200 sat while Mallory only loses 200 sat (5x griefing potential).</p>\n<p>While this griefing attack is not free, it could still be quite attractive to nodes looking to put competitors out of business.</p>\n<aside class=\"quote no-group\" data-username=\"JohnLaw\" data-post=\"4\" data-topic=\"1233\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://delvingbitcoin.org/letter_avatar_proxy/v4/letter/j/58956e/48.png\" class=\"avatar\"> JohnLaw:</div>\n<blockquote>\n<p>Actually, with the OPR protocol, choosing to stay off-chain (rather than force closing) in no way leads to accepting the incorrect resolution of an HTLC. That type of logic (having to go on-chain for resolve an HTLC in one\u2019s favor) applies to the current lightning protocol, but not to the OPR protocol.</p>\n</blockquote>\n</aside>\n<p>Good point \u2013 instead of forgiving the HTLC or force closing, the channel can remain open with diminished capacity.</p>\n<p>Over time, however, disputed HTLCs will accumulate and capacity will continue to decrease.  Eventually a channel close will be needed and all disputed HTLCs  will be burned with their matching funds.</p>\n<p>If the frequency of disputed HTLCs is low enough, channels can still be profitable while staying off chain, providing a chain fee benefit over the current LN protocol.</p>\n<aside class=\"quote no-group quote-modified\" data-username=\"JohnLaw\" data-post=\"4\" data-topic=\"1233\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://delvingbitcoin.org/letter_avatar_proxy/v4/letter/j/58956e/48.png\" class=\"avatar\"> JohnLaw:</div>\n<blockquote>\n<aside class=\"quote no-group\" data-username=\"morehouse\" data-post=\"2\" data-topic=\"1233\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://delvingbitcoin.org/letter_avatar_proxy/v4/letter/m/df705f/48.png\" class=\"avatar\"> morehouse:</div>\n<blockquote>\n<p>Since networks are inherently unreliable, can\u2019t an attacker easily lie about the actual time the message was sent? How does a node distinguish between occasional network lag and a malicious peer?</p>\n</blockquote>\n</aside>\n<p>Yes, an attacker can lie. However, with the OPR protocol they have absolutely no incentive to do so (and will actually be penalized if they do so).</p>\n<p>There\u2019s no reason for a peer to be malicious (unless they\u2019re griefing while self-griefing, which should be very rare).</p>\n</blockquote>\n</aside>\n<p>There\u2019s an incentive to lie in the following case:</p>\n<ul>\n<li>If an HTLC from Alice to Mallory has already expired and then Mallory learns the preimage, she can backdate the timestamp in an attempt to convince Alice that network lag occurred and Mallory should still get the value of the HTLC.</li>\n</ul>\n<p>Now Alice could still dispute the HTLC, since Alice\u2019s clock says the HTLC already expired.  But that just proves my point \u2013 timestamps from the other party cannot be trusted and therefore shouldn\u2019t be used to determine HTLC resolution.</p>\n<aside class=\"quote no-group\" data-username=\"JohnLaw\" data-post=\"4\" data-topic=\"1233\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://delvingbitcoin.org/letter_avatar_proxy/v4/letter/j/58956e/48.png\" class=\"avatar\"> JohnLaw:</div>\n<blockquote>\n<p>The more relavent question is how both non-malicious peers can agree on whether or not an HTLC was resolved. A number of techniques for doing this are presented in the post at the end of the Burned Funds section.</p>\n</blockquote>\n</aside>\n<p>Yes, the whole protocol hinges on such agreement being possible the vast majority of the time.  If disputes are too common, then routing fees become quite expensive.</p>",
  "post_number": 10,
  "post_type": 1,
  "updated_at": "2024-11-14T20:52:41.355Z",
  "reply_count": 0,
  "reply_to_post_number": 4,
  "quote_count": 2,
  "incoming_link_count": 0,
  "reads": 10,
  "readers_count": 9,
  "score": 2.0,
  "yours": false,
  "topic_id": 1233,
  "topic_slug": "a-fast-scalable-protocol-for-resolving-lightning-payments",
  "topic_title": "A Fast, Scalable Protocol For Resolving Lightning Payments",
  "topic_html_title": "A Fast, Scalable Protocol For Resolving Lightning Payments",
  "category_id": 7,
  "display_username": "Matt Morehouse",
  "primary_group_name": null,
  "flair_name": null,
  "flair_url": null,
  "flair_bg_color": null,
  "flair_color": null,
  "flair_group_id": null,
  "version": 1,
  "can_edit": false,
  "can_delete": false,
  "can_recover": false,
  "can_see_hidden_post": false,
  "can_wiki": false,
  "user_title": null,
  "bookmarked": false,
  "raw": "[quote=\"JohnLaw, post:4, topic:1233\"]\nUsers can *never* profit from force closing a channel with the OPR protocol (as long as their peer follows the protocol and avoids being bullied, as described in the post). With the OPR protocol, neither the offerer nor the offeree receives the HTLC\u2019s funds if they force close the channel with a peer that has not agreed on the HTLC\u2019s resolution. Therefore, there is no such minimum burn contribution that\u2019s required to secure the channel.\n[/quote]\n\nAfter thinking through this more, I agree a node can't profit from force closing.  It can, however, carry out an asymmetric griefing attack where the cost of the attack is less than the damage caused to the victim.\n\nSuppose the following payment route:\n\n```mermaid height=60,auto\nflowchart LR\nAlice--1001 sat-->Bob--1000 sat-->Mallory\n```\n\nSuppose further than 200 sat of matching funds are contributed by each party to the burn outputs of the two channels.  So while the HTLC is outstanding the contributions to burn outputs on the Bob-Mallory channel are as follows:\n\n| Bob's Burn | Mallory's Burn |\n|---|---|\n| 1200 sat | 200 sat |\n\nIf Mallory closes the Bob-Mallory channel, Bob loses 1200 sat while Mallory only loses 200 sat (5x griefing potential).\n\nWhile this griefing attack is not free, it could still be quite attractive to nodes looking to put competitors out of business.\n\n[quote=\"JohnLaw, post:4, topic:1233\"]\nActually, with the OPR protocol, choosing to stay off-chain (rather than force closing) in no way leads to accepting the incorrect resolution of an HTLC. That type of logic (having to go on-chain for resolve an HTLC in one\u2019s favor) applies to the current lightning protocol, but not to the OPR protocol.\n[/quote]\n\nGood point -- instead of forgiving the HTLC or force closing, the channel can remain open with diminished capacity.\n\nOver time, however, disputed HTLCs will accumulate and capacity will continue to decrease.  Eventually a channel close will be needed and all disputed HTLCs  will be burned with their matching funds.\n\nIf the frequency of disputed HTLCs is low enough, channels can still be profitable while staying off chain, providing a chain fee benefit over the current LN protocol.\n\n\n[quote=\"JohnLaw, post:4, topic:1233\"]\n[quote=\"morehouse, post:2, topic:1233\"]\nSince networks are inherently unreliable, can\u2019t an attacker easily lie about the actual time the message was sent? How does a node distinguish between occasional network lag and a malicious peer?\n[/quote]\n\nYes, an attacker can lie. However, with the OPR protocol they have absolutely no incentive to do so (and will actually be penalized if they do so).\n\nThere\u2019s no reason for a peer to be malicious (unless they\u2019re griefing while self-griefing, which should be very rare).\n[/quote]\n\nThere's an incentive to lie in the following case:\n- If an HTLC from Alice to Mallory has already expired and then Mallory learns the preimage, she can backdate the timestamp in an attempt to convince Alice that network lag occurred and Mallory should still get the value of the HTLC.\n\nNow Alice could still dispute the HTLC, since Alice's clock says the HTLC already expired.  But that just proves my point -- timestamps from the other party cannot be trusted and therefore shouldn't be used to determine HTLC resolution.\n\n[quote=\"JohnLaw, post:4, topic:1233\"]\nThe more relavent question is how both non-malicious peers can agree on whether or not an HTLC was resolved. A number of techniques for doing this are presented in the post at the end of the Burned Funds section.\n[/quote]\n\nYes, the whole protocol hinges on such agreement being possible the vast majority of the time.  If disputes are too common, then routing fees become quite expensive.",
  "actions_summary": [],
  "moderator": false,
  "admin": false,
  "staff": false,
  "user_id": 47,
  "hidden": false,
  "trust_level": 2,
  "deleted_at": null,
  "user_deleted": false,
  "edit_reason": null,
  "can_view_edit_history": true,
  "wiki": false,
  "reactions": [],
  "current_user_reaction": null,
  "reaction_users_count": 0,
  "current_user_used_main_reaction": false
}