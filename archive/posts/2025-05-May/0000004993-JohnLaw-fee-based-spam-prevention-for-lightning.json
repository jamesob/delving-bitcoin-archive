{
  "id": 4993,
  "name": null,
  "username": "JohnLaw",
  "avatar_template": "/letter_avatar_proxy/v4/letter/j/58956e/{size}.png",
  "created_at": "2025-05-12T17:47:12.512Z",
  "cooked": "<p>Here\u2019s a numerical example of using Upfront, Hold and Success Fees for a 10-hop payment of 10,000 sats, where node 0 is the payment\u2019s source and node 10 is the payment\u2019s destination.</p>\n<p>It also includes a comparison to the current protocol.</p>\n<h1><a name=\"p-4993-fee-based-spam-reduction-protocol-1\" class=\"anchor\" href=\"#p-4993-fee-based-spam-reduction-protocol-1\"></a>FEE-BASED SPAM REDUCTION PROTOCOL</h1>\n<h2><a name=\"p-4993-assume-2\" class=\"anchor\" href=\"#p-4993-assume-2\"></a>Assume:</h2>\n<ul>\n<li>each node on the route uses the same parameters</li>\n<li>each routing node charges 10 msats as the fixed part of the Upfront Fee to cover the costs of calculation, communication and allocation of a slot</li>\n<li>each routing node charges 1 * 10^(-5) of the payment amount as the proportional part of the Upfront Fee to cover:\n<ul>\n<li>the cost of allocating channel funds to the payment for the seconds that can be required for a non-delayed payment, and</li>\n<li>the risk of losing the payment amount (due to paying the downstream HTLC without being paid the upstream HTLC)</li>\n</ul>\n</li>\n<li>each node has a cltv_expiry_delta of 10 hours (600 blocks)</li>\n<li>each node charges a Hold Fee at the rate of 2 * 10^(-5) / hour\n<ul>\n<li>this corresponds to a 19% (compounded) annual rate of return (as 1.00002^(24*365) = 1.19)</li>\n</ul>\n</li>\n<li>each node charges 1 * 10^(-4) of their nonreimbursable Hold Fee stake contribution as part of the Upfront Fee\n<ul>\n<li>this covers the risk that the node will be responsible for paying a Hold Fee due to a delay that it causes</li>\n<li>the value 1 * 10^(-4) corresponds to causing a 10-hour delay once every 10,000 payments\n<ul>\n<li>note that a 10-hour delay is the maximum nonreimbursable delay given the cltv_expiry_delta value of 10 hours</li>\n<li>any delay beyond 10 hours must be caused by some downstream node and thus will be paid (reimbursed) by that downstream node</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>each node charges 1 * 10^(-4) of their Hold Fee stake contribution as part of the Upfront Fee\n<ul>\n<li>this covers the risk of burning those funds due to a partner who fails to agree to the division of the burn funds (e.g., due to a permanent failure or griefing attack)</li>\n</ul>\n</li>\n<li>each node requires their partner devote (as matching funds) 1/4 of the base funds in the burn output\n<ul>\n<li>this guarantees one\u2019s partner loses at least 1/5 of what one loses in a griefing attack</li>\n<li>this increases the size of the burn output by 50% (as each channel partner provides matching funds that are 1/4 of the base funds)</li>\n</ul>\n</li>\n<li>each routing node charges 90 msats as the fixed part of the Success Fee</li>\n<li>each routing node charges 6 * 10^(-5) of the payment amount as the proportional part of the Success Fee</li>\n</ul>\n<p>Given the above assumptions:</p>\n<ul>\n<li>\n<p>each node charges a Hold Fee of (2 * 10^(-5) / hour) * (10,000 sats) = 2 * 10^(-1) sats / hour</p>\n</li>\n<li>\n<p>each node i, 1 &lt;= i &lt;= 10, pays a nonreimbursable Hold Fee to the i upstream nodes at the rate of i * (2 * 10^(-1) sats / hour) for delays caused by node i</p>\n<ul>\n<li>thus node i pays a maximum of 2i sats in nonreimbursed Hold Fees if node i causes its maximum possible 10-hour delay</li>\n</ul>\n</li>\n<li>\n<p>each routing node i, 1 &lt;= i &lt;= 9, charges a Succees Fee of 90 msats + 10,000 * 6 * 10^(-5) sats = 690 msats</p>\n<pre><code>                 \t\tUpfront Fee     \t    \n  Max            \t\tcharge for      \tHold Fee    \n  nonreimbursable\t\tnonreimburable  \tbase stake    \n  Hold Fee       \t\tHold Fee risk   \tcontribution    \n</code></pre>\n</li>\n</ul>\n<p>Node:\tpayment (sats):\t\t(msats):        \t(sats):</p>\n<hr>\n<p>0   \t   0           \t\t   0.0          \t 0<br>\n1   \t   2\t           \t   0.2          \t20<br>\n2   \t   4\t           \t   0.4          \t36<br>\n3   \t   6           \t\t   0.6          \t48<br>\n4   \t   8           \t\t   0.8          \t56<br>\n5   \t  10           \t\t   1.0          \t60<br>\n6   \t  12           \t\t   1.2          \t60<br>\n7   \t  14           \t\t   1.4          \t56<br>\n8   \t  16           \t\t   1.6          \t48<br>\n9   \t  18           \t\t   1.8          \t36<br>\n10   \t  20           \t\t   2.0          \t20</p>\n<p>(For example, node 6 pays at most 2 sats to each of the 6 upstream nodes (nodes 0..5) for delays that node 6 causes.)<br>\n(For example, node 6 charges 12 sats * 10^(-4) = 1.2 msats in additional Upfront Fees in order to cover the risk that node 6 will have to pay a Hold Fee for a delay that it causes.)<br>\n(For example, node 6 stakes 5 * 6 * 2 = 60 sats for the maximum 2-sat Hold Fee paid by each of the 5 downstream nodes (nodes 6..10) to each of the 6 upstream nodes (nodes 0..5).)</p>\n<pre><code> \t             \tTotal        \tUpfront Fee  \n \tHold Fee     \tHold Fee     \tcharge for  \n \tmatch stake  \tstake\t     \tHold Fee  \n \tcontribution \tcontribution \tburn risk  \n</code></pre>\n<p>Node:\t(sats):      \t(sats):\t     \t(msats):</p>\n<hr>\n<p>0   \t5            \t5            \t   0.5<br>\n1   \t14           \t34           \t   3.4<br>\n2   \t21           \t57           \t   5.7<br>\n3   \t26           \t74           \t   7.4<br>\n4   \t29           \t85           \t   8.5<br>\n5   \t30           \t90           \t   9.0<br>\n6   \t29           \t89           \t   8.9<br>\n7   \t26           \t82           \t   8.2<br>\n8   \t21           \t69           \t   6.9<br>\n9   \t14           \t50           \t   5.0<br>\n10   \t5            \t25           \t   2.5<br>\n(For example, node 6 matches 1/4 of its 60-sat Hold Fee base stake in the channel with node 5 and 1/4 of node 7\u2019s 56-sat Hold fee base stake in that channel.)<br>\n(For example, node 6 contributes 60 sats of base funds in the channel with node 5, plus it contributes 15 sats of matching funds in that channel and 14 sats of matching funds in its channel with node 7.)<br>\n(For example, node 6 charges 89 sats * 10^(-4) = 8.9 msats for the risk that its 89-sat Hold Fee stake contribution to burn outputs will be lost due to burning those funds.)</p>\n<pre><code> \tUpfront Fee   \n \tcharge       \tTotal       \tUpfront Fee  \n \tunrelated to \tUpfront Fee \tbase stake  \n \tHold Fees    \tcharge      \tcontribution  \n</code></pre>\n<p>Node:\t(msats):     \t(msats):    \t(msats):</p>\n<hr>\n<p>0   \t   0         \t   0.5      \t1,066.5<br>\n1   \t 110         \t 113.6      \t  952.9<br>\n2   \t 110         \t 116.1      \t  836.8<br>\n3   \t 110         \t 118.0      \t  718.8<br>\n4   \t 110         \t 119.3      \t  599.5<br>\n5   \t 110         \t 120.0      \t  479.5<br>\n6   \t 110         \t 120.1      \t  359.4<br>\n7   \t 110         \t 119.6      \t  239.8<br>\n8   \t 110         \t 118.5      \t  121.3<br>\n9   \t 110         \t 116.8      \t    4.5<br>\n10   \t   0         \t   4.5      \t    0.0<br>\n(For example, node 6 charges a fixed Upfront fee of 10 msats and a proportional Upfront Fee of 10,000 * 10^(-5) = 0.1 sats = 100 msats.)<br>\n(For example, node 6 charges 1.2 msats for the risk of paying a nonreimbursable Hold Fee, 8.9 msats for the risk of burning its contributions to Hold Fee stakes, and 110 msats unrelated to Hold Fees.)<br>\n(For example, node 6 stakes base funds to cover Upfront Fee transfers for payments of 119.6 + 118.5 + 116.8 + 4.5 = 359.4 msats to nodes 7..10.)</p>\n<pre><code> \t               \t             \tTotal Hold +   \n \tUpfront Fee     Upfront Fee  \tUpfront Fee    \n \tmatching stake  total stake  \tstake          \n \tcontribution   \tcontribution \tcontribution   \n</code></pre>\n<p>Node:\t(msats):       \t(msats):     \t(msats):</p>\n<hr>\n<p>0   \t266.625        \t1,333.1      \t 6,333.1<br>\n1   \t504.850        \t1,457.8      \t35,457.8<br>\n2   \t447.425        \t1,284.2      \t58,284.2<br>\n3   \t388.900        \t1,107.7      \t75,107.7<br>\n4   \t329.575        \t  929.1      \t85,929.1<br>\n5   \t269.750        \t  749.3      \t90,749.3<br>\n6   \t209.725        \t  569.1      \t89,569.1<br>\n7   \t149.800        \t  389.6      \t82,569.1<br>\n8   \t 90.275        \t  211.6      \t69,211.6<br>\n9   \t 31.450        \t   36.0      \t50,036.0<br>\n10   \t  1.125        \t    1.1      \t25,001.1<br>\n(For example, node 6 contributes 479.5 / 4 = 119.875 msats Upfront matching funds in its channel with node 5 and 359.4 / 4 = 89.85 msats Upfront matching fund in its channel with node 7.)<br>\n(For example, node 6 contributes 359.4 msats base funds and 209.725 msats matching funds for the Upfront Fee.)<br>\n(For example, node 6 contributes 89 sats for Hold Fee stakes and 569.1 msats for Upfront Fee stakes.)</p>\n<pre><code>    \t            \t            \tburn output  \n    \tHTLC output \tburn output \toverhead     \n</code></pre>\n<p>Channel:\t(msats):    \t(msats):    \t(percent):</p>\n<hr>\n<p>0-1     \t10,006,210  \t 31,600     \t0.32%<br>\n1-2    \t\t10,005,520  \t 55,429     \t0.55%<br>\n2-3    \t\t10,004,830  \t 73,255     \t0.73%<br>\n3-4    \t\t10,004,140  \t 85,078     \t0.85%<br>\n4-5    \t\t10,003,450  \t 90,899     \t0.91$<br>\n5-6    \t\t10,002,760  \t 90,719     \t0.91$<br>\n6-7    \t\t10,002,070  \t 84,539     \t0.85%<br>\n7-8    \t\t10,001,380  \t 72,360     \t0.72%<br>\n8-9    \t\t10,000,690  \t 54,182     \t0.54%<br>\n9-10   \t\t10,000,000  \t 30,007     \t0.30%<br>\n(For example, the HTLC output in channel 5-6 contains the 10,000,000 msats for the payment amount and a Success Fee of 690 msats for each of the 4 downstream routing nodes (nodes 6..9).)<br>\n(For example, the burn output in channel 5-6 contains 479.5 msats in Upfront Fee base stake contributions from node 5 and 60,000 msats in Hold Fee base stake contributions from node 6 = 60,479.5 msats base funds plus an additional 60,479.5 / 4 = 15,119.875 msats of matching funds from each of nodes 5 and 6.)<br>\n(For example, the overhead for the burn output in channel 5-6 is 90,719 / 10,002,760 = 0.91%.)</p>\n<p>This completes the analysis of the calculation of the HTLC output and the burn output for this payment in each channel.</p>\n<h1><a name=\"p-4993-comparison-with-current-protocol-3\" class=\"anchor\" href=\"#p-4993-comparison-with-current-protocol-3\"></a>COMPARISON WITH CURRENT PROTOCOL</h1>\n<p>Now consider 4 scenarios for the execution of this payment using the Fee-Based Spam Prevention protocol and the current protocol.</p>\n<h2><a name=\"p-4993-for-the-current-protocol-assume-4\" class=\"anchor\" href=\"#p-4993-for-the-current-protocol-assume-4\"></a>For the current protocol, assume:</h2>\n<ul>\n<li>each routing node charges a 100 msats as the fixed portion of the routing fee</li>\n<li>each routing node charges 7.011 * 10^(-5) as the proportional part of the routing fee\n<ul>\n<li>this value was chosen to match the charges for the Fee-Based Spam Prevention protocol above, minus the costs associated with losing funds by burning them (as those costs are unique to that protocol)</li>\n<li>however, this value is likely too small, as it ignores the larger on-chain fees that the current protocol can have (as shown in Scenario 3 below)</li>\n</ul>\n</li>\n<li>on-chain transactions cost 10 sats/vbyte</li>\n<li>timing out an HTLC on-chain requires 388.75 vbytes\n<ul>\n<li>Commitment transaction is 168 vbytes non-witness data + 222/4 vbytes witness data</li>\n<li>HTLC-timeout transaction is 94 vbytes non-witness data + 285/4 vbytes witness data</li>\n<li>cost of timing out an HTLC on-chain is 10,000 msats/vbyte * 388.75 vbytes = 3,887,500 msats</li>\n</ul>\n</li>\n</ul>\n<p>Given these assumptions, with the current protocol the sender attempts to create the following HTLC outputs.</p>\n<pre><code>    \tHTLC output  \n</code></pre>\n<p>Channel:\t(msats):</p>\n<hr>\n<p>0-1     \t10,007,210<br>\n1-2    \t\t10,006,409<br>\n2-3    \t\t10,005,608<br>\n3-4    \t\t10,004,807<br>\n4-5    \t\t10,004,006<br>\n5-6    \t\t10,003,204<br>\n6-7    \t\t10,002,403<br>\n7-8    \t\t10,001,602<br>\n8-9    \t\t10,000,801<br>\n9-10   \t\t10,000,000<br>\n(For example, the HTLC output in channel 5-6 contains the 10,000,000 msats for the payment amount and a routing fee of 100 + 10,000,000 * 7.011 * 10^(-5) = 801.1  msats for each of the 4 downstream routing nodes (nodes 6..9).)</p>\n<h2><a name=\"p-4993-scenario-1-successful-payment-with-no-delay-5\" class=\"anchor\" href=\"#p-4993-scenario-1-successful-payment-with-no-delay-5\"></a>Scenario 1: Successful payment with no delay</h2>\n<pre><code> \tSpam Prevention \tCurrent Protocol  \n \tgain from       \tgain from  \n \tsuccessful      \tsuccessful  \n \tnon-delayed     \tnon-delayed  \n \tpayment          \tpayment  \n</code></pre>\n<p>Node:\t(msats):         \t(msats):</p>\n<hr>\n<p>0   \t-10,007,276.5   \t-10,007,209.9<br>\n1   \t        803.6   \t        801.1<br>\n2   \t        806.1   \t        801.1<br>\n3   \t        808.0   \t        801.1<br>\n4   \t        809.3   \t        801.1<br>\n5   \t        810.0   \t        801.1<br>\n6   \t        810.1   \t        801.1<br>\n7   \t        809.6   \t        801.1<br>\n8   \t        808.5   \t        801.1<br>\n9   \t        806.8   \t        801.1<br>\n10   \t 10,000,004.5   \t 10,000,000.0<br>\n(For example, node 6 charges an Upfront Fee of 120.1 msats and a Success Fee of 690 msats.)<br>\n(For example, node 6 charges a fixed routing fee of 100 msats and a proportional routing fee of 10,000 sats * 7.011 * 10^(-5) = 701.1 msats.)</p>\n<p>Note that in Scenario 1 the two protocols have very similar results, with the fees for the Spam Prevention protocol being 0.9% higher overall (as 7276.5 / 7209.5 = 1.0092).</p>\n<h2><a name=\"p-4993-scenario-2-successful-payment-delayed-1-hour-at-the-destination-6\" class=\"anchor\" href=\"#p-4993-scenario-2-successful-payment-delayed-1-hour-at-the-destination-6\"></a>Scenario 2: Successful payment delayed 1 hour at the destination</h2>\n<pre><code> \tSpam Prevention \tSpam Prevention \tSpam Prevention  \n \tgross gain from \tcapital costs   \tnet gain from  \n \tsuccessful      \tof successful   \tsuccessful  \n \tpayment         \tpayment         \tpayment  \n \tdelayed 1 hour  \tdelayed 1 hour   \tdelayed 1 hour  \n \tat destination \t\tat destination  \tat destination  \n</code></pre>\n<p>Node:\t(msats):       \t\t(msats):        \t(msats):</p>\n<hr>\n<p>0   \t-10,007,076.5  \t\t200.3           \t-10,007,276.8<br>\n1   \t      1,003.6  \t\t200.8           \t        802.8<br>\n2   \t      1,006.1  \t\t201.3           \t        804.8<br>\n3   \t      1,008.0  \t\t201.6           \t        806.4<br>\n4   \t      1,009.3  \t  \t201.8           \t        807.5<br>\n5   \t      1,010.0  \t  \t201.9           \t        808.1<br>\n6   \t      1,010.1  \t  \t201.8           \t        808.3<br>\n7   \t      1,009.6  \t  \t201.7           \t        807.9<br>\n8   \t      1,008.5  \t  \t201.4           \t        807.1<br>\n9   \t      1,006.8  \t   \t201.0           \t        805.8<br>\n10   \t  9,998,004.5  \t    \t  0.5           \t  9,998,004.0<br>\n(For example, node 6 charges an Upfront Fee of 120.1 msats, a Hold Fee of 10,000,000 msats * (2 * 10^(-5) / hour) * 1 hour = 200 msats, and a Success Fee of 690 msats.)<br>\n(For example, node 6 has capital costs of (10,002,070 + 89,569.1) msats * (2 * 10^(-5) / hour) * 1 hour = 201.8 msats.)<br>\n(For example, node 6 receives 1,010.1 msats in fees and loses 201.8 msats in capital costs for a net gain of 808.3 msats.)</p>\n<pre><code> \tCurrent Protocol \tCurrent Protocol \tCurrent Protocol  \n \tgross gain from  \tcapital costs    \tnet gain from  \n \tsuccessful       \tof successful    \tsuccessful  \n \tpayment          \tpayment          \tpayment  \n \tdelayed 1 hour   \tdelayed 1 hour   \tdelayed 1 hour  \n \tat destination \t \tat destination   \tat destination  \n</code></pre>\n<p>Node:\t(msats):       \t \t(msats):         \t(msats):</p>\n<hr>\n<p>0   \t-10,007,209.9  \t \t200.1           \t-10,007,410.0<br>\n1   \t        801.1  \t \t200.1           \t        601.0<br>\n2   \t        801.1  \t \t200.1           \t        601.0<br>\n3   \t        801.1  \t \t200.1           \t        601.0<br>\n4   \t        801.1  \t \t200.1           \t        601.0<br>\n5   \t        801.1  \t  \t200.1           \t        601.0<br>\n6   \t        801.1  \t  \t200.0           \t        601.1<br>\n7   \t        801.1  \t  \t200.0           \t        601.1<br>\n8   \t        801.1  \t  \t200.0           \t        601.1<br>\n9   \t        801.1  \t \t200.0           \t        601.1<br>\n10   \t 10,000,000.0  \t \t  0.0           \t 10,000,000.0<br>\n(For example, node 6 charges a fixed routing fee of 100 msats and a proportional routing fee of 10,000 sats * 7.011 * 10^(-5) = 701.1 msats.)<br>\n(For example, node 6 has capital costs of 10,002,403 msats * (2 * 10^(-5) / hour) * 1 hour = 200.0 msats.)<br>\n(For example, node 6 receives 801.1 msats in fees and loses 200.0 msats in capital costs for a net gain of 601.1 msats.)</p>\n<p>Note that in Scenario 2 the Spam Prevention protocol has a much more fair outcome, as the sender and the routing nodes are compensated for their capital costs by the node (namely the destination) that imposed those costs on them. This is an important scenario, as it is an example of a not-immediately-settled payment (as Dave Harding pointed out above).</p>\n<h2><a name=\"p-4993-scenario-3-failed-payment-due-to-an-unresponsive-destination-7\" class=\"anchor\" href=\"#p-4993-scenario-3-failed-payment-due-to-an-unresponsive-destination-7\"></a>Scenario 3: Failed payment due to an unresponsive destination</h2>\n<pre><code> \tSpam Prevention  \n \tgain from  \n \tfailed payment  \n \tdue to  \n \tunresponsive  \n \tdestination  \n</code></pre>\n<p>Node:\t(msats):</p>\n<hr>\n<p>0   \t-1,062.0<br>\n1   \t   113.6<br>\n2   \t   116.1<br>\n3   \t   118.0<br>\n4   \t   119.3<br>\n5   \t   120.0<br>\n6   \t   120.1<br>\n7   \t   119.6<br>\n8   \t   118.5<br>\n9   \t   116.8<br>\n10   \t     0.0<br>\n(For example, node 6 charges an Upfront Fee of 120.1 msats.)</p>\n<pre><code> \tCurrent Protocol \tCurrent Protocol  \tCurrent Protocol  \n \tcapital costs of \ton-chain fees for \tnet gain from  \n \tfailed payment   \tfailed payment    \tfailed payment  \n \tdue to           \tdue to            \tdue to  \n \tunresponsive     \tunresponsive      \tunresponsive \n \tdestination      \tdestination       \tdestination  \n</code></pre>\n<p>Node:\t(msats):         \t(msats):          \t(msats):</p>\n<hr>\n<p>0   \t 2,001.4         \t        0.0       \t    -2,001.4<br>\n1   \t 2,001.3         \t        0.0       \t    -2,001.3<br>\n2   \t 2,001.1         \t        0.0       \t    -2,001.1<br>\n3   \t 2,001.0         \t        0.0       \t    -2,001.0<br>\n4   \t 2,000.8         \t        0.0       \t    -2,000.8<br>\n5   \t 2,000.6         \t        0.0       \t    -2,000.6<br>\n6   \t 2,000.5         \t        0.0       \t    -2,000.5<br>\n7   \t 2,000.3         \t        0.0       \t    -2,000.3<br>\n8   \t 2,000.2         \t        0.0       \t    -2,000.2<br>\n9   \t 2,000.0          \t3,887,500.0       \t-3,889,500.0<br>\n10   \t     0.0         \t        0.0       \t         0.0<br>\n(For example, node 6 has capital costs of 10,002,403 msats * (2 * 10^(-5) / hour) * 10 hours = 2,000.5 msats.)<br>\n(For example, node 6 is able to resolve the failed payment off-chain with nodes 5 and 7 and therefore has no on-chain costs.)<br>\n(For example, node 6 loses 2,000.5 msats in capital costs for a net loss of 2,000.5 msats.)</p>\n<p>Note that in Scenario 3 the Spam Prevention protocol has a far better outcome than the current protocol. In particular, with the Spam Prevention protocol the sender is notified of the failed payment within seconds and no node is required to devote their capital to the payment for more than a few seconds. In contrast, with the current protocol the sender has to wait 10 hours (the time required for node 9 to time out node 10 on-chain) before discovering that the payment has failed. Furthermore, with the current protocol nodes 0 through 9 have to devote their capital to this failed payment for those 10 hours and (even more significantly) node 9 has to pay millions of msats in on-chain fees in order to resolve the payment</p>\n<p>The protocols behave so differently because the Spam Prevention protocol allows node 9 to fail the payment off-chain and within seconds when the destination fails to increase the burn output for the payment. In contrast, the current protocol requires node 9 to go on-chain to resolve the payment. (Note that this difference between the protocols did not exist in the original paper; it was enabled by the bug fix that separates the increase in burn funds from the creation of the HTLC output.)</p>\n<h2><a name=\"p-4993-scenario-4-failed-payment-due-to-insufficient-funds-at-node-6-8\" class=\"anchor\" href=\"#p-4993-scenario-4-failed-payment-due-to-insufficient-funds-at-node-6-8\"></a>Scenario 4: Failed payment due to insufficient funds at node 6</h2>\n<pre><code> \tSpam Prevention \tCurrent Protocol  \n \tgain from       \tgain from  \n \tfailed payment  \tfailed payment  \n \tdue to          \tdue to  \n \tinsufficient     \tinsufficient  \n \tfunds at node 6 \tfunds at node 6  \n</code></pre>\n<p>Node:\t(msats):         \t(msats):</p>\n<hr>\n<p>0   \t-707.1          \t          0.0<br>\n1   \t 113.6          \t          0.0<br>\n2   \t 116.1          \t          0.0<br>\n3   \t 118.0          \t          0.0<br>\n4   \t 119.3          \t          0.0<br>\n5   \t 120.0          \t          0.0<br>\n6   \t 120.1          \t          0.0<br>\n7   \t   0.0          \t          0.0<br>\n8   \t   0.0          \t          0.0<br>\n9   \t   0.0          \t          0.0<br>\n10   \t   0.0          \t          0.0<br>\n(For example, node 6 charges an Upfront Fee of 120.1 msats.)<br>\n(For example, node 6 does not receive a routing fee because the payment was unsuccessful.)</p>\n<p>Note that in Scenario 4 the Spam Prevention protocol compensates nodes 1..6 for their costs, while the current protocol fails to do so.</p>\n<p>Hopefully the above analysis helps to clarify the details of the Spam Prevention protocol and to give some quantitative sense of how it operates. The comparison with the current protocol helps to demonstrate the advantages of the Spam Prevention protocol.</p>\n<p>Please let me know if anything isn\u2019t clear or if you feel the example parameters are unrealistic.</p>",
  "post_number": 9,
  "post_type": 1,
  "posts_count": 9,
  "updated_at": "2025-05-12T17:47:12.512Z",
  "reply_count": 0,
  "reply_to_post_number": 7,
  "quote_count": 0,
  "incoming_link_count": 0,
  "reads": 7,
  "readers_count": 6,
  "score": 1.4,
  "yours": false,
  "topic_id": 1524,
  "topic_slug": "fee-based-spam-prevention-for-lightning",
  "topic_title": "Fee-Based Spam Prevention For Lightning",
  "topic_html_title": "Fee-Based Spam Prevention For Lightning",
  "category_id": 7,
  "display_username": null,
  "primary_group_name": null,
  "flair_name": null,
  "flair_url": null,
  "flair_bg_color": null,
  "flair_color": null,
  "flair_group_id": null,
  "badges_granted": [],
  "version": 1,
  "can_edit": false,
  "can_delete": false,
  "can_recover": false,
  "can_see_hidden_post": false,
  "can_wiki": false,
  "user_title": null,
  "reply_to_user": {
    "username": "JohnLaw",
    "name": null,
    "avatar_template": "/letter_avatar_proxy/v4/letter/j/58956e/{size}.png"
  },
  "bookmarked": false,
  "raw": "\nHere's a numerical example of using Upfront, Hold and Success Fees for a 10-hop payment of 10,000 sats, where node 0 is the payment's source and node 10 is the payment's destination.  \n\nIt also includes a comparison to the current protocol.\n\nFEE-BASED SPAM REDUCTION PROTOCOL  \n=================================  \n\nAssume:  \n------  \n* each node on the route uses the same parameters  \n* each routing node charges 10 msats as the fixed part of the Upfront Fee to cover the costs of calculation, communication and allocation of a slot  \n* each routing node charges 1 * 10^(-5) of the payment amount as the proportional part of the Upfront Fee to cover:  \n  - the cost of allocating channel funds to the payment for the seconds that can be required for a non-delayed payment, and  \n  - the risk of losing the payment amount (due to paying the downstream HTLC without being paid the upstream HTLC)  \n* each node has a cltv_expiry_delta of 10 hours (600 blocks)  \n* each node charges a Hold Fee at the rate of 2 * 10^(-5) / hour  \n  - this corresponds to a 19% (compounded) annual rate of return (as 1.00002^(24*365) = 1.19)  \n* each node charges 1 * 10^(-4) of their nonreimbursable Hold Fee stake contribution as part of the Upfront Fee  \n  - this covers the risk that the node will be responsible for paying a Hold Fee due to a delay that it causes  \n  - the value 1 * 10^(-4) corresponds to causing a 10-hour delay once every 10,000 payments  \n    - note that a 10-hour delay is the maximum nonreimbursable delay given the cltv_expiry_delta value of 10 hours  \n    - any delay beyond 10 hours must be caused by some downstream node and thus will be paid (reimbursed) by that downstream node  \n* each node charges 1 * 10^(-4) of their Hold Fee stake contribution as part of the Upfront Fee  \n  - this covers the risk of burning those funds due to a partner who fails to agree to the division of the burn funds (e.g., due to a permanent failure or griefing attack)  \n* each node requires their partner devote (as matching funds) 1/4 of the base funds in the burn output  \n  - this guarantees one's partner loses at least 1/5 of what one loses in a griefing attack  \n  - this increases the size of the burn output by 50% (as each channel partner provides matching funds that are 1/4 of the base funds)  \n* each routing node charges 90 msats as the fixed part of the Success Fee  \n* each routing node charges 6 * 10^(-5) of the payment amount as the proportional part of the Success Fee  \n\nGiven the above assumptions:  \n* each node charges a Hold Fee of (2 * 10^(-5) / hour) * (10,000 sats) = 2 * 10^(-1) sats / hour  \n* each node i, 1 <= i <= 10, pays a nonreimbursable Hold Fee to the i upstream nodes at the rate of i * (2 * 10^(-1) sats / hour) for delays caused by node i  \n  - thus node i pays a maximum of 2i sats in nonreimbursed Hold Fees if node i causes its maximum possible 10-hour delay  \n* each routing node i, 1 <= i <= 9, charges a Succees Fee of 90 msats + 10,000 * 6 * 10^(-5) sats = 690 msats  \n\n     \t               \t\tUpfront Fee     \t    \n     \tMax            \t\tcharge for      \tHold Fee    \n     \tnonreimbursable\t\tnonreimburable  \tbase stake    \n     \tHold Fee       \t\tHold Fee risk   \tcontribution    \nNode:\tpayment (sats):\t\t(msats):        \t(sats):    \n---- \t---------------\t\t--------------- \t------------  \n 0   \t   0           \t\t   0.0          \t 0  \n 1   \t   2\t           \t   0.2          \t20  \n 2   \t   4\t           \t   0.4          \t36  \n 3   \t   6           \t\t   0.6          \t48  \n 4   \t   8           \t\t   0.8          \t56  \n 5   \t  10           \t\t   1.0          \t60  \n 6   \t  12           \t\t   1.2          \t60  \n 7   \t  14           \t\t   1.4          \t56  \n 8   \t  16           \t\t   1.6          \t48  \n 9   \t  18           \t\t   1.8          \t36  \n10   \t  20           \t\t   2.0          \t20  \n\n(For example, node 6 pays at most 2 sats to each of the 6 upstream nodes (nodes 0..5) for delays that node 6 causes.)  \n(For example, node 6 charges 12 sats * 10^(-4) = 1.2 msats in additional Upfront Fees in order to cover the risk that node 6 will have to pay a Hold Fee for a delay that it causes.)  \n(For example, node 6 stakes 5 * 6 * 2 = 60 sats for the maximum 2-sat Hold Fee paid by each of the 5 downstream nodes (nodes 6..10) to each of the 6 upstream nodes (nodes 0..5).)  \n\n     \t             \tTotal        \tUpfront Fee  \n     \tHold Fee     \tHold Fee     \tcharge for  \n     \tmatch stake  \tstake\t     \tHold Fee  \n     \tcontribution \tcontribution \tburn risk  \nNode:\t(sats):      \t(sats):\t     \t(msats):  \n---- \t------------ \t------------ \t---------------  \n 0   \t5            \t5            \t   0.5  \n 1   \t14           \t34           \t   3.4  \n 2   \t21           \t57           \t   5.7  \n 3   \t26           \t74           \t   7.4  \n 4   \t29           \t85           \t   8.5  \n 5   \t30           \t90           \t   9.0  \n 6   \t29           \t89           \t   8.9  \n 7   \t26           \t82           \t   8.2  \n 8   \t21           \t69           \t   6.9  \n 9   \t14           \t50           \t   5.0  \n10   \t5            \t25           \t   2.5  \n(For example, node 6 matches 1/4 of its 60-sat Hold Fee base stake in the channel with node 5 and 1/4 of node 7's 56-sat Hold fee base stake in that channel.)  \n(For example, node 6 contributes 60 sats of base funds in the channel with node 5, plus it contributes 15 sats of matching funds in that channel and 14 sats of matching funds in its channel with node 7.)  \n(For example, node 6 charges 89 sats * 10^(-4) = 8.9 msats for the risk that its 89-sat Hold Fee stake contribution to burn outputs will be lost due to burning those funds.)  \n\n     \tUpfront Fee   \n     \tcharge       \tTotal       \tUpfront Fee  \n     \tunrelated to \tUpfront Fee \tbase stake  \n     \tHold Fees    \tcharge      \tcontribution  \nNode:\t(msats):     \t(msats):    \t(msats):  \n---- \t------------ \t----------- \t------------  \n 0   \t   0         \t   0.5      \t1,066.5  \n 1   \t 110         \t 113.6      \t  952.9  \n 2   \t 110         \t 116.1      \t  836.8  \n 3   \t 110         \t 118.0      \t  718.8  \n 4   \t 110         \t 119.3      \t  599.5  \n 5   \t 110         \t 120.0      \t  479.5  \n 6   \t 110         \t 120.1      \t  359.4  \n 7   \t 110         \t 119.6      \t  239.8  \n 8   \t 110         \t 118.5      \t  121.3  \n 9   \t 110         \t 116.8      \t    4.5  \n10   \t   0         \t   4.5      \t    0.0  \n(For example, node 6 charges a fixed Upfront fee of 10 msats and a proportional Upfront Fee of 10,000 * 10^(-5) = 0.1 sats = 100 msats.)  \n(For example, node 6 charges 1.2 msats for the risk of paying a nonreimbursable Hold Fee, 8.9 msats for the risk of burning its contributions to Hold Fee stakes, and 110 msats unrelated to Hold Fees.)  \n(For example, node 6 stakes base funds to cover Upfront Fee transfers for payments of 119.6 + 118.5 + 116.8 + 4.5 = 359.4 msats to nodes 7..10.)  \n\n     \t               \t             \tTotal Hold +   \n     \tUpfront Fee     Upfront Fee  \tUpfront Fee    \n     \tmatching stake  total stake  \tstake          \n     \tcontribution   \tcontribution \tcontribution   \nNode:\t(msats):       \t(msats):     \t(msats):     \n---- \t-------------- \t------------  \t-------------  \n 0   \t266.625        \t1,333.1      \t 6,333.1        \n 1   \t504.850        \t1,457.8      \t35,457.8        \n 2   \t447.425        \t1,284.2      \t58,284.2        \n 3   \t388.900        \t1,107.7      \t75,107.7        \n 4   \t329.575        \t  929.1      \t85,929.1        \n 5   \t269.750        \t  749.3      \t90,749.3        \n 6   \t209.725        \t  569.1      \t89,569.1        \n 7   \t149.800        \t  389.6      \t82,569.1        \n 8   \t 90.275        \t  211.6      \t69,211.6        \n 9   \t 31.450        \t   36.0      \t50,036.0        \n10   \t  1.125        \t    1.1      \t25,001.1        \n(For example, node 6 contributes 479.5 / 4 = 119.875 msats Upfront matching funds in its channel with node 5 and 359.4 / 4 = 89.85 msats Upfront matching fund in its channel with node 7.)  \n(For example, node 6 contributes 359.4 msats base funds and 209.725 msats matching funds for the Upfront Fee.)  \n(For example, node 6 contributes 89 sats for Hold Fee stakes and 569.1 msats for Upfront Fee stakes.)  \n\n        \t            \t            \tburn output  \n        \tHTLC output \tburn output \toverhead     \nChannel:\t(msats):    \t(msats):    \t(percent):   \n------- \t----------- \t----------- \t-----------  \n0-1     \t10,006,210  \t 31,600     \t0.32%  \n1-2    \t\t10,005,520  \t 55,429     \t0.55%  \n2-3    \t\t10,004,830  \t 73,255     \t0.73%  \n3-4    \t\t10,004,140  \t 85,078     \t0.85%  \n4-5    \t\t10,003,450  \t 90,899     \t0.91$  \n5-6    \t\t10,002,760  \t 90,719     \t0.91$  \n6-7    \t\t10,002,070  \t 84,539     \t0.85%  \n7-8    \t\t10,001,380  \t 72,360     \t0.72%  \n8-9    \t\t10,000,690  \t 54,182     \t0.54%  \n9-10   \t\t10,000,000  \t 30,007     \t0.30%  \n(For example, the HTLC output in channel 5-6 contains the 10,000,000 msats for the payment amount and a Success Fee of 690 msats for each of the 4 downstream routing nodes (nodes 6..9).)  \n(For example, the burn output in channel 5-6 contains 479.5 msats in Upfront Fee base stake contributions from node 5 and 60,000 msats in Hold Fee base stake contributions from node 6 = 60,479.5 msats base funds plus an additional 60,479.5 / 4 = 15,119.875 msats of matching funds from each of nodes 5 and 6.)  \n(For example, the overhead for the burn output in channel 5-6 is 90,719 / 10,002,760 = 0.91%.)  \n\nThis completes the analysis of the calculation of the HTLC output and the burn output for this payment in each channel.  \n\n\nCOMPARISON WITH CURRENT PROTOCOL  \n================================  \n\nNow consider 4 scenarios for the execution of this payment using the Fee-Based Spam Prevention protocol and the current protocol.  \n\nFor the current protocol, assume:  \n--------------------------------  \n* each routing node charges a 100 msats as the fixed portion of the routing fee  \n* each routing node charges 7.011 * 10^(-5) as the proportional part of the routing fee  \n  - this value was chosen to match the charges for the Fee-Based Spam Prevention protocol above, minus the costs associated with losing funds by burning them (as those costs are unique to that protocol)  \n  - however, this value is likely too small, as it ignores the larger on-chain fees that the current protocol can have (as shown in Scenario 3 below)  \n* on-chain transactions cost 10 sats/vbyte  \n* timing out an HTLC on-chain requires 388.75 vbytes  \n  - Commitment transaction is 168 vbytes non-witness data + 222/4 vbytes witness data  \n  - HTLC-timeout transaction is 94 vbytes non-witness data + 285/4 vbytes witness data  \n  - cost of timing out an HTLC on-chain is 10,000 msats/vbyte * 388.75 vbytes = 3,887,500 msats  \n\nGiven these assumptions, with the current protocol the sender attempts to create the following HTLC outputs.  \n\n        \tHTLC output  \nChannel:\t(msats):  \n------- \t-----------  \n0-1     \t10,007,210  \n1-2    \t\t10,006,409  \n2-3    \t\t10,005,608  \n3-4    \t\t10,004,807  \n4-5    \t\t10,004,006  \n5-6    \t\t10,003,204  \n6-7    \t\t10,002,403  \n7-8    \t\t10,001,602  \n8-9    \t\t10,000,801  \n9-10   \t\t10,000,000  \n(For example, the HTLC output in channel 5-6 contains the 10,000,000 msats for the payment amount and a routing fee of 100 + 10,000,000 * 7.011 * 10^(-5) = 801.1  msats for each of the 4 downstream routing nodes (nodes 6..9).)  \n\nScenario 1: Successful payment with no delay  \n--------------------------------------------  \n\n     \tSpam Prevention \tCurrent Protocol  \n     \tgain from       \tgain from  \n     \tsuccessful      \tsuccessful  \n     \tnon-delayed     \tnon-delayed  \n     \tpayment          \tpayment  \nNode:\t(msats):         \t(msats):  \n---- \t-------------   \t----------------  \n 0   \t-10,007,276.5   \t-10,007,209.9  \n 1   \t        803.6   \t        801.1  \n 2   \t        806.1   \t        801.1  \n 3   \t        808.0   \t        801.1  \n 4   \t        809.3   \t        801.1  \n 5   \t        810.0   \t        801.1  \n 6   \t        810.1   \t        801.1  \n 7   \t        809.6   \t        801.1  \n 8   \t        808.5   \t        801.1  \n 9   \t        806.8   \t        801.1  \n10   \t 10,000,004.5   \t 10,000,000.0  \n(For example, node 6 charges an Upfront Fee of 120.1 msats and a Success Fee of 690 msats.)  \n(For example, node 6 charges a fixed routing fee of 100 msats and a proportional routing fee of 10,000 sats * 7.011 * 10^(-5) = 701.1 msats.)  \n\nNote that in Scenario 1 the two protocols have very similar results, with the fees for the Spam Prevention protocol being 0.9% higher overall (as 7276.5 / 7209.5 = 1.0092).  \n\n\nScenario 2: Successful payment delayed 1 hour at the destination  \n----------------------------------------------------------------  \n\n     \tSpam Prevention \tSpam Prevention \tSpam Prevention  \n     \tgross gain from \tcapital costs   \tnet gain from  \n     \tsuccessful      \tof successful   \tsuccessful  \n     \tpayment         \tpayment         \tpayment  \n     \tdelayed 1 hour  \tdelayed 1 hour   \tdelayed 1 hour  \n     \tat destination \t\tat destination  \tat destination  \nNode:\t(msats):       \t\t(msats):        \t(msats):  \n---- \t-------------- \t\t--------------- \t---------------  \n 0   \t-10,007,076.5  \t\t200.3           \t-10,007,276.8  \n 1   \t      1,003.6  \t\t200.8           \t        802.8  \n 2   \t      1,006.1  \t\t201.3           \t        804.8  \n 3   \t      1,008.0  \t\t201.6           \t        806.4  \n 4   \t      1,009.3  \t  \t201.8           \t        807.5  \n 5   \t      1,010.0  \t  \t201.9           \t        808.1  \n 6   \t      1,010.1  \t  \t201.8           \t        808.3  \n 7   \t      1,009.6  \t  \t201.7           \t        807.9  \n 8   \t      1,008.5  \t  \t201.4           \t        807.1  \n 9   \t      1,006.8  \t   \t201.0           \t        805.8  \n10   \t  9,998,004.5  \t    \t  0.5           \t  9,998,004.0  \n(For example, node 6 charges an Upfront Fee of 120.1 msats, a Hold Fee of 10,000,000 msats * (2 * 10^(-5) / hour) * 1 hour = 200 msats, and a Success Fee of 690 msats.)  \n(For example, node 6 has capital costs of (10,002,070 + 89,569.1) msats * (2 * 10^(-5) / hour) * 1 hour = 201.8 msats.)  \n(For example, node 6 receives 1,010.1 msats in fees and loses 201.8 msats in capital costs for a net gain of 808.3 msats.)  \n\n     \tCurrent Protocol \tCurrent Protocol \tCurrent Protocol  \n     \tgross gain from  \tcapital costs    \tnet gain from  \n     \tsuccessful       \tof successful    \tsuccessful  \n     \tpayment          \tpayment          \tpayment  \n     \tdelayed 1 hour   \tdelayed 1 hour   \tdelayed 1 hour  \n     \tat destination \t \tat destination   \tat destination  \nNode:\t(msats):       \t \t(msats):         \t(msats):  \n---- \t-------------- \t \t--------------- \t---------------  \n 0   \t-10,007,209.9  \t \t200.1           \t-10,007,410.0  \n 1   \t        801.1  \t \t200.1           \t        601.0  \n 2   \t        801.1  \t \t200.1           \t        601.0  \n 3   \t        801.1  \t \t200.1           \t        601.0  \n 4   \t        801.1  \t \t200.1           \t        601.0  \n 5   \t        801.1  \t  \t200.1           \t        601.0  \n 6   \t        801.1  \t  \t200.0           \t        601.1  \n 7   \t        801.1  \t  \t200.0           \t        601.1  \n 8   \t        801.1  \t  \t200.0           \t        601.1  \n 9   \t        801.1  \t \t200.0           \t        601.1  \n10   \t 10,000,000.0  \t \t  0.0           \t 10,000,000.0  \n(For example, node 6 charges a fixed routing fee of 100 msats and a proportional routing fee of 10,000 sats * 7.011 * 10^(-5) = 701.1 msats.)  \n(For example, node 6 has capital costs of 10,002,403 msats * (2 * 10^(-5) / hour) * 1 hour = 200.0 msats.)  \n(For example, node 6 receives 801.1 msats in fees and loses 200.0 msats in capital costs for a net gain of 601.1 msats.)  \n\nNote that in Scenario 2 the Spam Prevention protocol has a much more fair outcome, as the sender and the routing nodes are compensated for their capital costs by the node (namely the destination) that imposed those costs on them. This is an important scenario, as it is an example of a not-immediately-settled payment (as Dave Harding pointed out above).  \n\nScenario 3: Failed payment due to an unresponsive destination  \n-------------------------------------------------------------  \n\n     \tSpam Prevention  \n     \tgain from  \n     \tfailed payment  \n     \tdue to  \n     \tunresponsive  \n     \tdestination  \nNode:\t(msats):  \n---- \t--------------  \n 0   \t-1,062.0       \n 1   \t   113.6       \n 2   \t   116.1       \n 3   \t   118.0       \n 4   \t   119.3       \n 5   \t   120.0       \n 6   \t   120.1       \n 7   \t   119.6       \n 8   \t   118.5       \n 9   \t   116.8       \n10   \t     0.0       \n(For example, node 6 charges an Upfront Fee of 120.1 msats.)  \n\n     \tCurrent Protocol \tCurrent Protocol  \tCurrent Protocol  \n     \tcapital costs of \ton-chain fees for \tnet gain from  \n     \tfailed payment   \tfailed payment    \tfailed payment  \n     \tdue to           \tdue to            \tdue to  \n     \tunresponsive     \tunresponsive      \tunresponsive \n     \tdestination      \tdestination       \tdestination  \nNode:\t(msats):         \t(msats):          \t(msats):  \n---- \t---------------- \t----------------- \t---------------  \n 0   \t 2,001.4         \t        0.0       \t    -2,001.4   \n 1   \t 2,001.3         \t        0.0       \t    -2,001.3   \n 2   \t 2,001.1         \t        0.0       \t    -2,001.1   \n 3   \t 2,001.0         \t        0.0       \t    -2,001.0   \n 4   \t 2,000.8         \t        0.0       \t    -2,000.8   \n 5   \t 2,000.6         \t        0.0       \t    -2,000.6   \n 6   \t 2,000.5         \t        0.0       \t    -2,000.5   \n 7   \t 2,000.3         \t        0.0       \t    -2,000.3   \n 8   \t 2,000.2         \t        0.0       \t    -2,000.2  \n 9   \t 2,000.0          \t3,887,500.0       \t-3,889,500.0   \n10   \t     0.0         \t        0.0       \t         0.0   \n(For example, node 6 has capital costs of 10,002,403 msats * (2 * 10^(-5) / hour) * 10 hours = 2,000.5 msats.)  \n(For example, node 6 is able to resolve the failed payment off-chain with nodes 5 and 7 and therefore has no on-chain costs.)  \n(For example, node 6 loses 2,000.5 msats in capital costs for a net loss of 2,000.5 msats.)  \n\nNote that in Scenario 3 the Spam Prevention protocol has a far better outcome than the current protocol. In particular, with the Spam Prevention protocol the sender is notified of the failed payment within seconds and no node is required to devote their capital to the payment for more than a few seconds. In contrast, with the current protocol the sender has to wait 10 hours (the time required for node 9 to time out node 10 on-chain) before discovering that the payment has failed. Furthermore, with the current protocol nodes 0 through 9 have to devote their capital to this failed payment for those 10 hours and (even more significantly) node 9 has to pay millions of msats in on-chain fees in order to resolve the payment  \n\nThe protocols behave so differently because the Spam Prevention protocol allows node 9 to fail the payment off-chain and within seconds when the destination fails to increase the burn output for the payment. In contrast, the current protocol requires node 9 to go on-chain to resolve the payment. (Note that this difference between the protocols did not exist in the original paper; it was enabled by the bug fix that separates the increase in burn funds from the creation of the HTLC output.)  \n\nScenario 4: Failed payment due to insufficient funds at node 6  \n--------------------------------------------------------------  \n\n     \tSpam Prevention \tCurrent Protocol  \n     \tgain from       \tgain from  \n     \tfailed payment  \tfailed payment  \n     \tdue to          \tdue to  \n     \tinsufficient     \tinsufficient  \n     \tfunds at node 6 \tfunds at node 6  \nNode:\t(msats):         \t(msats):  \n----  \t--------------- \t----------------  \n 0   \t-707.1          \t          0.0  \n 1   \t 113.6          \t          0.0  \n 2   \t 116.1          \t          0.0  \n 3   \t 118.0          \t          0.0  \n 4   \t 119.3          \t          0.0  \n 5   \t 120.0          \t          0.0  \n 6   \t 120.1          \t          0.0  \n 7   \t   0.0          \t          0.0  \n 8   \t   0.0          \t          0.0  \n 9   \t   0.0          \t          0.0  \n10   \t   0.0          \t          0.0  \n(For example, node 6 charges an Upfront Fee of 120.1 msats.)  \n(For example, node 6 does not receive a routing fee because the payment was unsuccessful.)  \n\nNote that in Scenario 4 the Spam Prevention protocol compensates nodes 1..6 for their costs, while the current protocol fails to do so.  \n\nHopefully the above analysis helps to clarify the details of the Spam Prevention protocol and to give some quantitative sense of how it operates. The comparison with the current protocol helps to demonstrate the advantages of the Spam Prevention protocol.  \n\nPlease let me know if anything isn't clear or if you feel the example parameters are unrealistic.",
  "actions_summary": [],
  "moderator": false,
  "admin": false,
  "staff": false,
  "user_id": 279,
  "hidden": false,
  "trust_level": 1,
  "deleted_at": null,
  "user_deleted": false,
  "edit_reason": null,
  "can_view_edit_history": true,
  "wiki": false,
  "excerpt": "Here\u2019s a numerical example of using Upfront, Hold and Success Fees for a 10-hop payment of 10,000 sats, where node 0 is the payment\u2019s source and node 10 is the payment\u2019s destination. \nIt also includes a comparison to the current protocol. \n<a name=\"p-4993-fee-based-spam-reduction-protocol-1\" class=\"anchor\" href=\"#p-4993-fee-based-spam-reduction-protocol-1\"></a>FEE-BASED SPAM REDUCTION PROTOCOL\n<a name=\"p-4993-assume-2\" class=\"anchor\" href=\"#p-4993-assume-2\"></a>Assume:\n\neach node on the &hellip;",
  "truncated": true,
  "post_url": "/t/fee-based-spam-prevention-for-lightning/1524/9",
  "reactions": [],
  "current_user_reaction": null,
  "reaction_users_count": 0,
  "current_user_used_main_reaction": false
}