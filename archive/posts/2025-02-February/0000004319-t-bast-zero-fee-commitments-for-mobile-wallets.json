{
  "id": 4319,
  "name": "Bastien Teinturier",
  "username": "t-bast",
  "avatar_template": "/user_avatar/delvingbitcoin.org/t-bast/{size}/98_2.png",
  "created_at": "2025-02-18T14:54:25.455Z",
  "cooked": "<aside class=\"quote no-group\" data-username=\"harding\" data-post=\"2\" data-topic=\"1453\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://delvingbitcoin.org/user_avatar/delvingbitcoin.org/harding/48/925_2.png\" class=\"avatar\"> harding:</div>\n<blockquote>\n<p>Am I understanding correctly that the fees for the high feerate will be deducted from the balance of the channel opener in the current way?</p>\n</blockquote>\n</aside>\n<p>Not exactly the channel opener, but rather the owner of the HTLC transaction (ie the mobile wallet), which is even better (and as you highlight, doesn\u2019t cost anything to the peer): those fees are deducted from the output of the HTLC tx. Your conclusions correctly apply though!</p>\n<p>The only thing to be careful about is that we shouldn\u2019t use an unreasonably high feerate, otherwise the following attack can be performed by the mobile wallet user:</p>\n<ul>\n<li>the mobile wallet receive a batch of HTLCs for which the fee-paying pre-signed transaction consumes almost all of the HTLC amount to fees</li>\n<li>the mobile wallet then fulfills those HTLCs</li>\n<li>later, they publish the revoked commitment that contains all of those HTLCs</li>\n<li>since most of the value goes to mining fees, it cannot be claimed by the peer as penalty transactions</li>\n</ul>\n<p>This type of attack is why we had to make HTLC transactions pay 0 fees in anchor outputs to protect against miners attacking lightning peers. But in this specific case, the LSP can mitigate that risk by not overshooting the feerate and/or trying to detect that kind of behavior and refusing to relay \u201crisky\u201d HTLCs. Details need to be fleshed out for that, but I\u2019m not too worried, I think we can come up with something that guarantees that the LSP doesn\u2019t take too much risk as long as they have some honest users.</p>",
  "post_number": 3,
  "post_type": 1,
  "updated_at": "2025-02-18T14:54:25.455Z",
  "reply_count": 0,
  "reply_to_post_number": 2,
  "quote_count": 1,
  "incoming_link_count": 0,
  "reads": 8,
  "readers_count": 7,
  "score": 1.4,
  "yours": false,
  "topic_id": 1453,
  "topic_slug": "zero-fee-commitments-for-mobile-wallets",
  "topic_title": "Zero-fee commitments for mobile wallets",
  "topic_html_title": "Zero-fee commitments for mobile wallets",
  "category_id": 7,
  "display_username": "Bastien Teinturier",
  "primary_group_name": null,
  "flair_name": null,
  "flair_url": null,
  "flair_bg_color": null,
  "flair_color": null,
  "flair_group_id": null,
  "badges_granted": [],
  "version": 1,
  "can_edit": false,
  "can_delete": false,
  "can_recover": false,
  "can_see_hidden_post": false,
  "can_wiki": false,
  "user_title": null,
  "bookmarked": false,
  "raw": "[quote=\"harding, post:2, topic:1453\"]\nAm I understanding correctly that the fees for the high feerate will be deducted from the balance of the channel opener in the current way?\n[/quote]\n\nNot exactly the channel opener, but rather the owner of the HTLC transaction (ie the mobile wallet), which is even better (and as you highlight, doesn't cost anything to the peer): those fees are deducted from the output of the HTLC tx. Your conclusions correctly apply though!\n\nThe only thing to be careful about is that we shouldn't use an unreasonably high feerate, otherwise the following attack can be performed by the mobile wallet user:\n\n- the mobile wallet receive a batch of HTLCs for which the fee-paying pre-signed transaction consumes almost all of the HTLC amount to fees\n- the mobile wallet then fulfills those HTLCs\n- later, they publish the revoked commitment that contains all of those HTLCs\n- since most of the value goes to mining fees, it cannot be claimed by the peer as penalty transactions\n\nThis type of attack is why we had to make HTLC transactions pay 0 fees in anchor outputs to protect against miners attacking lightning peers. But in this specific case, the LSP can mitigate that risk by not overshooting the feerate and/or trying to detect that kind of behavior and refusing to relay \"risky\" HTLCs. Details need to be fleshed out for that, but I'm not too worried, I think we can come up with something that guarantees that the LSP doesn't take too much risk as long as they have some honest users.",
  "actions_summary": [],
  "moderator": false,
  "admin": false,
  "staff": false,
  "user_id": 101,
  "hidden": false,
  "trust_level": 3,
  "deleted_at": null,
  "user_deleted": false,
  "edit_reason": null,
  "can_view_edit_history": true,
  "wiki": false,
  "reactions": [],
  "current_user_reaction": null,
  "reaction_users_count": 0,
  "current_user_used_main_reaction": false
}