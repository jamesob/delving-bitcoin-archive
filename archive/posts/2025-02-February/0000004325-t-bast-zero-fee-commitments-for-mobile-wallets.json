{
  "id": 4325,
  "name": "Bastien Teinturier",
  "username": "t-bast",
  "avatar_template": "/user_avatar/delvingbitcoin.org/t-bast/{size}/98_2.png",
  "created_at": "2025-02-19T09:44:53.454Z",
  "cooked": "<p>Let me clarify my previous comment about revoked commitments, which was too vague. What a malicious wallet can do to its peer to abuse the additional pre-signed HTLC transactions is the following:</p>\n<ul>\n<li>open a channel</li>\n<li>wait for the mempool feerate to be high</li>\n<li>send its whole balance out (to another node it controls)</li>\n<li>once the HTLCs are fulfilled, it only has its channel reserve at stake (which may be <code>0 sat</code> if the wallet provider allows zero-reserve)</li>\n<li>broadcast the revoked commitment where the HTLCs were still pending</li>\n<li>broadcast the HTLC transactions that pay non-zero fees</li>\n</ul>\n<p>The peer will be able to publish penalty transaction to claim the outputs of those HTLC transactions. But it won\u2019t be able to claim the HTLC transaction fees, which will go to miners. In that case, it\u2019s similar to the wallet peer paying the on-chain fees, whereas they should be paid by the wallet user.</p>\n<p>This is the risk taken by the wallet peer when offering those pre-signed HTLC transactions. This risk is however offset by the following facts:</p>\n<ul>\n<li>the wallet peer should have earned fees for the channel creation</li>\n<li>the wallet peer earned routing fees for the outgoing HTLC</li>\n<li>the wallet peer decides the feerate, and could cap it to X% of the HTLC amount</li>\n<li>splice transactions make it impossible to publish revoked commitments that happened before the splice</li>\n<li>pathological scenarios like the one above can be detected and HTLCs can be failed instead of relayed when it looks risky</li>\n<li>the wallet peer can limit the risk they take until they\u2019ve earned enough fees from the wallet user (from routing or liquidity purchases)</li>\n</ul>\n<p>I think this is a risk that is worth taking by wallet providers (who are betting they will have enough honest users anyway) to provide good lightning trust trade-offs for their users.</p>",
  "post_number": 4,
  "post_type": 1,
  "updated_at": "2025-02-19T09:44:53.454Z",
  "reply_count": 0,
  "reply_to_post_number": 3,
  "quote_count": 0,
  "incoming_link_count": 0,
  "reads": 14,
  "readers_count": 13,
  "score": 17.6,
  "yours": false,
  "topic_id": 1453,
  "topic_slug": "zero-fee-commitments-for-mobile-wallets",
  "topic_title": "Zero-fee commitments for mobile wallets",
  "topic_html_title": "Zero-fee commitments for mobile wallets",
  "category_id": 7,
  "display_username": "Bastien Teinturier",
  "primary_group_name": null,
  "flair_name": null,
  "flair_url": null,
  "flair_bg_color": null,
  "flair_color": null,
  "flair_group_id": null,
  "badges_granted": [],
  "version": 1,
  "can_edit": false,
  "can_delete": false,
  "can_recover": false,
  "can_see_hidden_post": false,
  "can_wiki": false,
  "user_title": null,
  "reply_to_user": {
    "username": "t-bast",
    "name": "Bastien Teinturier",
    "avatar_template": "/user_avatar/delvingbitcoin.org/t-bast/{size}/98_2.png"
  },
  "bookmarked": false,
  "raw": "Let me clarify my previous comment about revoked commitments, which was too vague. What a malicious wallet can do to its peer to abuse the additional pre-signed HTLC transactions is the following:\n\n- open a channel\n- wait for the mempool feerate to be high\n- send its whole balance out (to another node it controls)\n- once the HTLCs are fulfilled, it only has its channel reserve at stake (which may be `0 sat` if the wallet provider allows zero-reserve)\n- broadcast the revoked commitment where the HTLCs were still pending\n- broadcast the HTLC transactions that pay non-zero fees\n\nThe peer will be able to publish penalty transaction to claim the outputs of those HTLC transactions. But it won't be able to claim the HTLC transaction fees, which will go to miners. In that case, it's similar to the wallet peer paying the on-chain fees, whereas they should be paid by the wallet user.\n\nThis is the risk taken by the wallet peer when offering those pre-signed HTLC transactions. This risk is however offset by the following facts:\n\n- the wallet peer should have earned fees for the channel creation\n- the wallet peer earned routing fees for the outgoing HTLC\n- the wallet peer decides the feerate, and could cap it to X% of the HTLC amount\n- splice transactions make it impossible to publish revoked commitments that happened before the splice\n- pathological scenarios like the one above can be detected and HTLCs can be failed instead of relayed when it looks risky\n- the wallet peer can limit the risk they take until they've earned enough fees from the wallet user (from routing or liquidity purchases)\n\nI think this is a risk that is worth taking by wallet providers (who are betting they will have enough honest users anyway) to provide good lightning trust trade-offs for their users.",
  "actions_summary": [
    {
      "id": 2,
      "count": 1
    }
  ],
  "moderator": false,
  "admin": false,
  "staff": false,
  "user_id": 101,
  "hidden": false,
  "trust_level": 3,
  "deleted_at": null,
  "user_deleted": false,
  "edit_reason": null,
  "can_view_edit_history": true,
  "wiki": false,
  "reactions": [
    {
      "id": "heart",
      "type": "emoji",
      "count": 1
    }
  ],
  "current_user_reaction": null,
  "reaction_users_count": 1,
  "current_user_used_main_reaction": false
}