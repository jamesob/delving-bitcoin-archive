{
  "id": 4147,
  "name": "Anthony Towns",
  "username": "ajtowns",
  "avatar_template": "/user_avatar/delvingbitcoin.org/ajtowns/{size}/417_2.png",
  "created_at": "2025-02-02T04:36:56.859Z",
  "cooked": "<p>I think you could solve this by hanging a HTLC commitment off of a balance output. ie, if you have a commitment <code>(Alice: 10k, Bob: 20k, HTLCs: X: 1k, Y: 4k)</code>, and want to add a new HTLC from Alice to Bob for 2k, then you do two things:</p>\n<ul>\n<li>sign a new commitment <code>(Alice: 8k, Bob: 20k, HTLCs: X: 1k, Y: 4k, Z: 2k)</code></li>\n<li>sign a spend of Alice\u2019s balance from Alice\u2019s version of the old commitment tx to <code>(Alice: 8k, Z: 2k)</code></li>\n</ul>\n<p>After sending the above, if Alice closes the channel with the old commitment, Bob can claim HTLC Z via Alice\u2019s balance; or Bob can close the channel with the new commitment. If Bob closes the channel with the old commitment, that just automatically refunds HTLC Z to Alice with no action needed on Alice\u2019s behalf.</p>\n<p>(That probably only works with something like <a href=\"https://github.com/lightning/bolts/pull/867\">option-simplified-update</a>, as otherwise Bob may have had an update in flight when Alice sends the sigs for Z through, and if Alice closed the channel with that commitment, Z would not be claimable by Bob)</p>\n<p>(Similar stuff discussed in <a href=\"https://web.archive.org/web/20231114193842/https://lists.linuxfoundation.org/pipermail/lightning-dev/2021-October/003278.html\">Oct 2021</a>)</p>",
  "post_number": 5,
  "post_type": 1,
  "updated_at": "2025-02-02T04:36:56.859Z",
  "reply_count": 0,
  "reply_to_post_number": null,
  "quote_count": 0,
  "incoming_link_count": 0,
  "reads": 6,
  "readers_count": 5,
  "score": 1.2,
  "yours": false,
  "topic_id": 1414,
  "topic_slug": "minimal-signing-flow-changes-for-truc-channels",
  "topic_title": "Minimal signing flow changes for TRUC channels",
  "topic_html_title": "Minimal signing flow changes for TRUC channels",
  "category_id": 7,
  "display_username": "Anthony Towns",
  "primary_group_name": null,
  "flair_name": null,
  "flair_url": null,
  "flair_bg_color": null,
  "flair_color": null,
  "flair_group_id": null,
  "badges_granted": [],
  "version": 1,
  "can_edit": false,
  "can_delete": false,
  "can_recover": false,
  "can_see_hidden_post": false,
  "can_wiki": false,
  "user_title": null,
  "bookmarked": false,
  "raw": "I think you could solve this by hanging a HTLC commitment off of a balance output. ie, if you have a commitment `(Alice: 10k, Bob: 20k, HTLCs: X: 1k, Y: 4k)`, and want to add a new HTLC from Alice to Bob for 2k, then you do two things:\n\n  * sign a new commitment `(Alice: 8k, Bob: 20k, HTLCs: X: 1k, Y: 4k, Z: 2k)`\n  * sign a spend of Alice's balance from Alice's version of the old commitment tx to `(Alice: 8k, Z: 2k)`\n\nAfter sending the above, if Alice closes the channel with the old commitment, Bob can claim HTLC Z via Alice's balance; or Bob can close the channel with the new commitment. If Bob closes the channel with the old commitment, that just automatically refunds HTLC Z to Alice with no action needed on Alice's behalf.\n\n(That probably only works with something like [option-simplified-update](https://github.com/lightning/bolts/pull/867), as otherwise Bob may have had an update in flight when Alice sends the sigs for Z through, and if Alice closed the channel with that commitment, Z would not be claimable by Bob)\n\n(Similar stuff discussed in [Oct 2021](https://web.archive.org/web/20231114193842/https://lists.linuxfoundation.org/pipermail/lightning-dev/2021-October/003278.html))",
  "actions_summary": [],
  "moderator": true,
  "admin": true,
  "staff": true,
  "user_id": 3,
  "hidden": false,
  "trust_level": 4,
  "deleted_at": null,
  "user_deleted": false,
  "edit_reason": null,
  "can_view_edit_history": true,
  "wiki": false,
  "reactions": [],
  "current_user_reaction": null,
  "reaction_users_count": 0,
  "current_user_used_main_reaction": false
}