{
  "id": 55,
  "name": "Anthony Towns",
  "username": "ajtowns",
  "avatar_template": "/user_avatar/delvingbitcoin.org/ajtowns/{size}/3_2.png",
  "created_at": "2023-01-10T11:40:43.648Z",
  "cooked": "<p>Context: <a href=\"https://twitter.com/renepickhardt/status/1612582052636889088\">https://twitter.com/renepickhardt/status/1612582052636889088</a></p>\n<p>If a payment going from Alice to Bob has both outbound fees (paid to Alice) and inbound fees (paid to Bob), how do you sensibly negotiate the split between those fees?</p>\n<p>Presume first that Alice has complete knowledge about what the demand for the channel is: that is she knows a function <span class=\"math\">Q(f)</span> that perfectly predicts the payment volume that will flow through the channel for a given total fee <span class=\"math\">f</span>, so that the total fees will be <span class=\"math\">f \\cdot Q(f)</span>, split somehow between Alice and Bob. In that case, if we split the fees as <span class=\"math\">f = a + b</span> where Alice receives <span class=\"math\">a</span> and Bob receives <span class=\"math\">b</span>, then for any given fee <span class=\"math\">b</span> that Bob quotes, Alice can calculate her optimal fee <span class=\"math\">a</span> by solving <span class=\"math\">\\frac{\\partial}{\\partial a} a \\cdot Q(a+b) = 0</span>.</p>\n<p>If Bob likewise has complete knowledge about the channel demand, he will make the same calculation, resulting in an even split <span class=\"math\">a=b</span>. This will usually not maximise total fees collected, instead both sides will raise their fees above the optimal level, as in doing so they get the benefit of increasing their fee but share the losses of decreasing demand with their channel partner.</p>\n<p>For example, if <span class=\"math\">Q(f) = 1000 - 100 \\cdot f</span> then <span class=\"math\">f^{opt} = 5</span> but <span class=\"math\">a^{opt} = b^{opt} = 10/3</span> so <span class=\"math\">a^{opt}+b^{opt} = 20/3 = 4/3 \\cdot f^{opt}</span>, while <span class=\"math\">Q(f^{opt})=1000/2</span> and <span class=\"math\">Q(a^{opt}+b^{opt}) = 1000/3</span>, so <span class=\"math\">(a^{opt}+b^{opt})\\cdot Q(a^{opt}+b^{opt} = 8/9 \\ cdot f^{opt}\\cdot Q(f^{opt})</span>, and Alice and Bob are only receiving an equal split of fee income, but only achieving 88% of their optimal possible fee income.</p>\n<p>Generally speaking, this is a stable outcome: while Alice may reduce <span class=\"math\">a</span> if Bob raises <span class=\"math\">b</span>, even in the new scenario, Bob remains incentivised to lower <span class=\"math\">b</span> back towards <span class=\"math\">b^{opt}</span>.</p>\n<p>Without the assumption of perfect knowledge, this changes, of course. In that case Alice and Bob will potentially optimise against different demand predictions <span class=\"math\">Q_A(f)</span> and <span class=\"math\">Q_B(f)</span>, with Alice and Bob solving respectively for</p>\n<div class=\"math\">\n\\frac{\\partial}{\\partial a} a \\cdot Q_A(a+b) = 0 \\\\\n\\frac{\\partial}{\\partial b} b \\cdot Q_B(a+b) = 0 \\\\\n</div>\n<p>which will usually result in differing values for <span class=\"math\">a</span> and <span class=\"math\">b</span>. For example, given <span class=\"math\">Q_A(f) = 1000 - 100\\cdot f</span> and <span class=\"math\">Q_B(f) = 600 - 40\\cdot f</span>, this resolves to <span class=\"math\">a=5-b/{2}</span> and <span class=\"math\">b = 7.5-a/2</span> or <span class=\"math\">a=5/3</span> and <span class=\"math\">b=20/3</span>. Further, at those fee rates, <span class=\"math\">Q_A(a+b)=Q_B(a+b)=1000/3</span>, so channel activity alone isn\u2019t enough for either Alice or Bob to falsify their prediction of demand: if Alice is correct, Bob will make more profit by reducing his fee encouraging more traffic; if Bob is correct, Alice will make more profit by increasing her fee, despite that resulting in a reduction of traffic over the channel.</p>",
  "post_number": 1,
  "post_type": 1,
  "updated_at": "2023-01-12T07:16:51.472Z",
  "reply_count": 0,
  "reply_to_post_number": null,
  "quote_count": 0,
  "incoming_link_count": 25,
  "reads": 13,
  "readers_count": 12,
  "score": 127.4,
  "yours": false,
  "topic_id": 29,
  "topic_slug": "lightning-fees-inbound-vs-outbound",
  "topic_title": "Lightning Fees - inbound vs outbound",
  "topic_html_title": "Lightning Fees - inbound vs outbound",
  "category_id": 6,
  "display_username": "Anthony Towns",
  "primary_group_name": null,
  "flair_name": null,
  "flair_url": null,
  "flair_bg_color": null,
  "flair_color": null,
  "flair_group_id": null,
  "version": 3,
  "can_edit": false,
  "can_delete": false,
  "can_recover": false,
  "can_see_hidden_post": false,
  "can_wiki": false,
  "user_title": null,
  "bookmarked": false,
  "raw": "Context: https://twitter.com/renepickhardt/status/1612582052636889088\n\nIf a payment going from Alice to Bob has both outbound fees (paid to Alice) and inbound fees (paid to Bob), how do you sensibly negotiate the split between those fees?\n\nPresume first that Alice has complete knowledge about what the demand for the channel is: that is she knows a function $Q(f)$ that perfectly predicts the payment volume that will flow through the channel for a given total fee $f$, so that the total fees will be $f \\cdot Q(f)$, split somehow between Alice and Bob. In that case, if we split the fees as $f = a + b$ where Alice receives $a$ and Bob receives $b$, then for any given fee $b$ that Bob quotes, Alice can calculate her optimal fee $a$ by solving $\\frac{\\partial}{\\partial a} a \\cdot Q(a+b) = 0$.\n\nIf Bob likewise has complete knowledge about the channel demand, he will make the same calculation, resulting in an even split $a=b$. This will usually not maximise total fees collected, instead both sides will raise their fees above the optimal level, as in doing so they get the benefit of increasing their fee but share the losses of decreasing demand with their channel partner.\n\nFor example, if $Q(f) = 1000 - 100 \\cdot f$ then $f^{opt} = 5$ but $a^{opt} = b^{opt} = 10/3$ so $a^{opt}+b^{opt} = 20/3 = 4/3 \\cdot f^{opt}$, while $Q(f^{opt})=1000/2$ and $Q(a^{opt}+b^{opt}) = 1000/3$, so $(a^{opt}+b^{opt})\\cdot Q(a^{opt}+b^{opt} = 8/9 \\ cdot f^{opt}\\cdot Q(f^{opt})$, and Alice and Bob are only receiving an equal split of fee income, but only achieving 88% of their optimal possible fee income.\n\nGenerally speaking, this is a stable outcome: while Alice may reduce $a$ if Bob raises $b$, even in the new scenario, Bob remains incentivised to lower $b$ back towards $b^{opt}$.\n\nWithout the assumption of perfect knowledge, this changes, of course. In that case Alice and Bob will potentially optimise against different demand predictions $Q_A(f)$ and $Q_B(f)$, with Alice and Bob solving respectively for\n\n$$\n\\frac{\\partial}{\\partial a} a \\cdot Q_A(a+b) = 0 \\\\\n\\frac{\\partial}{\\partial b} b \\cdot Q_B(a+b) = 0 \\\\\n$$\n\nwhich will usually result in differing values for $a$ and $b$. For example, given $Q_A(f) = 1000 - 100\\cdot f$ and $Q_B(f) = 600 - 40\\cdot f$, this resolves to $a=5-b/{2}$ and $b = 7.5-a/2$ or $a=5/3$ and $b=20/3$. Further, at those fee rates, $Q_A(a+b)=Q_B(a+b)=1000/3$, so channel activity alone isn't enough for either Alice or Bob to falsify their prediction of demand: if Alice is correct, Bob will make more profit by reducing his fee encouraging more traffic; if Bob is correct, Alice will make more profit by increasing her fee, despite that resulting in a reduction of traffic over the channel.",
  "actions_summary": [],
  "moderator": true,
  "admin": true,
  "staff": true,
  "user_id": 3,
  "hidden": false,
  "trust_level": 4,
  "deleted_at": null,
  "user_deleted": false,
  "edit_reason": null,
  "can_view_edit_history": true,
  "wiki": false,
  "reactions": [],
  "current_user_reaction": null,
  "reaction_users_count": 0,
  "current_user_used_main_reaction": false
}