{
  "id": 350,
  "name": "Anthony Towns",
  "username": "ajtowns",
  "avatar_template": "/user_avatar/delvingbitcoin.org/ajtowns/{size}/3_2.png",
  "created_at": "2023-11-08T19:35:16.019Z",
  "cooked": "<aside class=\"quote no-group\" data-username=\"ZmnSCPxj\" data-post=\"1\" data-topic=\"170\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://delvingbitcoin.org/letter_avatar_proxy/v4/letter/z/ee7513/48.png\" class=\"avatar\"> ZmnSCPxj:</div>\n<blockquote>\n<p>B can actually double-spend channel-with-B (pre-splice) using a revoked commitment transaction.</p>\n</blockquote>\n</aside>\n<p>Why wouldn\u2019t they just do a normal unilateral close, using the current non-splice commitment transaction?</p>\n<p>In either case, you now have access to your funds with B\u2019s channel, and can redo the splice/open with C/D, so what\u2019s the problem?</p>\n<aside class=\"quote no-group\" data-username=\"ZmnSCPxj\" data-post=\"1\" data-topic=\"170\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://delvingbitcoin.org/letter_avatar_proxy/v4/letter/z/ee7513/48.png\" class=\"avatar\"> ZmnSCPxj:</div>\n<blockquote>\n<p>D, having seen me broadcast the batched transaction that includes the open of the channel-with-D, has now, naively, sent the preimage to the HTLC for the JIT channel payment.</p>\n</blockquote>\n</aside>\n<p>The sensible thing to do would be for you to reject the HTLC when it reached you, refusing to forward it to D, because your channel isn\u2019t suitable for zeroconf use, because you don\u2019t control all the inputs. Maybe you could have a super-advanced version of zeroconf channels where the channel can survive being given an entirely new funding tx (in which case you just updated the funding tx for the channel when B closes that channel), but I don\u2019t think we have that currently?</p>\n<aside class=\"quote no-group\" data-username=\"ZmnSCPxj\" data-post=\"1\" data-topic=\"170\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://delvingbitcoin.org/letter_avatar_proxy/v4/letter/z/ee7513/48.png\" class=\"avatar\"> ZmnSCPxj:</div>\n<blockquote>\n<p>I need to be able to tell C \u201cforget about the splice, let us go back to our original channel funding output\u201d, without having to close the channel-with-C, in order to try again with a different batched splice that no longer involves the peer B, or to splice in to C with my onchain funds instead of from the channel-with-B.</p>\n</blockquote>\n</aside>\n<p>I think if you have a splice transaction that spends utxo X, but utxo X was already spent by transaction T that\u2019s had 6 confirmations, dropping the splice transaction should be fine?</p>",
  "post_number": 5,
  "post_type": 1,
  "updated_at": "2023-11-08T19:35:16.019Z",
  "reply_count": 2,
  "reply_to_post_number": null,
  "quote_count": 1,
  "incoming_link_count": 0,
  "reads": 5,
  "readers_count": 4,
  "score": 11.0,
  "yours": false,
  "topic_id": 170,
  "topic_slug": "batched-splicing-considered-risky",
  "topic_title": "Batched Splicing Considered Risky",
  "topic_html_title": "Batched Splicing Considered Risky",
  "category_id": 7,
  "display_username": "Anthony Towns",
  "primary_group_name": null,
  "flair_name": null,
  "flair_url": null,
  "flair_bg_color": null,
  "flair_color": null,
  "flair_group_id": null,
  "version": 1,
  "can_edit": false,
  "can_delete": false,
  "can_recover": false,
  "can_see_hidden_post": false,
  "can_wiki": false,
  "user_title": null,
  "bookmarked": false,
  "raw": "[quote=\"ZmnSCPxj, post:1, topic:170\"]\nB can actually double-spend channel-with-B (pre-splice) using a revoked commitment transaction.\n[/quote]\n\nWhy wouldn't they just do a normal unilateral close, using the current non-splice commitment transaction?\n\nIn either case, you now have access to your funds with B's channel, and can redo the splice/open with C/D, so what's the problem?\n\n[quote=\"ZmnSCPxj, post:1, topic:170\"]\nD, having seen me broadcast the batched transaction that includes the open of the channel-with-D, has now, naively, sent the preimage to the HTLC for the JIT channel payment.\n[/quote]\n\nThe sensible thing to do would be for you to reject the HTLC when it reached you, refusing to forward it to D, because your channel isn't suitable for zeroconf use, because you don't control all the inputs. Maybe you could have a super-advanced version of zeroconf channels where the channel can survive being given an entirely new funding tx (in which case you just updated the funding tx for the channel when B closes that channel), but I don't think we have that currently?\n\n[quote=\"ZmnSCPxj, post:1, topic:170\"]\nI need to be able to tell C \u201cforget about the splice, let us go back to our original channel funding output\u201d, without having to close the channel-with-C, in order to try again with a different batched splice that no longer involves the peer B, or to splice in to C with my onchain funds instead of from the channel-with-B.\n[/quote]\n\nI think if you have a splice transaction that spends utxo X, but utxo X was already spent by transaction T that's had 6 confirmations, dropping the splice transaction should be fine?",
  "actions_summary": [],
  "moderator": true,
  "admin": true,
  "staff": true,
  "user_id": 3,
  "hidden": false,
  "trust_level": 4,
  "deleted_at": null,
  "user_deleted": false,
  "edit_reason": null,
  "can_view_edit_history": true,
  "wiki": false,
  "reactions": [
    {
      "id": "thinking",
      "type": "emoji",
      "count": 1
    }
  ],
  "current_user_reaction": null,
  "reaction_users_count": 1,
  "current_user_used_main_reaction": false
}