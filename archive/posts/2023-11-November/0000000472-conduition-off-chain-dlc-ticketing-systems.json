{
  "id": 472,
  "name": "",
  "username": "conduition",
  "avatar_template": "/user_avatar/delvingbitcoin.org/conduition/{size}/127_2.png",
  "created_at": "2023-11-23T20:31:51.703Z",
  "cooked": "<p>Thanks for the questions <a class=\"mention\" href=\"/u/harding\">@harding</a>. If you\u2019d like to understand the protocol in more detail, i think you\u2019d find my original email to the dlc-dev mailing list helpful: <a href=\"https://mailmanlists.org/pipermail/dlc-dev/2023-November/000182.html\" class=\"inline-onebox\" rel=\"noopener nofollow ugc\">[dlc-dev] Off-Chain DLC Market Maker</a></p>\n<p>I think that should clear up most of your confusion, but let me try to answer a few things directly:</p>\n<blockquote>\n<p>I think the major efficiency gains that this depends on requires that each participant be a member of the multisig (so the contract is trustless) and then also be available after all tickets have been settled in order to sign a non-contracted payment back to the market maker.</p>\n</blockquote>\n<p>Only the DLC winners would need to be online and available to sell the on-chain contract TXO back to the market maker.</p>\n<p>Once the DLC oracle publishes the outcome signature, the winners of the DLC can prove they have sole custody of the contract output. If they cooperate during that time, the winners can sell the whole contract back to the market maker, in exchange for off-chain payments therefrom.</p>\n<p>The trick is in using multiple stages of transactions, not just a single n-of-n multisig address.</p>\n<ul>\n<li>The first stage TXO (of <span class=\"math\">\\text{TX}_{\\text{init}}</span>) is owned by all players and the market maker.</li>\n<li>The second stage TXO (of <span class=\"math\">\\text{TX}_{\\text{outcome } i}</span>) is owned by ticketholding winners, or the market maker as a fallback.</li>\n<li>Adding a separate third stage (<span class=\"math\">\\text{TX}_{\\text{split }i}</span>) which splits the winnings would enable an \u2018all winners cooperate\u2019 path, where the DLC contract output doesn\u2019t need to be split into separate per-winner outputs. This would be useful for DLCs which have lots of winners.</li>\n</ul>\n<p>I think a diagram might be helpful to visualize the TX flow. This diagram shows a contract with 3 players, Alice, Bob and Carol, plus a market maker. I added \u2018split\u2019 transactions (not described in my original email) to enable the \u2018all winners cooperate\u2019 path.</p>\n<p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://delvingbitcoin.org/uploads/default/original/1X/ea399462db51e973f76434f50781b1bbf309dbbb.png\" data-download-href=\"https://delvingbitcoin.org/uploads/default/ea399462db51e973f76434f50781b1bbf309dbbb\" title=\"diagram-screencap.png\"><img src=\"https://delvingbitcoin.org/uploads/default/optimized/1X/ea399462db51e973f76434f50781b1bbf309dbbb_2_483x500.png\" data-base62-sha1=\"xq35HbL1frk44gngSHJJPOhIYgX\" width=\"483\" height=\"500\" srcset=\"https://delvingbitcoin.org/uploads/default/optimized/1X/ea399462db51e973f76434f50781b1bbf309dbbb_2_483x500.png, https://delvingbitcoin.org/uploads/default/optimized/1X/ea399462db51e973f76434f50781b1bbf309dbbb_2_724x750.png 1.5x, https://delvingbitcoin.org/uploads/default/optimized/1X/ea399462db51e973f76434f50781b1bbf309dbbb_2_966x1000.png 2x\" data-dominant-color=\"212325\"><div class=\"meta\"><svg class=\"fa d-icon d-icon-far-image svg-icon\" aria-hidden=\"true\"><use href=\"#far-image\"></use></svg><span class=\"filename\">diagram-screencap.png</span><span class=\"informations\">1105\u00d71143 66.4 KB</span><svg class=\"fa d-icon d-icon-discourse-expand svg-icon\" aria-hidden=\"true\"><use href=\"#discourse-expand\"></use></svg></div></a></div></p>\n<p><a href=\"https://www.mathcha.io/editor/dxr6ncP8twWsGkYVZxHP52E1PhdgEoQMiwZlDV0\" rel=\"noopener nofollow ugc\">Mathcha diagram link</a></p>\n<ul>\n<li>The big solid-lined boxes are transactions.</li>\n<li>The small boxes inside them labeled with <span class=\"math\">v</span> are transaction outputs.</li>\n<li>The arrows indicate transactions which spend those outputs.</li>\n<li>Locking conditions are written above and below the spending path arrows.</li>\n<li><span class=\"math\">\\Delta</span> is a relative block delay timelock.</li>\n</ul>\n<p>This diagram uses adaptor signatures and PTLCs, but you could easily swap that logic for hashlocks instead.</p>\n<blockquote>\n<p>The maker then sells tickets to Alice and Bob over LN. I think this likely requires PTLCs given that DLCs are working with signatures. If you have more details on how that would work, I\u2019d appreciate them.</p>\n<p>Alice wins. Her winning ticket is an output that can be spent by her unilaterally after a certain delay,</p>\n</blockquote>\n<p>Tickets are actually just preimages - or scalars depending on the implementation. In the above diagram, i represent them as locking conditions with <span class=\"math\">T_A</span>, <span class=\"math\">T_B</span>, and <span class=\"math\">T_C</span>. The ticket locking conditions are one stage <em>after</em> the DLC oracle signature is needed, and i\u2019m assuming the players all learn the outcome signature directly from the oracle for free (no PTLC needed).</p>\n<p>You\u2019re correct about the winner being able to unilaterally spend her winnings output after a delay. But to spend this output, the winner needs her ticket secret/preimage. Without it, after a longer timelock, the output returns to the control of the market maker, via <span class=\"math\">\\text{TX}_{\\text{reclaim}}</span>.</p>\n<blockquote>\n<p>In the meantime, Alice and Bob have bought and settled 99 other tickets with the maker in the same way.</p>\n</blockquote>\n<p>I think the protocol you\u2019re picturing diverged from mine beyond this point. Each player can only buy one ticket per DLC. The purchase of the ticket secret grants the player access to a specific set of payouts, contingent on the outcome signed by the oracle.</p>\n<p>Also the protocol as i\u2019ve described is only for a single DLC contract; i haven\u2019t yet considered how this might be applied to multiple DLCs.</p>",
  "post_number": 3,
  "post_type": 1,
  "updated_at": "2023-11-23T20:35:12.943Z",
  "reply_count": 0,
  "reply_to_post_number": 2,
  "quote_count": 0,
  "incoming_link_count": 0,
  "reads": 8,
  "readers_count": 7,
  "score": 16.0,
  "yours": false,
  "topic_id": 214,
  "topic_slug": "off-chain-dlc-ticketing-systems",
  "topic_title": "Off Chain DLC Ticketing Systems",
  "topic_html_title": "Off Chain DLC Ticketing Systems",
  "category_id": 7,
  "display_username": "",
  "primary_group_name": null,
  "flair_name": null,
  "flair_url": null,
  "flair_bg_color": null,
  "flair_color": null,
  "flair_group_id": null,
  "version": 2,
  "can_edit": false,
  "can_delete": false,
  "can_recover": false,
  "can_see_hidden_post": false,
  "can_wiki": false,
  "user_title": null,
  "reply_to_user": {
    "username": "harding",
    "name": "David A. Harding",
    "avatar_template": "/user_avatar/delvingbitcoin.org/harding/{size}/6_2.png"
  },
  "bookmarked": false,
  "raw": "Thanks for the questions @harding. If you'd like to understand the protocol in more detail, i think you'd find my original email to the dlc-dev mailing list helpful: https://mailmanlists.org/pipermail/dlc-dev/2023-November/000182.html\n\nI think that should clear up most of your confusion, but let me try to answer a few things directly:\n\n> I think the major efficiency gains that this depends on requires that each participant be a member of the multisig (so the contract is trustless) and then also be available after all tickets have been settled in order to sign a non-contracted payment back to the market maker. \n\nOnly the DLC winners would need to be online and available to sell the on-chain contract TXO back to the market maker. \n\nOnce the DLC oracle publishes the outcome signature, the winners of the DLC can prove they have sole custody of the contract output. If they cooperate during that time, the winners can sell the whole contract back to the market maker, in exchange for off-chain payments therefrom. \n\nThe trick is in using multiple stages of transactions, not just a single n-of-n multisig address. \n- The first stage TXO (of $\\text{TX}_{\\text{init}}$) is owned by all players and the market maker. \n- The second stage TXO (of $\\text{TX}_{\\text{outcome } i}$) is owned by ticketholding winners, or the market maker as a fallback. \n- Adding a separate third stage ($\\text{TX}_{\\text{split }i}$) which splits the winnings would enable an 'all winners cooperate' path, where the DLC contract output doesn't need to be split into separate per-winner outputs. This would be useful for DLCs which have lots of winners.\n\nI think a diagram might be helpful to visualize the TX flow. This diagram shows a contract with 3 players, Alice, Bob and Carol, plus a market maker. I added 'split' transactions (not described in my original email) to enable the 'all winners cooperate' path. \n\n\n<img src=\"upload://xq35HbL1frk44gngSHJJPOhIYgX.png\">\n\n[Mathcha diagram link](https://www.mathcha.io/editor/dxr6ncP8twWsGkYVZxHP52E1PhdgEoQMiwZlDV0)\n\n- The big solid-lined boxes are transactions.\n- The small boxes inside them labeled with $v$ are transaction outputs.\n- The arrows indicate transactions which spend those outputs. \n- Locking conditions are written above and below the spending path arrows.\n- $\\Delta$ is a relative block delay timelock.\n\n\nThis diagram uses adaptor signatures and PTLCs, but you could easily swap that logic for hashlocks instead. \n\n> The maker then sells tickets to Alice and Bob over LN. I think this likely requires PTLCs given that DLCs are working with signatures. If you have more details on how that would work, I\u2019d appreciate them.\n>\n> Alice wins. Her winning ticket is an output that can be spent by her unilaterally after a certain delay, \n\nTickets are actually just preimages - or scalars depending on the implementation. In the above diagram, i represent them as locking conditions with $T_A$, $T_B$, and $T_C$. The ticket locking conditions are one stage _after_ the DLC oracle signature is needed, and i'm assuming the players all learn the outcome signature directly from the oracle for free (no PTLC needed).\n\nYou're correct about the winner being able to unilaterally spend her winnings output after a delay. But to spend this output, the winner needs her ticket secret/preimage. Without it, after a longer timelock, the output returns to the control of the market maker, via $\\text{TX}_{\\text{reclaim}}$.\n\n> In the meantime, Alice and Bob have bought and settled 99 other tickets with the maker in the same way.\n\nI think the protocol you're picturing diverged from mine beyond this point. Each player can only buy one ticket per DLC. The purchase of the ticket secret grants the player access to a specific set of payouts, contingent on the outcome signed by the oracle.\n\nAlso the protocol as i've described is only for a single DLC contract; i haven't yet considered how this might be applied to multiple DLCs.",
  "actions_summary": [
    {
      "id": 2,
      "count": 1
    }
  ],
  "moderator": false,
  "admin": false,
  "staff": false,
  "user_id": 129,
  "hidden": false,
  "trust_level": 1,
  "deleted_at": null,
  "user_deleted": false,
  "edit_reason": null,
  "can_view_edit_history": true,
  "wiki": false,
  "reactions": [
    {
      "id": "+1",
      "type": "emoji",
      "count": 1
    }
  ],
  "current_user_reaction": null,
  "reaction_users_count": 1,
  "current_user_used_main_reaction": false
}