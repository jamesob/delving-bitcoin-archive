{
  "id": 479,
  "name": "Pieter Wuille",
  "username": "sipa",
  "avatar_template": "/user_avatar/delvingbitcoin.org/sipa/{size}/1100_2.png",
  "created_at": "2023-11-24T15:04:57.323Z",
  "cooked": "<p>(Only digested part of the above so far)</p>\n<blockquote>\n<p>Note that <span class=\"math\">R_1 \\leq P_1</span>.</p>\n</blockquote>\n<p>Why? Moving part of <span class=\"math\">P_1</span> to the front could put a higher feerate new chunk up front.</p>\n<blockquote>\n<p><span class=\"math\">M_{PI}(L_1,L_2)</span></p>\n</blockquote>\n<p>What is PI?</p>\n<p>FWIW, my (incomplete) proof sketch is as follows:</p>\n<ul>\n<li>Assume that the following holds: moving transactions to the front of a linearization such that they form a new chunk, while leaving the internal ordering within moved and non-moved transactions the same, is a non-worsening of the diagram if the new chunk\u2019s feerate is &gt;= the original first chunk\u2019s feerate. (<s>no proof</s> EDIT: see proof <a href=\"https://delvingbitcoin.org/t/merging-incomparable-linearizations/209/28\">here</a>)</li>\n<li>Also assume that reordering the transaction <em>within</em> one chunk can never worsen the diagram (worst case the chunk set remains the same, best case it splits in multiple parts).</li>\n<li>The prefix-intersection merging algorithm can be seen as starting with two linearizations <span class=\"math\">L_1</span> and <span class=\"math\">L_2</span>, and in each step moves some transactions to the front of both. Each step is a non-worsening of the diagram of both, and in the end, both linearizations are identical. That resulting linearization is thus better or equal than each of the inputs. To see why each step is a non-worsening:\n<ul>\n<li>WLOG, assume the intersection found is a subset of <span class=\"math\">L_1</span>'s first chunk, in the order of transactions of <span class=\"math\">L_2</span>. (swap the linearizations if not)</li>\n<li>The change applied to <span class=\"math\">L_1</span> is just a reordering of its first chunk, which is fine.</li>\n<li>The change applied to <span class=\"math\">L_2</span> is moving a new chunk to the front, of feerate at least that of its original first chunk (if not, that chunk would have been chosen instead), leaving the order within moved and non-moved transactions the same. This is fine.</li>\n<li>Afterwards, both linearizations start with the same transactions (at least one, so progress is made), so we can continue with just the distinct suffix.</li>\n</ul>\n</li>\n</ul>",
  "post_number": 10,
  "post_type": 1,
  "posts_count": 46,
  "updated_at": "2023-12-02T22:12:48.137Z",
  "reply_count": 1,
  "reply_to_post_number": 9,
  "quote_count": 0,
  "incoming_link_count": 1,
  "reads": 30,
  "readers_count": 29,
  "score": 16.0,
  "yours": false,
  "topic_id": 209,
  "topic_slug": "merging-incomparable-linearizations",
  "topic_title": "Merging incomparable linearizations",
  "topic_html_title": "Merging incomparable linearizations",
  "category_id": 8,
  "display_username": "Pieter Wuille",
  "primary_group_name": null,
  "flair_name": null,
  "flair_url": null,
  "flair_bg_color": null,
  "flair_color": null,
  "flair_group_id": null,
  "badges_granted": [],
  "version": 2,
  "can_edit": false,
  "can_delete": false,
  "can_recover": false,
  "can_see_hidden_post": false,
  "can_wiki": false,
  "user_title": null,
  "reply_to_user": {
    "id": 3,
    "username": "ajtowns",
    "name": "Anthony Towns",
    "avatar_template": "/user_avatar/delvingbitcoin.org/ajtowns/{size}/417_2.png"
  },
  "bookmarked": false,
  "raw": "(Only digested part of the above so far)\n\n> Note that $R_1 \\leq P_1$.\n\nWhy? Moving part of $P_1$ to the front could put a higher feerate new chunk up front.\n\n> $M_{PI}(L_1,L_2)$\n\nWhat is PI?\n\nFWIW, my (incomplete) proof sketch is as follows:\n\n* Assume that the following holds: moving transactions to the front of a linearization such that they form a new chunk, while leaving the internal ordering within moved and non-moved transactions the same, is a non-worsening of the diagram if the new chunk's feerate is >= the original first chunk's feerate. (~~no proof~~ EDIT: see proof [here](https://delvingbitcoin.org/t/merging-incomparable-linearizations/209/28))\n* Also assume that reordering the transaction *within* one chunk can never worsen the diagram (worst case the chunk set remains the same, best case it splits in multiple parts).\n* The prefix-intersection merging algorithm can be seen as starting with two linearizations $L_1$ and $L_2$, and in each step moves some transactions to the front of both. Each step is a non-worsening of the diagram of both, and in the end, both linearizations are identical. That resulting linearization is thus better or equal than each of the inputs. To see why each step is a non-worsening:\n  * WLOG, assume the intersection found is a subset of $L_1$'s first chunk, in the order of transactions of $L_2$. (swap the linearizations if not)\n  * The change applied to $L_1$ is just a reordering of its first chunk, which is fine.\n  * The change applied to $L_2$ is moving a new chunk to the front, of feerate at least that of its original first chunk (if not, that chunk would have been chosen instead), leaving the order within moved and non-moved transactions the same. This is fine.\n  * Afterwards, both linearizations start with the same transactions (at least one, so progress is made), so we can continue with just the distinct suffix.",
  "actions_summary": [],
  "moderator": false,
  "admin": false,
  "staff": false,
  "user_id": 96,
  "hidden": false,
  "trust_level": 3,
  "deleted_at": null,
  "user_deleted": false,
  "edit_reason": null,
  "can_view_edit_history": true,
  "wiki": false,
  "excerpt": "(Only digested part of the above so far) \n\nNote that R_1 \\leq P_1. \n\nWhy? Moving part of P_1 to the front could put a higher feerate new chunk up front. \n\nM_{PI}(L_1,L_2) \n\nWhat is PI? \nFWIW, my (incomplete) proof sketch is as follows: \n\nAssume that the following holds: moving transactions to the fr&hellip;",
  "truncated": true,
  "post_url": "/t/merging-incomparable-linearizations/209/10",
  "reactions": [],
  "current_user_reaction": null,
  "reaction_users_count": 0,
  "current_user_used_main_reaction": false,
  "can_accept_answer": false,
  "can_unaccept_answer": false,
  "accepted_answer": false,
  "topic_accepted_answer": null
}