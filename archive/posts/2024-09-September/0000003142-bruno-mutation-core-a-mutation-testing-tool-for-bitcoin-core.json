{
  "id": 3142,
  "name": "Bruno Garcia",
  "username": "bruno",
  "avatar_template": "/user_avatar/delvingbitcoin.org/bruno/{size}/60_2.png",
  "created_at": "2024-09-06T19:43:09.267Z",
  "cooked": "<p>Hi,</p>\n<p>I\u2019ve been working on a mutation testing tool for Bitcoin Core. It\u2019s something I\u2019ve been using it for some time now and just made it public recently.</p>\n<aside class=\"onebox githubrepo\" data-onebox-src=\"https://github.com/brunoerg/mutation-core\">\n  <header class=\"source\">\n\n      <a href=\"https://github.com/brunoerg/mutation-core\" target=\"_blank\" rel=\"noopener\">github.com</a>\n  </header>\n\n  <article class=\"onebox-body\">\n    <div class=\"github-row\" data-github-private-repo=\"false\">\n  <img width=\"690\" height=\"344\" src=\"https://delvingbitcoin.org/uploads/default/optimized/1X/65a9ac320f8a437088d270217c640aa5b7362272_2_690x344.png\" class=\"thumbnail\" data-dominant-color=\"E8E9EB\">\n\n  <h3><a href=\"https://github.com/brunoerg/mutation-core\" target=\"_blank\" rel=\"noopener\">GitHub - brunoerg/mutation-core: Mutation testing tool designed for Bitcoin Core</a></h3>\n\n    <p><span class=\"github-repo-description\">Mutation testing tool designed for Bitcoin Core</span></p>\n</div>\n\n  </article>\n\n  <div class=\"onebox-metadata\">\n    \n    \n  </div>\n\n  <div style=\"clear: both\"></div>\n</aside>\n\n<h2><a name=\"p-3142-features-1\" class=\"anchor\" href=\"#p-3142-features-1\"></a>Features</h2>\n<ul>\n<li>\n<p>Allows generating mutants only for the code touched or added in a specific branch (useful to test PRs) and avoid spending time by generating mutants for files from bench/test/doc/etc folders.</p>\n</li>\n<li>\n<p>Allows generating mutants using only some security-based mutation operators. This might be good for testing fuzzing.</p>\n<ul>\n<li>e.g:</li>\n</ul>\n<pre data-code-wrap=\"diff\"><code class=\"lang-diff\">    @@ -630,7 +630,7 @@ static void ApproximateBestSubset(FastRandomContext&amp; insecure_rand, const std::v\n                {\n                    nTotal += groups[i].GetSelectionAmount();\n                    selected_coins_weight += groups[i].m_weight;\n-                   vfIncluded[i] = true;\n+                   vfIncluded[i + 100] = true;\n                    if (nTotal &gt;= nTargetValue &amp;&amp; selected_coins_weight &lt;= max_selection_weight) {\n                        fReachedTarget = true;\n                        // If the total is between nTargetValue and nBest, it's our new best\n</code></pre>\n<pre data-code-wrap=\"diff\"><code class=\"lang-diff\">    @@ -560,7 +560,7 @@ util::Result&lt;SelectionResult&gt; SelectCoinsSRD(const std::vector&lt;OutputGroup&gt;&amp; utx\n\n        // Add group to selection\n        heap.push(group);\n-        selected_eff_value += group.GetSelectionAmount();\n+        selected_eff_value += group.GetSelectionAmount() + std::numeric_limits&lt;CAmount&gt;::max();\n        weight += group.m_weight;\n\n        // If the selection weight exceeds the maximum allowed size, remove the least valuable inputs until we\n</code></pre>\n<pre data-code-wrap=\"diff\"><code class=\"lang-diff\">    @@ -4194,7 +4194,7 @@ static bool ContextualCheckBlockHeader(const CBlockHeader&amp; block, BlockValidatio\n    }\n\n    // Check timestamp against prev\n-    if (block.GetBlockTime() &lt;= pindexPrev-&gt;GetMedianTimePast())\n+    if (block.GetBlockTime() &lt;= std::numeric_limits&lt;int64_t&gt;::max())\n        return state.Invalid(BlockValidationResult::BLOCK_INVALID_HEADER, \"time-too-old\", \"block's timestamp is too early\");\n\n    // Testnet4 only: Check timestamp against prev for difficulty-adjustment\n</code></pre>\n</li>\n<li>\n<p>Avoids creating useless mutants. (e.g. by skipping comments, <code>LogPrintf</code> statements, etc).</p>\n</li>\n<li>\n<p>Allows generating only one mutant per line of code (might be useful for CI/CD). It reduces the total number of mutants significantly.</p>\n</li>\n<li>\n<p>Allows creating mutations in the functional tests. By removing some statements and method calls, we can check whether the test passes and identify buggy tests. In our case, we\nwill not touch any <code>wait_for</code>, <code>wait_until</code>, <code>send_and_ping</code>, <code>assert_*</code> and other verifications.</p>\n</li>\n</ul>\n<p>\u2026and, of course, there are some specific mutation operators designed for Bitcoin Core.</p>\n<hr>\n<p>For more informations, please see the README in the repository. Feedbacks are welcome! <img src=\"https://delvingbitcoin.org/images/emoji/twitter/slight_smile.png?v=12\" title=\":slight_smile:\" class=\"emoji\" alt=\":slight_smile:\" loading=\"lazy\" width=\"20\" height=\"20\"></p>",
  "post_number": 1,
  "post_type": 1,
  "updated_at": "2024-09-06T19:43:09.267Z",
  "reply_count": 0,
  "reply_to_post_number": null,
  "quote_count": 0,
  "incoming_link_count": 0,
  "reads": 3,
  "readers_count": 2,
  "score": 0.4,
  "yours": false,
  "topic_id": 1119,
  "topic_slug": "mutation-core-a-mutation-testing-tool-for-bitcoin-core",
  "topic_title": "Mutation-core: A mutation testing tool for Bitcoin Core",
  "topic_html_title": "Mutation-core: A mutation testing tool for Bitcoin Core",
  "category_id": 8,
  "display_username": "Bruno Garcia",
  "primary_group_name": null,
  "flair_name": null,
  "flair_url": null,
  "flair_bg_color": null,
  "flair_color": null,
  "flair_group_id": null,
  "version": 1,
  "can_edit": false,
  "can_delete": false,
  "can_recover": false,
  "can_see_hidden_post": false,
  "can_wiki": false,
  "user_title": null,
  "bookmarked": false,
  "raw": "Hi, \n\nI\u2019ve been working on a mutation testing tool for Bitcoin Core. It's something I've been using it for some time now and just made it public recently.\n\nhttps://github.com/brunoerg/mutation-core\n\n## Features\n\n- Allows generating mutants only for the code touched or added in a specific branch (useful to test PRs) and avoid spending time by generating mutants for files from bench/test/doc/etc folders.\n\n- Allows generating mutants using only some security-based mutation operators. This might be good for testing fuzzing.\n\n    - e.g:\n    ```diff\n        @@ -630,7 +630,7 @@ static void ApproximateBestSubset(FastRandomContext& insecure_rand, const std::v\n                    {\n                        nTotal += groups[i].GetSelectionAmount();\n                        selected_coins_weight += groups[i].m_weight;\n    -                   vfIncluded[i] = true;\n    +                   vfIncluded[i + 100] = true;\n                        if (nTotal >= nTargetValue && selected_coins_weight <= max_selection_weight) {\n                            fReachedTarget = true;\n                            // If the total is between nTargetValue and nBest, it's our new best\n    ```\n    ```diff\n        @@ -560,7 +560,7 @@ util::Result<SelectionResult> SelectCoinsSRD(const std::vector<OutputGroup>& utx\n    \n            // Add group to selection\n            heap.push(group);\n    -        selected_eff_value += group.GetSelectionAmount();\n    +        selected_eff_value += group.GetSelectionAmount() + std::numeric_limits<CAmount>::max();\n            weight += group.m_weight;\n    \n            // If the selection weight exceeds the maximum allowed size, remove the least valuable inputs until we\n    ```\n    ```diff\n        @@ -4194,7 +4194,7 @@ static bool ContextualCheckBlockHeader(const CBlockHeader& block, BlockValidatio\n        }\n    \n        // Check timestamp against prev\n    -    if (block.GetBlockTime() <= pindexPrev->GetMedianTimePast())\n    +    if (block.GetBlockTime() <= std::numeric_limits<int64_t>::max())\n            return state.Invalid(BlockValidationResult::BLOCK_INVALID_HEADER, \"time-too-old\", \"block's timestamp is too early\");\n    \n        // Testnet4 only: Check timestamp against prev for difficulty-adjustment\n    ```\n- Avoids creating useless mutants. (e.g. by skipping comments, `LogPrintf` statements, etc).\n\n- Allows generating only one mutant per line of code (might be useful for CI/CD). It reduces the total number of mutants significantly.\n\n- Allows creating mutations in the functional tests. By removing some statements and method calls, we can check whether the test passes and identify buggy tests. In our case, we \nwill not touch any `wait_for`, `wait_until`, `send_and_ping`, `assert_*` and other verifications.\n\n...and, of course, there are some specific mutation operators designed for Bitcoin Core.\n\n----------\n\nFor more informations, please see the README in the repository. Feedbacks are welcome! :slight_smile:",
  "actions_summary": [],
  "moderator": false,
  "admin": false,
  "staff": false,
  "user_id": 72,
  "hidden": false,
  "trust_level": 3,
  "deleted_at": null,
  "user_deleted": false,
  "edit_reason": null,
  "can_view_edit_history": true,
  "wiki": false,
  "reactions": [],
  "current_user_reaction": null,
  "reaction_users_count": 0,
  "current_user_used_main_reaction": false
}