{
  "id": 6374,
  "name": "Rusty Russell",
  "username": "rustyrussell",
  "avatar_template": "/user_avatar/delvingbitcoin.org/rustyrussell/{size}/154_2.png",
  "created_at": "2025-12-04T04:31:59.086Z",
  "cooked": "<aside class=\"quote no-group\" data-username=\"jonhbit\" data-post=\"13\" data-topic=\"2105\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img alt=\"\" width=\"24\" height=\"24\" src=\"https://delvingbitcoin.org/user_avatar/delvingbitcoin.org/jonhbit/48/1661_2.png\" class=\"avatar\"> jonhbit:</div>\n<blockquote>\n<p>IMO we can adjust the size of these fields based on current constraints like min. tx size, etc. such that the amount of overlap is minimal, but we wouldn\u2019t need this fallback path.</p>\n</blockquote>\n</aside>\n<p>But now you need to detect clashes and decide who wins.  Easier to up-front fail to decode, in practice.</p>\n<aside class=\"quote no-group quote-modified\" data-username=\"jonhbit\" data-post=\"13\" data-topic=\"2105\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img alt=\"\" width=\"24\" height=\"24\" src=\"https://delvingbitcoin.org/user_avatar/delvingbitcoin.org/jonhbit/48/1661_2.png\" class=\"avatar\"> jonhbit:</div>\n<blockquote>\n<p>This is the message flow I was thinking of in my response:</p>\n<p>BobAliceBobAlice#mermaid-diagram-2{font-family:\u201ctrebuchet ms\u201d,verdana,arial,sans-serif;font-size:16px;fill:<span class=\"hashtag-raw\">#333</span>;}<span class=\"hashtag-raw\">#mermaid-diagram-2</span> .error-icon{fill:<span class=\"hashtag-raw\">#552222</span>;}<span class=\"hashtag-raw\">#mermaid-diagram-2</span> .error-text{fill:<span class=\"hashtag-raw\">#552222</span>;stroke:<span class=\"hashtag-raw\">#552222</span>;}<span class=\"hashtag-raw\">#mermaid-diagram-2</span> .edge-thickness-normal{stroke-width:1px;}<span class=\"hashtag-raw\">#mermaid-diagram-2</span> .edge-thickness-thick{stroke-width:3.5px;}<span class=\"hashtag-raw\">#mermaid-diagram-2</span> .edge-pattern-solid{stroke-dasharray:0;}<span class=\"hashtag-raw\">#mermaid-diagram-2</span> .edge-thickness-invisible{stroke-width:0;fill:none;}<span class=\"hashtag-raw\">#mermaid-diagram-2</span> .edge-pattern-dashed{stroke-dasharray:3;}<span class=\"hashtag-raw\">#mermaid-diagram-2</span> .edge-pattern-dotted{stroke-dasharray:2;}<span class=\"hashtag-raw\">#mermaid-diagram-2</span> .marker{fill:<span class=\"hashtag-raw\">#333333</span>;stroke:<span class=\"hashtag-raw\">#333333</span>;}<span class=\"hashtag-raw\">#mermaid-diagram-2</span> .marker.cross{stroke:<span class=\"hashtag-raw\">#333333</span>;}<span class=\"hashtag-raw\">#mermaid-diagram-2</span> svg{font-family:\u201ctrebuchet ms\u201d,verdana,arial,sans-serif;font-size:16px;}<span class=\"hashtag-raw\">#mermaid-diagram-2</span> p{margin:0;}<span class=\"hashtag-raw\">#mermaid-diagram-2</span> .actor{stroke:hsl(259.6261682243, 59.7765363128%, 87.9019607843%);fill:<span class=\"hashtag-raw\">#ECECFF</span>;}<span class=\"hashtag-raw\">#mermaid-diagram-2</span> text.actor&gt;tspan{fill:black;stroke:none;}<span class=\"hashtag-raw\">#mermaid-diagram-2</span> .actor-line{stroke:hsl(259.6261682243, 59.7765363128%, 87.9019607843%);}<span class=\"hashtag-raw\">#mermaid-diagram-2</span> .messageLine0{stroke-width:1.5;stroke-dasharray:none;stroke:<span class=\"hashtag-raw\">#333</span>;}<span class=\"hashtag-raw\">#mermaid-diagram-2</span> .messageLine1{stroke-width:1.5;stroke-dasharray:2,2;stroke:<span class=\"hashtag-raw\">#333</span>;}<span class=\"hashtag-raw\">#mermaid-diagram-2</span> <span class=\"hashtag-raw\">#arrowhead</span> path{fill:<span class=\"hashtag-raw\">#333</span>;stroke:<span class=\"hashtag-raw\">#333</span>;}<span class=\"hashtag-raw\">#mermaid-diagram-2</span> .sequenceNumber{fill:white;}<span class=\"hashtag-raw\">#mermaid-diagram-2</span> <span class=\"hashtag-raw\">#sequencenumber</span>{fill:<span class=\"hashtag-raw\">#333</span>;}<span class=\"hashtag-raw\">#mermaid-diagram-2</span> <span class=\"hashtag-raw\">#crosshead</span> path{fill:<span class=\"hashtag-raw\">#333</span>;stroke:<span class=\"hashtag-raw\">#333</span>;}<span class=\"hashtag-raw\">#mermaid-diagram-2</span> .messageText{fill:<span class=\"hashtag-raw\">#333</span>;stroke:none;}<span class=\"hashtag-raw\">#mermaid-diagram-2</span> .labelBox{stroke:hsl(259.6261682243, 59.7765363128%, 87.9019607843%);fill:<span class=\"hashtag-raw\">#ECECFF</span>;}<span class=\"hashtag-raw\">#mermaid-diagram-2</span> .labelText,<span class=\"hashtag-raw\">#mermaid-diagram-2</span> .labelText&gt;tspan{fill:black;stroke:none;}<span class=\"hashtag-raw\">#mermaid-diagram-2</span> .loopText,<span class=\"hashtag-raw\">#mermaid-diagram-2</span> .loopText&gt;tspan{fill:black;stroke:none;}<span class=\"hashtag-raw\">#mermaid-diagram-2</span> .loopLine{stroke-width:2px;stroke-dasharray:2,2;stroke:hsl(259.6261682243, 59.7765363128%, 87.9019607843%);fill:hsl(259.6261682243, 59.7765363128%, 87.9019607843%);}<span class=\"hashtag-raw\">#mermaid-diagram-2</span> .note{stroke:<span class=\"hashtag-raw\">#aaaa33</span>;fill:<span class=\"hashtag-raw\">#fff5ad</span>;}<span class=\"hashtag-raw\">#mermaid-diagram-2</span> .noteText,<span class=\"hashtag-raw\">#mermaid-diagram-2</span> .noteText&gt;tspan{fill:black;stroke:none;}<span class=\"hashtag-raw\">#mermaid-diagram-2</span> .activation0{fill:<span class=\"hashtag-raw\">#f4f4f4</span>;stroke:<span class=\"hashtag-raw\">#666</span>;}<span class=\"hashtag-raw\">#mermaid-diagram-2</span> .activation1{fill:<span class=\"hashtag-raw\">#f4f4f4</span>;stroke:<span class=\"hashtag-raw\">#666</span>;}<span class=\"hashtag-raw\">#mermaid-diagram-2</span> .activation2{fill:<span class=\"hashtag-raw\">#f4f4f4</span>;stroke:<span class=\"hashtag-raw\">#666</span>;}<span class=\"hashtag-raw\">#mermaid-diagram-2</span> .actorPopupMenu{position:absolute;}<span class=\"hashtag-raw\">#mermaid-diagram-2</span> .actorPopupMenuPanel{position:absolute;fill:<span class=\"hashtag-raw\">#ECECFF</span>;box-shadow:0px 8px 16px 0px rgba(0,0,0,0.2);filter:drop-shadow(3px 5px 2px rgb(0 0 0 / 0.4));}<span class=\"hashtag-raw\">#mermaid-diagram-2</span> .actor-man line{stroke:hsl(259.6261682243, 59.7765363128%, 87.9019607843%);fill:<span class=\"hashtag-raw\">#ECECFF</span>;}<span class=\"hashtag-raw\">#mermaid-diagram-2</span> .actor-man circle,<span class=\"hashtag-raw\">#mermaid-diagram-2</span> line{stroke:hsl(259.6261682243, 59.7765363128%, 87.9019607843%);fill:<span class=\"hashtag-raw\">#ECECFF</span>;stroke-width:2px;}<span class=\"hashtag-raw\">#mermaid-diagram-2</span> :root{\u2013mermaid-font-family:\u201ctrebuchet ms\u201d,verdana,arial,sans-serif;}alt[DecodeSketch() failed]RequestSketch()SketchDifferenceOfTwoFourthsDecodeSketch()RequestSketchExtension()SketchDifferenceOfThirdFourthdecode</p>\n<p>I\u2019m unclear on what you meant by \u201cgo larger\u201d, but I think you meant that Alice should build a sketch from a larger set locally and retry reconciliation?. IIUC, if the number of differences exceeds the capacity of the sketch Bob sent Alice, Alice retrying reconciliation in this way would only succeed if the number of differences decreased between her first and second sets. Which may happen if she has reconciled with other peers in the meantime.</p>\n<p>I think we\u2019d probably want to do both? So if initial reconciliation fails, wait for timer_interval / 3 seconds, expand our local set, build a larger sketch, and try reconciliation again. If the 2nd reconciliation fails, ask Bob for a sketch extension and retry reconciliation a 3rd time. If it still fails, either:</p>\n<ul>\n<li>Query Bob for all set elements and reconcile locally (lots of bandwidth, minimal CPU)</li>\n<li>Give up on reconciliation with Bob for this interval, retry the normal reconciliation protocol in (timer_interval) * 2/3 seconds. Hope that our reconciliation with other peers reduces our difference with Bob.</li>\n</ul>\n<p>Another option is to ask Bob for a fresh sketch of the same capacity, instead of an extension of the 1st sketch we received.</p>\n<p>IIUC we mostly agree on the options for handling initial reconciliation failure; I think having evidence to decide will require simulation and tweaking parameters there.</p>\n</blockquote>\n</aside>\n<p>How about:</p>\n<ol>\n<li>Send a sketch every 60 seconds.  You may reduce the set before sending.</li>\n<li>If you receive a sketch you can decode, simply reply with any messages the sender is missing.</li>\n<li>If you can\u2019t decode:\n<ol>\n<li>If they are on a different blockheight, ignore.</li>\n<li>If you can send a larger set, do so next time.</li>\n<li>If you have other peers, wait until you get more failures.</li>\n<li>If they have much less gossip than you, start streaming gossip.</li>\n<li>Otherwise, something is wrong, query them for everything (or if you don\u2019t have a channel with them, ignore?).</li>\n</ol>\n</li>\n</ol>\n<p>I don\u2019t really think a query protocol is needed.</p>",
  "post_number": 14,
  "post_type": 1,
  "posts_count": 20,
  "updated_at": "2025-12-04T04:36:13.212Z",
  "reply_count": 2,
  "reply_to_post_number": 13,
  "quote_count": 1,
  "incoming_link_count": 0,
  "reads": 23,
  "readers_count": 22,
  "score": 14.6,
  "yours": false,
  "topic_id": 2105,
  "topic_slug": "gossip-observer-new-project-to-monitor-the-lightning-p2p-network",
  "topic_title": "Gossip Observer: New project to monitor the Lightning P2P network",
  "topic_html_title": "Gossip Observer: New project to monitor the Lightning P2P network",
  "category_id": 7,
  "display_username": "Rusty Russell",
  "primary_group_name": null,
  "flair_name": null,
  "flair_url": null,
  "flair_bg_color": null,
  "flair_color": null,
  "flair_group_id": null,
  "badges_granted": [],
  "version": 2,
  "can_edit": false,
  "can_delete": false,
  "can_recover": false,
  "can_see_hidden_post": false,
  "can_wiki": false,
  "user_title": null,
  "bookmarked": false,
  "raw": "[quote=\"jonhbit, post:13, topic:2105\"]\nIMO we can adjust the size of these fields based on current constraints like min. tx size, etc. such that the amount of overlap is minimal, but we wouldn\u2019t need this fallback path.\n\n[/quote]\n\nBut now you need to detect clashes and decide who wins.  Easier to up-front fail to decode, in practice.\n\n[quote=\"jonhbit, post:13, topic:2105\"]\nThis is the message flow I was thinking of in my response:\n\nBobAliceBobAlice#mermaid-diagram-2{font-family:\u201ctrebuchet ms\u201d,verdana,arial,sans-serif;font-size:16px;fill:#333;}#mermaid-diagram-2 .error-icon{fill:#552222;}#mermaid-diagram-2 .error-text{fill:#552222;stroke:#552222;}#mermaid-diagram-2 .edge-thickness-normal{stroke-width:1px;}#mermaid-diagram-2 .edge-thickness-thick{stroke-width:3.5px;}#mermaid-diagram-2 .edge-pattern-solid{stroke-dasharray:0;}#mermaid-diagram-2 .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaid-diagram-2 .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-diagram-2 .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-diagram-2 .marker{fill:#333333;stroke:#333333;}#mermaid-diagram-2 .marker.cross{stroke:#333333;}#mermaid-diagram-2 svg{font-family:\u201ctrebuchet ms\u201d,verdana,arial,sans-serif;font-size:16px;}#mermaid-diagram-2 p{margin:0;}#mermaid-diagram-2 .actor{stroke:hsl(259.6261682243, 59.7765363128%, 87.9019607843%);fill:#ECECFF;}#mermaid-diagram-2 text.actor>tspan{fill:black;stroke:none;}#mermaid-diagram-2 .actor-line{stroke:hsl(259.6261682243, 59.7765363128%, 87.9019607843%);}#mermaid-diagram-2 .messageLine0{stroke-width:1.5;stroke-dasharray:none;stroke:#333;}#mermaid-diagram-2 .messageLine1{stroke-width:1.5;stroke-dasharray:2,2;stroke:#333;}#mermaid-diagram-2 #arrowhead path{fill:#333;stroke:#333;}#mermaid-diagram-2 .sequenceNumber{fill:white;}#mermaid-diagram-2 #sequencenumber{fill:#333;}#mermaid-diagram-2 #crosshead path{fill:#333;stroke:#333;}#mermaid-diagram-2 .messageText{fill:#333;stroke:none;}#mermaid-diagram-2 .labelBox{stroke:hsl(259.6261682243, 59.7765363128%, 87.9019607843%);fill:#ECECFF;}#mermaid-diagram-2 .labelText,#mermaid-diagram-2 .labelText>tspan{fill:black;stroke:none;}#mermaid-diagram-2 .loopText,#mermaid-diagram-2 .loopText>tspan{fill:black;stroke:none;}#mermaid-diagram-2 .loopLine{stroke-width:2px;stroke-dasharray:2,2;stroke:hsl(259.6261682243, 59.7765363128%, 87.9019607843%);fill:hsl(259.6261682243, 59.7765363128%, 87.9019607843%);}#mermaid-diagram-2 .note{stroke:#aaaa33;fill:#fff5ad;}#mermaid-diagram-2 .noteText,#mermaid-diagram-2 .noteText>tspan{fill:black;stroke:none;}#mermaid-diagram-2 .activation0{fill:#f4f4f4;stroke:#666;}#mermaid-diagram-2 .activation1{fill:#f4f4f4;stroke:#666;}#mermaid-diagram-2 .activation2{fill:#f4f4f4;stroke:#666;}#mermaid-diagram-2 .actorPopupMenu{position:absolute;}#mermaid-diagram-2 .actorPopupMenuPanel{position:absolute;fill:#ECECFF;box-shadow:0px 8px 16px 0px rgba(0,0,0,0.2);filter:drop-shadow(3px 5px 2px rgb(0 0 0 / 0.4));}#mermaid-diagram-2 .actor-man line{stroke:hsl(259.6261682243, 59.7765363128%, 87.9019607843%);fill:#ECECFF;}#mermaid-diagram-2 .actor-man circle,#mermaid-diagram-2 line{stroke:hsl(259.6261682243, 59.7765363128%, 87.9019607843%);fill:#ECECFF;stroke-width:2px;}#mermaid-diagram-2 :root{\u2013mermaid-font-family:\u201ctrebuchet ms\u201d,verdana,arial,sans-serif;}alt\\[DecodeSketch() failed\\]RequestSketch()SketchDifferenceOfTwoFourthsDecodeSketch()RequestSketchExtension()SketchDifferenceOfThirdFourthdecode\n\nI\u2019m unclear on what you meant by \u201cgo larger\u201d, but I think you meant that Alice should build a sketch from a larger set locally and retry reconciliation?. IIUC, if the number of differences exceeds the capacity of the sketch Bob sent Alice, Alice retrying reconciliation in this way would only succeed if the number of differences decreased between her first and second sets. Which may happen if she has reconciled with other peers in the meantime.\n\nI think we\u2019d probably want to do both? So if initial reconciliation fails, wait for timer_interval / 3 seconds, expand our local set, build a larger sketch, and try reconciliation again. If the 2nd reconciliation fails, ask Bob for a sketch extension and retry reconciliation a 3rd time. If it still fails, either:\n\n* Query Bob for all set elements and reconcile locally (lots of bandwidth, minimal CPU)\n* Give up on reconciliation with Bob for this interval, retry the normal reconciliation protocol in (timer_interval) \\* 2/3 seconds. Hope that our reconciliation with other peers reduces our difference with Bob.\n\nAnother option is to ask Bob for a fresh sketch of the same capacity, instead of an extension of the 1st sketch we received.\n\nIIUC we mostly agree on the options for handling initial reconciliation failure; I think having evidence to decide will require simulation and tweaking parameters there.\n\n[/quote]\n\nHow about:\n\n1. Send a sketch every 60 seconds.  You may reduce the set before sending.\n2. If you receive a sketch you can decode, simply reply with any messages the sender is missing.\n3. If you can\u2019t decode:\n   1. If they are on a different blockheight, ignore.\n   2. If you can send a larger set, do so next time.\n   3. If you have other peers, wait until you get more failures.\n   4. If they have much less gossip than you, start streaming gossip.\n   5. Otherwise, something is wrong, query them for everything (or if you don\u2019t have a channel with them, ignore?).\n\n\nI don\u2019t really think a query protocol is needed.",
  "actions_summary": [],
  "moderator": false,
  "admin": false,
  "staff": false,
  "user_id": 137,
  "hidden": false,
  "trust_level": 2,
  "deleted_at": null,
  "user_deleted": false,
  "edit_reason": null,
  "can_view_edit_history": true,
  "wiki": false,
  "excerpt": "But now you need to detect clashes and decide who wins.  Easier to up-front fail to decode, in practice. \n\nHow about: \n\nSend a sketch every 60 seconds.  You may reduce the set before sending.\nIf you receive a sketch you can decode, simply reply with any messages the sender is missing.\nIf you can\u2019t &hellip;",
  "truncated": true,
  "post_url": "/t/gossip-observer-new-project-to-monitor-the-lightning-p2p-network/2105/14",
  "reactions": [],
  "current_user_reaction": null,
  "reaction_users_count": 0,
  "current_user_used_main_reaction": false,
  "can_accept_answer": false,
  "can_unaccept_answer": false,
  "accepted_answer": false,
  "topic_accepted_answer": null
}