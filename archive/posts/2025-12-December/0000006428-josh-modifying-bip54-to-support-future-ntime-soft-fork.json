{
  "id": 6428,
  "name": "",
  "username": "josh",
  "avatar_template": "/user_avatar/delvingbitcoin.org/josh/{size}/95_2.png",
  "created_at": "2025-12-15T00:31:48.389Z",
  "cooked": "<h3><a name=\"p-6428-tldr-1\" class=\"anchor\" href=\"#p-6428-tldr-1\"></a>TLDR</h3>\n<p>BIP54 prevents the \u201ctimewarp attack\u201d but inadvertently also precludes a future soft fork that could resolve the <code>nTime</code> overflow problem, which is expected to halt the chain in 2106. Modifying BIP54 slightly by including a <code>u64</code> timestamp in the coinbase can resolve timewarp concerns, while leaving the door open for a soft fork that resolves the <code>nTime</code> problem, rather than a hard fork.</p>\n<h3><a name=\"p-6428-the-problem-2\" class=\"anchor\" href=\"#p-6428-the-problem-2\"></a>The Problem</h3>\n<p><a href=\"https://github.com/bitcoin-inquisition/bitcoin/pull/99\" rel=\"noopener nofollow ugc\">Active work</a> is underway to implement <a href=\"https://github.com/bitcoin/bips/blob/6ce21f4eaeb4a73373688e99d7ea74a6c0413f22/bip-0054.md\" rel=\"noopener nofollow ugc\">BIP54</a>, also known as the <a href=\"https://delvingbitcoin.org/t/great-consensus-cleanup-revival/710\">Great Consensus Cleanup</a>. One of the goals of BIP54 is to prevent the \u201ctimewarp attack,\u201d whereby an attacker artificially suppresses the median time past (MTP) in order to artificially reduce the difficulty target.</p>\n<p>The proposed solution in BIP54 is:</p>\n<blockquote>\n<p>Given a block of height <span class=\"math\">N</span>:</p>\n<ul>\n<li>If <span class=\"math\">N\\ \\%\\ 2016</span> is equal to <span class=\"math\">0</span>, <code>nTime</code> must be set to a value higher than or equal to the <code>nTime</code> at height <span class=\"math\">N-1</span> minus <span class=\"math\">7200</span> <span class=\"math\">(T_N \u2265 T_{N\u22121} \u2212 7200)</span></li>\n</ul>\n</blockquote>\n<p>This eliminates the attack vector, but it inadvertently precludes a future generation from resolving the <code>nTime</code> overflow problem via a soft fork, rather than a hard fork.</p>\n<h3><a name=\"p-6428-a-possible-ntime-soft-fork-3\" class=\"anchor\" href=\"#p-6428-a-possible-ntime-soft-fork-3\"></a>A Possible <code>nTime</code> Soft Fork</h3>\n<p>Imagine that it is the year 2080. Developers want to use immutable software that can run for the next 100 years (ex: an SPV bridge on a L2), but a hard fork to increase the <code>nTime</code> field from <code>u32</code> to <code>u64</code> is not yet pressing enough to be viable. Instead, users adopt the following soft fork:</p>\n<blockquote>\n<p>Given a block of height <span class=\"math\">N</span> and a timestamp <span class=\"math\">T_A</span> at activation height <span class=\"math\">H</span>:</p>\n<ul>\n<li>\n<p>Miners store the timestamp <span class=\"math\">T_N</span> in a <code>u64</code> field in the coinbase.</p>\n</li>\n<li>\n<p>If <span class=\"math\">N \\ \\% \\ 2016 &lt; 2015</span>: miners set <code>nTime</code> to <span class=\"math\">T_A+N-H</span>.</p>\n</li>\n<li>\n<p>If <span class=\"math\">N \\ \\% \\ 2016 = 2015</span>: miners set <code>nTime</code> to <span class=\"math\">(T_A + N - H - 2015) + T_N - T_{N-2015}</span>.</p>\n</li>\n</ul>\n</blockquote>\n<p>Consequently, MTP increases by at most 1 each block, ensuring the chain effectively never halts (assuming <span class=\"math\">T_H</span> is sufficiently low).</p>\n<p>In addition, the difficulty adjustment remains the same for legacy nodes and upgraded nodes. This resolves a DOS concern <a class=\"mention\" href=\"/u/gmaxwell\">@gmaxwell</a> <a href=\"https://groups.google.com/g/bitcoindev/c/L4Eu9bA5iBw/m/_5HEbNmHAQAJ\" rel=\"noopener nofollow ugc\">raised</a> in my original post on the mailing list.</p>\n<h3><a name=\"p-6428-modifying-bip54-4\" class=\"anchor\" href=\"#p-6428-modifying-bip54-4\"></a>Modifying BIP54</h3>\n<p>I would not venture to propose that we fix the <code>nTime</code> problem today. The <code>nTime</code> problem is still too far in the future, and it may turn out that a hard fork is the better option. But I would tend to prefer a fix to the timewarp problem that does not bind the hands of future generations.</p>\n<p>A simply modification to BIP54 would resolve the problem:</p>\n<blockquote>\n<p>Given a block of height <span class=\"math\">N</span>:</p>\n<ul>\n<li>\n<p>Miners store the timestamp <span class=\"math\">T_N</span> in a <code>u64</code> field in the coinbase.</p>\n</li>\n<li>\n<p>If <span class=\"math\">N\\ \\%\\ 2016</span> is equal to <span class=\"math\">0</span>, <span class=\"math\">T_N</span> must be set to a value higher than or equal to <span class=\"math\">T_{N-1}</span> minus <span class=\"math\">7200</span> <span class=\"math\">(T_N \u2265 T_{N\u22121} \u2212 7200)</span>.</p>\n</li>\n<li>\n<p>If <span class=\"math\">N\\ \\%\\ 2016</span> is equal to <span class=\"math\">2015</span>, <code>nTime</code> must be set to the <code>nTime</code> at height <span class=\"math\">N-2015</span> plus <span class=\"math\">T_N - T_{N-2015}</span>.</p>\n</li>\n</ul>\n</blockquote>\n<p>This effectively prevents a timewarp attack while keeping the door open to a soft fork that fixes the <code>nTime</code> problem. The cost is a few bytes in the coinbase, which can be removed if a hard fork ends up being the preferred option.</p>\n<h3><a name=\"p-6428-request-for-feedback-5\" class=\"anchor\" href=\"#p-6428-request-for-feedback-5\"></a>Request for Feedback</h3>\n<p>Has the proposed modification to BIP54 been considered before? If not, would the flexibility of the proposed change be worth pursuing further?</p>",
  "post_number": 1,
  "post_type": 1,
  "posts_count": 6,
  "updated_at": "2025-12-15T00:36:53.445Z",
  "reply_count": 0,
  "reply_to_post_number": null,
  "quote_count": 0,
  "incoming_link_count": 12,
  "reads": 33,
  "readers_count": 32,
  "score": 46.2,
  "yours": false,
  "topic_id": 2163,
  "topic_slug": "modifying-bip54-to-support-future-ntime-soft-fork",
  "topic_title": "Modifying BIP54 to Support Future nTime Soft Fork",
  "topic_html_title": "Modifying BIP54 to Support Future nTime Soft Fork",
  "category_id": 7,
  "display_username": "",
  "primary_group_name": null,
  "flair_name": null,
  "flair_url": null,
  "flair_bg_color": null,
  "flair_color": null,
  "flair_group_id": null,
  "badges_granted": [],
  "version": 2,
  "can_edit": false,
  "can_delete": false,
  "can_recover": false,
  "can_see_hidden_post": false,
  "can_wiki": false,
  "user_title": null,
  "bookmarked": false,
  "raw": "### TLDR\n\nBIP54 prevents the \"timewarp attack\" but inadvertently also precludes a future soft fork that could resolve the `nTime` overflow problem, which is expected to halt the chain in 2106. Modifying BIP54 slightly by including a `u64` timestamp in the coinbase can resolve timewarp concerns, while leaving the door open for a soft fork that resolves the `nTime` problem, rather than a hard fork.\n\n### The Problem\n\n[Active work](https://github.com/bitcoin-inquisition/bitcoin/pull/99) is underway to implement [BIP54](https://github.com/bitcoin/bips/blob/6ce21f4eaeb4a73373688e99d7ea74a6c0413f22/bip-0054.md), also known as the [Great Consensus Cleanup](https://delvingbitcoin.org/t/great-consensus-cleanup-revival/710). One of the goals of BIP54 is to prevent the \"timewarp attack,\" whereby an attacker artificially suppresses the median time past (MTP) in order to artificially reduce the difficulty target.\n\nThe proposed solution in BIP54 is:\n> Given a block of height $N$:\n>\n> - If $N\\ \\%\\ 2016$ is equal to $0$, `nTime` must be set to a value higher than or equal to the `nTime` at height $N-1$ minus $7200$ $(T_N \u2265 T_{N\u22121} \u2212 7200)$\n\nThis eliminates the attack vector, but it inadvertently precludes a future generation from resolving the `nTime` overflow problem via a soft fork, rather than a hard fork.\n\n### A Possible `nTime` Soft Fork\n\nImagine that it is the year 2080. Developers want to use immutable software that can run for the next 100 years (ex: an SPV bridge on a L2), but a hard fork to increase the `nTime` field from `u32` to `u64` is not yet pressing enough to be viable. Instead, users adopt the following soft fork:\n\n> Given a block of height $N$ and a timestamp $T_A$ at activation height $H$:\n>\n> - Miners store the timestamp $T_N$ in a `u64` field in the coinbase.\n>\n> - If $N \\ \\% \\ 2016 < 2015$: miners set `nTime` to $T_A+N-H$.\n> \n> - If $N \\ \\% \\ 2016 = 2015$: miners set `nTime` to $(T_A + N - H - 2015) + T_N - T_{N-2015}$.\n\nConsequently, MTP increases by at most 1 each block, ensuring the chain effectively never halts (assuming $T_H$ is sufficiently low).\n\nIn addition, the difficulty adjustment remains the same for legacy nodes and upgraded nodes. This resolves a DOS concern @gmaxwell [raised](https://groups.google.com/g/bitcoindev/c/L4Eu9bA5iBw/m/_5HEbNmHAQAJ) in my original post on the mailing list.\n\n### Modifying BIP54\n\nI would not venture to propose that we fix the `nTime` problem today. The `nTime` problem is still too far in the future, and it may turn out that a hard fork is the better option. But I would tend to prefer a fix to the timewarp problem that does not bind the hands of future generations.\n\nA simply modification to BIP54 would resolve the problem:\n\n> Given a block of height $N$:\n>\n> - Miners store the timestamp $T_N$ in a `u64` field in the coinbase.\n>\n> - If $N\\ \\%\\ 2016$ is equal to $0$, $T_N$ must be set to a value higher than or equal to $T_{N-1}$ minus $7200$ $(T_N \u2265 T_{N\u22121} \u2212 7200)$.\n>\n> - If $N\\ \\%\\ 2016$ is equal to $2015$, `nTime` must be set to the `nTime` at height $N-2015$ plus $T_N - T_{N-2015}$.\n\nThis effectively prevents a timewarp attack while keeping the door open to a soft fork that fixes the `nTime` problem. The cost is a few bytes in the coinbase, which can be removed if a hard fork ends up being the preferred option.\n\n### Request for Feedback\n\nHas the proposed modification to BIP54 been considered before? If not, would the flexibility of the proposed change be worth pursuing further?",
  "actions_summary": [],
  "moderator": false,
  "admin": false,
  "staff": false,
  "user_id": 98,
  "hidden": false,
  "trust_level": 2,
  "deleted_at": null,
  "user_deleted": false,
  "edit_reason": "Github link was replaced with a permanent link",
  "can_view_edit_history": true,
  "wiki": false,
  "excerpt": "<a name=\"p-6428-tldr-1\" class=\"anchor\" href=\"#p-6428-tldr-1\"></a>TLDR\nBIP54 prevents the \u201ctimewarp attack\u201d but inadvertently also precludes a future soft fork that could resolve the nTime overflow problem, which is expected to halt the chain in 2106. Modifying BIP54 slightly by including a u64 timestamp in the coinbase can resolve timewarp concerns, while leaving&hellip;",
  "truncated": true,
  "post_url": "/t/modifying-bip54-to-support-future-ntime-soft-fork/2163/1",
  "reactions": [],
  "current_user_reaction": null,
  "reaction_users_count": 0,
  "current_user_used_main_reaction": false,
  "can_accept_answer": false,
  "can_unaccept_answer": false,
  "accepted_answer": false,
  "topic_accepted_answer": null,
  "can_vote": false
}