{
  "id": 6391,
  "name": "Matt Morehouse",
  "username": "morehouse",
  "avatar_template": "/letter_avatar_proxy/v4/letter/m/df705f/{size}.png",
  "created_at": "2025-12-06T15:31:27.660Z",
  "cooked": "<aside class=\"quote no-group\" data-username=\"ariard\" data-post=\"5\" data-topic=\"2145\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img alt=\"\" width=\"24\" height=\"24\" src=\"https://delvingbitcoin.org/letter_avatar_proxy/v4/letter/a/c67d28/48.png\" class=\"avatar\"> ariard:</div>\n<blockquote>\n<p>Thanks for the disclosures \u2013 Browsed over the Replacement Stalling Attacks one, if my memory is correct on this subject, I think Bastien Teinturier was the first back in 2021 sharing with few lightning devs the idea of \u201ccat-and-mouse\u201d attacks, i,e adversarially aggregating and disaggregating <code>option_anchors</code> second-stage HTLCs transactions. Sounds what you found is one variant of those \u201ccat-and-mouse\u201d attacks, but this is nothing very specific to LND.</p>\n</blockquote>\n</aside>\n<p>The general weakness in LND was that transaction fees could be manipulated to stay too low, and the reaggregation+rebroadcast period was infrequent (once every two blocks).  As a result, an attacker could pull off the attack for cheap.  At the time I looked at other implementations and found their fees couldn\u2019t be manipulated this way, and they generally responded to double spends immediately after confirmation.  But I think there certainly is <a href=\"https://morehouse.github.io/lightning/lnd-deadline-aware-budget-sweeper/\" rel=\"noopener nofollow ugc\">much that can be improved</a> about other implementations\u2019 fee bumping strategies to protect against replacement cycling and similar attacks in general.</p>\n<aside class=\"quote no-group\">\n<blockquote>\n<p>About disclosure timeline, 90-days is generally the basic infosec embargo timeline. It can be a bit dry, assuming it\u2019s a \u201csimple\u201d bug that can be fixed solely by the implementation (so no cross-layer vulnerability), letting a 4-6 months sounds more generous and in line with the usual release cycles of Lightning implementations. It\u2019s really depends on the type of vulnerability, however the drawback with an isolated release with only 2 or 3 lines of changelog, with one altering some critical code paths, is to make it too much obvious there is \u201ccovert fix\u201d somewhere and lowering the bar for any external actor to know what to look for to reverse-engineer.</p>\n</blockquote>\n</aside>\n<p>Yes, though 90 days may be a bit aggressive when so much money is at risk.  Especially for LND, which has historically had a lot of upgrade friction.  Perhaps 6 months is a better disclosure timeline.</p>\n<aside class=\"quote no-group\">\n<blockquote>\n<p>On all the logic area you\u2019re pointing you, i.e claimable outputs detection, generation of claims transactions, fee selection and scheduled rebroadcast of the claims of transactions, it has been floated few times the idea, at least since 2020, to write a specific BOLT encompassing all this flow with the do and don\u2019t. While there is no necessity at all of inter-compatibility among the Lightning implementations on logic, despite being one of the most critical area for channels funds security, somehow Lightning implementations kept put one\u2019s foot in one\u2019s mouth on this flow. An (incomplete) <a href=\"https://github.com/discreetlogcontracts/dlcspecs/blob/9cd9148938c616690c79d99ec6f330e213c246c5/Non-Interactive-Protocol.md\" rel=\"noopener nofollow ugc\">experience</a> has been attempted for the DLC spec on what such piece of recommendations can cover.</p>\n</blockquote>\n</aside>\n<p>Perhaps this would be beneficial.  I\u2019ve also long thought that LN implementations are barking up the wrong tree with all these force close fee optimizations. Getting too fancy in this area inevitably leads to vulnerabilities.  Perhaps we should focus on making force closes less frequent (e.g., by reducing state machine bugs, implementing 0-fee commitments) rather than saving ~30% or less on fees by batching.</p>",
  "post_number": 6,
  "post_type": 1,
  "posts_count": 6,
  "updated_at": "2025-12-06T15:31:27.660Z",
  "reply_count": 0,
  "reply_to_post_number": 5,
  "quote_count": 1,
  "incoming_link_count": 13,
  "reads": 33,
  "readers_count": 32,
  "score": 71.6,
  "yours": false,
  "topic_id": 2145,
  "topic_slug": "disclosure-critical-vulnerabilities-fixed-in-lnd-0-19-0",
  "topic_title": "Disclosure: Critical vulnerabilities fixed in LND 0.19.0",
  "topic_html_title": "Disclosure: Critical vulnerabilities fixed in LND 0.19.0",
  "category_id": 8,
  "display_username": "Matt Morehouse",
  "primary_group_name": null,
  "flair_name": null,
  "flair_url": null,
  "flair_bg_color": null,
  "flair_color": null,
  "flair_group_id": null,
  "badges_granted": [],
  "version": 1,
  "can_edit": false,
  "can_delete": false,
  "can_recover": false,
  "can_see_hidden_post": false,
  "can_wiki": false,
  "user_title": null,
  "bookmarked": false,
  "raw": "[quote=\"ariard, post:5, topic:2145\"]\nThanks for the disclosures \u2013 Browsed over the Replacement Stalling Attacks one, if my memory is correct on this subject, I think Bastien Teinturier was the first back in 2021 sharing with few lightning devs the idea of \u201ccat-and-mouse\u201d attacks, i,e adversarially aggregating and disaggregating `option_anchors` second-stage HTLCs transactions. Sounds what you found is one variant of those \u201ccat-and-mouse\u201d attacks, but this is nothing very specific to LND.\n[/quote]\n\nThe general weakness in LND was that transaction fees could be manipulated to stay too low, and the reaggregation+rebroadcast period was infrequent (once every two blocks).  As a result, an attacker could pull off the attack for cheap.  At the time I looked at other implementations and found their fees couldn't be manipulated this way, and they generally responded to double spends immediately after confirmation.  But I think there certainly is [much that can be improved](https://morehouse.github.io/lightning/lnd-deadline-aware-budget-sweeper/) about other implementations' fee bumping strategies to protect against replacement cycling and similar attacks in general.\n\n[quote]\nAbout disclosure timeline, 90-days is generally the basic infosec embargo timeline. It can be a bit dry, assuming it\u2019s a \u201csimple\u201d bug that can be fixed solely by the implementation (so no cross-layer vulnerability), letting a 4-6 months sounds more generous and in line with the usual release cycles of Lightning implementations. It\u2019s really depends on the type of vulnerability, however the drawback with an isolated release with only 2 or 3 lines of changelog, with one altering some critical code paths, is to make it too much obvious there is \u201ccovert fix\u201d somewhere and lowering the bar for any external actor to know what to look for to reverse-engineer.\n[/quote]\n\nYes, though 90 days may be a bit aggressive when so much money is at risk.  Especially for LND, which has historically had a lot of upgrade friction.  Perhaps 6 months is a better disclosure timeline.\n\n[quote]\nOn all the logic area you\u2019re pointing you, i.e claimable outputs detection, generation of claims transactions, fee selection and scheduled rebroadcast of the claims of transactions, it has been floated few times the idea, at least since 2020, to write a specific BOLT encompassing all this flow with the do and don\u2019t. While there is no necessity at all of inter-compatibility among the Lightning implementations on logic, despite being one of the most critical area for channels funds security, somehow Lightning implementations kept put one\u2019s foot in one\u2019s mouth on this flow. An (incomplete) [experience](https://github.com/discreetlogcontracts/dlcspecs/blob/9cd9148938c616690c79d99ec6f330e213c246c5/Non-Interactive-Protocol.md) has been attempted for the DLC spec on what such piece of recommendations can cover.\n[/quote]\n\nPerhaps this would be beneficial.  I've also long thought that LN implementations are barking up the wrong tree with all these force close fee optimizations. Getting too fancy in this area inevitably leads to vulnerabilities.  Perhaps we should focus on making force closes less frequent (e.g., by reducing state machine bugs, implementing 0-fee commitments) rather than saving ~30% or less on fees by batching.",
  "actions_summary": [],
  "moderator": false,
  "admin": false,
  "staff": false,
  "user_id": 47,
  "hidden": false,
  "trust_level": 2,
  "deleted_at": null,
  "user_deleted": false,
  "edit_reason": null,
  "can_view_edit_history": true,
  "wiki": false,
  "excerpt": "The general weakness in LND was that transaction fees could be manipulated to stay too low, and the reaggregation+rebroadcast period was infrequent (once every two blocks).  As a result, an attacker could pull off the attack for cheap.  At the time I looked at other implementations and found their &hellip;",
  "truncated": true,
  "post_url": "/t/disclosure-critical-vulnerabilities-fixed-in-lnd-0-19-0/2145/6",
  "reactions": [],
  "current_user_reaction": null,
  "reaction_users_count": 0,
  "current_user_used_main_reaction": false,
  "can_accept_answer": false,
  "can_unaccept_answer": false,
  "accepted_answer": false,
  "topic_accepted_answer": null
}