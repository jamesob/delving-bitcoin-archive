{
  "id": 6429,
  "name": "Anthony Towns",
  "username": "ajtowns",
  "avatar_template": "/user_avatar/delvingbitcoin.org/ajtowns/{size}/417_2.png",
  "created_at": "2025-12-15T03:13:31.693Z",
  "cooked": "<p>That\u2019s not \u201creally\u201d a soft fork, in that it would make the chain\u2019s mediantime lag signficantly behind real time, so that transactions with an nTimeLock set by timestamp rather than block height would not be spendable at the time they were expected to be. That\u2019s somewhat confiscatory, particularly if the timelock setting is enforced by OP_CLTV.</p>\n<p>The \u201cobvious\u201d fix to the nTime overflow issue is to calculate a 64 bit nTime64 from the 32 bit nTime something like:</p>\n<pre><code class=\"lang-auto\">    uint64_t mediantime = pindexPrev-&gt;GetMedianTime();\n    uint64_t nTimeHigh = mediantime &amp; 0xFFFFFFFF00000000ull;\n    uint64_t blockntime = nTimeHigh | uint32_t{block.nTime};\n    if (blockntime &lt; mediantime) blockntime + 0x100000000ull;\n</code></pre>\n<p>That\u2019s a hard fork (but only compared to the chain stopping entirely), and means that a 64 bit replacement for timestamp-based nLockTime would be needed for that feature to still be usable, but otherwise seems pretty straightforward and non-intrusive.</p>",
  "post_number": 2,
  "post_type": 1,
  "posts_count": 6,
  "updated_at": "2025-12-15T03:13:31.693Z",
  "reply_count": 1,
  "reply_to_post_number": null,
  "quote_count": 0,
  "incoming_link_count": 0,
  "reads": 32,
  "readers_count": 31,
  "score": 41.0,
  "yours": false,
  "topic_id": 2163,
  "topic_slug": "modifying-bip54-to-support-future-ntime-soft-fork",
  "topic_title": "Modifying BIP54 to Support Future nTime Soft Fork",
  "topic_html_title": "Modifying BIP54 to Support Future nTime Soft Fork",
  "category_id": 7,
  "display_username": "Anthony Towns",
  "primary_group_name": null,
  "flair_name": null,
  "flair_url": null,
  "flair_bg_color": null,
  "flair_color": null,
  "flair_group_id": null,
  "badges_granted": [],
  "version": 1,
  "can_edit": false,
  "can_delete": false,
  "can_recover": false,
  "can_see_hidden_post": false,
  "can_wiki": false,
  "user_title": null,
  "bookmarked": false,
  "raw": "That's not \"really\" a soft fork, in that it would make the chain's mediantime lag signficantly behind real time, so that transactions with an nTimeLock set by timestamp rather than block height would not be spendable at the time they were expected to be. That's somewhat confiscatory, particularly if the timelock setting is enforced by OP_CLTV.\n\nThe \"obvious\" fix to the nTime overflow issue is to calculate a 64 bit nTime64 from the 32 bit nTime something like:\n\n```\n    uint64_t mediantime = pindexPrev->GetMedianTime();\n    uint64_t nTimeHigh = mediantime & 0xFFFFFFFF00000000ull;\n    uint64_t blockntime = nTimeHigh | uint32_t{block.nTime};\n    if (blockntime < mediantime) blockntime + 0x100000000ull;\n```\n\nThat's a hard fork (but only compared to the chain stopping entirely), and means that a 64 bit replacement for timestamp-based nLockTime would be needed for that feature to still be usable, but otherwise seems pretty straightforward and non-intrusive.",
  "actions_summary": [
    {
      "id": 2,
      "count": 2
    }
  ],
  "moderator": true,
  "admin": true,
  "staff": true,
  "user_id": 3,
  "hidden": false,
  "trust_level": 4,
  "deleted_at": null,
  "user_deleted": false,
  "edit_reason": null,
  "can_view_edit_history": true,
  "wiki": false,
  "excerpt": "That\u2019s not \u201creally\u201d a soft fork, in that it would make the chain\u2019s mediantime lag signficantly behind real time, so that transactions with an nTimeLock set by timestamp rather than block height would not be spendable at the time they were expected to be. That\u2019s somewhat confiscatory, particularly if&hellip;",
  "truncated": true,
  "post_url": "/t/modifying-bip54-to-support-future-ntime-soft-fork/2163/2",
  "reactions": [
    {
      "id": "+1",
      "type": "emoji",
      "count": 2
    }
  ],
  "current_user_reaction": null,
  "reaction_users_count": 2,
  "current_user_used_main_reaction": false,
  "can_accept_answer": false,
  "can_unaccept_answer": false,
  "accepted_answer": false,
  "topic_accepted_answer": null
}