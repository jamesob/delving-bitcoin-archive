{
  "id": 3430,
  "name": "Anthony Towns",
  "username": "ajtowns",
  "avatar_template": "/user_avatar/delvingbitcoin.org/ajtowns/{size}/417_2.png",
  "created_at": "2024-10-28T11:16:51.953Z",
  "cooked": "<aside class=\"quote no-group\" data-username=\"moonsettler\" data-post=\"1\" data-topic=\"1216\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://delvingbitcoin.org/user_avatar/delvingbitcoin.org/moonsettler/48/38_2.png\" class=\"avatar\"> moonsettler:</div>\n<blockquote>\n<p>The idea is that the number of SHA256 iterations should be minimized in the most likely use case we can optimize for, which is LN-Symmetry.</p>\n</blockquote>\n</aside>\n<p>Not really seeing that as particularly important to minimise, personally; the difference between hashing 64 bytes and 256 bytes is pretty minor, compared to the checksig operation(s) you also have. I\u2019d just write <code>[BAL] [CTVHASH] SHA256 SWAP SHA256 CAT SHA256</code>.</p>\n<aside class=\"quote no-group\" data-username=\"moonsettler\" data-post=\"1\" data-topic=\"1216\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://delvingbitcoin.org/user_avatar/delvingbitcoin.org/moonsettler/48/38_2.png\" class=\"avatar\"> moonsettler:</div>\n<blockquote>\n<p>In case of a 7 byte balance commitment + 32 byte CTV hash (no HTLCs in-flight), the total preimage size is 55 bytes. Which should make it fit into a single block with the SHA256 length commitment.</p>\n</blockquote>\n</aside>\n<aside class=\"quote no-group\" data-username=\"moonsettler\" data-post=\"1\" data-topic=\"1216\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://delvingbitcoin.org/user_avatar/delvingbitcoin.org/moonsettler/48/38_2.png\" class=\"avatar\"> moonsettler:</div>\n<blockquote>\n<p>It\u2019s a particular concern for LN-Symmetry with CTV that the concatenation of the two preimages allows for length redistribution attacks, because CTV is only defined for 32 byte templates and will act as NOP for different template sizes for upgradeability.</p>\n</blockquote>\n</aside>\n<p>This seems as much an argument against doing upgradeability that way as anything else; but if you do want that, and want to minimise hashing as well for whatever reason, then writing <code>[BAL] [CTVHASH] SIZE 32 EQUALVERIFY CAT SHA256</code> seems like it would solve the problem.</p>\n<p>If you want to support CTV upgradeability prior to knowing what that upgradeability will do, you could do <code>[BAL] [CTVHASH] SIZE DUP VERIFY DUP 127 LESSTHANOREQUAL VERIFY SWAP CAT SWAP CAT SHA256</code> to construct <code>sha256(1B: &lt;size(CTVHASH)&gt;; 0B-127B: &lt;CTVHASH&gt;; &lt;BAL&gt;)</code>. (Having CTV error if the hash is 0 bytes would let you avoid the <code>DUP VERIFY</code> step and might be a reasonable update to the BIP)</p>",
  "post_number": 8,
  "post_type": 1,
  "updated_at": "2024-10-28T11:16:51.953Z",
  "reply_count": 1,
  "reply_to_post_number": null,
  "quote_count": 1,
  "incoming_link_count": 5,
  "reads": 7,
  "readers_count": 6,
  "score": 46.4,
  "yours": false,
  "topic_id": 1216,
  "topic_slug": "op-paircommit-as-a-candidate-for-addition-to-lnhance",
  "topic_title": "OP_PAIRCOMMIT as a candidate for addition to LNhance",
  "topic_html_title": "OP_PAIRCOMMIT as a candidate for addition to LNhance",
  "category_id": 7,
  "display_username": "Anthony Towns",
  "primary_group_name": null,
  "flair_name": null,
  "flair_url": null,
  "flair_bg_color": null,
  "flair_color": null,
  "flair_group_id": null,
  "version": 1,
  "can_edit": false,
  "can_delete": false,
  "can_recover": false,
  "can_see_hidden_post": false,
  "can_wiki": false,
  "user_title": null,
  "bookmarked": false,
  "raw": "[quote=\"moonsettler, post:1, topic:1216\"]\nThe idea is that the number of SHA256 iterations should be minimized in the most likely use case we can optimize for, which is LN-Symmetry.\n[/quote]\n\nNot really seeing that as particularly important to minimise, personally; the difference between hashing 64 bytes and 256 bytes is pretty minor, compared to the checksig operation(s) you also have. I'd just write `[BAL] [CTVHASH] SHA256 SWAP SHA256 CAT SHA256`.\n\n[quote=\"moonsettler, post:1, topic:1216\"]\nIn case of a 7 byte balance commitment + 32 byte CTV hash (no HTLCs in-flight), the total preimage size is 55 bytes. Which should make it fit into a single block with the SHA256 length commitment.\n[/quote]\n\n[quote=\"moonsettler, post:1, topic:1216\"]\nIt\u2019s a particular concern for LN-Symmetry with CTV that the concatenation of the two preimages allows for length redistribution attacks, because CTV is only defined for 32 byte templates and will act as NOP for different template sizes for upgradeability.\n[/quote]\n\nThis seems as much an argument against doing upgradeability that way as anything else; but if you do want that, and want to minimise hashing as well for whatever reason, then writing `[BAL] [CTVHASH] SIZE 32 EQUALVERIFY CAT SHA256` seems like it would solve the problem.\n\nIf you want to support CTV upgradeability prior to knowing what that upgradeability will do, you could do `[BAL] [CTVHASH] SIZE DUP VERIFY DUP 127 LESSTHANOREQUAL VERIFY SWAP CAT SWAP CAT SHA256` to construct `sha256(1B: <size(CTVHASH)>; 0B-127B: <CTVHASH>; <BAL>)`. (Having CTV error if the hash is 0 bytes would let you avoid the `DUP VERIFY` step and might be a reasonable update to the BIP)",
  "actions_summary": [
    {
      "id": 2,
      "count": 1
    }
  ],
  "moderator": true,
  "admin": true,
  "staff": true,
  "user_id": 3,
  "hidden": false,
  "trust_level": 4,
  "deleted_at": null,
  "user_deleted": false,
  "edit_reason": null,
  "can_view_edit_history": true,
  "wiki": false,
  "reactions": [
    {
      "id": "heart",
      "type": "emoji",
      "count": 1
    }
  ],
  "current_user_reaction": null,
  "reaction_users_count": 1,
  "current_user_used_main_reaction": false
}